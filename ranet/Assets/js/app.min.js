"use strict";!function(){var e=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},t=angular.module("sampleDynamicPivotGrid.controllers",[]);t.controller("busyIndicatorController",["$scope",function(e){e.visible=!1,e.$parent&&(e.visible=!e.$parent.isShowContent),e.$on("onChangeStateLoadPanel",function(t,n){e.visible=n.visible,e.visible&&(e.message=n.message)})}]),t.controller("sampleDynamicPivotGridController",["$scope","$translate","$uibModal","$log","$rootScope","reportsStorageProvider","messageService","appConfig","exportService","pagesStorageProvider","splitWordsFilter",function(t,n,o,r,i,a,c,s,l,u,d,p){function m(e){t.currentPage=e,t.referenceDynamicPivotGrid.setPage(e.id)}function g(e){void 0!==t.reportDescription&&t.referenceDynamicPivotGrid.destroy(),t.reportDescription=e,t.referenceDynamicPivotGrid.init(e.content,t.connection),m(e.content.pages[e.content.pages.length-1])}function f(t,o){i.$broadcast("onChangeStateLoadPanel",{visible:!0,message:n.instant("LoadPanel_GetReport")}),a.getReport(t,o).success(function(e){Ranet.UserActionsTracker.track("Load the report from the repository",{caption:e.caption,id:e.id,isPublic:e.isPublic}),g(e),i.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(o){i.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(o),Ranet.UserMessageService.showError(e.call(n.instant("LoadReportViewer_LoadingReportError"),t.caption))})}function C(e){t.reportDescription.content.pages.push(e),m(e)}function v(o){i.$broadcast("onChangeStateLoadPanel",{visible:!0,message:n.instant("LoadPanel_GetReport")}),u.getEntry(o).success(function(e){var n=t.referenceDynamicPivotGrid.descriptionCurrentPage.page.id;t.referenceDynamicPivotGrid.deletePage(t.referenceDynamicPivotGrid.descriptionCurrentPage.page),e.content.id=n;var o=P(e.content);o||(o=e.content),C(o),i.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(t){i.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(t),Ranet.UserMessageService.showError(e.call(n.instant("LoadReportViewer_LoadingReportError"),o.caption))})}function b(e){var n=e.historyManager;t.$evalAsync(function(){t.isEnabledGoToStart=n.canGoToStart,t.isEnabledGoToBack=n.canGoToBack,t.isEnabledGoToNext=n.canGoToNext,t.isEnabledGoToEnd=n.canGoToEnd})}function h(e,n){t.$evalAsync(function(){t.hasLocalChanges=e,t.hasServerChanges=n})}function y(e,n){if(n){var o=n.view;o.onHistoryChangedCallback=b,o.onStateUpdateStorageChangedCallback=h,t.showMetadataAndQueryDesigner=o.showMetadataAndQueryDesigner,t.isVisibleActiveFilters=o.isVisibleActiveFilters,t.chartType=t.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.chartOptions.defaultDiagramType,t.isVisibleChart=!!t.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer,t.autogenerateSeries=t.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.chartOptions.autogenerate,b(o)}}function S(){var e=function(){for(var e={},t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(void 0===e[o[0]])e[o[0]]=decodeURIComponent(o[1]);else if("string"==typeof e[o[0]]){var r=[e[o[0]],decodeURIComponent(o[1])];e[o[0]]=r}else e[o[0]].push(decodeURIComponent(o[1]))}return e}(),t=e.ranetreportid,n=e.ranetispublic;void 0!==t&&void 0!==n&&f({id:t,isPublic:n})}Ranet.UserActionsTracker.track("Application initialization"),t.connection=s.defaultConnection,t.isShowContent=!0,t.autoExecuteMdxQuery=!0,t.showMetadataAndQueryDesigner=!0,t.isVisibleActiveFilters=!1,t.chartTypes=["DiagramType_Line","DiagramType_Area","DiagramType_Bar","DiagramType_StackedArea","DiagramType_StackedBar"],t.pathResource=s.resourcePath,t.pathTemplates=t.pathResource+"templates/",t.applicationUrl=s.applicationUrl,t.hiddenToolbarButtons=["exportLayoutButton","importLayoutButton","exportToExcelButton","exportToXmlButton","layoutDesignerSelectorDropdown"],t.getWords=function(e){return n.instant(e).split(" ")};var P=function(e){return e},w=function(e){return null};t.toggleRotateAxes=function(){var e=t.referenceDynamicPivotGrid.descriptionCurrentPage.view;e.rotateAxes=!e.rotateAxes,Ranet.UserActionsTracker.track("ToolBar. Click a button 'RotateAxes'.",{value:t.rotateAxes})},t.toggleShowMetadataAndQueryDesigner=function(){t.showMetadataAndQueryDesigner=!t.showMetadataAndQueryDesigner,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.showMetadataAndQueryDesigner=t.showMetadataAndQueryDesigner,Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowOrHideQueryDesignerPanel'.",{value:t.showMetadataAndQueryDesigner})},t.changeLayoutQueryDesigner=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ChangeLayoutQueryDesigner' (MetaDataTree, QueryDesigner, DataViewPanel).",{value:e}),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeQueryDesigner=e},t.changeChartType=function(e){Ranet.UserActionsTracker.track("ToolBar. Change a type of diagram.",{value:e});var n={chartOptions:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.chartOptions};n.chartOptions.defaultDiagramType=e,t.chartType=e,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.chartOptions=n.chartOptions},t.historyReportGoTo=function(e){Ranet.UserActionsTracker.track("ToolBar. History navigation.",{value:e}),"start"!==e?"back"!==e?"next"!==e?"end"!==e||t.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToEnd():t.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToNext():t.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToBack():t.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToStart()},t.onCreateRefControl=function(e){t.referenceDynamicPivotGrid=e,t.referenceDynamicPivotGrid.onPageChangedCallback=y},t.setPage=function(e){m(e),Ranet.UserActionsTracker.track("Open another page report",{captionPage:e.caption,captionReport:t.reportDescription.caption,idReport:t.reportDescription.id})},t.editPage=function(e){var n=angular.element(".dynamicPivotGrid");o.open({appendTo:n,templateUrl:s.resourcePath+"templates/editPage.html",controller:"editPageController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{page:e,windowTitle:"Edit page",otherPages:t.reportDescription.content.pages,isEnabledEditCube:!1}}}}).result.then(function(t){e.caption=t.caption},function(){})},t.deletePage=function(o,r){c.showQuestion(n.instant("Warning"),e.call(n.instant("MdxDesigner_ConfirmCloseQuery"),o.caption),function(){t.referenceDynamicPivotGrid.deletePage(o),t.referenceDynamicPivotGrid.descriptionCurrentPage?t.currentPage=t.referenceDynamicPivotGrid.descriptionCurrentPage.page:t.currentPage=void 0,r&&r(!0)},function(){r&&r(!1)})},t.addNewPageInReport=function(){var e={};e.cubeName=t.currentPage.cubeName,e.id=Ranet.Utility.Guid.newGuid(),e.caption="",e.queryDesignerSetting={},e.queryDesignerSetting.hideEmptyColumns=!0,e.queryDesignerSetting.hideEmptyRows=!0,e.queryDesignerSetting.includeAllMembers=!1,e.queryDesignerSetting.includeCustomCalculationsInDrillDown=!1,e.queryDesignerSetting.subsetCount=0,e.queryDesignerSetting.useVisualTotals=!0,e.queryDesignerSetting.generateCustomCalculated=!1;var n=angular.element(".dynamicPivotGrid");o.open({appendTo:n,templateUrl:s.resourcePath+"templates/editPage.html",controller:"editPageController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{page:e,windowTitle:"Add new page",otherPages:t.reportDescription.content.pages,isEnabledEditCube:!0,connection:t.connection}}}}).result.then(function(n){e.caption=n.caption,e.cubeName=n.cubeName,C(e),Ranet.UserActionsTracker.track("Add a new page in the report",{captionPage:e.caption,idReport:t.reportDescription.id,captionReport:t.reportDescription.caption})},function(){})},t.reset=function(){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ResetState'."),c.showQuestion(n.instant("Warning"),n.instant("Reset_Question"),function(){t.referenceDynamicPivotGrid.descriptionCurrentPage.view.reset()},function(){})},t.removeAllActions=function(){Ranet.UserActionsTracker.track("ToolBar. Click a button 'RemoveAllActions'."),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.removeAllActions()},t.openReport=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/openReport.html",controller:"openEntryController",size:"lg",backdrop:"static",scope:!1,resolve:{args:function(){return{storageProvider:a,filterKey:null}}}}).result.then(function(e){f(e,t.connection)},function(){})},t.saveReport=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/saveReport.html",controller:"saveEntryController",backdrop:"static",size:"lg",resolve:{args:function(){return{entry:{},defaultCaption:t.reportDescription.caption,storageProvider:a,filterKey:null,onBeforeSavingEntryCallback:function(e){e.content=t.referenceDynamicPivotGrid.report}}}}}).result.then(function(e){t.reportDescription.id=e.id,t.reportDescription.isPublic=e.isPublic},function(){})},t.showMdxQuery=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowMdx'.");var n=angular.element(".dynamicPivotGrid");o.open({appendTo:n,templateUrl:s.resourcePath+"templates/queryViewer.html",controller:"showMdxQueryController",backdrop:"static",size:e,resolve:{args:function(){return{query:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentMdxQuery,initialQuery:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.initialQuery,useQueryAsDataSource:1===t.referenceDynamicPivotGrid.descriptionCurrentPage.view.initialSourceType,updateScriptTemplate:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentUpdateScriptTemplate,useCustomUpdateScriptTemplate:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.useCustomUpdateScriptTemplate}}}}).result.then(function(e){t.referenceDynamicPivotGrid.descriptionCurrentPage.view.useCustomUpdateScriptTemplate=e.useCustomUpdateScriptTemplate,e.useCustomUpdateScriptTemplate&&(t.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentUpdateScriptTemplate=e.updateScriptTemplate),e.useQueryAsDataSource?t.referenceDynamicPivotGrid.descriptionCurrentPage.view.setUpInitialQuery(e.query):1===t.referenceDynamicPivotGrid.descriptionCurrentPage.view.initialSourceType&&t.referenceDynamicPivotGrid.descriptionCurrentPage.view.setUpInitialCurrentState()},function(){})},t.openWindowEditSettings=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowSettings'.");var n=angular.element(".dynamicPivotGrid");o.open({appendTo:n,templateUrl:s.resourcePath+"templates/editQueryDesignerSettings.html",controller:"editQueryDesignerSettingsController",backdrop:"static",size:e,resolve:{queryDesignerSetting:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.queryDesignerSetting},loadStateFromHistory:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.loadStateFromHistory}}}).result.then(function(e){t.referenceDynamicPivotGrid.descriptionCurrentPage.view.queryDesignerSetting=e.setting,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.loadStateFromHistory=e.loadStateFromHistory},function(){})},t.openWindowEditConnection=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'OpenConnectionEditor'.");var n=angular.element(".dynamicPivotGrid");o.open({appendTo:n,templateUrl:s.resourcePath+"templates/editCurrentConnection.html",controller:"editCurrentConnectionController",backdrop:"static",size:e,resolve:{currentConnection:function(){return t.connection}}}).result.then(function(e){t.connection=e},function(){})},t.createNewReport=function(){var e=angular.element(".dynamicPivotGrid");o.open({templateUrl:s.resourcePath+"templates/newReport.html",appendTo:e,controller:"createNewReportController",backdrop:"static",size:"sm",resolve:{connection:function(){return t.connection}}}).result.then(function(e){g(e),Ranet.UserActionsTracker.track("Create new report")},function(){})},t.showCustomCalculationsEditor=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/customCalculationsEditor.html",controller:"customCalculationsEditorController",backdrop:"static",size:"lg",resolve:{calculatedMembers:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems.calculatedMembers},calculatedNamedSets:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems.calculatedNamedSets},cubeMetaData:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeMetaData},connection:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.connection},cubeName:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeName}}}).result.then(function(e){t.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems={calculatedMembers:e.customMembers,calculatedNamedSets:e.customSet},t.referenceDynamicPivotGrid.descriptionCurrentPage.view.updateData()},function(){})},t.showCellConditionsDesigner=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/cellConditionsDesigner.html",controller:"cellConditionsDesignerController",backdrop:"static",size:"lg",resolve:{cubeExplorerOptions:function(){return{cubeMetaData:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeMetaData,connection:t.connection,cubeName:t.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeName}},customCellsConditions:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCellsConditions}}}).result.then(function(e){t.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCellsConditions=e.styleDescriptors},function(){})},t.export=function(e){var r=t.referenceDynamicPivotGrid.descriptionCurrentPage.page.caption,a=t.referenceDynamicPivotGrid.descriptionCurrentPage.view.descriptionActiveFilters,c=t.referenceDynamicPivotGrid.descriptionCurrentPage.view.headerText,u=t.referenceDynamicPivotGrid.descriptionCurrentPage.view.footerText,d=s.applicationUrl+"api/export/download/",p=void 0,m=n.instant("Command_Export_Group");if(0===e)i.$broadcast("onChangeStateLoadPanel",{visible:!0,message:m}),p="Excel",l.toExcel(r,a,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentDataSource,c,u).success(function(e){var t=d+e;i.$broadcast("onChangeStateLoadPanel",{visible:!1}),window.location=t}).error(function(e){i.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Export to Excel - error. See log.")});else if(1===e)i.$broadcast("onChangeStateLoadPanel",{visible:!0,message:m}),p="Xml",l.toXml(r,a,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentDataSource,c,u).success(function(e){var t=d+e;i.$broadcast("onChangeStateLoadPanel",{visible:!1}),window.location=t}).error(function(e){i.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Export to Xml - error. See log.")});else if(2===e){p="Url";o.open({appendTo:angular.element(".dynamicPivotGrid"),templateUrl:s.resourcePath+"templates/urlViewer.html",controller:"exportToUrlController",backdrop:"static",size:"lg",resolve:{args:{reportId:t.reportDescription.id,isPublic:t.reportDescription.isPublic}}})}Ranet.UserActionsTracker.track("Export",{type:p})},t.toggleVisibilityActiveFilters=function(){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowOrHideActiveFilters'.",{value:!t.isVisibleActiveFilters}),t.isVisibleActiveFilters=!t.isVisibleActiveFilters,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.isVisibleActiveFilters=t.isVisibleActiveFilters},t.isVisibleInToolbar=function(e){switch(e){case"":default:return-1===t.hiddenToolbarButtons.indexOf(e)}},t.editExtension=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/editExtension.html",controller:"editExtensionController",backdrop:"static",size:"lg",resolve:{extensionSettings:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings},layoutMode:function(){return t.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer}}}).result.then(function(e){var n=e.extensionSettings,o=e.layoutMode;t.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings=n,t.autogenerateSeries=n.chartOptions.autogenerate,t.chartType=n.chartOptions.defaultDiagramType,t.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer!==o&&(Ranet.UserActionsTracker.track("ToolBar. Change a layout of dataViewer.",{value:o}),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer=o,t.isVisibleChart=!!o)},function(){})},t.openNewPage=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/openReport.html",controller:"openEntryController",size:"lg",backdrop:"static",resolve:{args:function(){return{storageProvider:u,filterKey:w(t.referenceDynamicPivotGrid.descriptionCurrentPage.page)}}}}).result.then(function(e){v(e)},function(){})},t.saveCurrentPage=function(){var e=angular.element(".dynamicPivotGrid");o.open({appendTo:e,templateUrl:s.resourcePath+"templates/saveReport.html",controller:"saveEntryController",backdrop:"static",size:"lg",resolve:{args:function(){return{entry:{},defaultCaption:"",storageProvider:u,onBeforeSavingEntryCallback:function(e){var n=t.referenceDynamicPivotGrid.descriptionCurrentPage;n.page.caption=e.caption,e.content=n.page},filterKey:w(t.referenceDynamicPivotGrid.descriptionCurrentPage.page)}}}}).result.then(function(){},function(){})},t.hasLocalChanges=!1,t.hasServerChanges=!1,t.toggleIsEnabledWhatIfAnalysis=function(){var e=!t.referenceDynamicPivotGrid.descriptionCurrentPage.view.isEnabledWhatIfAnalysis;e?Ranet.UserActionsTracker.track("What if Analysis is activated."):Ranet.UserActionsTracker.track("What if Analysis is unactivated."),!1===e&&(t.referenceDynamicPivotGrid.descriptionCurrentPage.view.useChangesCache=!1),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.isEnabledWhatIfAnalysis=e},t.toggleUseChangesCache=function(){var e=!t.referenceDynamicPivotGrid.descriptionCurrentPage.view.useChangesCache;e?Ranet.UserActionsTracker.track("What if Analasis. Use changes cache."):Ranet.UserActionsTracker.track("What if Analasis. Don't use changes cache."),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.useChangesCache=e},t.recalculate=function(){Ranet.UserActionsTracker.track("What if Analasis. Recalculate."),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.recalculate()},t.save=function(){Ranet.UserActionsTracker.track("What if Analasis. Commit transaction."),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.save()},t.rollback=function(){Ranet.UserActionsTracker.track("What if Analasis. Rollback transaction."),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.rollback()},t.clearLocalChanges=function(){Ranet.UserActionsTracker.track("What if Analasis. Clear local changes."),t.referenceDynamicPivotGrid.descriptionCurrentPage.view.clearLocalChanges()},t.$on("openNewReportApiEvent",function(e,t){g(t)}),t.$on("addNewPageApiEvent",function(e,n){var o=n.page;if(0!==t.reportDescription.content.pages.filter(function(e){return e.id===o.id}).length)throw new Error("We already have this page.");C(o)}),t.$on("changeOnPageImportingApiEvent",function(e,t){if("function"!=typeof t.onPageImporting)throw new Error("onPageImporting must be a function.");P=t.onPageImporting}),t.$on("changeOnGetFilterKeyApiEvent",function(e,t){if("function"!=typeof t.onGetFilterKey)throw new Error("onGetFilterKey must be a function.");w=t.onGetFilterKey}),t.$on("deletePageApiEvent",function(e,n){var o=t.reportDescription.content.pages.filter(function(e){return e.id===n.id})[0];if(!o)throw new Error("We didn't find a page with id '"+n.id+"'.");t.deletePage(o,n.deleteCallback)}),t.$on("changeConnectionApiEvent",function(e,n){t.connection=n.connection}),t.$on("changeToolBarOptionsApiEvent",function(e,n){n.buttons.forEach(function(e){!1===e.isVisible?t.hiddenToolbarButtons.push(e.name):!0===e.isVisible&&-1!==t.hiddenToolbarButtons.indexOf(e.name)&&t.hiddenToolbarButtons.splice(t.hiddenToolbarButtons.indexOf(e.name),1)}),t.$apply()}),t.$on("setSelectedPageApiEvent",function(e,n){var o=t.reportDescription.content.pages.filter(function(e){return e.id===n.idPage});if(0===o.length)throw new Error("We didn't find a page with id '"+n.idPage+"'.");m(o[0])}),!1===n.isReady()?(t.isShowContent=!1,i.$broadcast("onChangeStateLoadPanel",{visible:!0}),i.$on("$translateChangeSuccess",function(){i.$broadcast("onChangeStateLoadPanel",{visible:!1}),t.isShowContent=!0,S()})):S()}]),t.controller("cellConditionsDesignerController",["$scope","$uibModalInstance","$translate","cubeExplorerOptions","customCellsConditions","messageService",function(e,t,n,o,r,i){function a(t){e.currentDescriptor=t}function c(t){e.currentCondition=t}function s(){e.openGroups={options:!1,appearance:!1,imageEditor:!1}}function l(e,t,n){var o=0,r="";do{r=e+" "+o,o++}while(t.filter(function(e){return e[n]===this.currentName},{currentName:r}).length>0);return r}Ranet.UserActionsTracker.track("Open editor of cell conditions."),e.uniqueName="",e.isVisibleSecondTextBox=!1,e.textMemberUniqueName="",e.typeConditions=[{caption:n.instant("ComboBoxItem_None"),type:Ranet.Controls.CellConditionType.None,imageClass:""},{caption:n.instant("ValueFilter_Equal"),type:Ranet.Controls.CellConditionType.Equal,imageClass:"imageLibrary_fcopequal"},{caption:n.instant("ValueFilter_NotEqual"),type:Ranet.Controls.CellConditionType.NotEqual,imageClass:"imageLibrary_fcopnotequal"},{caption:n.instant("ValueFilter_Greater"),type:Ranet.Controls.CellConditionType.Greater,imageClass:"imageLibrary_fcopgreater"},{caption:n.instant("ValueFilter_GreaterOrEqual"),type:Ranet.Controls.CellConditionType.GreaterOrEqual,imageClass:"imageLibrary_fcopgreaterorequal"},{caption:n.instant("ValueFilter_Less"),type:Ranet.Controls.CellConditionType.Less,imageClass:"imageLibrary_fcopless"},{caption:n.instant("ValueFilter_LessOrEqual"),type:Ranet.Controls.CellConditionType.LessOrEqual,imageClass:"imageLibrary_fcoplessorequal"},{caption:n.instant("ValueFilter_Between"),type:Ranet.Controls.CellConditionType.Between,imageClass:"imageLibrary_fcopbetween"},{caption:n.instant("ValueFilter_BetweenNotIncluding"),type:Ranet.Controls.CellConditionType.BetweenNotIncluding,imageClass:"imageLibrary_fcopbetweennotincluding"},{caption:n.instant("ValueFilter_NotBetween"),type:Ranet.Controls.CellConditionType.NotBetween,imageClass:"imageLibrary_fcopnotbetween"},{caption:n.instant("ValueFilter_NotBetweenNotIncluding"),type:Ranet.Controls.CellConditionType.NotBetweenNotIncluding,imageClass:"imageLibrary_fcopnotbetweennotincluding"}];var u=Ranet.Utility.ImageStorage.getImages(),d={caption:n.instant("Color_None"),imageClass:""};u.splice(0,0,d),e.imageDescriptions=u;var p=Ranet.Utility.ColorHelper.getColors(),m={caption:n.instant("Color_None"),color:"rgba(255,255,255,0)",a:0,r:255,g:255,b:255};p.splice(0,0,m),e.setColors=p,e.currentTypeCondition=e.typeConditions[0],e.connection=o.connection,e.cubeName=o.cubeName,e.cubeMetaData=o.cubeMetaData,e.arrayDescriptors=function(e){var t=JSON.stringify(e);return JSON.parse(t)}(r),e.openGroups={options:!1,appearance:!1,imageEditor:!1},s(),e.$watch("currentDescriptor",function(t){e.textMemberUniqueName=t?t.memberUniqueName:"",e.currentCondition=void 0,e.currentTypeCondition=e.typeConditions[0]}),e.$watch("currentCondition",function(t){if(!t)return s(),void(e.currentTypeCondition=e.typeConditions[0]);var n=t.conditionType;e.currentTypeCondition=e.typeConditions.filter(function(e){return e.type===n})[0]}),e.$watch("currentTypeCondition",function(t){switch(t.type){case Ranet.Controls.CellConditionType.Equal:case Ranet.Controls.CellConditionType.NotEqual:case Ranet.Controls.CellConditionType.Greater:case Ranet.Controls.CellConditionType.GreaterOrEqual:case Ranet.Controls.CellConditionType.Less:case Ranet.Controls.CellConditionType.LessOrEqual:case Ranet.Controls.CellConditionType.None:e.isVisibleSecondTextBox=!1;break;default:e.isVisibleSecondTextBox=!0}}),e.getCaptionCondition=function(t){var o=e.typeConditions.filter(function(e){return e.type===t.conditionType})[0],r="";switch(o.type){case Ranet.Controls.CellConditionType.None:r=o.caption;break;case Ranet.Controls.CellConditionType.Equal:case Ranet.Controls.CellConditionType.NotEqual:case Ranet.Controls.CellConditionType.Greater:case Ranet.Controls.CellConditionType.GreaterOrEqual:case Ranet.Controls.CellConditionType.Less:case Ranet.Controls.CellConditionType.LessOrEqual:r=o.caption,r+=" ",r+=t.value1;break;default:r=o.caption,r+=" ",r+=t.value1,r+=" "+n.instant("Filter_Label_And")+" ",r+=t.value2}return r},e.onMemberUniqueChanged=function(){e.textMemberUniqueName?e.currentDescriptor.memberUniqueName=e.textMemberUniqueName:e.textMemberUniqueName=e.currentDescriptor.memberUniqueName},e.addNewStyleDescriptor=function(){var t=new Ranet.Controls.CellConditionsDescriptor(l(n.instant("CellConditionDescr_NewStyle"),e.arrayDescriptors,"memberUniqueName"));e.arrayDescriptors.push(t),a(t)},e.deleteSelectedDescriptor=function(){i.showQuestion(n.instant("Warning"),n.instant("DeleteCurrent_Question"),function(){e.arrayDescriptors.splice(e.arrayDescriptors.indexOf(e.currentDescriptor),1),a(void 0)},function(){})},e.deleteAllDescriptors=function(){i.showQuestion(n.instant("Warning"),n.instant("DeleteAll_Question"),function(){e.arrayDescriptors.length=0,a(void 0)},function(){})},e.setCurrentDescriptor=function(e){a(e)},e.addCondition=function(){var t=new Ranet.Controls.CellCondition;e.currentDescriptor.conditions.push(t),c(t)},e.deleteCurrentCondition=function(){i.showQuestion(n.instant("Warning"),n.instant("DeleteCurrent_Question"),function(){e.currentDescriptor.conditions.splice(e.currentDescriptor.conditions.indexOf(e.currentCondition),1),c(void 0)},function(){})},e.deleteAllConditions=function(){i.showQuestion(n.instant("Warning"),n.instant("DeleteAll_Question"),function(){e.currentDescriptor.conditions.length=0,c(void 0)},function(){})},e.setCondition=function(e){c(e)},e.setTypeCondition=function(t){e.currentTypeCondition=t,e.currentCondition.conditionType=t.type},e.getBackColorDescription=function(){if(!e.currentCondition)return"";var t=e.currentCondition.appearance.backColor;return t?p.filter(function(e){return e.argbText===t})[0]:p[0]},e.getForeColorDescription=function(){if(!e.currentCondition)return"";var t=e.currentCondition.appearance.foreColor;return t?p.filter(function(e){return e.argbText===t})[0]:p[0]},e.setBackgroundCondition=function(t){e.currentCondition.appearance.backColor=t.argbText},e.setForecolorCondition=function(t){e.currentCondition.appearance.foreColor=t.argbText},e.getImageDescription=function(){if(!e.currentCondition)return"";var t=e.currentCondition.appearance.cssClassImage;return t?e.imageDescriptions.filter(function(e){return e.imageClass===t})[0]:e.imageDescriptions[0]},e.setImageCondition=function(t){e.currentCondition.appearance.cssClassImage=t.imageClass},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){Ranet.UserActionsTracker.track("Change cell conditions."),t.close({styleDescriptors:e.arrayDescriptors})}}]),t.controller("saveEntryController",["$translate","$scope","$rootScope","$uibModalInstance","$uibModal","messageService","appConfig","args",function(e,t,n,o,r,i,a,c){function s(e){function t(e,t){return e.toString()<t.toString()?-1:e.toString()>t.toString()?1:0}return e.sort(function(e,n){if("report"===e.type&&"folder"===n.type)return 1;if("report"===n.type&&"folder"===e.type)return-1;var o=e.index,r=n.index;if(null!==o&&0===o.length&&(o=null),null!==r&&0===r.length&&(r=null),null!=r&&null==o)return 1;if(null!=o&&null==r)return-1;if(null!=o&&null!=r){var i=t(o,r);return 0===i?t(e.caption,n.caption):i}return t(e.caption,n.caption)})}function l(e,t){for(var n=0;n<e.items.length;n++){if(e.items[n].id===t)return e.items[n];if(e.items[n].items&&e.items[n].items.length>0){var o=l(e.items[n],t);if(null!=o)return o}}return null}function u(e){var n=e.id,o=e.isPublic?t.treeFoldersLookupDataSource[0]:t.treeFoldersLookupDataSource[1];if(null!==n){var r=l(o,n);t.lookupSelected=[r]}else t.lookupSelected=[o]}function d(e){var t=JSON.stringify(e);return JSON.parse(t)}function p(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];"folder"===o.type&&(o.isOpen=!0,t.push(o),o.items.length>0&&(o.items=p(o.items)))}return t}function m(){if(R=f(t.datasource[0],0),A=f(t.datasource[1],0),h){var e=h.isPublic?t.datasource[0]:t.datasource[1];(null===h.id?e:l(e,h.id)).isSelected=!0}t.treeViewFacade.repaintTreeView();var n=p(d(t.datasource));t.treeFoldersLookupDataSource=n,t.lookupSelected=[t.treeFoldersLookupDataSource[0]]}function g(){t.disableAddFolderButton=!0,t.disableDeleteButton=!0,t.disableEditButton=!0}function f(e,t){var n=[];e.levelDepth=t,n.push(e);for(var o=0;o<e.items.length;o++){var r=e.items[o];if("folder"===r.type){var i=f(r,t+1);n=n.concat(i)}}return n}function C(){g(),n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:w}),k.getDescriptionStorage(T).success(function(e){t.datasource=e,m(),n.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error loading reports. See log.")})}function v(){E.parentId=I.id,E.caption=t.caption,E.isPublic=I.isPublic,E.description=t.description,E.filterKey=T,E.index=t.index,M(E),k.saveEntry(E).error(function(e){Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error save report. Please see server log for more details.")}),o.close(E)}function b(e,n,o){var i=angular.element(".dynamicPivotGrid");r.open({appendTo:i,templateUrl:a.resourcePath+"templates/editFolder.html",controller:"editFolderController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{folder:e,otherFolders:n,storageProvider:k}}}}).result.then(function(){h={id:e.id,isPublic:e.isPublic};var n=e.isPublic?t.datasource[0]:t.datasource[1],r=null;if(null===(r=null!==e.parentId?l(n,e.parentId):n))throw new Error("InvalidOperationException");o&&r.items.push(e),r.items=s(r.items),m(),Ranet.UserActionsTracker.track("Update folder in reports",{id:e.id,caption:e.caption})},function(){})}var h,y=e.instant("ObjectSaveDialog_NameIsEmpty_Message"),S=e.instant("ObjectSaveDialog_AlreadyExist_Message"),P=e.instant("Warning"),w=e.instant("LoadPanel_GetReports"),x=e.instant("LoadPanel_DeleteFolder"),D=e.instant("LoadPanel_DeleteReport"),T=c.filterKey,E=c.entry,k=c.storageProvider,M=c.onBeforeSavingEntryCallback,R=[],A=[],I={};t.saveReport=function(){k.convertReportToXmlFile(t.selectedItem).success(function(e){var n=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(n,t.selectedItem.caption+".xml")}).error(function(e){Ranet.LogService.error(e),Ranet.UserMessageService.showError("Some error. See log.")})},t.showLoadReportWindow=function(){var e=angular.element(".dynamicPivotGrid");r.open({appendTo:e,templateUrl:a.resourcePath+"templates/loadReportFromPC.html",controller:"loadReportFromPcController",size:"sm",backdrop:"static",scope:!1,resolve:{args:function(){return{tree:angular.copy(t.datasource)}}}}).result.then(function(e){k.convertXmlFileToReport(e.fileContent,e.folder).success(function(e){C()}).error(function(e){Ranet.LogService.error(e),Ranet.UserMessageService.showError("Some error. See log.")})},function(){})},t.lookupSelected=[],t.treeViewFacade={},t.selectedItem=void 0,t.caption=c.defaultCaption,t.index="",t.searchTreeViewOptions={isVisibleSearch:!0},t.lookupOptions={messages:{noDataMessage:e.instant("Lookup_NotFindElements"),placeholderMessage:e.instant("ComboBoxItem_None"),prefixMultiSelectionField:" "+e.instant("Lookup_PrefixSelectedItems")},iconExpr:"icon",iconExpandedExpr:"iconExpanded",expandedExpr:"isOpen",selectedExpr:"isSelected",dataSource:[],displayExpr:"caption",isVisibleSearchPanel:!1,onSelectionChanged:function(e){var t=e.selectedItems;if(0!==t.length){var n=t[0];I={id:n.id,isPublic:n.isPublic}}}},t.addFolder=function(){var e=t.selectedItem.id,n=t.selectedItem.items.filter(function(e){return"folder"===e.type});b({id:Ranet.Utility.Guid.newGuid(),caption:"",parentId:e,isPublic:t.selectedItem.isPublic,filterKey:T,icon:"folder",iconExpanded:"folderOpen",index:null,type:"folder",isOpen:!0,levelDepth:t.selectedItem.levelDepth+1,items:[]},n,!0)},t.editItem=function(){var e,n=t.selectedItem,o=(e=n.isPublic?R:A).filter(function(e){return e.id===n.parentId})[0].items.filter(function(e){return"folder"===e.type&&e.id!==n.id});b(n,o,!1)},t.deleteItem=function(){i.showQuestion(e.instant("Warning"),e.instant("DeleteCurrent_Question"),function(){var e="",o=void 0;if("folder"===t.selectedItem.type?(e=x,o=k.deleteFolder(t.selectedItem),Ranet.UserActionsTracker.track("Delete folder",{id:t.selectedItem.id,caption:t.selectedItem.caption})):(e=D,o=k.deleteEntry(t.selectedItem),Ranet.UserActionsTracker.track("Delete report",{id:t.selectedItem.id,caption:t.selectedItem.caption})),!o)throw new Error("InvalidOperationException");n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:e}),o.success(function(){t.caption="",t.description="",n.$broadcast("onChangeStateLoadPanel",{visible:!1});var e=t.selectedItem.isPublic?t.datasource[0]:t.datasource[1];if(null!==t.selectedItem.parentId){var o=l(e,t.selectedItem.parentId);o.items.splice(o.items.indexOf(t.selectedItem),1)}else e.items.splice(e.items.indexOf(t.selectedItem),1);h={id:t.selectedItem.parentId,isPublic:t.selectedItem.isPublic},m()}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error deleting report. See log.")})},function(){})},t.onSelectedStorageItemChanged=function(e){if(t.selectedItem=e.data,t.disableAddFolderButton=!0,t.disableDeleteButton=!0,t.disableEditButton=!0,"folder"===e.data.type)t.caption="",t.description="",t.disableAddFolderButton=!1,t.index="",null!==t.selectedItem.id&&(t.disableEditButton=!1,0===t.selectedItem.items.length&&(t.disableDeleteButton=!1)),h={id:t.selectedItem.parentId,isPublic:t.selectedItem.isPublic},u(I={id:t.selectedItem.id,isPublic:t.selectedItem.isPublic});else{if("report"!==e.data.type&&"page"!==e.data.type)throw new Error("InvalidOperationException");t.disableDeleteButton=!1,t.caption=t.selectedItem.caption,t.index=t.selectedItem.index,t.description=t.selectedItem.description,u(I={id:t.selectedItem.parentId,isPublic:t.selectedItem.isPublic})}},t.save=function(){if(t.caption){var e,n=t.caption,o=(e=I.isPublic?R.filter(function(e){return e.id===I.id})[0]:A.filter(function(e){return e.id===I.id})[0]).items.filter(function(e){return"folder"!==e.type&&e.caption.toUpperCase()===n.toUpperCase()})[0];o?i.showQuestion(P,S,function(){E.id=o.id,v(),Ranet.UserActionsTracker.track("Save report",{overwrite:!0,id:E.id,caption:E.caption,isPublic:E.isPublic})},function(){}):(E.id=Ranet.Utility.Guid.newGuid(),v(),Ranet.UserActionsTracker.track("Save report",{overwrite:!1,id:E.id,caption:E.caption,isPublic:E.isPublic}))}else i.showInformation(P,y)},t.cancel=function(){o.dismiss("cancel")},C(),g()}]),t.controller("editFolderController",["$scope","$rootScope","$uibModalInstance","$translate","messageService","args",function(e,t,n,o,r,i){var a=o.instant("ObjectSaveDialog_NameIsEmpty_Message"),c=o.instant("EditFolderWindow_AlreadyExist"),s=o.instant("Warning"),l=o.instant("LoadPanel_SaveFolder"),u=i.storageProvider,d=i.folder;e.caption=d.caption,e.index=d.index,e.ok=function(){e.caption?i.otherFolders.filter(function(t){return t.caption.toUpperCase()===e.caption.toUpperCase()}).length>=1?r.showInformation(s,c):(d.caption=e.caption,d.index=e.index,t.$broadcast("onChangeStateLoadPanel",{visible:!0,message:l}),u.saveFolder(d).success(function(){t.$broadcast("onChangeStateLoadPanel",{visible:!1}),n.close(void 0)}).error(function(e){t.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Save folder - error. See log.")})):r.showInformation(s,a)},e.cancel=function(){n.dismiss("cancel")}}]),t.controller("editPageController",["$scope","$translate","$rootScope","$uibModalInstance","reportsStorageProvider","messageService","args",function(e,t,n,o,r,i,a){var c=t.instant("ObjectSaveDialog_NameIsEmpty_Message"),s=t.instant("EditPageWindow_WarningCubeNameIsEmpty"),l=t.instant("EditPageWindow_AlreadyExist"),u=t.instant("Warning"),d=a.page;e.windowTitle=a.windowTitle,e.caption=d.caption,e.cubeName=d.cubeName,e.isEnabledEditCube=a.isEnabledEditCube,a.hasOwnProperty("connection")&&(e.onCubeSelectedItemChanged=function(t){e.cubeName=t.name},e.connection=a.connection),e.ok=function(){e.caption?e.cubeName?a.otherPages.filter(function(t){return t.caption.toUpperCase()===e.caption.toUpperCase()})[0]?i.showInformation(u,l):o.close({caption:e.caption,cubeName:e.cubeName}):i.showInformation(u,s):i.showInformation(u,c)},e.cancel=function(){o.dismiss("cancel")}}]),t.controller("messageServiceController",["$scope","$uibModalInstance","args",function(e,t,n){e.message=n.message,e.caption=n.caption,e.isVisibleOkButton=n.isVisibleOkButton,e.isVisibleCancelButton=n.isVisibleCancelButton,e.contentOkButton=n.contentOkButton,e.contentCancelButton=n.contentCancelButton,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]),t.controller("customCalculationsEditorController",["$scope","$rootScope","$uibModalInstance","$translate","calculatedMembers","calculatedNamedSets","cubeMetaData","connection","cubeName","messageService",function(e,t,n,o,r,i,a,c,s,l){function u(e){var t=e;return-1===e.indexOf("[")&&(t="["+t),e.lastIndexOf("]")!==e.length-1&&(t+="]"),t}function d(e){var t=JSON.stringify(e);return JSON.parse(t)}function p(e,t){for(var n,o=0;;){if(n="["+e+" "+o+"]",0===t.filter(function(e){return e.caption===this.newCaption},{newCaption:n}).length)return n;o++}}function m(e,t){return!!e&&0===t.filter(function(t){return t.caption===e}).length}function g(){e.dataCustomSetEditor={customCalculatedSetPropName:"",customCalculatedSetPropScript:""},e.dataCustomMemberEditor={customCalculatedMemberPropName:"",customCalculatedMemberPropExpression:"",customCalculatedMemberPropFormatString:o.instant("ComboBoxItem_None"),customCalculatedMemberPropBackgroundColor:D,customCalculatedMemberPropForeground:D,customCalculatedMemberPropNonEmptyBehaviors:[]}}function f(t){if(void 0===t||null===t)e.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors.length=0;else{for(var n=[],o=0;o<k.length;o++)-1!==t.indexOf(k[o].uniqueName)&&n.push(k[o]);e.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors=n}}function C(t){e.dataCustomSetEditor.customCalculatedSetPropName=t.caption,e.dataCustomSetEditor.customCalculatedSetPropScript=t.expression}function v(t){e.dataCustomMemberEditor.customCalculatedMemberPropName=t.caption,e.dataCustomMemberEditor.customCalculatedMemberPropExpression=t.expression,e.dataCustomMemberEditor.customCalculatedMemberPropFormatString=t.formatString?t.formatString:o.instant("ComboBoxItem_None"),f(t.nonEmptyBehaviors);var n;n=t.backgroundColor?x.filter(function(e){return e.a===t.backgroundColor.a&&e.r===t.backgroundColor.r&&e.g===t.backgroundColor.g&&e.b===t.backgroundColor.b})[0]:x[0],e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor={caption:n.caption,color:n.argbText},n=t.foreground?x.filter(function(e){return e.a===t.foreground.a&&e.r===t.foreground.r&&e.g===t.foreground.g&&e.b===t.foreground.b})[0]:x[0],e.dataCustomMemberEditor.customCalculatedMemberPropForeground={caption:n.caption,color:n.argbText}}Ranet.UserActionsTracker.track("Open the editor custom calculations",{countCustomMembers:r.length,countCustomSet:i.length}),e.connection=c,e.cubeName=s;var b=d(r),h=d(i);e.calculatedMembers=b,e.calculatedNamedSets=h,e.cubeMetaData=a,e.disableDeleteButton=!0,e.disableEditorCustomSetPanel=!1,e.disableEditorCustomMemberPanel=!0,e.showEditorCustomSetPanel=!1,e.showEditorCustomMemberPanel=!0;var y=function(e){var t=[];if(!e.length)return t;for(var n=0;n<e.length;n++){var o={id:Ranet.Utility.Guid.newGuid(),caption:e[n].name,expression:e[n].expression,icon:"customNamedSet",type:"customSet"};t.push(o)}return t}(e.calculatedNamedSets),S=function(e){var t=[];if(!e.length)return t;for(var n=0;n<e.length;n++){var o={id:Ranet.Utility.Guid.newGuid(),caption:e[n].name,expression:e[n].expression,icon:"customMeasure",type:"customMember",formatString:e[n].formatString};if(e[n].foreColor&&(o.foreground={a:e[n].foreColor.a,r:e[n].foreColor.r,g:e[n].foreColor.g,b:e[n].foreColor.b}),e[n].backColor&&(o.backgroundColor={a:e[n].backColor.a,r:e[n].backColor.r,g:e[n].backColor.g,b:e[n].backColor.b}),e[n].nonEmptyBehaviors){o.nonEmptyBehaviors=[];for(var r=0;r<e[n].nonEmptyBehaviors.length;r++){var i=e[n].nonEmptyBehaviors[r];o.nonEmptyBehaviors.push(i)}}t.push(o)}return t}(e.calculatedMembers),P={id:0,caption:o.instant("CalculationsListControl_CalculatedMembers_TreeNode"),iconExpanded:"folderOpen",isOpen:!0,icon:"folder",items:S},w={id:1,caption:o.instant("CalculationsListControl_NamedSets_TreeNode"),iconExpanded:"folderOpen",isOpen:!0,icon:"folder",items:y};e.datasource=[P,w];var x=Ranet.Utility.ColorHelper.getColors(),D={caption:o.instant("Color_None"),color:"rgba(255,255,255,0)",a:0,r:255,g:255,b:255};x.splice(0,0,D);var T=[o.instant("ComboBoxItem_None"),"#","#,#","#,#.00","$#,#;-$#,#;","$#,#.00;-$#,#.00;","Standard","Short Date","Short Time","Percent","Sparkline"];e.formatStrings=T,e.setColors=x,g();var E=Ranet.Controls.CubeExplorer.getPlainData(a.treeMetadata.filter(function(e){return"measuresRootNode"===e.type}),"id"),k=[];for(var M in E)if(E.hasOwnProperty(M)){var R=E[M];if(""!==R.expression)continue;k.push(R)}var A={};e.measureOptions={displayExpr:"caption",messages:{noDataMessage:o.instant("Lookup_NotFindElements"),placeholderMessage:o.instant("ComboBoxItem_None"),prefixMultiSelectionField:" "+o.instant("Lookup_PrefixSelectedItems")},dataSource:k,multiSelection:!0,onSelectionChanged:function(e){A.nonEmptyBehaviors=[];for(var t=0;t<e.selectedItems.length;t++){var n=e.selectedItems[t];A.nonEmptyBehaviors.push(n.uniqueName)}},itemTemplate:function(e){return"<div><div style='width:16px;display:inline-block;height:16px;' class='imageLibrary_"+e.icon+"'></div><div style='display: inline-block; margin-left:4px; vertical-align: top; overflow:hidden;'>"+e.caption+"</div></div>"},grouped:!1},e.onCustomCalculatedSetCaptionChanged=function(){for(var t,n=0;n<e.calculatedNamedSets.length;n++)e.calculatedNamedSets[n].name===A.caption&&(t=e.calculatedNamedSets[n]);m(e.dataCustomSetEditor.customCalculatedSetPropName,y)?A.caption=e.dataCustomSetEditor.customCalculatedSetPropName:e.dataCustomSetEditor.customCalculatedSetPropName=A.caption,t&&(t.name=A.caption)},e.onCustomCalculatedSetExpressionChanged=function(){A.expression=e.dataCustomSetEditor.customCalculatedSetPropScript},e.getBackgroundColorCustomMemberEditor=function(){return{background:e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color}},e.getForegroundCustomMemberEditor=function(){return{background:e.dataCustomMemberEditor.customCalculatedMemberPropForeground.color}},e.onCustomCalculatedMemberCaptionChanged=function(){for(var t,n=0;n<e.calculatedMembers.length;n++)e.calculatedMembers[n].name===A.caption&&(t=e.calculatedMembers[n]);m(e.dataCustomMemberEditor.customCalculatedMemberPropName,S)?A.caption=e.dataCustomMemberEditor.customCalculatedMemberPropName:e.dataCustomMemberEditor.customCalculatedMemberPropName=A.caption,t&&(t.name=A.caption)},e.onCustomCalculatedMemberExpressionChanged=function(){A.expression=e.dataCustomMemberEditor.customCalculatedMemberPropExpression},e.customcalculatedmemberformatstringselected=function(t){t===o.instant("ComboBoxItem_None")?A.formatString="":A.formatString=t,e.dataCustomMemberEditor.customCalculatedMemberPropFormatString=t},e.customcalculatedmemberforegroundselected=function(t){A.foreground={a:t.a,r:t.r,g:t.g,b:t.b},e.dataCustomMemberEditor.customCalculatedMemberPropForeground.caption=t.caption,e.dataCustomMemberEditor.customCalculatedMemberPropForeground.color=t.argbText},e.customcalculatedmemberbackgroundselected=function(t){A.backgroundColor={a:t.a,r:t.r,g:t.g,b:t.b},e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.caption=t.caption,e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color=t.argbText},e.deleteSelectedItem=function(){l.showQuestion(o.instant("Warning"),o.instant("DeleteCurrent_Question"),function(){var t;if("customMember"===A.type){Ranet.UserActionsTracker.track("Delete custom member",{caption:A.caption});for(var n=0;n<e.calculatedMembers.length;n++)e.calculatedMembers[n].name===A.caption&&(t=e.calculatedMembers[n]);Ranet.Utility.ArrayUtility.removeItem(S,A),Ranet.Utility.ArrayUtility.removeItem(e.calculatedMembers,t),A=P,P.isSelected=!0}else if("customSet"===A.type){Ranet.UserActionsTracker.track("Delete custom set",{caption:A.caption});for(var o=0;o<e.calculatedNamedSets.length;o++)e.calculatedNamedSets[o].name===A.caption&&(t=e.calculatedNamedSets[o]);Ranet.Utility.ArrayUtility.removeItem(y,A),Ranet.Utility.ArrayUtility.removeItem(e.calculatedNamedSets,t),A=w,w.isSelected=!0}},function(){})},e.addNewCustomMember=function(){Ranet.UserActionsTracker.track("Add new custom member");for(var t in S)S.hasOwnProperty(t)&&(S[t].isSelected=!1);for(var n in y)y.hasOwnProperty(n)&&(y[n].isSelected=!1);var o={id:Ranet.Utility.Guid.newGuid(),caption:p("Calculated Member",S),expression:"",icon:"customMeasure",type:"customMember",isSelected:!0};S.push(o),e.datasource[0].isSelected=!1,e.datasource[1].isSelected=!1,e.datasource[0].items=S,e.calculatedMembers.push({expression:"",forecolor:null,name:o.caption})},e.addNewCustomSet=function(){Ranet.UserActionsTracker.track("Add new custom set");for(var t in S)S.hasOwnProperty(t)&&(S[t].isSelected=!1);for(var n in y)y.hasOwnProperty(n)&&(y[n].isSelected=!1);var o={id:Ranet.Utility.Guid.newGuid(),caption:p("Set",y),icon:"customNamedSet",expression:"",type:"customSet",isSelected:!0};y.push(o),e.datasource[0].isSelected=!1,e.datasource[1].isSelected=!1,e.datasource[1].items=y,e.calculatedNamedSets.push({expression:"",forecolor:null,name:o.caption})},e.getScriptForCustomMember=function(){if(!e.dataCustomMemberEditor.customCalculatedMemberPropExpression)return"";var t=e.dataCustomMemberEditor.customCalculatedMemberPropExpression;e.dataCustomMemberEditor.customCalculatedMemberPropFormatString!==o.instant("ComboBoxItem_None")&&(t+=', FORMAT_STRING = "'+e.dataCustomMemberEditor.customCalculatedMemberPropFormatString+'"');var n;return e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color&&"rgba(255,255,255,0)"!==e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color&&(t+=", BACK_COLOR = Rgb("+(n=x.filter(function(t){return t.argbText===e.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color})[0]).r+","+n.g+","+n.b+")"),e.dataCustomMemberEditor.customCalculatedMemberPropForeground.color&&"rgba(255,255,255,0)"!==e.dataCustomMemberEditor.customCalculatedMemberPropForeground.color&&(t+=", FORE_COLOR = Rgb("+(n=x.filter(function(t){return t.argbText===e.dataCustomMemberEditor.customCalculatedMemberPropForeground.color})[0]).r+","+n.g+","+n.b+")"),e.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors.length>0&&(t+=", NON_EMPTY_BEHAVIOR = {"+e.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors.map(function(e){return e.uniqueName}).join(", ")+"}"),t},e.deleteAll=function(){l.showQuestion(o.instant("Warning"),o.instant("DeleteAll_Question"),function(){y.length=0,S.length=0,e.calculatedNamedSets.length=0,e.calculatedMembers.length=0,A=P,P.isSelected=!0},function(){})},e.onSelectedItemChanged=function(t){"customSet"===t.data.type||"customMember"===t.data.type?(e.showEditorCustomSetPanel=!1,e.showEditorCustomMemberPanel=!1,A.isSelected=!1,"customSet"===t.data.type&&(e.disableEditorCustomSetPanel=!1,e.showEditorCustomSetPanel=!0,C(A=y.filter(function(e){return e.id===t.data.id})[0])),"customMember"===t.data.type&&(e.disableEditorCustomMemberPanel=!1,e.showEditorCustomMemberPanel=!0,v(A=S.filter(function(e){return e.id===t.data.id})[0])),A.isSelected=!0,e.disableDeleteButton=!1):(e.disableEditorCustomSetPanel=!0,e.disableEditorCustomMemberPanel=!0,e.disableDeleteButton=!0,A.isSelected=!1,0===t.data.id?A=P:1===t.data.id&&(A=w),A.isSelected=!0,g())},e.cancel=function(){n.dismiss("cancel")},e.ok=function(){var e=[],t=[];S.forEach(function(t){var n={name:u(t.caption),expression:t.expression,formatString:t.formatString,nonEmptyBehaviors:t.nonEmptyBehaviors};t.backgroundColor&&(n.backColor={a:t.backgroundColor.a,r:t.backgroundColor.r,g:t.backgroundColor.g,b:t.backgroundColor.b}),t.foreground&&(n.foreColor={a:t.foreground.a,r:t.foreground.r,g:t.foreground.g,b:t.foreground.b}),e.push(n)}),y.forEach(function(e){t.push({name:u(e.caption),expression:e.expression})}),Ranet.UserActionsTracker.track("Update custom calculations",{countCustomMembers:e.length,countCustomSet:t.length}),n.close({customMembers:e,customSet:t})}}]),t.controller("showMdxQueryController",["$scope","$rootScope","$uibModalInstance","args",function(e,t,n,o){var r=o.updateScriptTemplate;e.vmUpdateScriptTemplate={useCustomUpdateScriptTemplate:o.useCustomUpdateScriptTemplate,updateScriptTemplate:r},e.initialQuery=o.initialQuery,e.vm={useQueryAsDataSource:o.useQueryAsDataSource,mdxQuery:o.query},e.ok=function(){n.close({query:e.vm.mdxQuery,useQueryAsDataSource:e.vm.useQueryAsDataSource,useCustomUpdateScriptTemplate:e.vmUpdateScriptTemplate.useCustomUpdateScriptTemplate,updateScriptTemplate:e.vmUpdateScriptTemplate.updateScriptTemplate})},e.cancel=function(){n.dismiss("cancel")}}]),t.controller("createNewReportController",["$scope","$rootScope","$uibModalInstance","connection","$translate",function(e,t,n,o,r){e.currentCaption="Report",e.connection=o,e.onCubeSelectedItemChanged=function(t){var n=t.name;e.currentCubeName=n},e.ok=function(){var t={};t.id=Ranet.Utility.Guid.newGuid(),t.content={},t.content.pages=[],t.caption=e.currentCaption;var o={};o.id=Ranet.Utility.Guid.newGuid(),o.cubeName=e.currentCubeName,o.caption=r.instant("Page")+" 1",t.content.pages.push(o),o.queryDesignerSetting={},o.queryDesignerSetting.hideEmptyColumns=!0,o.queryDesignerSetting.hideEmptyRows=!0,o.queryDesignerSetting.includeAllMembers=!1,o.queryDesignerSetting.includeCustomCalculationsInDrillDown=!1,o.queryDesignerSetting.subsetCount=0,o.queryDesignerSetting.useVisualTotals=!0,o.queryDesignerSetting.generateCustomCalculated=!1,n.close(t)},e.cancel=function(){n.dismiss("cancel")}}]),t.controller("openEntryController",["$scope","$translate","$rootScope","$uibModalInstance","args","$uibModal","appConfig",function(e,t,n,o,r,i,a){var c=r.storageProvider,s=r.filterKey;e.selectedItem=void 0,e.searchTreeViewOptions={isVisibleSearch:!0},n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:t.instant("LoadPanel_GetReports")}),c.getDescriptionStorage(s).success(function(t){e.datasource=t,n.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error loading reports. See log.")}),e.onSelectedItemChanged=function(t){e.selectedItem=t.data},e.ok=function(){o.close(e.selectedItem)},e.cancel=function(){o.dismiss("cancel")}}]),t.controller("loadReportFromPcController",["$scope","$translate","$rootScope","$uibModalInstance","args","$uibModal","appConfig","messageService",function(e,t,n,o,r,i,a,c){function s(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];"folder"===o.type&&(o.isOpen=!0,t.push(o),o.items.length>0&&(o.items=s(o.items)))}return t}var l;e.lookupOptions={messages:{noDataMessage:t.instant("Lookup_NotFindElements"),placeholderMessage:t.instant("ComboBoxItem_None"),prefixMultiSelectionField:" "+t.instant("Lookup_PrefixSelectedItems")},iconExpr:"icon",iconExpandedExpr:"iconExpanded",expandedExpr:"isOpen",selectedExpr:"isSelected",dataSource:[],displayExpr:"caption",isVisibleSearchPanel:!1,onSelectionChanged:function(e){var t=e.selectedItems;0!==t.length&&(l=t[0])}};var u=s(r.tree);e.treeFoldersLookupDataSource=u,e.selectedFolders=[u[0]],e.ok=function(){var e=document.getElementById("fileForUpload").files[0];if(e){var n=new FileReader;n.readAsText(e,"UTF-8"),n.onload=function(e){var t=e.target.result;o.close({folder:l,fileContent:t})},n.onerror=function(e){alert("Some error.")}}else c.showInformation(t.instant("Warning"),t.instant("Warning_UserDidNotSelectedImportedFile"))},e.cancel=function(){o.dismiss("cancel")}}]),t.controller("editCurrentConnectionController",["$scope","$uibModalInstance","currentConnection","$uibModal","appConfig",function(e,t,n,o,r){e.currentConnection=n,e.isVisibleBadStatusPanel=!1,e.isVisibleGoodStatusPanel=!1,e.exceptionText="",e.onConnectionChecked=function(t){var n=t.data;1===n.status?e.isVisibleGoodStatusPanel=!0:0===n.status&&(e.isVisibleBadStatusPanel=!0,e.exceptionText=n.exception),Ranet.UserActionsTracker.track("Check connection",{status:1===n.status?"good":"bad",connection:e.currentConnection})},e.onStartChecking=function(){e.exceptionText="",e.isVisibleBadStatusPanel=!1,e.isVisibleGoodStatusPanel=!1},e.showError=function(t){var n=angular.element(".dynamicPivotGrid");o.open({appendTo:n,templateUrl:r.resourcePath+"templates/showException.html",controller:"showExceptionController",backdrop:"static",size:t,resolve:{exception:function(){return e.exceptionText}}})},e.ok=function(){t.close(e.currentConnection)},e.cancel=function(){t.dismiss("cancel")}}]),t.controller("editExtensionController",["$scope","$uibModalInstance","extensionSettings","layoutMode","$uibModal","appConfig",function(e,t,n,o,r,i){n.chartOptions.legend.visible?e.currentLegendType=n.chartOptions.legend.position||0:e.currentLegendType=4,e.activeTab=0,e.cellNumber=n.cellNumber||1e4,e.settingsMode="General",e.innerSettings="General",e.setInnerSettings=function(t){e.innerSettings=t},e.setSettingsMode=function(t){e.settingsMode=t,e.innerSettings="Chart"===t?"Series":"General"},e.chartTypes=["DiagramType_Line","DiagramType_Area","DiagramType_Bar","DiagramType_StackedArea","DiagramType_StackedBar","DiagramType_Pie"],e.currentChartType=n.chartOptions.defaultDiagramType,e.legendTypes=["ChartLegendPosition_Top","ChartLegendPosition_Bottom","ChartLegendPosition_Left","ChartLegendPosition_Right","ChartLegendPosition_None"],e.layoutModes=["DockExtension_ExtensionNo","DockExtension_ExtensionaboveGrid","DockExtension_ExtensionbelowGrid","DockExtension_ExtensiontorightofGrid","DockExtension_ExtensiontoleftofGrid","DockExtension_ExtensionOnly"],e.useMultipleCharts=n.chartOptions.useMultipleCharts||!1,e.multipleRows=n.chartOptions.multipleRows||1,e.multipleColumns=n.chartOptions.multipleColumns||1,e.currentArgumentVisibility=n.chartOptions.showArgumentLabels,e.currentTooltipVisibility=n.chartOptions.tooltip.enabled,e.autogenerateSeries=n.chartOptions.autogenerate,e.detalization=n.vectorMapSettings.mapOptions.detailedMapSettings.enable,e.series=n.chartOptions.seriesOptions,e.pieSeries=n.chartOptions.pie.pieSeries||[],e.selectedSeria=void 0,e.layout=o,e.displayedData=e.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentDataSource,e.currentRow=e.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.vectorMapSettings.dataSettings.row,e.currentColumn=e.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.vectorMapSettings.dataSettings.col,e.rows=[],e.columns=[],e.displayInnerLabels="none"!==n.chartOptions.pie.labels.inner.format,e.displayOuterLabels="none"!==n.chartOptions.pie.labels.outer.format,e.displayLegend=!!n.chartOptions.pie.legend.visible,e.displayTooltips=!!n.chartOptions.pie.tooltips.enabled,e.palettes=[];var a=Ranet.Controls.Extensions.PaletteCollection.palettes;for(var c in a)a.hasOwnProperty(c)&&e.palettes.push({name:c,colors:a[c]});n.chartOptions.palette?e.currentPalette={name:n.chartOptions.palette,colors:a[n.chartOptions.palette]}:e.currentPalette=e.palettes[0],e.checkVectorMapCompatible=function(){return Ranet.Controls.Extensions.MapDataHelper.checkValidMapData(e.displayedData)},e.checkDisabled=function(t){Ranet.ClientInformation.isIE()&&!e.layout&&(e[t]=!e[t],console.log(t))},e.fixIsolateScope=function(t,n){e[t]=n},e.checkVectorMapCompatible()&&(e.rows=Ranet.Controls.Extensions.MapDataHelper.generateRowList(e.displayedData),e.columns=Ranet.Controls.Extensions.MapDataHelper.generateColumnList(e.displayedData)),-1===e.rows.indexOf(e.currentRow)&&(e.currentRow=e.rows[0]||"");var s=["Chart","VectorMap","Pie"];e.extensionType=s[n.extensionType||0],"Pie"===e.extensionType&&(e.extensionType="Chart",e.currentChartType=5,e.useMultipleCharts=!0),e.changeChartType=function(t){5===t?e.useMultipleCharts=!0:e.activeTab=0},e.setLegend=function(t){e.currentLegendType=t},e.setMultipleRows=function(t){e.multipleRows=t},e.setMultipleColumns=function(t){e.multipleColumns=t},e.changeRow=function(t){e.currentRow=t},e.changeColumn=function(t){e.currentColumn=t},e.addSeria=function(){var t=angular.element(".dynamicPivotGrid");r.open({appendTo:t,templateUrl:i.resourcePath+"templates/editSeria.html",controller:"editSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return{}},editType:function(){return 1},additionalAxisSelected:function(){for(var t=0;t<e.series.length;t++)if(e.series[t].useAdditionalAxis)return!0;return!1}}}).result.then(function(t){e.series.push({columnIndex:parseInt(t.columnIndex),diagramType:parseInt(t.diagramType),useAdditionalAxis:t.useAdditionalAxis})},function(){})},e.deleteSeria=function(){e.series.splice(e.series.indexOf(e.selectedSeria),1)},e.editSeria=function(){var t=e.series.indexOf(e.selectedSeria),n=angular.element(".dynamicPivotGrid");r.open({appendTo:n,templateUrl:i.resourcePath+"templates/editSeria.html",controller:"editSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return e.series[t]},editType:function(){return 0},additionalAxisSelected:function(){for(var t=0;t<e.series.length;t++)if(e.series[t].useAdditionalAxis)return!0;return!1}}}).result.then(function(n){e.series[t].columnIndex=parseInt(n.columnIndex),e.series[t].diagramType=parseInt(n.diagramType),e.series[t].useAdditionalAxis=n.useAdditionalAxis},function(){})},e.addPieSeria=function(){var t=angular.element(".dynamicPivotGrid");r.open({appendTo:t,templateUrl:i.resourcePath+"templates/editPieSeria.html",controller:"editPieSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return{}},editType:function(){return 1}}}).result.then(function(t){e.pieSeries.push({index:parseInt(t.index),title:t.title})},function(){})},e.deletePieSeria=function(){e.pieSeries.splice(e.pieSeries.indexOf(e.selectedPieSeria),1)},e.editPieSeria=function(){var t=e.pieSeries.indexOf(e.selectedPieSeria),n=angular.element(".dynamicPivotGrid");r.open({appendTo:n,templateUrl:i.resourcePath+"templates/editPieSeria.html",controller:"editPieSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return e.pieSeries[t]},editType:function(){return 0}}}).result.then(function(n){e.pieSeries[t].index=parseInt(n.index),e.pieSeries[t].title=n.title},function(){})},e.setPalette=function(t){e.currentPalette=t},e.selectSeria=function(t){e.selectedSeria=t},e.selectPieSeria=function(t){e.selectedPieSeria=t},e.ok=function(){n.chartOptions.legend.position=4!==e.currentLegendType?e.currentLegendType:0,5===e.currentChartType&&"VectorMap"!==e.extensionType&&(e.extensionType="Pie"),n.chartOptions.extensionType=s.indexOf(e.extensionType),n.chartOptions.showArgumentLabels=e.currentArgumentVisibility,n.chartOptions.tooltip.enabled=e.currentTooltipVisibility,n.chartOptions.autogenerate=e.autogenerateSeries,n.chartOptions.legend.visible=4!==e.currentLegendType,n.chartOptions.seriesOptions=e.series,n.chartOptions.useMultipleCharts=e.useMultipleCharts,n.chartOptions.defaultDiagramType=e.currentChartType,n.chartOptions.pie.labels.inner.format=e.displayInnerLabels?"value":"none",n.chartOptions.pie.labels.outer.format=e.displayOuterLabels?"label":"none",n.chartOptions.pie.pieSeries=e.pieSeries,n.chartOptions.pie.legend.visible=e.displayLegend,n.chartOptions.pie.tooltips.enabled=e.displayTooltips,n.chartOptions.palette=e.currentPalette.name,n.chartOptions.multipleRows=e.multipleRows,n.chartOptions.multipleColumns=e.multipleColumns,n.chartOptions.cellNumber=e.cellNumber,n.chartOptions.pie.rowLength=e.multipleColumns,n.chartOptions.pie.columnLength=e.multipleRows,o=e.layout;var r={extensionSettings:{}};r.extensionSettings.chartOptions=$.extend(!0,{},n.chartOptions),r.extensionSettings.extensionType=s.indexOf(e.extensionType),r.extensionSettings.vectorMapSettings=n.vectorMapSettings,r.extensionSettings.vectorMapSettings.dataSettings={col:e.currentColumn,row:e.currentRow},r.extensionSettings.vectorMapSettings.mapOptions.detailedMapSettings.enable=e.detalization,r.layoutMode=o,t.close(r)},e.cancel=function(){t.dismiss("cancel")}}]),t.controller("editSeriaController",["$scope","$uibModalInstance","seria","editType","additionalAxisSelected",function(e,t,n,o,r){e.chartTypes=["DiagramType_Line","DiagramType_Area","DiagramType_Bar","DiagramType_StackedArea","DiagramType_StackedBar"],e.disableAdditionalAxis=!1,1===o?(e.currentChartType=0,e.columnIndex=void 0,e.useAdditionalAxis=!1,r&&(e.disableAdditionalAxis=!0)):0===o&&(e.currentChartType=n.diagramType,e.columnIndex=n.columnIndex,e.useAdditionalAxis=n.useAdditionalAxis,r&&!e.useAdditionalAxis&&(e.disableAdditionalAxis=!0)),e.setChartType=function(t){e.currentChartType=t},e.ok=function(){t.close({diagramType:e.currentChartType,columnIndex:e.columnIndex,useAdditionalAxis:e.useAdditionalAxis})},e.cancel=function(){t.dismiss("cancel")}}]),t.controller("editPieSeriaController",["$scope","$uibModalInstance","seria","editType",function(e,t,n,o){1===o?(e.index=void 0,e.title=""):0===o&&(e.index=n.index,e.title=n.title),e.ok=function(){t.close({index:e.index,title:e.title})},e.cancel=function(){t.dismiss("cancel")}}]),t.controller("showExceptionController",["$scope","$rootScope","$uibModalInstance","exception",function(e,t,n,o){e.exception=o,e.cancel=function(){n.dismiss("cancel")}}]),t.controller("editQueryDesignerSettingsController",["$scope","$uibModalInstance","queryDesignerSetting","loadStateFromHistory",function(e,t,n,o){e.hideEmptyColumns=n.hideEmptyColumns,e.hideEmptyRows=n.hideEmptyRows,e.subsetCount=n.subsetCount,e.useVisualTotals=n.useVisualTotals,e.generateCustomCalculated=n.generateCustomCalculated,e.includeAllMembers=n.includeAllMembers,e.includeCustomCalculationsInDrillDown=n.includeCustomCalculationsInDrillDown,e.loadStateFromHistory=o,e.ok=function(){t.close({setting:{hideEmptyColumns:e.hideEmptyColumns,hideEmptyRows:e.hideEmptyRows,subsetCount:e.subsetCount,useVisualTotals:e.useVisualTotals,generateCustomCalculated:e.generateCustomCalculated,includeAllMembers:e.includeAllMembers,includeCustomCalculationsInDrillDown:e.includeCustomCalculationsInDrillDown},loadStateFromHistory:e.loadStateFromHistory})},e.cancel=function(){t.dismiss("cancel")}}]),t.controller("exportToUrlController",["$scope","$translate","$uibModalInstance","args",function(e,t,n,o){var r="?ranetreportid="+o.reportId+"&ranetispublic="+o.isPublic;void 0===o.isPublic?e.reportUrl=t.instant("UrlViewer_Warning_NewReport"):-1===window.location.href.indexOf("ranetreportid")?e.reportUrl=window.location.href+r:e.reportUrl=window.location.protocol+"//"+window.location.host+window.location.pathname+r,e.cancel=function(){n.dismiss("cancel")}}])}(),function(){var e=angular.module("sampleDynamicPivotGrid.directives",[]);e.directive("treeView",[function(){return{restrict:"A",link:function(e,t,n){var o,r={keyExpr:"id",displayExpr:"caption",iconExpandedExpr:"iconExpanded",iconExpr:"icon",selectedExpr:"isSelected",expandedExpr:"isOpen",onItemSelected:function(t){e.$evalAsync(function(){e.onselecteditemchanged({e:t})})}};e.$watch("datasource",function(){var n=e.datasource;void 0===o?(r.dataSource=n,o=new Ranet.Controls.TreeView(t,r)):o.dataSource=n},!0)},scope:{onselecteditemchanged:"&onselectedchanged",datasource:"="}}}]),e.directive("loadPanel",function(){return{restrict:"A",link:function(e,t,n){var o={message:"Loading...",visible:!1,position:{of:window}},r=new Ranet.Controls.LoadPanel(t,o);n.$observe("message",function(e){r.message=e}),n.$observe("visible",function(e){var t="true"===e;r.visible=t})}}}),e.directive("cubeChoiceControl",["$parse",function(e){return{restrict:"A",link:function(t,n,o){var r=e(o.oncubeselectedchanged),i=new Ranet.Controls.CubeChoiceControl(n);i.selectionCubeChanged.on(function(e){t.$evalAsync(function(){r(t,{e:e})})}),o.$observe("connection",function(e){i.connection=e,i.refrehCubes()})}}}]),e.directive("dragAndDropTreeMetadataToText",function(){return{restrict:"A",require:"?ngModel",scope:{deletePrevValue:"="},link:function(e,t,n,o){function r(e){return 0===e[0].childNodes.length&&e[0].selectedSelf?e[0]:r(e[0].childNodes)}n.$observe("disableDragAndDrop",function(e){"true"===e?$(t).droppable("disable"):$(t).droppable("enable")}),$(t).droppable({drop:function(t,n){var i=jQuery.data(n.draggable.get(0),"data"),a="";if("namedSet"===i.type)a="["+i.name+"]";else if("customNamedSet"===i.type||"calculatedMember"===i.type||"calculatedNamedSet"===i.type)a=i.name;else if("measure"===i.type)a=i.uniqueName;else if("level"===i.type)a=i.filter?r(i.filter.membersFilter.selectionNodes).uniqueName:i.uniqueName;else if("dimension"===i.type||"hierarchy"===i.type)a=i.uniqueName;else if("kpiInfo"===i.type)for(var c=0;c<i.items.length;c++){var s=i.items[c];"goal"===s.kpiType&&(a+='KPIGoal("'+i.name+'")'),"value"===s.kpiType&&(a+='KPIValue("'+i.name+'")'),"trend"===s.kpiType&&(a+='KPITrend("'+i.name+'")'),"status"===s.kpiType&&(a+='KPIStatus("'+i.name+'")'),c+1!==i.items.length&&(a+=", ")}else"kpiItem"===i.type&&("goal"===i.kpiType&&(a='KPIGoal("'+i.parentName+'")'),"value"===i.kpiType&&(a='KPIValue("'+i.parentName+'")'),"trend"===i.kpiType&&(a='KPITrend("'+i.parentName+'")'),"status"===i.kpiType&&(a='KPIStatus("'+i.parentName+'")'));var l=o.$modelValue;l&&(l+=" "),e.deletePrevValue&&(l=""),o.$setViewValue(l+a),o.$commitViewValue(),o.$render()},scope:"textBox",hoverClass:"customCalculationsEditor-textEditor-border_orange"})}}}),e.directive("cubeExplorer",function(){return{restrict:"A",scope:{cubeMetaData:"=",cubeName:"=",connection:"=",calculatedMembers:"=",calculatedNamedSets:"="},link:function(e,t){var n=new Ranet.Controls.CubeExplorer(t,{keyExpr:"id",connection:e.connection,cubeName:e.cubeName,selectedMeasureGroupName:null,draggableOptions:{appendTo:".modal-body",scope:"textBox",$dragContainer:$(".dynamicPivotGrid")}});e.$watch("cubeMetaData",function(e){void 0!==e&&(n.dataSource=e)},!1),e.$watch("calculatedMembers",function(e){void 0!==e&&(n.currentCalculatedMembers=e)},!0),e.$watch("calculatedNamedSets",function(e){void 0!==e&&(n.currentCalculatedNamedSets=e)},!0)}}}),e.directive("checkconnectionbutton",["$parse","$translate","connectionService",function(e,t,n){return{restrict:"E",replace:!0,template:'<button class="btn btn-default"></button>',link:function(o,r,i){var a=e(i.onconnectionchecked),c=e(i.onstartchecking),s=t.instant("ButtonCheckConnection"),l=t.instant("ButtonCheckingConnection"),u="",d=angular.element("<span>"+s+"</span>");r.append(d),r.click(function(){r.hasClass("disabled")||(c&&c(o),r.empty(),r.addClass("disabled"),r.append('<i class="fa fa-spinner fa-pulse"></i>'),r.append("<span style='margin-left:3px;'>"+l+"</span>"),n.checkConnection(u).then(function(e){r.removeClass("disabled"),r.empty(),r.append(d),a(o,{e:e})}))}),i.$observe("connection",function(e){u=e})}}}]),e.directive("uibModalWindow",function(){return{restrict:"EA",link:function(e,t){t.draggable({handle:".modal-header"})}}}),e.directive("ranetdynamicpivotgridapp",["appConfig",function(e){return{restrict:"E",replace:!0,controller:"sampleDynamicPivotGridController",templateUrl:e.resourcePath+"templates/appDynamicPivotGrid2.html"}}]),e.directive("cnpdynamicpivotgridapp",["appConfig",function(e){return{restrict:"E",replace:!0,controller:"sampleDynamicPivotGridController",templateUrl:e.resourcePath+"templates/cnpDynamicPivotGrid.html"}}]),e.directive("ranetSearchTreeView",[function(){return{restrict:"EA",scope:{datasource:"=",searchtreeoptions:"=",onSelectedItemChanged:"&onselectedchanged",control:"="},link:function(e,t){var n={keyExpr:"id",displayExpr:"caption",iconExpandedExpr:"iconExpanded",iconExpr:"icon",selectedExpr:"isSelected",expandedExpr:"isOpen",onItemSelected:function(e){console.warn("No onItenSelected function has been specified in SearchTreeView directive")},dataSource:[],isVisibleSearch:!0},o=e.searchtreeoptions,r=$.extend({},n,o);r.dataSource=e.datasource,r.onItemSelected=function(t){void 0!==e.onSelectedItemChanged&&e.$evalAsync(function(){e.onSelectedItemChanged({e:{data:t[0]}})})};var i=new Ranet.Controls.SearchTreeView.SearchTreeViewContent(t,r);i.init(),e.control&&(e.control.repaintTreeView=function(){i.repaint()}),e.$watch("datasource",function(){i.dataSource=e.datasource})}}}]),e.directive("ranetListLookup",[function(){return{link:function(e,t,n){var o=t.closest(".modal");0===o.length&&(o=t.closest(".dynamicPivotGrid"));var r=e.lookupOptions,i=new Ranet.Controls.Lookup.ListLookupControlOptions;i.displayExpr=r.displayExpr,i.messages=r.messages,i.dataSource=r.dataSource,i.multiSelection=r.multiSelection,i.grouped=r.grouped,i.getPopupContainer=function(){return o},i.onSelectionChanged=function(t){void 0!==r.onSelectionChanged&&e.$evalAsync(function(){r.onSelectionChanged(t)})},i.getItemTemplate=r.itemTemplate;var a=new Ranet.Controls.Lookup.LookupControl(t,i);a.init(),e.$watch("lookupDataSource",function(e){void 0!==e&&(a.dataSource=e)}),e.$watch("lookupSelectedItems",function(e){void 0!==e&&(a.selectedItems=e)},!0)},scope:{lookupOptions:"=",lookupSelectedItems:"=",lookupDataSource:"="}}}]),e.directive("ranetTreeLookup",[function(){return{link:function(e,t,n){var o=t.closest(".modal");0===o.length&&(o=t.closest(".dynamicPivotGrid"));var r=e.lookupOptions,i=new Ranet.Controls.Lookup.TreeLookupControlOptions;i.displayExpr=r.displayExpr,i.messages=r.messages,i.dataSource=r.dataSource,i.isVisibleSearchPanel=!1,i.iconExpr=r.iconExpr,i.iconExpandedExpr=r.iconExpandedExpr,i.expandedExpr=r.expandedExpr,i.selectedExpr=r.selectedExpr,i.getPopupContainer=function(){return o},i.onSelectionChanged=function(t){void 0!==r.onSelectionChanged&&e.$evalAsync(function(){r.onSelectionChanged(t)})};var a=new Ranet.Controls.Lookup.LookupControl(t,i);a.init(),e.$watch("lookupDataSource",function(e){void 0!==e&&(a.dataSource=e)}),e.$watch("lookupSelectedItems",function(e){void 0!==e&&(a.selectedItems=e)})},scope:{lookupOptions:"=",lookupSelectedItems:"=",lookupDataSource:"="}}}]),e.directive("ranetMultiChartTable",function(){return{restrict:"E",replace:!0,template:"<div></div>",link:function(e,t,n){for(var o=0,r=0,i=function(){for(var t=1;t<=e.rowLength;t++)for(var n=1;n<=e.colLength;n++)angular.element("[data-multicharttable-colid="+n+"][data-multicharttable-rowid="+t+"]").addClass("active");for(var i=1;i<=r;i++)for(var a=1;a<=o;a++)angular.element("[data-multicharttable-colid="+i+"][data-multicharttable-rowid="+a+"]").addClass("hovered")},a=1;a<=e.maxRowNumber;a++){for(var c=angular.element("<div/>").addClass("ranetMultiChartTable-row"),s=1;s<=e.maxColNumber;s++){var l=angular.element("<div/>").addClass("ranetMultiChartTable-col").attr("data-multicharttable-colid",s).attr("data-multicharttable-rowid",a);!function(t,n,o,r){o.on("click",function(){e.$apply(function(){e.colLength=n,e.rowLength=t,angular.element(".ranetMultiChartTable-col.active").removeClass("active"),r()})})}(a,s,l,i),function(t,n,i,a){i.on("mouseenter",function(){e.$apply(function(){r=n,o=t,angular.element(".ranetMultiChartTable-col.hovered").removeClass("hovered"),a()})})}(a,s,l,i),t.on("mouseleave",function(){angular.element(".ranetMultiChartTable-col.hovered").removeClass("hovered")}),c.append(l),c.append(angular.element("<br/>"))}t.append(c),t.addClass("ranetMultiChartTable"),i()}},scope:{maxColNumber:"=",maxRowNumber:"=",colLength:"=",rowLength:"="}}})}(),function(){var e=angular.module("sampleDynamicPivotGrid.factories",[]);e.factory("reportsStorageProvider",["$http","$translate","appConfig",function(e,t,n){function o(e){e.forEach(function(e){e.isPublic?e.caption=t.instant("Storage_Global"):e.caption=t.instant("Storage_User")})}var r={};return r.getDescriptionStorage=function(t){return e.post(n.applicationUrl+"api/reportsStorage/getReports",{filterKey:t}).success(function(e){o(e)})},r.getReport=function(t,o){return e.post(n.applicationUrl+"api/reportsStorage/getReport",t)},r.deleteEntry=function(t){return e.post(n.applicationUrl+"api/reportsStorage/deleteReport",t)},r.deleteFolder=function(t){return e.post(n.applicationUrl+"api/reportsStorage/deleteFolder",t)},r.saveEntry=function(t){return e.post(n.applicationUrl+"api/reportsStorage/saveReport",t)},r.saveFolder=function(t){return e.post(n.applicationUrl+"api/reportsStorage/saveFolder",t)},r.convertReportToXmlFile=function(t){return e.post(n.applicationUrl+"api/reportsStorage/convertReportToXmlFile",t)},r.convertXmlFileToReport=function(t,o){return e.post(n.applicationUrl+"api/reportsStorage/convertXmlFileToReport",{content:t,folder:o})},r}]),e.factory("pagesStorageProvider",["$http","$translate","appConfig",function(e,t,n){function o(e){e.forEach(function(e){e.isPublic?e.caption=t.instant("Storage_Global"):e.caption=t.instant("Storage_User")})}var r={};return r.getDescriptionStorage=function(t){return e.post(n.applicationUrl+"api/pagesStorage/getPages",{filterKey:t}).success(function(e){o(e)})},r.getEntry=function(t){return e.post(n.applicationUrl+"api/pagesStorage/getPage",t)},r.deleteEntry=function(t){return e.post(n.applicationUrl+"api/pagesStorage/deletePage",t)},r.deleteFolder=function(t){return e.post(n.applicationUrl+"api/pagesStorage/deleteFolder",t)},r.saveEntry=function(t){return e.post(n.applicationUrl+"api/pagesStorage/savePage",t)},r.saveFolder=function(t){return e.post(n.applicationUrl+"api/pagesStorage/saveFolder",t)},r.convertReportToXmlFile=function(t){return e.post(n.applicationUrl+"api/pagesStorage/convertPageOfReportToXmlFile",t)},r.convertXmlFileToReport=function(t,o){return e.post(n.applicationUrl+"api/pagesStorage/convertXmlFileToPageOfReport",{content:t,folder:o})},r}]),e.factory("connectionService",["$http","appConfig",function(e,t){var n={};return n.checkConnection=function(n){return e.post(t.applicationUrl+"api/olap/checkConnection",{connection:n})},n}]),e.factory("exportService",["$http","appConfig",function(e,t){var n={};return n.toExcel=function(n,o,r,i,a){return e.post(t.applicationUrl+"api/export/excel",{captionPage:n,descriptionActiveFilters:o,cellSetData:r,headerText:i,footerText:a})},n.toXml=function(n,o,r,i,a){return e.post(t.applicationUrl+"api/export/xml",{captionPage:n,descriptionActiveFilters:o,cellSetData:r,headerText:i,footerText:a})},n}]),e.factory("messageService",["$uibModal","$translate","appConfig",function(e,t,n){var o,r,i,a;t("DialogButton_Ok").then(function(e){o=e}),t("DialogButton_Cancel").then(function(e){r=e}),t("DialogButton_Yes").then(function(e){i=e}),t("DialogButton_No").then(function(e){a=e});var c={},s=function(t,o,r,i,a,c,s,l){var u=angular.element(document.getElementsByClassName("dynamicPivotGrid"));e.open({appendTo:u,templateUrl:n.resourcePath+"templates/message.html",controller:"messageServiceController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{message:o,caption:t,isVisibleOkButton:r,isVisibleCancelButton:i,contentOkButton:a,contentCancelButton:c}}}}).result.then(function(){s&&s()},function(){l&&l()})};return c.showInformation=function(e,t){s(e,t,!0,!1,o,r,null,null)},c.showQuestion=function(e,t,n,o){s(e,t,!0,!0,i,a,n,o)},c}]),e.factory("customLocalizationLoader",["$http","$q","appConfig",function(e,t,n){return function(e){var o=t.defer();return console.log(e),Ranet.Localization.init(n.applicationUrl,n.resourcePath,e.key).done(function(e){o.resolve(e.messages)}).fail(function(e){o.reject(e)}),o.promise}}]),e.factory("ranetAngularInstance",["$rootScope",function(e){var t={},n=!0;return t.config=function(t){t.hasOwnProperty("connection")&&e.$broadcast("changeConnectionApiEvent",{connection:t.connection}),t.hasOwnProperty("toolbar")&&e.$broadcast("changeToolBarOptionsApiEvent",{buttons:t.toolbar}),t.hasOwnProperty("onPageImporting")&&e.$broadcast("changeOnPageImportingApiEvent",{onPageImporting:t.onPageImporting}),t.hasOwnProperty("onGetFilterKey")&&e.$broadcast("changeOnGetFilterKeyApiEvent",{onGetFilterKey:t.onGetFilterKey})},t.setSelectedPage=function(t){e.$broadcast("setSelectedPageApiEvent",{idPage:t})},t.addNewPage=function(t){t.layout.filters||(t.layout.filters=[]),n?(e.$broadcast("openNewReportApiEvent",{content:{pages:[t]}}),n=!1):e.$broadcast("addNewPageApiEvent",{page:t})},t.deletePage=function(t,n){e.$broadcast("deletePageApiEvent",{id:t,deleteCallback:n})},t}])}(),angular.module("sampleDynamicPivotGrid.config",[]).constant("appConfig",{applicationUrl:window.applicationUrlSpa?window.applicationUrlSpa:"",resourcePath:window.resoursePathSpa?window.resoursePathSpa:"assets/",defaultConnection:"Provider=MSOLAP.4; Data Source=https://bi.galaktikasoft.com/olap/2012/msmdpump.dll; Catalog=AdventureWorksDW2012 MD-EE;",placementLayoutModeQueryDesigner:0}),angular.module("sampleDynamicPivotGrid",["ranet","ui.bootstrap","ngSanitize","sampleDynamicPivotGrid.config","sampleDynamicPivotGrid.factories","sampleDynamicPivotGrid.directives","pascalprecht.translate","sampleDynamicPivotGrid.controllers","sampleDynamicPivotGrid.filters"]).config(["$translateProvider","appConfig","$locationProvider",function(e,t){e.useSanitizeValueStrategy(null),function(t){var n;"en"!==(n=t||function(){var e=window.navigator.languages?window.navigator.languages[0]:null;return-1!==(e=e||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage).indexOf("-")&&(e=e.split("-")[0]),-1!==e.indexOf("_")&&(e=e.split("_")[0]),e}())&&"ru"!==n&&"zh"!==n&&(n="en"),e.useLoader("customLocalizationLoader"),e.preferredLanguage(n)}(t.preferLanguage)}]),angular.module("sampleDynamicPivotGrid.filters",[]).filter("splitWords",function(){return function(e){return e.split(" ").reduce(function(e,t){return""===e?t:e+"<br/>"+t},"")}});
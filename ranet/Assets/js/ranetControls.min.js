var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Ranet;!function(e){!function(e){!function(e){Math.radians=function(e){return e*Math.PI/180},Math.degrees=function(e){return 180*e/Math.PI};var t=function(){function t(t,i){var n=this;this._stackedBarCount=0,this._prevStackedCoords=[],this._parsedCoords=[],this._maxBarWidth=e.ChartConf.maxBarWidth,this._htmlelement=t,this._element=d3.select(this._htmlelement);var o=this._element.node();if(this._fieldHeight=o.getBoundingClientRect().height,this._fieldWidth=o.getBoundingClientRect().width,this._content=this._element.append("svg"),this._legendSize={width:0,height:0},this._element.append("xhtml:div").attr("class","popOvers"),this._element.attr("id")||this._element.attr("id","ranetChart-"+e.Chart.ChartDataHelper.createGuid()),this._countedStyles={paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0},this._options=i,this._additionalAxisType=e.DataType.Number,this._options.styling||(this._options.styling={paddingLeft:0,paddingRight:0,paddingTop:10,paddingBottom:25}),this._initialStyling=$.extend({},this._options.styling),this._options.tooltip||(this._options.tooltip={enabled:!0,customizeTooltip:function(){return"<strong>"+this.point.name.toString()+" "+this.point.displayValue+"</strong>"}}),!this._options.tooltip.customizeTooltip){var r=this;this._options.tooltip.customizeTooltip=function(){return r._argumentsHidden||!1===r._options.showArgumentLabels?"<span><font color="+this.point.color+">&#9632;</font> "+this.point.name.toString()+", "+this.point.argument.toString()+", "+this.point.displayValue+"</span>":"<span><font color="+this.point.color+">&#9632;</font> "+this.point.name.toString()+" "+this.point.displayValue+"</span>"}}this._options.legend||(this._options.legend={visible:!1}),this._options.legend.onmouseenterevent=function(e){var t=new CustomEvent("mouseEnterChartLegend",{detail:{name:e.name},bubbles:!0,cancelable:!1}),i=document.querySelectorAll(".line");if(i[0])for(s=0;s<i.length;s++)i[s].dispatchEvent(t);var n=document.querySelectorAll(".area");if(n[0])for(s=0;s<n.length;s++)n[s].dispatchEvent(t);var o=document.querySelectorAll(".stackedArea");if(o[0])for(s=0;s<o.length;s++)o[s].dispatchEvent(t);var r=document.querySelectorAll(".bar");if(r[0])for(s=0;s<r.length;s++)r[s].dispatchEvent(t);var a=document.querySelectorAll(".stackedBar");if(a[0])for(var s=0;s<a.length;s++)a[s].dispatchEvent(t)},this._options.legend.onmouseleaveevent=function(e){var t=new CustomEvent("mouseLeaveChartLegend",{detail:{name:e.name},bubbles:!0,cancelable:!1}),i=document.querySelectorAll(".line");if(i[0])for(s=0;s<i.length;s++)i[s].dispatchEvent(t);var n=document.querySelectorAll(".area");if(n[0])for(s=0;s<n.length;s++)n[s].dispatchEvent(t);var o=document.querySelectorAll(".stackedArea");if(o[0])for(s=0;s<o.length;s++)o[s].dispatchEvent(t);var r=document.querySelectorAll(".bar");if(r[0])for(s=0;s<r.length;s++)r[s].dispatchEvent(t);var a=document.querySelectorAll(".stackedBar");if(a[0])for(var s=0;s<a.length;s++)a[s].dispatchEvent(t)},this._options.legend.onclickevent=function(e,t){n._options.seriesOptions[t].hidden=!n._options.seriesOptions[t].hidden,n._notParsed=!0,n._parsedData[t].forEach(function(e){!1===e.visible?e.visible=!0:e.visible=!1}),n.redraw()},this._options.legend.visible&&(void 0===this._options.legend.position&&(this._options.legend.position=e.LegendPosition.Bottom),this._options.legend.position===e.LegendPosition.Top||this._options.legend.position===e.LegendPosition.Left?this._element.insert("xhtml:div","svg").attr("class","legend"):this._element.insert("xhtml:div",".popOvers").attr("class","legend"),this._options.legend.position!==e.LegendPosition.Top&&this._options.legend.position!==e.LegendPosition.Bottom||(this._fieldHeight-=e.ChartConf.legendHeight)),this._color=d3.scale.category10(),this._barCount=0,this._stacked=!1,this._notParsed=!0,this._yScale=d3.scale.linear(),this._additionalScale=d3.scale.linear(),this._xScale=d3.scale.linear(),this._rawData=i.dataSource||[],this._legendItems=[],this._options.seriesOptions=i.seriesOptions||[],this._uniqueArgs=[],this._axisesOptions={useAdditional:!1,useMain:!1}}return t.prototype.parse=function(){this.parseSeries(this._options.seriesOptions),this.parseData(this._rawData),this._notParsed=!1},t.prototype.parseSeries=function(t){this._legendItems=[],this._barCount=0,this._options.seriesOptions=t,this._stacked=!1;for(var i=!1,n=0,o=0;o<this._options.seriesOptions.length;o++)this._rawData&&this._rawData[0]&&void 0!==this._rawData[this._options.seriesOptions[o].valueField]&&(i=!0),this._options.seriesOptions[o].useAdditionalAxis&&(this._options.seriesOptions[o].chartType===e.ChartTypes.StackedBar&&(this._options.seriesOptions[o].chartType=e.ChartTypes.Bar),this._options.seriesOptions[o].chartType===e.ChartTypes.StackedArea&&(this._options.seriesOptions[o].chartType=e.ChartTypes.Area),n>=1?this._options.seriesOptions[o].useAdditionalAxis=!1:n++),this._options.seriesOptions[o].chartType===e.ChartTypes.Bar&&this._barCount++,this._options.seriesOptions[o].chartType!==e.ChartTypes.StackedBar&&this._options.seriesOptions[o].chartType!==e.ChartTypes.StackedArea||(this._stacked=!0),this._options.seriesOptions[o].color||(this._options.seriesOptions[o].color=this._color(o)),this._legendItems.push({name:this._options.seriesOptions[o].name,color:this._options.seriesOptions[o].color,visible:!this._options.seriesOptions[o].hidden});return i},t.prototype.parseData=function(t){var i=this;if(this._additionalAxisType=e.DataType.Number,this._mainAxisType=e.DataType.Percentage,this._parsedData=[],this._parsedCoords=[],this._rawData[0]){var n,o=this._options;this._stackedBarCount=0,this._prevStackedCoords=[],this._uniqueArgs=[],this._parsedCoords=[],this._stackedAreaValues=[],this._stackedBarValues=[],this._numType=!0;for(m=0;m<o.seriesOptions.length;m++)if(!o.seriesOptions[m].hidden)for(var r=0;r<this._rawData.length;r++)this._additionalAxisType===e.DataType.Number&&this._rawData[r][o.seriesOptions[m].formatField]===e.DataType.Percentage&&o.seriesOptions[m].useAdditionalAxis&&(this._additionalAxisType=e.DataType.Percentage),this._mainAxisType===e.DataType.Percentage&&this._rawData[r][o.seriesOptions[m].formatField]===e.DataType.Number&&(this._mainAxisType=e.DataType.Number),n=o.seriesOptions[m].argumentField||this._options.argumentField,"number"!=typeof this._rawData[r][n]&&(this._numType=!1),this._rawData[r][o.seriesOptions[m].valueField]&&"NA"!==this._rawData[r][o.seriesOptions[m].valueField]||(this._rawData[r][o.seriesOptions[m].valueField]=0);var a,s;if(this._numType){for(var l=[],c=0;c<o.seriesOptions.length;c++){n=o.seriesOptions[c].argumentField||this._options.argumentField;for(var u=0;u<this._rawData.length;u++)l.push(this._rawData[u][n])}a=d3.max(l),s=d3.min(l),this._xScale.domain([s-5,a+5])}else n=o.seriesOptions[0].argumentField||this._options.argumentField,this._uniqueArgs=this.getUniqueValues("uniqueRowName",n,this._rawData,this._uniqueArgs),this._xScale.domain([-.5,this._uniqueArgs.length-.5]);this._parsedData=[];for(var p=0;p<this._options.seriesOptions.length;p++)if(n=o.seriesOptions[p].argumentField||this._options.argumentField,this._parsedData[p]=[],!o.seriesOptions[p].hidden)for(var h=0;h<this._rawData.length;h++)if(this._rawData[h][n]){var d={};(d=this._rawData[h]["data"+this._options.seriesOptions[p].columnIndex]||{}).seriesData=this._options.seriesOptions[p].data,this._parsedData[p].push({value:this._rawData[h][o.seriesOptions[p].valueField],name:this._options.seriesOptions[p].name,uniqueArgumentName:this._rawData[h].uniqueRowName,argument:this._rawData[h][n],displayValue:this._rawData[h][o.seriesOptions[p].displayValueField]||this._rawData[h][o.seriesOptions[p].valueField].toString(),data:d,useAdditionalAxis:o.seriesOptions[p].useAdditionalAxis})}for(var m=0;m<o.seriesOptions.length;m++)if(o.seriesOptions[m].useAdditionalAxis){if(this._additionalScale.domain([0,0]),o.seriesOptions[m].hidden)continue;var f=d3.min(this._parsedData[m],function(e){return e.value}),g=d3.max(this._parsedData[m],function(e){return e.value});f>0&&(f=0),g<0&&(g=0),this._additionalScale.domain([f,g]),this._additionalScale.nice()}var _,y,v=d3.max(this._parsedData,function(e,t){return d3.max(i._parsedData[t],function(e){return e.useAdditionalAxis?0:e.value})}),C=[];if(this._stacked){for(var b=[],w=[],S=0,x=0,D=0;D<o.seriesOptions.length;D++){var T,P;if(o.seriesOptions[D].chartType===e.ChartTypes.StackedBar){if(T=o.seriesOptions[D].stack?o.seriesOptions[D].stack:"defaultBar",C.indexOf(T)<0&&C.push(T),b[T]||(b[T]=[]),w[T]||(w[T]=[]),this._stackedBarValues[T]||(this._stackedBarCount++,this._stackedBarValues[T]=[]),this._stackedBarValues[T][x]=[],n=o.seriesOptions[D].argumentField||this._options.argumentField,o.seriesOptions[D].hidden)continue;for(P=0;P<this._rawData.length;P++)this._stackedBarValues[T][x].push({name:o.seriesOptions[D].name,value:this._rawData[P][o.seriesOptions[D].valueField],argument:this._rawData[P][n],color:o.seriesOptions[D].color,displayValue:this._rawData[P][o.seriesOptions[D].displayValueField]||this._rawData[P][o.seriesOptions[D].valueField].toString()}),b[T][this._rawData[P][n]]?this._rawData[P][o.seriesOptions[D].valueField]>0&&(b[T][this._rawData[P][n]]+=this._rawData[P][o.seriesOptions[D].valueField]):this._rawData[P][o.seriesOptions[D].valueField]>0&&(b[T][this._rawData[P][n]]=this._rawData[P][o.seriesOptions[D].valueField]),w[T][this._rawData[P][n]]?this._rawData[P][o.seriesOptions[D].valueField]<0&&(w[T][this._rawData[P][n]]+=this._rawData[P][o.seriesOptions[D].valueField]):this._rawData[P][o.seriesOptions[D].valueField]<0&&(w[T][this._rawData[P][n]]=this._rawData[P][o.seriesOptions[D].valueField]);x++}if(o.seriesOptions[D].chartType===e.ChartTypes.StackedArea){if(T=o.seriesOptions[D].stack?o.seriesOptions[D].stack:"defaultArea",C.indexOf(T)<0&&C.push(T),b[T]||(b[T]=[]),w[T]||(w[T]=[]),this._stackedAreaValues[T]||(this._stackedAreaValues[T]=[]),this._stackedAreaValues[T][S]=[],n=o.seriesOptions[D].argumentField||this._options.argumentField,o.seriesOptions[D].hidden)continue;for(P=0;P<this._rawData.length;P++)this._stackedAreaValues[T][S].push({name:o.seriesOptions[D].name,value:this._rawData[P][o.seriesOptions[D].valueField],argument:this._rawData[P][n],color:o.seriesOptions[D].color,displayValue:this._rawData[P][o.seriesOptions[D].displayValueField]||this._rawData[P][o.seriesOptions[D].valueField].toString()}),b[T][this._rawData[P][n]]?b[T][this._rawData[P][n]]+=this._rawData[P][o.seriesOptions[D].valueField]:b[T][this._rawData[P][n]]=this._rawData[P][o.seriesOptions[D].valueField];S++}}y=0;var I,M,E;for(E=0;E<C.length;E++)for(M=0;M<this._uniqueArgs.length;M++)(I=b[C[E]][this._uniqueArgs[M].row])>y&&(y=I);for(_=0,E=0;E<C.length;E++)for(M=0;M<this._uniqueArgs.length;M++)(I=w[C[E]][this._uniqueArgs[M].row])<_&&(_=I);y<v&&(y=v),y<0&&(y=0),_>0&&(_=0),this._yScale=d3.scale.linear().domain([_,y])}else y=v,_=d3.min(this._parsedData,function(e,t){return d3.min(i._parsedData[t],function(e){return e.useAdditionalAxis?0:e.value})}),y<0&&(y=0),_>0&&(_=0),_||(_=0),y||(y=0),this._yScale=d3.scale.linear().domain([_,y]);this._yScale.nice()}},t.prototype.getUniqueValues=function(e,t,i,n){return i.forEach(function(i){for(var o=!0,r=0;r<n.length;r++)i[e]?n[r].uniqueName===i[e]&&(o=!1):i[t]?n[r].row===i[t]&&(o=!1):o=!1;o&&n.push({uniqueName:i[e]||i[t],row:i[t]})}),n},t.prototype.calculateCoords=function(){this._prevStackedCoords=[];for(var e=0;e<this._parsedData.length;e++)this._parsedCoords[e]=[],this._options.seriesOptions[e]&&(this._parsedCoords[e]=this.scaleCoords(this._parsedData[e],this._options.seriesOptions[e]))},t.prototype.scaleCoords=function(t,i){var n,o,r,a=[],s=void 0;if(i.chartType!==e.ChartTypes.StackedBar&&i.chartType!==e.ChartTypes.StackedArea)if(i.useAdditionalAxis)for(r=0;r<t.length;r++)n=t[r],o=0,i.chartType===e.ChartTypes.Bar&&(o=this._additionalScale(0)-this._additionalScale(Math.abs(n.value)),s=n.value<0?this._additionalScale(0):void 0),this._numType?a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,x:this._xScale(n.argument),y:s||this._additionalScale(n.value||0),color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)}):a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,x:this._xScale(this.getIndexOfArg({row:n.argument,uniqueName:n.uniqueArgumentName},this._uniqueArgs)),y:s||this._additionalScale(n.value),color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)});else for(r=0;r<t.length;r++)n=t[r],o=0,i.chartType===e.ChartTypes.Bar&&(o=this._yScale(0)-this._yScale(Math.abs(n.value)),s=n.value<0?this._yScale(0):void 0),this._numType?a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,x:this._xScale(n.argument),y:s||this._yScale(n.value||0),color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)}):a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,x:this._xScale(this.getIndexOfArg({row:n.argument,uniqueName:n.uniqueArgumentName},this._uniqueArgs)),y:s||this._yScale(n.value),color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)});else{if(i.chartType===e.ChartTypes.StackedBar)for(r=0;r<t.length;r++)n=t[r],this._prevStackedCoords[i.stack||"defaultBar"]=this._prevStackedCoords[i.stack||"defaultBar"]||[],n.value<0?(s=this._yScale(0)-(this._prevStackedCoords[i.stack||"defaultBar"][n.uniqueArgumentName+"neg"]||0),o=Math.abs(this._yScale(0)-this._yScale(n.value)),this._prevStackedCoords[i.stack||"defaultBar"][n.uniqueArgumentName+"neg"]=(this._prevStackedCoords[i.stack||"defaultBar"][n.uniqueArgumentName+"neg"]||0)+(this._yScale(0)-this._yScale(n.value))):(s=this._yScale(n.value)-(this._prevStackedCoords[i.stack||"defaultBar"][n.uniqueArgumentName+"pos"]||0),o=Math.abs(this._yScale(0)-this._yScale(n.value)),this._prevStackedCoords[i.stack||"defaultBar"][n.uniqueArgumentName+"pos"]=(this._prevStackedCoords[i.stack||"defaultBar"][n.uniqueArgumentName+"pos"]||0)+(this._yScale(0)-this._yScale(n.value))),this._numType?a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,stack:i.stack||"defaultBar",x:this._xScale(n.argument),y:s,color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)}):a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,stack:i.stack||"defaultBar",x:this._xScale(this.getIndexOfArg({row:n.argument,uniqueName:n.uniqueArgumentName},this._uniqueArgs)),y:s,color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)});if(i.chartType===e.ChartTypes.StackedArea)for(this._prevStackedCoords[i.stack||"defaultArea"]=this._prevStackedCoords[i.stack||"defaultArea"]||[],r=0;r<t.length;r++)n=t[r],this._numType?a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,stack:i.stack||"defaultArea",x:this._xScale(n.argument)+40,y:this._yScale(n.value)-(this._prevStackedCoords[i.stack||"defaultArea"][n.argument]||0),color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)}):a.push({name:n.name,argument:n.argument,value:n.value,seriesType:i.chartType,stack:i.stack||"defaultArea",x:this._xScale(this.getIndexOfArg({row:n.argument,uniqueName:n.uniqueArgumentName},this._uniqueArgs)),y:this._yScale(n.value)-(this._prevStackedCoords[i.stack||"defaultArea"][n.uniqueArgumentName]||0),color:i.color,height:o,data:n.data,displayValue:n.displayValue,uniqueArgumentName:n.uniqueArgumentName,visible:!(!1===n.visible)}),this._prevStackedCoords[i.stack||"defaultArea"][n.uniqueArgumentName]=(this._prevStackedCoords[i.stack||"defaultArea"][n.uniqueArgumentName]||0)+(this._yScale(0)-this._yScale(n.value))}return a},t.prototype.getIndexOfArg=function(e,t){for(var i=0;i<t.length;i++)if(e.uniqueName===t[i].uniqueName)return i;return-1},t.prototype.fixDomains=function(e,t,i,n){var o=(0-i[0])/i[1],r=(0-n[0])/n[1];o<1&&r>1&&(i[0]=-i[1],n[1]=-n[0]),o>1&&r<1&&(i[1]=-i[0],n[0]=-n[1]);var a;o<1&&r<1&&(a=o>r?o:r,i[0]=-i[1]*a,n[0]=-n[1]*a),o>1&&r>1&&(a=o<r?o:r,i[1]=-i[0]/a,n[1]=-n[0]/a),this._additionalScale.domain(n),this._yScale.domain(i);var s,l,c,u,p=!1,h=[],d=i[0],m=(i[1]-i[0])/10;if(i[0]>=0||i[1]<=0){for(;d.toFixed(8)/1<i[1];)Math.abs(d)>m/2||p?h.push(d):(h.push(0),p=!0),d+=m;h.push(d),p||h.push(0)}else{s=Math.abs(i[0]),l=Math.abs(i[1]),c=Math.round(s/m),u=Math.round(l/m),d=0;for(g=0;g<c;g++)d-7<i[0]?h.push(this.getPrettyNumber(i[0])):h.push(this.getPrettyNumber(d)),d-=m;d=m;for(g=0;g<u;g++)d+7>i[1]?h.push(this.getPrettyNumber(i[1])):h.push(this.getPrettyNumber(d)),d+=m}var f=[];if(d=n[0],m=(n[1]-n[0])/10,p=!1,n[0]>=0||n[1]<=0){for(;d.toFixed(8)/1<n[1];)Math.abs(d)>m/2||p?f.push(d):(f.push(0),p=!0),d+=m;f.push(d),p||f.push(0)}else{s=Math.abs(n[0]),l=Math.abs(n[1]),c=Math.round(s/m),u=Math.round(l/m),d=0;for(g=0;g<c;g++)d-7<i[0]?f.push(this.getPrettyNumber(n[0])):f.push(this.getPrettyNumber(d)),d-=m;d=m;for(var g=0;g<u;g++)d+7>n[1]?f.push(this.getPrettyNumber(n[1])):f.push(this.getPrettyNumber(d)),d+=m}t.tickValues(f),e.tickValues(h)},t.prototype.recalculateVisualProps=function(){this._temporaryText=this._content.append("text"),this.resizeSvg(),this.checkAxises(),this.calculateLeftAxisWidth(),this.calculateAdditionalAxisWidth(),this.calculateBottomAxisProps(),this._temporaryText.remove(),this._countedStyles.paddingTop=10},t.prototype.checkAxises=function(){this._axisesOptions.useAdditional=!1,this._axisesOptions.useMain=!1;for(var e=0;e<this._options.seriesOptions.length;e++)this._options.seriesOptions[e].hidden||(this._options.seriesOptions[e].useAdditionalAxis?this._axisesOptions.useAdditional=!0:this._axisesOptions.useMain=!0)},t.prototype.calculateLeftAxisWidth=function(){if(this._axisesOptions.useMain){for(var t=this._temporaryText.node(),i=this._yScale.ticks(),n="",o=0;o<i.length;o++)(i[o]+"").length>n.length&&(n=i[o]+"");this._mainAxisType===e.DataType.Percentage&&(n=(100*parseInt(n)).toFixed(1)+"%"),this._temporaryText.text(n);var r=t.getBoundingClientRect().width;this._countedStyles.paddingLeft=r+15}else this._countedStyles.paddingLeft=10},t.prototype.calculateAdditionalAxisWidth=function(){if(this._axisesOptions.useAdditional){for(var t=this._temporaryText.node(),i=this._additionalScale.ticks(),n="",o=0;o<i.length;o++)(i[o]+"").length>n.length&&(n=i[o]+"");this._additionalAxisType===e.DataType.Percentage&&(n=(100*parseInt(n)).toFixed(1)+"%"),this._temporaryText.text(n);var r=t.getBoundingClientRect().width;this._countedStyles.paddingRight=r+15}else this._countedStyles.paddingRight=10},t.prototype.calculateBottomAxisProps=function(){if(this._options.showArgumentLabels){for(var e=(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight)/this._uniqueArgs.length/5,t=this._temporaryText.node(),i="",n="",o=!0,r=this._uniqueArgs.length-1,a=0;r>=0;r--,a++){var s=a*e;(this._uniqueArgs[r].row+"").length>i.length&&(i=this._uniqueArgs[r].row+""),(this._uniqueArgs[r].row+"").length-s>n.length&&(n=0!==s?(this._uniqueArgs[r].row+"").slice(0,-s):(this._uniqueArgs[r].row+"").slice(0))}this._temporaryText.text(i);var l=t.getBoundingClientRect().width;this._temporaryText.text(n);var c=t.getBoundingClientRect().width,u=(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight-l)/this._uniqueArgs.length;l>u&&(o=!1);var p=t.getBoundingClientRect().height;if(o)this._xAxisAngle=0,this._countedStyles.paddingBottom=p+10;else if(this._xAxisAngle=this.floorAngle(Math.degrees(Math.asin(p/u))),this._countedStyles.paddingBottom=Math.abs(l*Math.sin(Math.radians(this._xAxisAngle)))+15,this._countedStyles.paddingRight<c*Math.cos(Math.radians(this._xAxisAngle))&&(this._countedStyles.paddingRight+=c*Math.cos(Math.radians(this._xAxisAngle))),this._countedStyles.paddingBottom>this._fieldHeight||this._fieldHeight-this._countedStyles.paddingBottom-this._countedStyles.paddingTop<70)return this._argumentsHidden=!0,void(this._countedStyles.paddingBottom=0)}else this._countedStyles.paddingBottom=0},t.prototype.floorAngle=function(e){return e<15?15:e<30?30:e<45?45:e<60?60:e<75?75:90},t.prototype.calculateAxisScales=function(){this._axisWidth=this._fieldWidth-this._countedStyles.paddingRight-this._countedStyles.paddingLeft,this._axisHeight=this._fieldHeight-this._countedStyles.paddingBottom-this._countedStyles.paddingTop,this._yScale.range([this._axisHeight,this._countedStyles.paddingTop]),this._additionalScale.range([this._axisHeight,this._countedStyles.paddingTop]),this._xScale.range([this._countedStyles.paddingLeft,this._axisWidth+this._countedStyles.paddingLeft])},t.prototype.drawAxises=function(){var t=this,i=d3.svg.axis(),n=this._axisesOptions.useMain;n||(this._yScale=this._additionalScale);var o=d3.svg.axis(),r=d3.svg.axis();this._numType?i.scale(this._xScale).orient("bottom"):i.scale(this._xScale).orient("bottom").ticks(this._uniqueArgs.length).tickFormat(function(e){return t._options.showArgumentLabels&&!t._argumentsHidden&&t._uniqueArgs[e]?t._uniqueArgs[e].row||"":""}),n&&(o.scale(this._yScale).orient("left"),this._mainAxisType===e.DataType.Percentage&&o.tickFormat(function(e){return(100*e).toFixed(1)+"%"})),this._axisesOptions.useAdditional&&(r.scale(this._additionalScale).orient("right"),this._additionalAxisType===e.DataType.Percentage&&r.tickFormat(function(e){return(100*e).toFixed(1)+"%"}),this.fixDomains(o,r,this._yScale.domain(),this._additionalScale.domain())),this._content.append("g").attr("class","x-axis").attr("transform","translate(0,"+(t._yScale(0)||0)+")").call(i),this._axisesOptions.useAdditional&&this._content.append("g").attr("class","add-axis").attr("transform","translate("+(this._axisWidth+this._countedStyles.paddingLeft)+",0)").call(r),n&&this._content.append("g").attr("class","y-axis").attr("transform","translate("+this._countedStyles.paddingLeft+",0)").call(o),this._axisesOptions.useAdditional&&this._content.selectAll("g.add-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",0).attr("x2",-this._axisWidth).attr("y2",0),n&&(this._content.select(".y-axis").attr("transform","translate("+this._countedStyles.paddingLeft+",0)"),this._content.selectAll("g.y-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",0).attr("x2",this._axisWidth).attr("y2",0)),this._options.showArgumentLabels&&!this._argumentsHidden&&this._content.selectAll("g.x-axis g.tick text").attr("y",0).attr("transform",function(){return"translate(0, "+(t._yScale(t._yScale.domain()[0])-t._yScale(0)+10)+"), rotate("+t._xAxisAngle+")"}).attr("style",function(){return 0!==t._xAxisAngle?"text-anchor: beggining;":"text-anchor: middle;"}),this.hideOverlappingLabels()},t.prototype.clearAxises=function(){this._content.select("g.x-axis").remove(),this._content.select("g.y-axis").remove(),this._content.select("g.add-axis").remove()},t.prototype.hideOverlappingLabels=function(){var e=this;if(this._axisesOptions.useMain){var t=$(this._htmlelement).find("g.y-axis g.tick");if(!t[1])return;var i=d3.max([Math.abs(Math.floor(t[1].getBoundingClientRect().height)/(Math.floor(t[0].getBoundingClientRect().top)-Math.floor(t[1].getBoundingClientRect().top))),Math.abs(Math.floor(t[t.length-1].getBoundingClientRect().height)/(Math.floor(t[t.length-2].getBoundingClientRect().top)-Math.floor(t[t.length-1].getBoundingClientRect().top)))]);i>=1&&t.attr("class",function(n,o){var r=d3.select(t[n]).data()[0];return i>10?r>0&&r===e._yScale.domain()[1]?o:r<0&&r===e._yScale.domain()[0]?o:"hidden "+o:n%Math.ceil(i)==0?o:"hidden "+o})}if(this._axisesOptions.useAdditional){var n=$(this._htmlelement).find("g.add-axis g.tick");if(!n[1])return;var o=d3.max([Math.abs(Math.floor(n[1].getBoundingClientRect().height)/(Math.floor(n[0].getBoundingClientRect().top)-Math.floor(n[1].getBoundingClientRect().top))),Math.abs(Math.floor(n[n.length-1].getBoundingClientRect().height)/(Math.floor(n[n.length-2].getBoundingClientRect().top)-Math.floor(n[n.length-1].getBoundingClientRect().top)))]);o>=1&&n.attr("class",function(e,t){return e%Math.ceil(o)==0?t:"hidden "+t})}},t.prototype.getPrettyNumber=function(e){var t=1;if(0===e)return e;if(Math.abs(e)>1){for(;Math.abs(e)>100;)e/=10,t*=10;return Math.round(e)*t}for(;Math.abs(e)<10;)e*=10,t/=10;return Math.round(e)*t},t.prototype.drawCharts=function(){var t=this;this._chartArea=this._content.append("g").attr("class","Charts"),this._charts=[];for(var i,n=new e.ChartFactory(this._chartArea,this._xScale,this._yScale,this._parsedCoords.concat([]),this._uniqueArgs,this._options.seriesOptions,this._numType,this._barCount,this._stackedBarCount),o=0;o<this._options.seriesOptions.length;o++)(i=n.createChart(this._options.seriesOptions[o].chartType,this._options.seriesOptions[o].stack)).onClick.on(function(e){t._options.onClickCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),i.onContextMenu.on(function(e){t._options.onContextCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),this._charts.push(i),i.constructor===e.BaseChart.prototype.constructor||this._options.seriesOptions[o].hidden||i.draw()},t.prototype.clearCharts=function(){this._chartArea&&this._chartArea.remove()},t.prototype.drawTooltips=function(){var t=this;this._tooltip=new e.Tooltip(this._content,this._parsedCoords,this._barCount,this._uniqueArgs,this._options.tooltip),this._tooltip.onClick.on(function(e){t._options.onClickCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),this._tooltip.onContextMenu.on(function(e){t._options.onContextCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),this._tooltip.draw()},t.prototype.removeTooltips=function(){this._tooltip&&(this._tooltip.remove(),this._tooltip=null)},t.prototype.needToRedraw=function(){return this._fieldHeight>300||this._fieldHeight-this._countedStyles.paddingBottom-this._countedStyles.paddingTop<150},t.prototype.hideSvg=function(){this._content.style("visibility","hidden")},t.prototype.resizeSvg=function(){this.updateLegendSize(),this._fieldHeight=this._htmlelement.getBoundingClientRect().height-(this._legendSize.height||0)-5,this._fieldWidth=this._htmlelement.getBoundingClientRect().width-(this._legendSize.width||0)-5,this._fieldHeight>0?this._content.attr("height",this._fieldHeight+"px").attr("width",this._fieldWidth+"px"):this._content.attr("height","0px").attr("width","0px")},t.prototype.showSvg=function(){this._content.style("visibility","visible")},t.prototype.clearLegend=function(){this._element.select(".legend").html("")},t.prototype.updateLegendSize=function(){var t=this._element.select(".legend").node();if(this._options.legend.position===e.LegendPosition.Left||this._options.legend.position===e.LegendPosition.Right){t.classList?t.classList.add("vertical"):t.className+=" vertical";var i=t.getBoundingClientRect().width+15;this._legendSize.width=i,this._legendSize.height=null,this._content.attr("style","display: inline-block;")}else t&&(this._legendSize.height=t.getBoundingClientRect().height+5),this._legendSize.width=null},t.prototype.drawLegend=function(){this._element.select(".legend").remove(),this._options.legend.position===e.LegendPosition.Top||this._options.legend.position===e.LegendPosition.Left?this._element.insert("xhtml:div","svg").attr("class","legend"):this._element.insert("xhtml:div",".popOvers").attr("class","legend"),new e.Legend(this._element.select(".legend"),this._options.legend,this._legendItems,this._options.styling).create()},t.prototype.draw=function(){this.hideSvg(),console.log("not parsed: ",this._notParsed),this._notParsed&&(console.log("parsing started"),this.parse(),console.log("parsing finished"),console.log(this)),this.clearLegend(),this.clearAxises(),this.clearCharts(),this.removeTooltips(),this._parsedData&&this._parsedData[0]&&(this.drawLegend(),this.updateLegendSize(),this.recalculateVisualProps(),this.calculateAxisScales(),this.drawAxises(),this.calculateCoords(),this.drawCharts(),this.drawTooltips(),this.showSvg())},t.prototype.throwError=function(e){var t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-warning"),t.classList.add("fade"),t.classList.add("in"),t.innerHTML=e,t.setAttribute("id","chartError"),this._element.node().appendChild(t)},t.prototype.clearError=function(){var e=this._htmlelement.querySelector("#chartError");e&&e.remove()},t.prototype.clear=function(){this._element.html(""),this.clearError()},t.prototype.redraw=function(){this.draw()},t.prototype.resize=function(){this.error||(this.resizeSvg(),this.clearAxises(),this.clearCharts(),this.removeTooltips(),0!==this._fieldWidth&&0!==this._fieldHeight&&(this.needToRedraw()&&(this._argumentsHidden=!1,this.recalculateVisualProps()),this._parsedData&&this._parsedData[0]&&(this.calculateAxisScales(),this.drawAxises(),this.calculateCoords(),this.drawCharts(),this.drawTooltips())))},t.prototype.hide=function(){this.hideSvg()},t.prototype.show=function(){this.showSvg()},Object.defineProperty(t.prototype,"error",{get:function(){return this._htmlelement.querySelector("#chartError")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._rawData},set:function(e){this._rawData=e,this._notParsed=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(e){this._rawData===e.dataSource&&this._options.seriesOptions===e.seriesOptions||(this._notParsed=!0),this._options=e,this._rawData=e.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seriesOptions",{get:function(){return this._options.seriesOptions},set:function(e){this._options.seriesOptions=e,this._notParsed=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showArgumentLabels",{get:function(){return this._options.showArgumentLabels},set:function(e){e!==this._options.showArgumentLabels&&(this._notParsed=!0),this._options.showArgumentLabels=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"legend",{get:function(){return this._options.legend},set:function(e){this._options.legend=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styling",{get:function(){return this._options.styling},set:function(e){this._options.styling=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tooltip",{get:function(){return this._options.tooltip},set:function(e){this._options.tooltip=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._htmlelement},enumerable:!0,configurable:!0}),t}();e.ChartCtrl=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(t){function i(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=i(e[n]));return t}var n=function(){function t(){}return t.createGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.getDataSource=function(t){for(var i=[],n=t.cells.values,o=t.cells.displayValues,r=t.cells.formatStrings,a=0;a<t.rows.positions.length;a++){for(var s={},l="",c=0;c<t.rows.positions[a].positions.length;c++)""!==l&&(l+=", "),l+=t.rows.members[t.rows.positions[a].positions[c].id].caption;s.row=l,s.uniqueRowName=this.createGuid();for(var u=0;u<t.columns.positions.length;u++){var p=n[a][u],h=o[a][u],d=r[a][2*u];if(null!==p){s["column"+u]=p,s["displayValue"+u]=h,s["format"+u]="Percent"===d?e.DataType.Percentage:e.DataType.Number;var m=this.getRowDescription(t,a),f=this.getColumnDescription(t,u);s["data"+u]={row:m,column:f,index:u}}}i.push(s)}return i},t.getRowDescription=function(e,t){var i={};i.column=e.rows.hierarchies.length-1;for(var n=e.rows.positions[t].positions[i.column].id,o=e.rows.members[n],r="",a=0;a<e.rows.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.rows.members[e.rows.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.rows.hierarchies[i.column],i.place="rows",i.endRow=i.startRow=t,i.ancestors=[],i.data=o,i},t.getColumnDescription=function(e,t){var i={};i.row=e.columns.hierarchies.length-1;for(var n=e.columns.positions[t].positions[i.row].id,o=e.columns.members[n],r="",a=0;a<e.columns.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.columns.members[e.columns.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.columns.hierarchies[i.row],i.place="columns",i.endColumn=i.startColumn=t,i.ancestors=[],i.data=o,i},t.getSeries=function(t,i,n,o){var r,a,s,l,c,u,p,h,d=new e.ColorGenerator(n);if(i[0]){r=[];for(f=0;f<i.length;f++)if(s={},void 0!==(a=(g=i[f]).columnIndex)&&void 0!==t.columns&&void 0!==t.columns.members[a]){for(s.chartType=g.diagramType,s.useAdditionalAxis=g.useAdditionalAxis,s.argumentField="row",p="column"+a,u="displayValue"+a,h="format"+a,c="",l=0;l<t.columns.positions[a].positions.length;l++)""!==c&&(c+=", "),c+=t.columns.members[t.columns.positions[a].positions[l].id].caption;s.displayValueField=u,s.valueField=p,s.name=c,s.formatField=h,s.columnIndex=a,s.color=d.getRecomendedColor(f,i.length),r.push(s)}return r}if(void 0!==o){i=[];for(var m=0;m<t.columns.positions.length;m++)i.push({diagramType:o,columnIndex:m});r=[];for(var f=0;f<i.length;f++){var g=i[f];if(s={},i&&i.length){if(void 0===(a=g.columnIndex))continue;s.chartType=g.diagramType,s.argumentField="row"}for(p="column"+a,u="displayValue"+a,h="format"+a,c="",l=0;l<t.columns.positions[a].positions.length;l++)""!==c&&(c+=", "),c+=t.columns.members[t.columns.positions[a].positions[l].id].caption;s.displayValueField=u,s.valueField=p,s.name=c,s.formatField=h,s.columnIndex=a,s.color=d.getRecomendedColor(f,i.length),r.push(s)}return r}return[]},t.generateOrgeredSeries=function(t,n,o,r){var a,s,l,c,u,p,h,d,m=[],f=[],g=new e.ColorGenerator(o);if(void 0!==r){n=[];for(var _=0;_<t.columns.hierarchies.length;_++){m[_]=[];for(var y=0;y<t.columns.positions.length;y++){var v=t.columns.positions[y],C=t.columns.members[v.positions[_].id].uniqueName;m[_].indexOf(C)<0&&m[_].push(C)}}for(var b=0;b<m[m.length-1].length;b++){var w=m.length-1,S={};S[w]=m[w][b],f.push(S)}for(var x=m.length-2;x>=0;x--){for(var D=[],T=0;T<f.length;T++)for(var P=f[T],I=0;I<m[x].length;I++){var M=i(P);M[x]=m[x][I],D.push(M)}f=D}for(var E=0;E<f.length;E++)for(var F=0;F<t.columns.positions.length;F++){for(var N=!0,$=0;$<t.columns.positions[F].positions.length;$++){var O=t.columns.positions[F].positions[$].id,L=f[E][$];t.columns.members[O].uniqueName!==L&&(N=!1)}N&&n.push({diagramType:r,columnIndex:F})}a=[];for(var A=0;A<n.length;A++){var R=n[A];if(l={},n&&n.length){if(void 0===(s=R.columnIndex))continue;l.chartType=R.diagramType,l.argumentField="row"}for(h="column"+s,p="displayValue"+s,d="format"+s,u="",c=0;c<t.columns.positions[s].positions.length;c++)""!==u&&(u+=", "),u+=t.columns.members[t.columns.positions[s].positions[c].id].caption;l.displayValueField=p,l.valueField=h,l.name=u,l.formatField=d,l.columnIndex=s,l.color=g.getRecomendedColor(A,n.length),a.push(l)}return a}return[]},t}();t.ChartDataHelper=n}(e.Chart||(e.Chart={}))}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(){function t(t,i,n,o,r,a,s,l){this._onClick=new e.Events.LiteEvent,this._onContextMenu=new e.Events.LiteEvent,this._xScale=i,this._yScale=n,this._data=o,this._content=t,this._uniqueArgs=r,this._color=a,this._showLabels=!0,this._numType=l,this._prevStackedCoord=[]}return t.prototype.draw=function(){throw Error("This class is abstract")},Object.defineProperty(t.prototype,"onClick",{get:function(){return this._onClick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onContextMenu",{get:function(){return this._onContextMenu},enumerable:!0,configurable:!0}),t}();t.BaseChart=i}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(e){function t(t,i,n,o,r,a,s,l){e.call(this,t,i,n,o,r,a,s,l)}return __extends(t,e),t.prototype.drawChart=function(){var e=this;this._coords=this._data;var t=this._content,i=this,n=d3.svg.area().x(function(t,i){return e._coords[i].x}).y0(this._yScale(0)).y1(function(t,i){return e._coords[i].y});t.append("path").datum(this._coords).attr("class","area").attr("d",n).attr("fill",this._color).attr("fill-opacity",.65),this._content.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill",function(e){return e.color}).on("click",function(e,t){var n=d3.event;i._onClick.trigger({d:e,i:t,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,t){var n=d3.event;i._onContextMenu.trigger({d:e,i:t,context:this,event:n}),n.preventDefault()});var o=t.append("g").attr("class","area-selection");o.append("path").datum(this._coords).attr("d",n).attr("fill","black").attr("fill-opacity",1),o.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill","black").on("click",function(e,t){var n=d3.event;i._onClick.trigger({d:e,i:t,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,t){var n=d3.event;i._onContextMenu.trigger({d:e,i:t,context:this,event:n}),n.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(t){var i=t;t.target;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(t){var i=t;t.target;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(0)})},t.prototype.setSelectionOpacity=function(e){this._content.select(".area-selection").attr("opacity",e||0)},t.prototype.draw=function(){this.drawChart()},t}(e.BaseChart);e.AreaChart=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(t){function i(i,n,o,r,a,s,l,c,u,p){t.call(this,i,n,o,r,a,s,l,c),this._maxBarWidth=e.ChartConf.maxBarWidth,this._barCount=u,this._index=p;var h=i.node().parentNode.parentNode,d=d3.select(h).select(".x-axis .domain").node();if(d){var m=d.getBoundingClientRect().width;m/((this._uniqueArgs.length+1)*this._barCount)<this._maxBarWidth&&(this._maxBarWidth=m/((this._uniqueArgs.length+1)*this._barCount))}}return __extends(i,t),i.prototype.drawChart=function(){var e=this,t=this._maxBarWidth,i=this._maxBarWidth*this._barCount;this._coords=this._data;var n=this;this._content.append("g").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(n){return n.x-i/2+t*e._index}).attr("y",function(e){return e.y}).attr("width",t).attr("height",function(e){return e.height>=0?e.height:0}).attr("fill",function(t){return t.color||e._color}).on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:d3.mouse}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:d3.mouse}),i.preventDefault()}),this._content.append("g").attr("class","bar-selection").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(n){return n.x-i/2+t*e._index}).attr("y",function(e){return e.y}).attr("width",t).attr("height",function(e){return e.height>=0?e.height:0}).attr("fill","black").on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(0)})},i.prototype.setSelectionOpacity=function(e){this._content.select(".bar-selection").attr("opacity",e||0)},i.prototype.draw=function(){this.drawChart()},i}(e.BaseChart);e.BarChart=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(e,t,i,n,o,r,a,s,l){this._xScale=t,this._yScale=i,this._data=n,this._content=e,this._uniqueArgs=o,this._numType=a,this._barIndex=0,this._barCount=s,this._index=0,this._series=r;var c=d3.select(e.node().parentNode).select(".x-axis .domain").node();this._width=c.getBoundingClientRect().width,this._color=d3.scale.category20(),this._stackedBars=l,this._stackedBarIndex=0,this._uniqueStackBars=[]}return t.prototype.createChart=function(t,i){switch(t){case e.ChartTypes.Line:return new e.LineChart(this._content.insert("g",".x-axis").attr("class","line"),this._xScale,this._yScale,this._data[this._index],this._uniqueArgs,this._series[this._index].color||this._color(this._index),this._series[this._index++].label,this._numType);case e.ChartTypes.Area:return new e.AreaChart(this._content.insert("g",".x-axis").attr("class","area"),this._xScale,this._yScale,this._data[this._index],this._uniqueArgs,this._series[this._index].color||this._color(this._index),this._series[this._index++].label,this._numType);case e.ChartTypes.Bar:return new e.BarChart(this._content.insert("g",".x-axis").attr("class","bar"),this._xScale,this._yScale,this._data[this._index],this._uniqueArgs,this._series[this._index].color||this._color(this._index),this._series[this._index++].label,this._numType,this._barCount,this._barIndex++);case e.ChartTypes.StackedBar:var n=i||"defaultBar";return this._uniqueStackBars.indexOf(n)<0?(this._stackedBarIndex=this._uniqueStackBars.length,this._uniqueStackBars.push(n)):this._stackedBarIndex=this._uniqueStackBars.indexOf(n),new e.StackedBarChart(this._content.insert("g",".x-axis").attr("class","stackedBar"),this._xScale,this._yScale,this._data[this._index],this._uniqueArgs,this._series[this._index].color||this._color(this._index),this._series[this._index++].label,this._numType,this._width,this._stackedBars,this._stackedBarIndex);case e.ChartTypes.StackedArea:return new e.StackedAreaChart(this._content.insert("g",".Stack"+(i||"defaultArea")).attr("class","Stack"+(i||"defaultArea")),this._xScale,this._yScale,this._data[this._index],this._uniqueArgs,this._series[this._index].color||this._color(this._index),this._series[this._index++].label,this._numType);default:throw Error("Wrong parameters")}},t}();e.ChartFactory=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(e){function t(t,i,n,o,r,a,s,l){e.call(this,t,i,n,o,r,a,s,l)}return __extends(t,e),t.prototype.drawChart=function(){var e=this;this._coords=this._data;var t=this,i=d3.svg.line().x(function(t,i){return e._coords[i].x}).y(function(t,i){return e._coords[i].y});this._content.append("g").attr("class","line").append("path").datum(this._coords).attr("d",i).attr("stroke",this._color).attr("fill","none").attr("stroke-width","2"),this._content.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill",function(e){return e.color}).on("click",function(e,i){var n=d3.event;t._onClick.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,i){var n=d3.event;t._onContextMenu.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()});var n=this._content.append("g").attr("class","line-selection");n.append("path").datum(this._coords).attr("d",i).attr("stroke","black").attr("fill","none").attr("stroke-width","2"),n.append("g").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill","black").on("click",function(e,i){var n=d3.event;t._onClick.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,i){var n=d3.event;t._onContextMenu.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(0)})},t.prototype.setSelectionOpacity=function(e){this._content.select(".line-selection").attr("opacity",e||0)},t.prototype.draw=function(){this.drawChart()},t}(e.BaseChart);e.LineChart=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(e){function t(t,i,n,o,r,a,s,l){e.call(this,t,i,n,o,r,a,s,l)}return __extends(t,e),t.prototype.draw=function(){var e=this,t=this;this._coords=this._data;var i,n=this._content.node();n.classList?n.classList.add("stackedArea"):n.className+=" stackedArea",i=document.querySelector(".stackedLine")?this._content.insert("g",".stackedLine").attr("class","stackedLine"):this._content.append("g").attr("class","stackedLine");var o=d3.svg.area().x(function(t,i){return e._coords[i].x}).y0(this._yScale(0)).y1(function(t,i){return e._coords[i].y});i.append("path").datum(this._coords).attr("d",o).attr("fill",this._coords[0].color),this._content.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill",function(e){return e.color}).on("click",function(e,i){var n=d3.event;t._onClick.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,i){var n=d3.event;t._onContextMenu.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()});var r=this._content.append("g").attr("class","stackedArea-selection");r.append("path").datum(this._coords).attr("d",o).attr("fill","black"),r.append("g").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill","black").on("click",function(e,i){var n=d3.event;t._onClick.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,i){var n=d3.event;t._onContextMenu.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(0)})},t.prototype.setSelectionOpacity=function(e){this._content.select(".stackedArea-selection").attr("opacity",e||0)},t}(e.BaseChart);e.StackedAreaChart=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(t){function i(i,n,o,r,a,s,l,c,u,p,h){t.call(this,i,n,o,r,a,s,l,c),this._chartWidth=u,this._maxBarWidth=e.ChartConf.maxBarWidth,this._count=p,this._index=h,(this._chartWidth-40)/(a.length+1)<this._maxBarWidth&&(this._maxBarWidth=(this._chartWidth-40)/((a.length+1)*this._count))}return __extends(i,t),i.prototype.drawChart=function(){var e=this,t=this,i=this._maxBarWidth;this._coords=this._data;var n=this._count*i;this._content.append("g").attr("class","bars").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(t){return t.x-n/2+i*e._index}).attr("y",function(e){return e.y}).attr("width",i).attr("height",function(e){return e.height}).attr("fill",function(e){return e.color}).on("click",function(e,i){var n=d3.event;t._onClick.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,i){var n=d3.event;t._onContextMenu.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}),this._content.append("g").attr("class","stackedBar-selection").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(t){return t.x-n/2+i*e._index}).attr("y",function(e){return e.y}).attr("width",i).attr("height",function(e){return e.height}).attr("fill","black").on("click",function(e,i){var n=d3.event;t._onClick.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(e,i){var n=d3.event;t._onContextMenu.trigger({d:e,i:i,context:this,event:n}),n.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(t){var i=t;e._coords[0].name===i.detail.name&&e.setSelectionOpacity(0)})},i.prototype.setSelectionOpacity=function(e){this._content.select(".stackedBar-selection").attr("opacity",e||0)},i.prototype.draw=function(){this.drawChart()},i}(e.BaseChart);e.StackedBarChart=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){e[e.Line=0]="Line",e[e.Area=1]="Area",e[e.Bar=2]="Bar",e[e.StackedArea=3]="StackedArea",e[e.StackedBar=4]="StackedBar"}(e.ChartTypes||(e.ChartTypes={}));e.ChartTypes;!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Left=2]="Left",e[e.Right=3]="Right"}(e.LegendPosition||(e.LegendPosition={}));e.LegendPosition;!function(e){e[e.Number=0]="Number",e[e.Percentage=1]="Percentage"}(e.DataType||(e.DataType={}));e.DataType}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var t,i;e.ranetPies=function(n,o){var r,a,s=this,l={header:{title:{text:"",fontSize:24,font:"open sans"}},size:{canvasHeight:400,canvasWidth:400,pieInnerRadius:"0%",pieOuterRadius:"70%"},data:{content:[]},labels:{outer:{format:"label",pieDistance:32},inner:{format:"value",hideWhenLessThanPercentage:3},mainLabel:{color:"#fff",fontSize:11},percentage:{color:"#fff",fontSize:9,decimalPlaces:0},value:{color:"#fff",fontSize:11},lines:{enabled:!0},truncation:{enabled:!0}},tooltips:{enabled:!0,type:"placeholder",string:"{label}: {value}",styles:{backgroundColor:"#ffffff",backgroundOpacity:1,color:"#000000",fontSize:13,padding:5}},effects:{load:{effect:"none"},pullOutSegmentOnClick:{effect:"linear",speed:400,size:8}},legend:{visible:!0},dataSource:[],minHeight:200},c=this;c.settings=e.extend({},l);var u;this.redraw=function(){r&&r.redraw()},this.resize=function(){clearTimeout(a),r&&(a=setTimeout(function(){r.redraw()},50))},this.error=function(e){r||(r=new Ranet.Controls.Extensions.Pies(n,s.settings),o=r.options),r.clear(),r.throwError(e)},this.clearError=function(){r&&r.clearError()},this.options=function(o){if(!o)return s.settings;if(o.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Chart)r&&r.clear(),t=o.useMultipleCharts?new e.ranetMultipleControl(i,o):new e.ranetChart(n,o),e(i).css("overflow-y","hidden"),e(i).data("ranetChart",t),t.visible=!0,t.redraw();else{o.pie&&(o=o.pie);var a=e.extend({},s.settings,o);r.options=a,s.settings=r.options}},this.option=function(e,t){switch(e){case"dataSource":if(!t)return s.settings.dataSource;s.settings.dataSource=t,r.clear(),r=new Ranet.Controls.Extensions.Pies(i,s.settings),s.settings=r.options;break;case"seriesOptions":if(!t)return s.settings.specifiedSeries;s.settings.specifiedSeries=t}};this.destroy=function(){},this.visibility=function(e){u=e},this._type=Ranet.Controls.Extensions.ExtensionTypes.Pie,function(){e(i).css("overflow-y","auto");var t=e.extend(c.settings,o);r=new Ranet.Controls.Extensions.Pies(n,t)}()},e.ranetChart=function(n,o){var r,a,s=this,l={options:null,control:null},c={dataSource:[],seriesOptions:[],legend:{visible:!0,position:Ranet.Controls.Extensions.LegendPosition.Top},tooltip:{enabled:!0,font:{family:"Courier New"}},styling:{paddingLeft:10,paddingRight:0,paddingTop:10,paddingBottom:25},showArgumentLabels:!0};l.options=e.extend(!0,{},c),this.redraw=function(){l.control&&(r?l.control.redraw():l.control.clear())},this.option=function(t,i){if(void 0===i)return l.options[t];"object"==typeof i?"dataSource"===t||"seriesOptions"===t||"showArgumentLabels"===t?l.options[t]=i:e.extend(!0,i,l.options[t]):l.options[t]=i,"dataSource"===t&&i[0]&&(l.control?l.control.options=l.options:l.control=new Ranet.Controls.Extensions.ChartCtrl(n,l.options))},this.error=function(e){l.control||(l.control=new Ranet.Controls.Extensions.ChartCtrl(n,l.options),l.options=l.control.options),l.control.clear(),l.control.throwError(e)},this.clearError=function(){l.control&&l.control.clearError()},this.options=function(o){if(!o){if(l.control){var a=l.options.seriesOptions;l.options=l.control.options,l.options.seriesOptions=a}return l.options}if(o.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Pie)r=!1,s.redraw(),t=new e.ranetPies(n,o.pie),e(i).data("ranetChart",t),t.redraw();else if(o.useMultipleCharts)r=!1,s.redraw(),t=new e.ranetMultipleControl(i,o),e(i).data("ranetChart",t),t.redraw();else{var c;(c=l.control?l.control.options:l.options).tooltip=e.extend(c.tooltip,o.tooltip),c.legend=e.extend(c.legend,o.legend),c.styling=e.extend(c.styling,o.styling),c.dataSource=o.dataSource,c.seriesOptions=o.seriesOptions,c.showArgumentLabels=o.showArgumentLabels,c.onContextCallback=o.onContextCallback,l.control?l.control.options=c:l.options=c}};this.destroy=function(){},this._type=Ranet.Controls.Extensions.ExtensionTypes.Chart,this.visibility=function(e){r=e,s.redraw()},this.isDrawn=function(){return!!l.control&&!e(l.control.element).is(":empty")},this.element=function(){return l.control?l.control.element:n},this.resize=function(){clearTimeout(a),l.control&&(a=setTimeout(function(){l.control.resize(),a=void 0,e(n).css("visibility","visible"),l.control.show()},50))},e(i).css("overflow-y","hidden"),l.options.useMultipleCharts,l.options=e.extend(!0,l.options,o),l.options.dataSource&&l.options.dataSource[0]&&(l.control=new Ranet.Controls.Extensions.ChartCtrl(n,l.options),l.options=l.control.options),r=!0},e.ranetMultipleControl=function(n,o){var r=this,a={options:null,controls:[]},s=function(){for(var t=0;t<a.controls.length;t++)a.controls[t].visibility(!1),a.controls[t].redraw();a.controls=[],e(n).empty()};this.error=function(t){s(),r._error=e("<div class='alert alert-warning fade in'/>").text(t),e(n).append(r._error)},this.clearError=function(){r._error&&r._error.remove()};var l,c=function(){if(l){var t=e.extend(!0,{},a.options);if(a.options){for(var i=0;i<a.options.seriesOptions.length;i++){var o=Math.floor(100/a.options.multipleColumns)+"%",s=Math.floor(100/a.options.multipleRows)+"%",c=e("<div />").addClass("Chart_Container").css("width",o).css("height",s);e(n).append(c),t.seriesOptions=[a.options.seriesOptions[i]],t.useMultipleCharts=!1;var u=new e.ranetChart(c.get(0),t);a.controls[i]=u}a.controls.length=a.options.seriesOptions.length,r.redrawCharts()}}},u=function(){a.options.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Chart?a.options.useMultipleCharts?a.options.seriesOptions.length:(s(),t=new e.ranetChart(i,a.options),e(i).data("ranetChart",t),e(i).css("overflow-y","auto")):a.options.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Pie&&(s(),t=new e.ranetPies(i,a.options.pie),e(i).data("ranetChart",t))};this.options=function(t){if(!t)return a.options;a.options=e.extend(!0,a.options,t),u()},this.option=function(e,t){if(!t)return a.options[e];a.options[e]=t,u()},this.redraw=function(){s(),c(),e(i).css("overflow-y","auto")},this.resize=function(){for(var e=0;e<a.controls.length;e++)a.controls[e].resize()},this.redrawCharts=function(){for(var t=0;t<a.controls.length;t++)a.controls[t].redraw(),a.controls[t].isDrawn()||e(a.controls[t].element()).css("display","none")};this.destroy=function(){},this.visibility=function(e){l=e,r.redraw()},l=!0,e(i).css("overflow-y","auto"),o.multipleColumns||(o.multipleColumns=1),o.multipleRows||(o.multipleRows=1),a.options=e.extend(!0,a.options,o),c()},e.fn.ranetChart=function(n){return this.each(function(){void 0==e(this).data("ranetChart")&&(n.extensionType!==Ranet.Controls.Extensions.ExtensionTypes.Chart&&n.extensionType?n.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Pie&&(t=new e.ranetPies(this,n.pie)):n.useMultipleCharts?t=new e.ranetMultipleControl(this,n):(e(this).css("overflow-y","hidden"),t=new e.ranetChart(this,n)),e(this).data("ranetChart",t),i=this)})}}(jQuery),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}var t=window;if("function"==typeof t.CustomEvent)return!1;e.prototype=t.Event.prototype,t.CustomEvent=e}();var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i,n){this._content=e,this._legendConf=t,this._legendItems=i,this._chartStyling=n,this._maxLegendItemLength=d3.max(this._legendItems,function(e){return e.name.length})}return e.prototype.create=function(){if(this._legendConf.visible){var e=this;this._content.selectAll("items").data(this._legendItems).enter().append("xhtml:span").html(function(e){var t="<span style='color:"+e.color+";font-size:18px;'>&#9632;</span> ";return t+=e.name}).attr("class","legendItem").style("opacity",function(e){return e.visible?"1":"0.5"}).on("mouseenter",this._legendConf.onmouseenterevent||function(){}).on("mouseleave",this._legendConf.onmouseleaveevent||function(){}).on("click",function(t,i){e._legendConf.onclickevent(t,i),t.visible=!t.visible,d3.select(this).style("opacity",function(){return t.visible?"1":"0.5"})}),1===this._legendItems.length?this._content.style("overflow","hidden").style("text-overflow","ellipsis"):this._content.style("overflow-x","auto").style("text-overflow","initial")}},e.prototype.clear=function(){this._content.html("")},Object.defineProperty(e.prototype,"legendItems",{set:function(e){this._legendItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{set:function(e){this._legendConf.visible=e},enumerable:!0,configurable:!0}),e}();e.Legend=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.maxBarWidth=50,e.legendHeight=39,e}();e.ChartConf=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(){function i(t,i,n,o,r){this._onClick=new e.Events.LiteEvent,this._onContextMenu=new e.Events.LiteEvent,this._points=[];var a=0;this._stackedBars=[],this._uniqueStacks=[];var s;for(s=0;s<i.length;s++)for(var l=0;l<i[s].length;l++)this._points.push(i[s][l]),void 0===this._stackedBars[i[s][l].stack]?(this._stackedBars[i[s][l].stack]=0,this._uniqueStacks.push(i[s][l].stack)):(this._stackedBars[i[s][l].stack]=a,a++);this._stackedBarCount=0;for(var c=0;c<this._uniqueStacks.length;c++)this._stackedBarCount+=this._stackedBars[this._uniqueStacks[c]];for(this._barCount=n,this._content=t,this._uniqueArgs=o,this._argPointMap=[],s=0;s<this._uniqueArgs.length;s++)this._argPointMap[this._uniqueArgs[s].uniqueName]=this.getSameArgumentPoints(this._uniqueArgs[s].uniqueName);this._conf=r}return Object.defineProperty(i.prototype,"onClick",{get:function(){return this._onClick},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onContextMenu",{get:function(){return this._onContextMenu},enumerable:!0,configurable:!0}),i.prototype.draw=function(){if(this._conf.enabled){var e=this,i=this._content.node(),n=d3.select(i).select(".x-axis .domain").node(),o=t.ChartConf.maxBarWidth,r=t.ChartConf.maxBarWidth;if(n){var a=n.getBoundingClientRect().width;a/((this._uniqueArgs.length+1)*this._barCount)<o&&(o=a/((this._uniqueArgs.length+1)*this._barCount)),a/(this._uniqueArgs.length+1)<r&&(r=(a-40)/((this._uniqueArgs.length+1)*this._uniqueStacks.length))}var s=o*this._barCount,l=this._content.append("g"),c=this,u=this._conf.font||{family:"Courier New"};if(!this._content.node().parentNode)return;var p=d3.select(this._content.node().parentNode).attr("id");this._tooltips=l.attr("class","dots").selectAll(".dot").data(this._points).enter().append("rect").attr("class","dotarea").attr("x",function(e){var i=this;if(i.points=c._argPointMap[e.uniqueArgumentName],i.point=e,i.backgroundColor="white",$(i).popover({container:"#"+p+" .popOvers",trigger:"hover",content:function(){return c._conf.point=i.point,c._conf.points=i.points,c._conf.customizeTooltip.call(i)||e.value.toString()},html:!0,placement:"auto top",template:'<div class="popover chartPopover" role="tooltip" style="; font-family: '+u.family+'"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.seriesType===t.ChartTypes.Bar){var n=c.getBarIndex(c._argPointMap[e.uniqueArgumentName],e);return e.x-s/2+o*n}return e.seriesType===t.ChartTypes.StackedBar?e.x-r/2:e.x-5}).attr("y",function(e){return e.seriesType===t.ChartTypes.Bar||e.seriesType===t.ChartTypes.StackedBar?e.y:e.y-5}).attr("height",function(e){return e.seriesType===t.ChartTypes.StackedBar||e.seriesType===t.ChartTypes.Bar?e.height:10}).attr("width",function(e){return e.seriesType===t.ChartTypes.Bar?o:e.seriesType===t.ChartTypes.StackedBar?r:10}).style("display",function(e){return!1===e.visible?"none":"initial"}).attr("opacity",0).attr("fill","black").on("mouseover",function(e){if(e.seriesType===t.ChartTypes.Bar||e.seriesType===t.ChartTypes.StackedBar)d3.select(this).attr("opacity",.3);else{var i=new CustomEvent("mouseEnterChartDot",{detail:{name:e.name,value:e.value},bubbles:!0,cancelable:!1}),n=document.querySelectorAll(".line");if(n[0])for(a=0;a<n.length;a++)n[a].dispatchEvent(i);var o=document.querySelectorAll(".area");if(o[0])for(a=0;a<o.length;a++)o[a].dispatchEvent(i);var r=document.querySelectorAll(".stackedArea");if(r[0])for(var a=0;a<r.length;a++)r[a].dispatchEvent(i)}}).on("mouseleave",function(e){e.seriesType!==t.ChartTypes.Bar&&e.seriesType!==t.ChartTypes.StackedBar||d3.select(this).attr("opacity",0)}).on("click",function(t,i){var n=d3.event;e._onClick.trigger({d:t,i:i,context:this,event:n}),n.preventDefault()}).on("contextmenu",function(t,i){var n=d3.event;e._onContextMenu.trigger({d:t,i:i,context:this,event:n}),n.preventDefault()})}},i.prototype.remove=function(){d3.selectAll(".chartPopover").remove(),this._tooltips&&this._tooltips.remove()},i.prototype.getSameArgumentPoints=function(e){for(var t=[],i=0;i<this._points.length;i++)this._points[i].uniqueArgumentName===e&&t.push(this._points[i]);return t},i.prototype.getBarIndex=function(e,i){var n=0,o=0;if(i.seriesType===t.ChartTypes.StackedBar)n=this._stackedBars[i.stack];else for(;e[o]!==i;)e[o].seriesType===i.seriesType&&n++,o++;return n},i}();t.Tooltip=i}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){var t=function(){function e(){}return e.isMobileBrowser=function(){var e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)},e.isIE=function(){var e=navigator.userAgent.toLowerCase();return/msie/.test(e)||/trident/.test(e)||/edge/.test(e)},e}();e.ClientInformation=t}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e){this._options=e,this._$container=void 0===this._options.container?$("body"):this._options.container}return e.prototype.show=function(){var t=this;this._contextMenuLayout=e.createContextMenu(this._options),this._$container.append(this._contextMenuLayout);var i=this._contextMenuLayout.find("ul"),n=this.getPositionMenu(this._options.position,i.height(),i.width());this._contextMenuLayout.css("left",n.left+"px"),this._contextMenuLayout.css("top",n.top+"px"),$("body").mousedown(function(e){t._contextMenuLayout.remove()})},e.prototype.getPositionMenu=function(e,t,i){var n=e.left,o=e.top;return $(window).width()<e.left+i&&(n=e.left-i),$(window).height()<=e.top+t&&(o=e.top-t),{top:o,left:n}},e.createContextMenu=function(e){for(var t=$("<div class='ranetContextMenu'/>"),i=$('<ul class="dropdown-menu" role="menu" style=\'display:block;\'/>'),n=0;n<e.dataSource.length;n++){var o=e.dataSource[n],r=$("<li><a style='cursor:default'>"+o.text+"</a></li>");o.disabled&&r.addClass("disabled"),r.on("mousedown",o,function(e){var t=e.data;t.disabled&&e.preventDefault(),t.onMenuItemClick({})}),i.append(r),o.afterInsertSeparator&&i.append('<li class="divider ranetContextMenu-divider"></li>')}return t.append(i),t},e}();e.ContextMenuControl=t}(e.ContextMenu||(e.ContextMenu={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetContextMenu=function(e,t){var i=this;i.settings={};var n;i.init=function(){n=new Ranet.Controls.ContextMenu.ContextMenuControl(t)},i.destroy=function(){},i.show=function(){n.show()},i.option=function(e){e.hasOwnProperty("visible"),e.hasOwnProperty("message")},i.init()},e.fn.ranetContextMenu=function(t){return this.each(function(){var i=new e.ranetContextMenu(this,t);e(this).data("ranetContextMenu",i)})}}(jQuery);var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){this.afterInsertSeparator=!1}}();e.ContextMenuItemOptions=t;var i=function(){return function(){}}();e.PositionDescription=i;var n=function(){return function(){this.dataSource=new Array,this.position=new i}}();e.ContextMenuOptions=n}(e.ContextMenu||(e.ContextMenu={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(){this._handlers=[]}return e.prototype.on=function(e){this._handlers.push(e)},e.prototype.off=function(e){this._handlers=this._handlers.filter(function(t){return t!==e})},e.prototype.trigger=function(e){this._handlers.slice(0).forEach(function(t){return t(e)})},e}();e.LiteEvent=t}(e.Events||(e.Events={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function t(){this._onSelectionChanged=new e.Controls.Events.LiteEvent}return Object.defineProperty(t.prototype,"itemSource",{get:function(){return this._itemSource},set:function(e){this._itemSource=e,this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayPropertyExpr",{get:function(){return this._displayPropertyExpr},set:function(e){this._displayPropertyExpr=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageCssClassExp",{get:function(){return this._imageCssClassExpr},set:function(e){this._imageCssClassExpr=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedExpr",{get:function(){return this._selectedExpr},set:function(e){this._selectedExpr=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItem",{get:function(){var e=this;if(!this.selectedExpr||!this.itemSource)return null;var t=this.itemSource.filter(function(t){return!0===t[e.selectedExpr]});if(0===t.length)return null;if(t.length>1)throw new Error("InvalidOperationException");return t[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._$view||(this._$view=this.getView(),this.itemSource&&this.updateData()),this._$view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),t.prototype.getView=function(){var e=$("<div/>");e.addClass("dropdown btn-group dropDownControl default-dropdown");var t=this.getSelectedItemButton();return this._$imagePanelSelectedButton=t.$imagePanel,this._$textPanelSelectedButton=t.$textPanel,e.append(t.$button),e.append('<button type="button" class="btn btn-default dropdown-toggle caret-btn dropDownControl-caretButton" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>'),this._$listControl=this.getItems(),e.append(this._$listControl),e},t.prototype.getItems=function(){return $('<ul class="dropdown-menu"/>')},t.prototype.updateData=function(){if(this._$view){var e=this;this._$textPanelSelectedButton.empty(),this._$listControl.empty(),this._$imagePanelSelectedButton.removeClass(),this.imageCssClassExp&&this.selectedItem&&(this._$imagePanelSelectedButton.addClass("dropDownControl-imagePanel"),this._$imagePanelSelectedButton.addClass(this.selectedItem[this.imageCssClassExp])),this.displayPropertyExpr&&this.selectedItem&&this._$textPanelSelectedButton.append(this.selectedItem[this.displayPropertyExpr]);for(var t=0;t<this.itemSource.length;t++){var i=this.itemSource[t],n=$("<li/>"),o=$("<a/>");i===this.selectedItem&&(n.addClass("active"),this._$selectedElement=n);var r=$("<div/>");this.imageCssClassExp&&(r.addClass("dropDownControl-imagePanel"),r.addClass(i[this.imageCssClassExp]),o.append(r));var a=$("<span/>");a.append(i[this.displayPropertyExpr]),o.append(a),n.append(o),n.click({data:i,$visualElement:n},function(t){e.changeSelectedItem(t.data.$visualElement,t.data.data)}),this._$listControl.append(n)}this.selectedItem&&this.changeSelectedItem(this._$selectedElement,this.selectedItem)}},t.prototype.changeSelectedItem=function(e,t){this._$selectedElement&&this._$selectedElement.removeClass("active"),e.addClass("active"),this._$selectedElement=e,this._$textPanelSelectedButton.text(t[this.displayPropertyExpr]),this.imageCssClassExp&&this.updateImageClass(t[this.imageCssClassExp]),this.selectedExpr&&(this.selectedItem&&delete this.selectedItem[this.selectedExpr],t[this.selectedExpr]=!0),this._onSelectionChanged.trigger(t)},t.prototype.updateImageClass=function(e){var t=this._$imagePanelSelectedButton.attr("class");if(!t)return this._$imagePanelSelectedButton.addClass("dropDownControl-imagePanel"),void this._$imagePanelSelectedButton.addClass(e);for(var i=t.split(/\s+/),n=0;n<i.length;n++)"dropDownControl-imagePanel"!==i[n]&&(this._$imagePanelSelectedButton.removeClass(i[n]),this._$imagePanelSelectedButton.addClass(e))},t.prototype.getSelectedItemButton=function(){var e=$('<button class="btn btn-default dropdown-toggle btn-toggle-withcarret dropDownControl-contentButton" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"></button>'),t=$("<div/>");e.append(t);var i=$("<span/>");return i.append("&nbsp;"),e.append(i),{$button:e,$imagePanel:t,$textPanel:i}},t}();t.DropDownControl=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function i(t){this._isInit=!1,this._options=t,this._taskGetTemplateWindow=i.getTemplateWindow(e.PathManager.templatesPath),this._isEnabledOkButton=t.isEnabledOkButton}return Object.defineProperty(i.prototype,"isEnabledOkButton",{get:function(){return this._isEnabledOkButton},set:function(e){this._isEnabledOkButton=e,this._templateDescription&&(this._templateDescription.$okButton.removeClass("disabled"),!1===this.isEnabledOkButton&&this._templateDescription.$okButton.addClass("disabled"))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isVisibleCancelButton",{get:function(){return this._options.isVisibleCancelButton},enumerable:!0,configurable:!0}),i.prototype.show=function(){var t=this;!1===this._isInit?this._taskGetTemplateWindow.done(function(e){t._templateDescription=e,t.init(),t.showWindow()}).fail(function(t){e.LogService.error(t),e.UserMessageService.showServerError(t)}):this.showWindow()},i.prototype.showWindow=function(){var e=this,t=this;this._templateDescription.$window.modal("show").appendTo(this._options.container),this._options.draggableWindow&&this._templateDescription.$window.on("shown.bs.modal",function(){t._templateDescription.$window.find(".modal-dialog").draggable({handle:".modal-header"})}),this._templateDescription.$window.on("hidden.bs.modal",function(){e._options.draggableWindow&&e._templateDescription.$window.find(".modal-dialog").draggable("destroy"),e._templateDescription.$window.remove()}),this._options.resizable&&this.enableResizable()},i.prototype.enableResizable=function(){this._templateDescription.$window.find(".modal-content").resizable({minWidth:550,minHeight:300}),this._templateDescription.$window.find(".modal-body").addClass("modal-body-resizable")},i.prototype.init=function(){this._templateDescription.$title.append(this._options.title),this._templateDescription.$content.append(this._options.content);var e=this._templateDescription.$window.find(".modal-dialog");this._options.size===t.WindowSize.Large?e.addClass("modal-lg"):this._options.size===t.WindowSize.Small&&e.addClass("modal-sm"),!1===this.isEnabledOkButton&&this._templateDescription.$okButton.addClass("disabled"),!1===this.isVisibleCancelButton&&this._templateDescription.$cancelButton.hide();var i=this;this._templateDescription.$okButton.on("click",function(e){i._options.onClosed&&i._options.onClosed(i,new t.DialogResultArgs(!0))}),this._templateDescription.$cancelButton.on("click",function(e){i._options.onClosed&&i._options.onClosed(i,new t.DialogResultArgs(!1))}),this._templateDescription.$cancelButton.on("click",function(e){})},i.getTemplateWindow=function(t){var i=$.Deferred();return $.ajax({url:t+"floatingWindow.html"}).done(function(t){var n=$(e.Localization.localizeTemplate(t)),o=n.find(".windowTitle"),r=n.find(".modal-body"),a=n.find("#btnOk"),s=n.find("#btnCancel");i.resolve({$window:n,$okButton:a,$cancelButton:s,$title:o,$content:r})}).fail(function(e){i.reject(e)}),i},i}();t.FloatingWindow=i}(t.Windows||(t.Windows={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){e[e.Large=0]="Large",e[e.Small=1]="Small",e[e.Medium=2]="Medium"}(e.WindowSize||(e.WindowSize={}));var t=e.WindowSize,i=function(){function e(e){this._dialogResult=null,this._dialogResult=e}return Object.defineProperty(e.prototype,"dialogResult",{get:function(){return this._dialogResult},enumerable:!0,configurable:!0}),e}();e.DialogResultArgs=i;var n=function(){return function(){this.draggableWindow=!0,this.size=t.Medium,this.isEnabledOkButton=!0,this.isVisibleCancelButton=!0}}();e.FloatingWindowOptions=n}(e.Windows||(e.Windows={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(e,t){this._options=t,this.init(e)}return Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e,this._$messageElement.empty(),this._$messageElement.append(this._message),this.updateState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._visible?(this._$loadPanel.removeClass("loadPanel-state-invisible"),this.updateState()):this._$loadPanel.addClass("loadPanel-state-invisible"))},enumerable:!0,configurable:!0}),e.prototype.updateState=function(){this._$frontEndPanel.removeClass("loadPanel_frontEndWithText"),this._$frontEndPanel.removeClass("loadPanel_frontEndWithoutText"),this.message?this._$frontEndPanel.addClass("loadPanel_frontEndWithText"):this._$frontEndPanel.addClass("loadPanel_frontEndWithoutText");var e=this.getOffsetFrontEnd(this._$frontEndPanel,this._options.position),t=this.getOffsetControl(this._options.position),i=this.getSize(this._options.position);this._$frontEndPanel.css("transform","translate("+e.left+","+e.top+")"),this._$loadPanel.css("transform","translate("+t.left+","+t.top+")"),this._$loadPanel.css("height",i.height),this._$loadPanel.css("width",i.width)},e.prototype.init=function(e){this._$loadPanel=$("<div/>"),this._$loadPanel.addClass("loadPanel_backstage"),this._$frontEndPanel=$("<div/>"),this._$frontEndPanel.addClass("loadPanel_frontEnd");var t=$("<div/>");t.addClass("loadPanel_frontEnd_content");var i=$("<i/>");i.addClass("fa fa-circle-o-notch fa-spin loadPanel_frontEnd_content_indicator");var n=$("<div/>");this._$messageElement=n,n.addClass("loadPanel_frontEnd_content_text"),this._message=this._options.message,void 0!==this._options.message?n.append(this._options.message):n.append(""),t.append(i),t.append(n),this._$frontEndPanel.append(t),this._$loadPanel.append(this._$frontEndPanel),$(e).append(this._$loadPanel),void 0!==this._options.visible?this.visible=this._options.visible:this.visible=!1,$(window).resize(this,this.resizeWindow)},e.prototype.resizeWindow=function(e){var t=e.data,i=t.getOffsetFrontEnd(t._$frontEndPanel,t._options.position),n=t.getOffsetControl(t._options.position),o=t.getSize(t._options.position);t._$frontEndPanel.css("transform","translate("+i.left+","+i.top+")"),t._$loadPanel.css("transform","translate("+n.left+","+n.top+")"),t._$loadPanel.css("height",o.height),t._$loadPanel.css("width",o.width)},e.prototype.destroy=function(){$(window).off("resize",this.resizeWindow)},e.prototype.getSize=function(e){if(e.of===window)return{height:"100%",width:"100%"};if(e.of instanceof jQuery)return{height:e.of.outerHeight(),width:e.of.outerWidth()};throw new Error("NotImplementationException")},e.prototype.getOffsetControl=function(e){if(e.of===window)return{left:"0px",top:"0px"};if(e.of instanceof jQuery)return{left:e.of.offset().left+"px",top:e.of.offset().top+"px"};throw new Error("NotImplementationException")},e.prototype.getOffsetFrontEnd=function(e,t){var i=0,n=0;return t.of===window?(i=$(window).height(),n=$(window).width()):t.of instanceof jQuery&&(i=t.of.height(),n=t.of.width()),{left:n/2-e.outerWidth()/2+"px",top:i/2-e.outerHeight()/2+"px"}},e}();e.LoadPanel=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetLoadPanel=function(t,i){var n,o=this,r={message:"Loading...",visible:!1,position:{of:window}},a=this;a.settings={},a.init=function(){o.settings=e.extend({},r,i),n=new Ranet.Controls.LoadPanel(t,o.settings)},a.destroy=function(){n.destroy()},a.option=function(e){e.hasOwnProperty("visible")&&(n.visible=e.visible),e.hasOwnProperty("message")&&(n.message=e.message)},a.init()},e.fn.ranetLoadPanel=function(t){return this.each(function(){var i=new e.ranetLoadPanel(this,t);e(this).data("ranetLoadPanel",i)})}}(jQuery);var Ranet;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"isInit",{get:function(){return t._isInit},enumerable:!0,configurable:!0}),t.init=function(i,n,o){if(t._isInit)throw new Error("InvalidOperationException");var r=$.Deferred();return $.when($.ajax({url:i+"api/localization/getDictionary/"+("zh"===o?"zh-CN":o)}),$.ajax({url:n+"vendors/cldrData/main/"+o+"/ca-gregorian.json"}),$.ajax({url:n+"vendors/cldrData/main/"+o+"/numbers.json"}),$.ajax({url:n+"vendors/cldrData/supplemental/likelySubtags.json"})).done(function(e,i,n,a){Globalize.load(i[0],a[0],n[0]),"en"===o?Globalize.loadMessages({en:e[0]}):"ru"===o?Globalize.loadMessages({ru:e[0]}):"zh"===o&&Globalize.loadMessages({zh:e[0]}),t._locale=o,t._isInit=!0,r.resolve({messages:e})}).fail(function(t){e.LogService.error(t),r.reject(t)}),r},t.localizeTemplate=function(e){var i=e,n=Globalize(t._locale).cldr.get("globalize-messages")[t._locale],o=[];for(var r in n)n.hasOwnProperty(r)&&o.push(r);return o.sort(function(e,t){return t.length-e.length}),o.forEach(function(e){i=t.replaceAll(i,"@"+e,n[e])}),i},t.replaceAll=function(e,t,i){return e.replace(new RegExp(t,"g"),i)},t.localize=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return Globalize(t._locale).formatMessage(e,i)},t._isInit=!1,t}();e.Localization=t}(Ranet||(Ranet={}));var Ranet;!function(e){var t=function(){function e(){}return e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];e.forEach(function(e){console.log(e)})},e}();e.LogService=t}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.prototype.filterTree=function(e,t,i){return e},e.prototype.filterList=function(e,t,i){if(0===i.length)return e;for(var n=new Array,o=0;o<e.length;o++){var r=e[o];-1!==r[t].toLowerCase().indexOf(i.toLowerCase())&&n.push(r)}return n},e}();e.ContainsFilterController=t}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i;!function(e){e[e.Selected=0]="Selected",e[e.UnSelected=1]="UnSelected"}(i||(i={}));var n=function(){function n(i){this._filterController=new t.ContainsFilterController,this._grouped=!1,this._multiSelection=!1,this._onSelectionChanged=new e.Events.LiteEvent,this.dataSource=i.dataSource,this._selectedItems=i.selectedItems,this._itemTemplate=i.getItemTemplate,this._headerGroupTemplate=i.headerGroupTemplate,this._messages=i.messages,this._displayExpr=i.displayExpr,this._grouped=i.grouped,this._groupExpr=i.groupExpr,this._multiSelection=i.multiSelection}return Object.defineProperty(n.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this._onSelectionChanged.trigger(this._selectedItems)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onSelectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),n.prototype.getView=function(e){var t=new Array;t=void 0!==e?this._filterController.filterList(this._dataSource,this._displayExpr,e):this._dataSource;var i=$("<div/>");if(i.addClass("ranet-itemsPresenter"),t&&t.length>0){var n=void 0;n=!1===this._grouped?this.getPlainViewItems(t):this.getGroupsViewItems(t),i.append(n)}else{var o=$("<span>"+this._messages.noDataMessage+"</span>");o.addClass("ranet-noDataLabel"),i.append(o)}return i},n.prototype.onClickedItem=function(e,t){if(this._multiSelection)if(t===i.Selected)this._selectedItems.push(e);else{if(t!==i.UnSelected)throw new Error("InvalidOperationException");this._selectedItems.splice(this._selectedItems.indexOf(e),1)}else this._selectedItems=[e];this._onSelectionChanged.trigger(this._selectedItems)},n.prototype.getGroupsViewItems=function(e){for(var t=new Array,i={},n=0;n<e.length;n++){var o=e[n],r=o[this._groupExpr],a=this.getListItem(o,-1!==this._selectedItems.indexOf(o));i[r]?i[r].push(a):i[r]=new Array(a)}for(var s in i)if(i.hasOwnProperty(s)){var l=$("<div/>"),c=i[s],u=$("<div/>");u.append(c),l.append(this.getViewHeaderGroup(s,c)),l.append(u),t.push(l)}return t},n.prototype.getViewHeaderGroup=function(e,i){var n=$("<div/>"),o=void 0;return this._headerGroupTemplate&&(o=this._headerGroupTemplate(new t.HeaderGroupTemplateArgs(i,e))),n.addClass("ranet-headerGroup"),void 0!==o?n.append(o):n.append(e),n},n.prototype.getPlainViewItems=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i],o=this.getListItem(n,-1!==this._selectedItems.indexOf(n));t.push(o)}return t},n.prototype.getListItem=function(e,t){var n=this,o=$("<div/>");o.addClass("ranet-listItem");var r=$("<div/>");r.addClass("ranet-listItemContent");var a;if(this._multiSelection){var s=$("<div/>");s.addClass("ranet-checkBoxColumn"),(a=$("<div/>")).addClass("imageLibrary_check"),!1===t&&a.hide(),s.append(a),o.append(s),r.addClass("ranet-listItemContent_multiSelection")}var l=void 0;return void 0!==this._itemTemplate&&(l=this._itemTemplate(e)),l||(l=e[this._displayExpr]),r.append(l),o.append(r),o.on("click",e,function(e){var t=-1!==n._selectedItems.indexOf(e.data);n._multiSelection&&(t?(o.removeClass("ranet-listItem_selected"),a.hide()):(o.addClass("ranet-listItem_selected"),a.show())),n.onClickedItem(e.data,t?i.UnSelected:i.Selected)}),t&&o.addClass("ranet-listItem_selected"),o},n}();t.ListControl=n}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this._control=e,this._isVisibleSearchPanel=t}return e.prototype.setFocus=function(){this._$searchBox&&this._$searchBox.focus()},e.prototype.getView=function(){var e=this,t=$("<div/>");t.addClass("ranet-lookupContent");var i=this.getContainer();if(this._isVisibleSearchPanel){var n=$("<div/>");n.addClass("ranet-lookupContent-searchPanel"),t.append(n);var o=this._$searchBox=$("<input/>");o.attr("spellcheck","false"),o.attr("autocomplete","off"),o.keyup(function(t){i.empty(),i.append(e._control.getView(o.val()))}),o.addClass("ranet-lookupContent-searchTextBox"),n.append(o)}return i.append(this._control.getView()),t.append(i),t},e.prototype.getContainer=function(){var e=$("<div/>");return e.addClass("ranet-listContainer"),this._isVisibleSearchPanel?e.addClass("ranet-listContainer_withSearchPanel"):e.addClass("ranet-listContainer_withoutSearchPanel"),e},e}();e.PopupContentControl=t}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(t,i){if(this._isInit=!1,this._dataSource=new Array,this._selectedItems=new Array,"undefined"==typeof jQuery)throw new Error("Lookup requires jQuery");this._$panel=$(t),this._options=i;var n=this;this._options.dataSource&&(this._dataSource=this._options.dataSource),this._options.selectedItems&&(this._selectedItems=this._options.selectedItems);var o=null;if(i instanceof e.ListLookupControlOptions)o=e.LookupType.List;else{if(!(i instanceof e.TreeLookupControlOptions))throw new Error("InvalidOperationException");o=e.LookupType.TreeView}if(o===e.LookupType.List){var r=i,a=this._currentControl=new e.ListControl(r);a.onSelectionChanged.on(function(e){n.onSelectionChanged(e)}),this._popupContent=new e.PopupContentControl(a,i.isVisibleSearchPanel),this._popup=new e.PopupControl(this._popupContent)}else{if(o!==e.LookupType.TreeView)throw new Error("InvalidOperationException");var s=i,l=this._currentControl=new e.TreeControl(s);l.onSelectionChanged.on(function(e){n.onSelectionChanged(e)}),this._popupContent=new e.PopupContentControl(l,i.isVisibleSearchPanel),this._popup=new e.PopupControl(this._popupContent)}this._popup.onClosedPopup.on(this.onClosedPopup.bind(this)),this._popup.onOpenedPopup.on(this.onOpenedPopup.bind(this))}return Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){if(!1===this._isInit)throw new Error("The lookup is not initialized");this._dataSource=e,this._currentControl.dataSource=this._dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){if(!1===this._isInit)throw new Error("The lookup is not initialized");this._selectedItems=e,this._currentControl.selectedItems=this._selectedItems,this.drawField(this._selectedItems)},enumerable:!0,configurable:!0}),t.prototype.onOpenedPopup=function(){this._options.onOpenedPopup&&this._options.onOpenedPopup()},t.prototype.onClosedPopup=function(){this._options.onClosedPopup&&this._options.onClosedPopup()},t.prototype.onSelectionChanged=function(t){this._selectedItems=t,this.drawField(t),this._options.onSelectionChanged&&this._options.onSelectionChanged(new e.SelectedItemsArgs(t)),this._popup.isVisible&&!1===this._options.multiSelection&&this._popup.close()},t.prototype.init=function(){if(this._isInit)throw new Error("Lookup has already been initialized");this._isInit=!0;var e=this;$(window).resize(function(){e._popup.isVisible&&e._popup.close()}),this.createLayout(),this._$rootLayout.on("click",function(t){e.onClickRootLayout(t)}),this._options.onInitialized&&this._options.onInitialized(),void 0!==this._options.selectedItems&&this.onSelectionChanged(this._options.selectedItems),this._$panel.append(this._$rootLayout)},t.prototype.drawField=function(t){if(this._$fieldLayout.empty(),this._$fieldLayout.removeClass("ranet-fieldLayoutLookup_noSelectedItems"),this._$fieldLayout.removeClass("ranet-customContentFieldLayoutLookup"),t.length>0){var i=void 0;this._options.fieldTemplate&&(i=this._options.fieldTemplate(new e.SelectedItemsArgs(t))),void 0===i?i=!1===this._options.multiSelection||this._options.multiSelection&&1===t.length?t[0][this._options.displayExpr]:t.length+this._options.messages.prefixMultiSelectionField:this._$fieldLayout.addClass("ranet-customContentFieldLayoutLookup"),this._$fieldLayout.append(i)}else{var n=$("<span>"+this._options.messages.placeholderMessage+"</span>");this._$fieldLayout.addClass("ranet-fieldLayoutLookup_noSelectedItems"),this._$fieldLayout.append(n)}},t.prototype.onClickRootLayout=function(e){var t=this;if(this._popup.isVisible)e.stopPropagation();else{var i=this;setTimeout(function(){var e=i._$rootLayout.offset(),n=t._options.getPopupContainer().offset(),o={left:e.left-n.left,top:e.top-n.top},r=i._$rootLayout.height(),a=i._$rootLayout.outerWidth(),s=i._options.widthPopup?i._options.widthPopup:i._$rootLayout.outerWidth()+"px",l=i._options.heightPopup?i._options.heightPopup:"200px",c=o.left,u=o.top+r+5;"left"===i._options.startPositionPopup?c=o.left:"right"===i._options.startPositionPopup&&(c=o.left+a-Number(s.replace("px",""))),i._popup.show(t._options.getPopupContainer(),c,u,s,l)},1)}},t.prototype.createLayout=function(){this._$rootLayout=$("<div/>"),this._$rootLayout.addClass("ranet-lookup-rootLayout"),this._$fieldLayout=$("<div/>"),this._$fieldLayout.addClass("ranet-fieldLayoutLookup"),this._$rootLayout.append(this._$fieldLayout);var e=$("<div/>");e.addClass("ranet-lookup-arrow");var t=$("<div/>");t.addClass("imageLibrary_downArrow"),e.append(t),this._$rootLayout.append(e)},t}();e.LookupControl=t}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){e[e.List=0]="List",e[e.TreeView=1]="TreeView"}(e.LookupType||(e.LookupType={}));e.LookupType;var t=function(){return function(){this.noDataMessage="No data to display",this.placeholderMessage="Select a value",this.prefixMultiSelectionField=" selected"}}();e.Messages=t;var i=function(){return function(e){this.selectedItems=e}}();e.SelectedItemsArgs=i;var n=function(){return function(e,t){this.itemsGroup=e,this.captionGroup=t}}();e.HeaderGroupTemplateArgs=n;var o=function(){return function(){this.messages=new t,this.isVisibleSearchPanel=!0,this.multiSelection=!1}}();e.LookupControlOptions=o;var r=function(e){function t(){e.apply(this,arguments),this.grouped=!1}return __extends(t,e),t}(o);e.ListLookupControlOptions=r;var a=function(e){function t(){e.apply(this,arguments),this.hoverStateEnabled=!0}return __extends(t,e),t}(o);e.TreeLookupControlOptions=a}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(){function t(t){this._isVisible=!1,this._onOpenedPopup=new e.Events.LiteEvent,this._onClosedPopup=new e.Events.LiteEvent,this._popupContent=t}return Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onOpenedPopup",{get:function(){return this._onOpenedPopup},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClosedPopup",{get:function(){return this._onClosedPopup},enumerable:!0,configurable:!0}),t.prototype.show=function(e,t,i,n,o){var r=this._$popupWindow=$("<div/>");r.addClass("ranet-lookup-popup"),r.append(this._popupContent.getView()),r.css("transform","translate("+t+"px,"+i+"px)"),r.css("width",n),r.css("height",o),r.on("click",function(e){e.stopPropagation()}),this._callbackClosePopup=this.close.bind(this),$("html").one("click",this._callbackClosePopup),void 0!==e&&null!==e?e.append(r):$("body").append(r),this._isVisible=!0,this._onOpenedPopup.trigger()},t.prototype.close=function(){this._isVisible=!1,$("html").off("click",this._callbackClosePopup),this._$popupWindow.off("click"),this._callbackClosePopup=null,this._$popupWindow.remove(),this._onClosedPopup.trigger()},t}();t.PopupControl=i}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(){function i(i){this._onSelectionChanged=new e.Events.LiteEvent,this._isRenderedNow=!1,this._filterController=new t.ContainsFilterController,this._options=i,this._$treePanel=$("<div style='height:100%;width:100%;'/>");var n=this,o=new e.TreeViewOptions;o.displayExpr=i.displayExpr,o.iconExpr=i.iconExpr,o.iconExpandedExpr=i.iconExpandedExpr,o.expandedExpr=i.expandedExpr,o.hasChildrenExpr=i.hasChildrenExpr,o.keyExpr=i.keyExpr,o.hoverStateEnabled=i.hoverStateEnabled,o.selectedExpr=i.selectedExpr,o.dataSource=i.dataSource,o.onItemSelected=function(e){n._isRenderedNow||(n.selectedItems=[e.data])},this._treeView=new e.TreeView(this._$treePanel.get(0),o)}return Object.defineProperty(i.prototype,"onSelectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this._onSelectionChanged.trigger(this._selectedItems)},enumerable:!0,configurable:!0}),i.prototype.getView=function(e){this._isRenderedNow=!0;var t=new Array;t=void 0!==e?this._filterController.filterTree(this._dataSource,this._options.displayExpr,e):this._dataSource,i.setSelectedItemInDataSource(t,this.selectedItems[0],this._options.selectedExpr),this._treeView.dataSource=t;var n=$("<div/>");if(n.addClass("ranet-itemsPresenter"),t&&t.length>0)n.append(this._$treePanel);else{var o=$("<span>"+this._options.messages.noDataMessage+"</span>");o.addClass("ranet-noDataLabel"),n.append(o)}var r=n.find(".treeView");return r&&r.css("border-width",0),this._isRenderedNow=!1,n},i.setSelectedItemInDataSource=function(e,t,n){for(var o=0;o<e.length;o++){var r=e[o];r[n]=!1,r===t&&(r[n]=!0),r.items.length>0&&i.setSelectedItemInDataSource(r.items,t,n)}},i}();t.TreeControl=i}(e.Lookup||(e.Lookup={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetActiveFilters=function(t,i){var n,o=this,r={},a=this;a.settings={},a.init=function(){o.settings=e.extend({},r,i),n=new Ranet.Controls.ActiveFilters.ActiveFiltersPanel(t,o.settings)},Object.defineProperty(a,"isEnabled",{get:function(){return n.isEnabled},set:function(e){n.isEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(a,"isVisible",{get:function(){return n.isVisible},set:function(e){n.isVisible=e},enumerable:!0,configurable:!0}),Object.defineProperty(a,"descriptionActiveFilters",{get:function(){return n.descriptionActiveFilters},enumerable:!0,configurable:!0}),this.setLayout=function(e){n.layout=e},this.setCubeMetaData=function(e){n.mapIdToMetadataItem=e},a.option=function(e){},a.init()},e.fn.ranetActiveFilters=function(t){return this.each(function(){if(void 0==e(this).data("ranetActiveFilters")){var i=new e.ranetActiveFilters(this,t);e(this).data("ranetActiveFilters",i)}})}}(jQuery);var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){this.isEnabled=!0}}();e.ActiveFiltersOptions=t}(e.ActiveFilters||(e.ActiveFilters={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function n(o,r){this._isVisible=!1,this._isEnabled=!0,this._$parentPanel=$(o),this._listControl=n.createContentPanel(),this._options=r;var a=this._$activeFiltersPanel=$("<div/>");a.addClass("activeFiltersPanel-layout");var s=$('<div class="activeFiltersPanel-header"/>');s.append('<div class="imageLibrary_headerIcon activeFiltersPanel-icon"/>'),s.append('<span class="activeFiltersPanel-textHeader">'+e.Localization.localize("MdxDesigner_ActiveFilters")+"</span>"),this._dataManager=new i.DataManager(this._options.connection,this._options.cubeName),a.append(s);var l=$("<div/>");l.addClass("activeFiltersPanel-filtersContainer"),this._loadPanel=new t.LoadPanel(o,{visible:!1,position:{of:window},message:e.Localization.localize("LoadPanel_UpdateActiveFilters")}),l.append(this._listControl),a.append(l),this.isEnabled=this._options.isEnabled}return Object.defineProperty(n.prototype,"layout",{get:function(){return this._layout},set:function(e){this._layout=e,this.drawItems(),$.contains(this._$parentPanel.get(0),this._$activeFiltersPanel.get(0))||this._$parentPanel.append(this._$activeFiltersPanel)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible=e,this._isVisible?$.contains(this._$parentPanel.get(0),this._$activeFiltersPanel.get(0))?this._$parentPanel.show():this._$parentPanel.append(this._$activeFiltersPanel):this._$parentPanel.hide()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,this._isEnabled?this._$activeFiltersPanel.removeClass("activeFiltersPanel-disabledPanel"):this._$activeFiltersPanel.addClass("activeFiltersPanel-disabledPanel")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mapIdToMetadataItem",{get:function(){return this._mapIdToMetadataItem},set:function(e){this._mapIdToMetadataItem=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptionActiveFilters",{get:function(){return this._descriptionActiveFilters},enumerable:!0,configurable:!0}),n.createContentPanel=function(){return $("<ul class='activeFiltersPanel-filtersList'/>")},n.getFilterDescription=function(e,t){for(var n=new Array,o=0;o<e.length;o++){var r=e[o];if(r.filter&&r.filter.isUsed){var a=i.FilterParser.parse(r,t);n.push(a)}}return n},n.prototype.drawItems=function(){var e=this,i=new Array,o=new Array,r=new Array;this.layout.rows&&(i=n.getFilterDescription(this.layout.rows,this.mapIdToMetadataItem)),this.layout.columns&&(o=n.getFilterDescription(this.layout.columns,this.mapIdToMetadataItem)),this.layout.filters&&(r=n.getFilterDescription(this.layout.filters,this.mapIdToMetadataItem)),this._loadPanel.visible=!0,this._dataManager.getCaptions(i,o,r).done(function(n){e._listControl.empty(),e._descriptionActiveFilters=new Array,r&&e.drawDescriptionFilters(t.AreaType.Filters,r,n),i&&e.drawDescriptionFilters(t.AreaType.Rows,i,n),o&&e.drawDescriptionFilters(t.AreaType.Columns,o,n)}).then(function(){e._loadPanel.visible=!1})},n.prototype.onClickDeleteFilter=function(e,t){this._options.onDeleteFilter&&this._options.onDeleteFilter(e,t)},n.prototype.onClickShowFilterEdiror=function(e,t){this._options.onShowFilterEditor&&this._options.onShowFilterEditor(e,t)},n.prototype.drawDescriptionFilters=function(i,n,o){for(var r=this,a=0;a<n.length;a++){var s=n[a],l=s.template;for(var c in o)o.hasOwnProperty(c)&&(l=l.replace(c,o[c]));this._descriptionActiveFilters.push({key:s.caption,value:l});var u=void 0;switch(i){case t.AreaType.Filters:u="imageLibrary_filtersArea";break;case t.AreaType.Rows:u="imageLibrary_rowsArea";break;case t.AreaType.Columns:u="imageLibrary_columnsArea";break;default:throw new Error("InvalidOperationException")}var p=$('<li class="activeFiltersPanel-filterItem"/>'),h=$('<button type="button" class="btn btn-default btn-xs activeFiltersPanel-deleteFilterButton"><div class="imageLibrary_cancelFilter activeFiltersPanel-icon"/></button>'),d=$('<i class="'+u+' activeFiltersPanel-icon activeFiltersPanel-typeAreaIconFilterItem"/>'),m=$('<a class="activeFiltersPanel-contentFilterItem">'+s.caption+"</a>"),f=$('<span class="activeFiltersPanel-contentFilterItem">:&nbsp;</span>'),g=$('<a class="activeFiltersPanel-contentFilterItem">'+l+"</a>");g.attr("title",l),m.attr("title",l),h.attr("title",e.Localization.localize("MdxDesigner_ContextMenu_CancelFilter")),h.click({layoutItem:s.layoutItem},function(e){r.onClickDeleteFilter(i,e.data.layoutItem)}),m.click({layoutItem:s.layoutItem},function(e){r.onClickShowFilterEdiror(i,e.data.layoutItem)}),g.click({layoutItem:s.layoutItem},function(e){r.onClickShowFilterEdiror(i,e.data.layoutItem)}),p.append(h),p.append(d),p.append(m),p.append(f),p.append(g),this._listControl.append(p)}},n}();i.ActiveFiltersPanel=n}(t.ActiveFilters||(t.ActiveFilters={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(e,t){this._cache={},this._cubeName=t,this._connection=e}return t.prototype.getCaptions=function(i,n,o){var r=this,a=$.Deferred(),s=t.getQueryGettingUniqueNames(this._cubeName,i,n,o,this._cache);return s?$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/getCaptionsActiveFilters",data:{connection:this._connection,mdxQuery:s},success:function(e){for(var i=0;i<e.length;i++)r._cache[e[i].Key]=e[i].Value;r._cache=t.sortCacheByLengthProp(r._cache),a.resolve(r._cache)},error:function(t){a.resolve(r._cache),e.LogService.error(t),e.UserMessageService.showError("Error. Getting caption for active filters. Please see log.")}}):a.resolve(r._cache),a},t.sortCacheByLengthProp=function(e){var t,i={},n=new Array;for(t in e)e.hasOwnProperty(t)&&n.push(t);n.sort(function(e,t){return t.length-e.length});for(var o=0;o<n.length;o++)i[t=n[o]]=e[t];return i},t.getQueryGettingUniqueNames=function(e,t,i,n,o){var r="SELECT {} ON 0, {} ON 1 ",a=2,s=new Array,l=!1,c={},u=function(e){for(var t=0;t<e.length;t++){for(var i=e[t],n=new Array,r=0;r<i.uniqueNames.length;r++){var a=i.uniqueNames[r];o[a]||n.push(a)}if(n.length>0&&(!1===c.hasOwnProperty(i.hierarchyUniqueName)?c[i.hierarchyUniqueName]=n.join(", "):c[i.hierarchyUniqueName]=c[i.hierarchyUniqueName]+", "+n.join(", "),l=!0),i.measureUniqueNames.length>0)for(var u=0;u<i.measureUniqueNames.length;u++){var p=i.measureUniqueNames[u];o[p]||(s.push(i.measureUniqueNames[u]),l=!0)}}};u(t),u(i),u(n);for(var p in c)c.hasOwnProperty(p)&&(r+=", {"+c[p]+"} ON "+a++);if(s.length>0&&(r+=", {"+s.join(", ")+"} ON "+a++),!1!==l)return r+=" FROM "+e},t}();t.DataManager=i}(t.ActiveFilters||(t.ActiveFilters={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function e(e){this.uniqueNames=new Array,this.measureUniqueNames=new Array,this._layoutItem=e}return Object.defineProperty(e.prototype,"caption",{get:function(){var e=this.layoutItem.caption;return void 0!==this.captionPrefixes&&(e=this.captionPrefixes.join(" - ")+" - "+e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutItem",{get:function(){return this._layoutItem},enumerable:!0,configurable:!0}),e}();i.FilterDescription=n;var o=function(){function i(){}return i.parse=function(e,n){var o=null,r=null,a=null,s=e.filter;s.customFilter.isUsed&&(o=s.customFilter),s.membersFilter.isUsed&&(r=s.membersFilter.selectionNodes),s.smartCustomFilterDescription&&s.smartCustomFilterDescription.isUsed&&(a=t.SmartFilter.Options.SmartCustomFilterDescription.parse(JSON.stringify(s.smartCustomFilterDescription)));var l=i.parseFilters(e,o,a,r),c=i.getPrefixesCaption(e,n);return l.captionPrefixes=c,"hierarchy"===e.type&&(l.hierarchyUniqueName=e.uniqueName),"level"===e.type&&(l.hierarchyUniqueName=e.parentHierarchyId),l},i.getPrefixesCaption=function(e,t){var i=new Array,n=null,o=null;for(var r in t)if(t.hasOwnProperty(r)){var a=t[r];if("dimension"!==a.type){if("hierarchy"===a.type&&("hierarchy"===e.type&&a.uniqueName===e.uniqueName||"level"===e.type&&a.uniqueName===e.parentHierarchyId)&&(o=a,"hierarchy"===e.type))break;if("level"===a.type&&"level"===e.type&&e.uniqueName===a.uniqueName)break}else n=a}if("hierarchy"===e.type){if(null===n)throw new Error("InvalidOperationException");i.push(n.caption)}else{if("level"!==e.type)throw new Error("InvalidOperationException");if(null===n||null===o)throw new Error("InvalidOperationException");i.push(n.caption),i.push(o.caption)}return i},i.parseFilters=function(o,r,a,s){var l=new n(o);l.template=e.Localization.localize("All");var c=new Array,u=new Array,p=null;null!==s&&void 0!==s&&(p=i.parseMembers(s,c,!1));var h=null;if(null!==r)switch(r.currentDataFilter){case t.DataFilterType.LabelFilter:h=i.parseLabelFilter(r.labelFilter);break;case t.DataFilterType.TopFilter:h=i.parseTopFilter(r.topFilter),u.push(r.topFilter.measureUniqueName);break;case t.DataFilterType.ValueFilter:h=i.parseValueFilter(r.valueFilter),u.push(r.valueFilter.measureUniqueName);break;default:throw new Error("NotImplementedException")}if(null!==a&&a.isUsed)for(var d=0;d<a.filterTreeDescription.length;d++){var m=a.filterTreeDescription[d],f="",g="";f=null===m.level?e.Localization.localize("Filter_Label_HierarchyHasFilter"):e.Localization.localize("Filter_Label_LevelHasFilter",m.level.caption);var _=m.filters.filter(function(e){return e instanceof t.SmartFilter.Options.FilterGroupDescription}),y=m.filters.filter(function(e){return e instanceof t.SmartFilter.Options.TopDataFilter});if(y.length>0){var v=y[0];u.push(v.measureUniqueName),g+=""+i.parseSmartTopFilter(v),_.length>0&&(g+=" "+e.Localization.localize("Filter_Label_fromFilterGroupLabel"))}if(_.length>0){var C=_[0];g+=i.parseSmartGroup(C,u)}null!==h?h+=" "+e.Localization.localize("Filter_Label_And")+" ":h="",h+=f+" ("+g+")"}return null!==h&&null!==p?l.template=h+" "+e.Localization.localize("Filter_Label_And")+" "+p:null!==h?l.template=h:p&&(l.template=p),l.uniqueNames=c,l.measureUniqueNames=u,l},i.parseSmartGroup=function(e,n){for(var o="",r=0;r<e.filters.length;r++){var a=e.filters[r];if(a instanceof t.SmartFilter.Options.LabelDataFilter)o.length>0&&(o+=i.getSmartGroupTextOperation(e.operation)),o+=" "+i.parseSmartLabelFilter(a)+" ";else if(a instanceof t.SmartFilter.Options.ValueDataFilter){o.length>0&&(o+=i.getSmartGroupTextOperation(e.operation));var s=a;n.push(s.measureUniqueName),o+=" "+i.parseSmartValueFilter(s)+" "}else a instanceof t.SmartFilter.Options.FilterGroupDescription&&(o.length>0&&(o+=i.getSmartGroupTextOperation(e.operation)),o+=" ("+i.parseSmartGroup(a,n)+") ")}return o},i.getSmartGroupTextOperation=function(i){switch(i){case t.SmartFilter.Options.GroupOperation.And:return e.Localization.localize("OperationType_And");case t.SmartFilter.Options.GroupOperation.Or:return e.Localization.localize("OperationType_Or");case t.SmartFilter.Options.GroupOperation.NotAnd:return e.Localization.localize("OperationType_NotAnd");case t.SmartFilter.Options.GroupOperation.NotOr:return e.Localization.localize("OperationType_NotOr");default:throw new Error("NotImplementationException")}},i.parseSmartValueFilter=function(i){var n,o=i.measureUniqueName;switch(i.filterType){case t.SmartFilter.Options.ValueDataFilterType.Equal:n=e.Localization.localize("ValueFilter_Equal");break;case t.SmartFilter.Options.ValueDataFilterType.NotEqual:n=e.Localization.localize("ValueFilter_NotEqual");break;case t.SmartFilter.Options.ValueDataFilterType.Greater:n=e.Localization.localize("ValueFilter_Greater");break;case t.SmartFilter.Options.ValueDataFilterType.GreaterOrEqual:n=e.Localization.localize("ValueFilter_GreaterOrEqual");break;case t.SmartFilter.Options.ValueDataFilterType.Less:n=e.Localization.localize("ValueFilter_Less");break;case t.SmartFilter.Options.ValueDataFilterType.LessOrEqual:n=e.Localization.localize("ValueFilter_LessOrEqual");break;case t.SmartFilter.Options.ValueDataFilterType.Between:n=e.Localization.localize("ValueFilter_Between");break;case t.SmartFilter.Options.ValueDataFilterType.BetweenNotIncluding:n=e.Localization.localize("ValueFilter_BetweenNotIncluding");break;case t.SmartFilter.Options.ValueDataFilterType.NotBetween:n=e.Localization.localize("ValueFilter_NotBetween");break;case t.SmartFilter.Options.ValueDataFilterType.NotBetweenNotIncluding:n=e.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;default:throw new Error("NotImplementedExcepion")}switch(o+=" "+n.toLowerCase(),i.filterType){case t.SmartFilter.Options.ValueDataFilterType.Between:case t.SmartFilter.Options.ValueDataFilterType.BetweenNotIncluding:case t.SmartFilter.Options.ValueDataFilterType.NotBetween:case t.SmartFilter.Options.ValueDataFilterType.NotBetweenNotIncluding:o+=" '"+i.num1+"' "+e.Localization.localize("Filter_Label_And")+" '"+i.num2+"'";break;default:o+=" '"+i.num1+"'"}return o},i.parseSmartLabelFilter=function(i){var n="";i.levelPropertyName.toUpperCase()==="Caption".toUpperCase()?n=e.Localization.localize("Olap_Caption"):"Name".toUpperCase()===i.levelPropertyName.toUpperCase()?n=e.Localization.localize("Olap_Name"):"UNIQUE_NAME".toUpperCase()===i.levelPropertyName.toUpperCase()&&(n=e.Localization.localize("Olap_UniqueName")),n="'"+n+"'";var o="";switch(i.filterType){case t.SmartFilter.Options.LabelDataFilterType.Equal:o=e.Localization.localize("ValueFilter_Equal");break;case t.SmartFilter.Options.LabelDataFilterType.NotEqual:o=e.Localization.localize("ValueFilter_NotEqual");break;case t.SmartFilter.Options.LabelDataFilterType.Greater:o=e.Localization.localize("ValueFilter_Greater");break;case t.SmartFilter.Options.LabelDataFilterType.GreaterOrEqual:o=e.Localization.localize("ValueFilter_GreaterOrEqual");break;case t.SmartFilter.Options.LabelDataFilterType.Less:o=e.Localization.localize("ValueFilter_Less");break;case t.SmartFilter.Options.LabelDataFilterType.LessOrEqual:o=e.Localization.localize("ValueFilter_LessOrEqual");break;case t.SmartFilter.Options.LabelDataFilterType.Between:o=e.Localization.localize("ValueFilter_Between");break;case t.SmartFilter.Options.LabelDataFilterType.BetweenNotIncluding:o=e.Localization.localize("ValueFilter_BetweenNotIncluding");break;case t.SmartFilter.Options.LabelDataFilterType.NotBetween:o=e.Localization.localize("ValueFilter_NotBetween");break;case t.SmartFilter.Options.LabelDataFilterType.NotBetweenNotIncluding:o=e.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;case t.SmartFilter.Options.LabelDataFilterType.BeginWith:o=e.Localization.localize("LabelFilter_BeginWith");break;case t.SmartFilter.Options.LabelDataFilterType.NotBeginWith:o=e.Localization.localize("LabelFilter_NotBeginWith");break;case t.SmartFilter.Options.LabelDataFilterType.EndWith:o=e.Localization.localize("LabelFilter_EndWith");break;case t.SmartFilter.Options.LabelDataFilterType.NotEndWith:o=e.Localization.localize("LabelFilter_NotEndWith");break;case t.SmartFilter.Options.LabelDataFilterType.Contain:o=e.Localization.localize("LabelFilter_Contain");break;case t.SmartFilter.Options.LabelDataFilterType.NotContain:o=e.Localization.localize("LabelFilter_NotContain");break;default:throw new Error("NotImplementedException")}switch(n+=" "+o.toLowerCase(),i.filterType){case t.SmartFilter.Options.LabelDataFilterType.Between:case t.SmartFilter.Options.LabelDataFilterType.BetweenNotIncluding:case t.SmartFilter.Options.LabelDataFilterType.NotBetween:case t.SmartFilter.Options.LabelDataFilterType.NotBetweenNotIncluding:n+=" '"+i.text1+"' "+e.Localization.localize("Filter_Label_And")+" '"+i.text2+"'";break;default:n+=" '"+i.text1+"'"}return n},i.parseSmartTopFilter=function(i){var n,o;if(i.filterType===t.SmartFilter.Options.TopDataFilterType.Top)n=e.Localization.localize("Filter_Type_Top");else{if(i.filterType!==t.SmartFilter.Options.TopDataFilterType.Bottom)throw new Error("NotImplementedException");n=e.Localization.localize("Filter_Type_Bottom")}switch(n+=" "+i.count,i.filterTarget){case t.SmartFilter.Options.TopDataFilterTargetType.Items:o=e.Localization.localize("Filter_Target_Items");break;case t.SmartFilter.Options.TopDataFilterTargetType.Percent:o=e.Localization.localize("Filter_Target_Percent");break;case t.SmartFilter.Options.TopDataFilterTargetType.Sum:o=e.Localization.localize("Filter_Target_Sum");break;default:throw new Error("NotImplementedException")}return n+=" "+o.toLowerCase(),n+=" "+e.Localization.localize("Filter_Label_By")+" "+i.measureUniqueName},i.parseLabelFilter=function(i){var n="";i.levelPropertyName.toUpperCase()==="Caption".toUpperCase()?n=e.Localization.localize("Olap_Caption"):"Name".toUpperCase()===i.levelPropertyName.toUpperCase()?n=e.Localization.localize("Olap_Name"):"UNIQUE_NAME".toUpperCase()===i.levelPropertyName.toUpperCase()&&(n=e.Localization.localize("Olap_UniqueName")),n="'"+n+"'";var o="";switch(i.filterType){case t.LabelDataFilterType.Equal:o=e.Localization.localize("ValueFilter_Equal");break;case t.LabelDataFilterType.NotEqual:o=e.Localization.localize("ValueFilter_NotEqual");break;case t.LabelDataFilterType.Greater:o=e.Localization.localize("ValueFilter_Greater");break;case t.LabelDataFilterType.GreaterOrEqual:o=e.Localization.localize("ValueFilter_GreaterOrEqual");break;case t.LabelDataFilterType.Less:o=e.Localization.localize("ValueFilter_Less");break;case t.LabelDataFilterType.LessOrEqual:o=e.Localization.localize("ValueFilter_LessOrEqual");break;case t.LabelDataFilterType.Between:o=e.Localization.localize("ValueFilter_Between");break;case t.LabelDataFilterType.BetweenNotIncluding:o=e.Localization.localize("ValueFilter_BetweenNotIncluding");break;case t.LabelDataFilterType.NotBetween:o=e.Localization.localize("ValueFilter_NotBetween");break;case t.LabelDataFilterType.NotBetweenNotIncluding:o=e.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;case t.LabelDataFilterType.BeginWith:o=e.Localization.localize("LabelFilter_BeginWith");break;case t.LabelDataFilterType.NotBeginWith:o=e.Localization.localize("LabelFilter_NotBeginWith");break;case t.LabelDataFilterType.EndWith:o=e.Localization.localize("LabelFilter_EndWith");break;case t.LabelDataFilterType.NotEndWith:o=e.Localization.localize("LabelFilter_NotEndWith");break;case t.LabelDataFilterType.Contain:o=e.Localization.localize("LabelFilter_Contain");break;case t.LabelDataFilterType.NotContain:o=e.Localization.localize("LabelFilter_NotContain");break;default:throw new Error("NotImplementedException")}switch(n+=" "+o.toLowerCase(),i.filterType){case t.LabelDataFilterType.Between:case t.LabelDataFilterType.BetweenNotIncluding:case t.LabelDataFilterType.NotBetween:case t.LabelDataFilterType.NotBetweenNotIncluding:n+=" '"+i.text1+"' "+e.Localization.localize("Filter_Label_And")+" '"+i.text2+"'";break;default:n+=" '"+i.text1+"'"}return n},i.parseTopFilter=function(i){var n,o;if(i.filterType===t.TopDataFilterType.Top)n=e.Localization.localize("Filter_Type_Top");else{if(i.filterType!==t.TopDataFilterType.Bottom)throw new Error("NotImplementedException");n=e.Localization.localize("Filter_Type_Bottom")}switch(n+=" "+i.count,i.filterTarget){case t.TopDataFilterTargetType.Items:o=e.Localization.localize("Filter_Target_Items");break;case t.TopDataFilterTargetType.Percent:o=e.Localization.localize("Filter_Target_Percent");break;case t.TopDataFilterTargetType.Sum:o=e.Localization.localize("Filter_Target_Sum");break;default:throw new Error("NotImplementedException")}return n+=" "+o.toLowerCase(),n+=" "+e.Localization.localize("Filter_Label_By")+" "+i.measureUniqueName},i.parseValueFilter=function(i){var n,o=i.measureUniqueName;switch(i.filterType){case t.ValueDataFilterType.Equal:n=e.Localization.localize("ValueFilter_Equal");break;case t.ValueDataFilterType.NotEqual:n=e.Localization.localize("ValueFilter_NotEqual");break;case t.ValueDataFilterType.Greater:n=e.Localization.localize("ValueFilter_Greater");break;case t.ValueDataFilterType.GreaterOrEqual:n=e.Localization.localize("ValueFilter_GreaterOrEqual");break;case t.ValueDataFilterType.Less:n=e.Localization.localize("ValueFilter_Less");break;case t.ValueDataFilterType.LessOrEqual:n=e.Localization.localize("ValueFilter_LessOrEqual");break;case t.ValueDataFilterType.Between:n=e.Localization.localize("ValueFilter_Between");break;case t.ValueDataFilterType.BetweenNotIncluding:n=e.Localization.localize("ValueFilter_BetweenNotIncluding");break;case t.ValueDataFilterType.NotBetween:n=e.Localization.localize("ValueFilter_NotBetween");break;case t.ValueDataFilterType.NotBetweenNotIncluding:n=e.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;default:throw new Error("NotImplementedExcepion")}switch(o+=" "+n.toLowerCase(),i.filterType){case t.ValueDataFilterType.Between:case t.ValueDataFilterType.BetweenNotIncluding:case t.ValueDataFilterType.NotBetween:case t.ValueDataFilterType.NotBetweenNotIncluding:o+=" '"+i.num1+"' "+e.Localization.localize("Filter_Label_And")+" '"+i.num2+"'";break;default:o+=" '"+i.num1+"'"}return o},i.parseMembers=function(t,n,o){for(var r="",a=0;a<t.length;a++){var s=t[a],l="";if(s.selectedSelf?(l=s.uniqueName,o&&(l=" "+e.Localization.localize("ActiveFiltersPanel_include")+" "+l)):o&&!1===s.selectedSelf&&(l=" "+e.Localization.localize("ActiveFiltersPanel_exclude")+" "+s.uniqueName),s.selectedChildren?(l=s.selectedSelf?s.uniqueName+" "+e.Localization.localize("ActiveFiltersPanel_andItsChildren"):e.Localization.localize("ActiveFiltersPanel_children")+" "+s.uniqueName,o&&(l=" "+e.Localization.localize("ActiveFiltersPanel_include")+" "+l)):o&&!1===s.selectedChildren&&(l=!1===s.selectedSelf?" "+e.Localization.localize("ActiveFiltersPanel_exclude")+" "+s.uniqueName+" "+e.Localization.localize("ActiveFiltersPanel_andItsChildren"):" "+e.Localization.localize("ActiveFiltersPanel_exclude")+" "+e.Localization.localize("ActiveFiltersPanel_children")+" "+s.uniqueName),s.selectedDescendants?(l=s.selectedSelf?s.uniqueName+" "+e.Localization.localize("ActiveFiltersPanel_andItsDescendants"):e.Localization.localize("ActiveFiltersPanel_descendants")+" "+s.uniqueName,o&&(l=" "+e.Localization.localize("ActiveFiltersPanel_include")+" "+l)):o&&!1===s.selectedDescendants&&(l=!1===s.selectedSelf?" "+e.Localization.localize("ActiveFiltersPanel_exclude")+" "+s.uniqueName+" "+e.Localization.localize("ActiveFiltersPanel_andItsDescendants"):" "+e.Localization.localize("ActiveFiltersPanel_exclude")+" "+e.Localization.localize("ActiveFiltersPanel_descendants")+" "+s.uniqueName),""!==l&&n.push(s.uniqueName),s.childNodes.length>0){var c=s.selectedDescendants||s.selectedChildren||o,u=i.parseMembers(s.childNodes,n,c);""!==u&&(l+=""!==l?" ("+u+") ":u)}""!==r&&""!==l&&(r+=", "),r+=l}return r},i}();i.FilterParser=o}(t.ActiveFilters||(t.ActiveFilters={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(){this.options=new e.CellAppearanceOptions}}();e.CellAppearanceObject=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(){this.showValue=!0,this.useBackColor=!1,this.useForeColor=!1,this.useImage=!1}}();e.CellAppearanceOptions=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(){this.conditionType=e.CellConditionType.None,this.value1=0,this.value2=0,this.appearance=new e.CellAppearanceObject}}();e.CellCondition=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(e){this.conditions=new Array,this.memberUniqueName=e}}();e.CellConditionsDescriptor=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.None=0]="None",e[e.Equal=1]="Equal",e[e.NotEqual=2]="NotEqual",e[e.Between=3]="Between",e[e.NotBetween=4]="NotBetween",e[e.Less=5]="Less",e[e.Greater=6]="Greater",e[e.GreaterOrEqual=7]="GreaterOrEqual",e[e.LessOrEqual=8]="LessOrEqual",e[e.BetweenNotIncluding=9]="BetweenNotIncluding",e[e.NotBetweenNotIncluding=10]="NotBetweenNotIncluding"}(e.CellConditionType||(e.CellConditionType={}));e.CellConditionType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(e,t){this._tupleString=null,this.tuples=e,this.newValue=t}return Object.defineProperty(e.prototype,"tupleString",{get:function(){return null===this._tupleString&&(this._tupleString=this.getTuples()),this._tupleString},enumerable:!0,configurable:!0}),e.prototype.getTuples=function(){var e="",t=this.tuples;for(var i in t)t.hasOwnProperty(i)&&(e+=t[i]);return e},e}();e.UpdateEntry=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(e){this._items=new Array,this._cacheUpdatedCells={},this._sessionItems=new Array,this._onStateUpdateStorageChangedCallback=e}return Object.defineProperty(e.prototype,"entries",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasLocalChanges",{get:function(){return 0!==this.entries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasServerChanges",{get:function(){return 0!==this._sessionItems.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasAnyChanges",{get:function(){return this.hasLocalChanges||this.hasServerChanges},enumerable:!0,configurable:!0}),e.prototype.inform=function(){this._onStateUpdateStorageChangedCallback(this.hasLocalChanges,this.hasServerChanges)},e.prototype.add=function(e){this._cacheUpdatedCells.hasOwnProperty(e.tupleString)?this._cacheUpdatedCells[e.tupleString]=e:(this._cacheUpdatedCells[e.tupleString]=e,this._items.push(e),this.inform())},e.prototype.remove=function(e){if(!1===this._cacheUpdatedCells.hasOwnProperty(e.tupleString))throw new Error("InvalidOperationException");var t=this._cacheUpdatedCells[e.tupleString];delete this._cacheUpdatedCells[e.tupleString],this._items.splice(this._items.indexOf(t),1),this.inform()},e.prototype.setStateAfterRecalculate=function(){this._sessionItems=this._sessionItems.concat(this._items),this._items.length=0,this._cacheUpdatedCells={},this.inform()},e.prototype.setStateAfterSave=function(){this._sessionItems.length=0,this.inform()},e.prototype.clearAllChanges=function(){this._sessionItems.length=0,this._items.length=0,this._cacheUpdatedCells={},this.inform()},e.prototype.setStateAfterRollback=function(){this._sessionItems.length=0,this._items.length=0,this._cacheUpdatedCells={},this.inform()},e.prototype.clearLocalChanges=function(){this._items.length=0,this._cacheUpdatedCells={},this.inform()},e}();e.UpdatedCellsStorage=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(){}return e.build=function(e,t,i,n){for(var o=new Array,r=0;r<i.length;r++){var a,s,l,c=t,u=i[r].tuples;for(a in u)u.hasOwnProperty(a)&&(s="<%"+a+"%>",l=u[a],s=s.replace(new RegExp("\\[","g"),"\\[").replace(new RegExp("\\]","g"),"\\]"),c=c.replace(new RegExp(s,"g"),l));for(a in n)n.hasOwnProperty(a)&&(s="<%"+a+"%>",l=n[a],s=s.replace(new RegExp("\\[","g"),"\\[").replace(new RegExp("\\]","g"),"\\]"),c=c.replace(new RegExp(s,"g"),l));c=c.replace(new RegExp("<%newValue%>","g"),i[r].newValue),o.push(c)}var p="UPDATE CUBE "+e+" \nSET\n";return p+=o.join(", ")},e.getDefaultUpdateScriptTemplate=function(e){for(var t="(\n",i=0;i<e.length;i++)t+="<%"+e[i]+"%>",i+1!==e.length&&(t+=","),t+="\n";return t+=")",t+="=<%newValue%>"},e}();e.UpdateScriptBuilder=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(e){this._options=e,this._$textArea=$("<textarea class='form-control cellPropertiesViewerControl-textViewer' rows='15' readonly></textarea>"),this._$textArea.val(this.content)}return Object.defineProperty(t.prototype,"content",{get:function(){var t={};t.FORMATTED_VALUE=this._options.cellDescription.cellData.displayValue,t.VALUE=this._options.cellDescription.cellData.value,t.BACK_COLOR=this._options.cellDescription.cellData.backColor,t.FORE_COLOR=this._options.cellDescription.cellData.foreColor,t.FORMAT_STRING=this._options.cellDescription.cellData.formatString;var i=this.getString(t);i+="\n",(t={})[""+e.Localization.localize("Tuple")]="";var n;for(n=0;n<this._options.cellDescription.rows.length;n++){var o=this._options.cellDescription.rows[n];t[o.hierarchyCaption]=o.memberCaption+" ("+o.memberUniqueName+")"}for(n=0;n<this._options.cellDescription.columns.length;n++){var r=this._options.cellDescription.columns[n];t[r.hierarchyCaption]=r.memberCaption+" ("+r.memberUniqueName+")"}return i+=this.getString(t)},enumerable:!0,configurable:!0}),t.prototype.getString=function(e){var i,n=0;for(i in e)e.hasOwnProperty(i)&&i.length>n&&(n=i.length);n+=1;var o="";for(i in e)e.hasOwnProperty(i)&&(o+=t.addSpace(i,n)+": "+e[i]+"\n");return o},t.addSpace=function(e,t){for(var i=e,n=0;n<t-e.length;n++)i+=" ";return i},Object.defineProperty(t.prototype,"view",{get:function(){return this._$textArea},enumerable:!0,configurable:!0}),t}();t.CellPropertiesViewerControl=i}(t.CellPropertiesViewer||(t.CellPropertiesViewer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(e){this.cellDescription=e}}();e.CellPropertiesViewerOptions=t}(e.CellPropertiesViewer||(e.CellPropertiesViewer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=e.Controls.Events.LiteEvent,n=function(){function n(e){this._onSelectionCubeChanged=new i,this._isEnabled=!1,this._isEnabledDropDownControl=!0,e&&$(e).append(this.view)}return Object.defineProperty(n.prototype,"view",{get:function(){return this._$view||(this._$view=this.getView(),this.isEnabled=!1),this._$view},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedCube",{get:function(){return this._selectedCube},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectionCubeChanged",{get:function(){return this._onSelectionCubeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,this._$view.removeClass("cubeChoiceControl_disabled"),this._isEnabled||this._$view.addClass("cubeChoiceControl_disabled")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEnabledDropDownControl",{get:function(){return this._isEnabledDropDownControl},set:function(e){this._isEnabledDropDownControl=e,this._dropDownControl.view.removeClass("cubeChoiceControl_disabled"),this._isEnabledDropDownControl||this._dropDownControl.view.addClass("cubeChoiceControl_disabled")},enumerable:!0,configurable:!0}),n.prototype.getCubes=function(){var t=$.Deferred();return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/getCubes",data:{connection:this.connection},success:function(e){t.resolve(e)},error:function(e){t.reject(e)}}),t},n.prototype.refrehCubes=function(){if(!this.connection)throw new Error("invalidOperationException");var t=$('<div class="cubeChoiceControl-statusPanel"><i class="fa fa-spinner fa-pulse"></i><span class="cubeChoiceControl-loadCubesLabelStatus">'+e.Localization.localize("CubeChoiceControl_LoadingCubesMessage")+"</span></div>");this._$view.append(t);var i=this;this.getCubes().done(function(e){0===e.length&&i.showError(),i.isEnabled=!0,i.updateControls(e)}).fail(function(t){e.LogService.error(t),i.showError()}).always(function(){t.remove()})},n.prototype.showError=function(){var t=this;this.isEnabled=!0,this.isEnabledDropDownControl=!1;var i=$('<div class="cubeChoiceControl-statusPanel"></div>');i.append('<div class="cubeChoiceControl-imageContainer imageLibrary_error"></div>'),i.append('<span class="cubeChoiceControl-errorLabel">'+e.Localization.localize("CubeChoiceControl_ErrorLoadingCubes")+"</span>");var n=$('<button type="button" class="btn btn-default btn-xs cubeChoiceControl-buttonRefreshCubes">'+e.Localization.localize("CubeChoiceControl_ButtonRefreshCubes")+"</button>");i.append(n),n.click(function(){t.isEnabledDropDownControl=!0,t.isEnabled=!1,i.remove(),t.refrehCubes()}),this._$view.append(i)},n.prototype.updateControls=function(e){e.forEach(function(e,t){e.imageClass="imageLibrary_cube",0===t&&(e.isSelected=!0)}),this._dropDownControl.itemSource=e,this.changeCube(e[0])},n.prototype.changeCube=function(e){this._selectedCube=e,this._onSelectionCubeChanged.trigger(this._selectedCube)},n.prototype.getView=function(){var e=this,i=$("<div/>");i.addClass("cubeChoiceControl");var n=new t.DropDownControl;return n.displayPropertyExpr="caption",n.imageCssClassExp="imageClass",n.selectedExpr="isSelected",n.selectionChanged.on(function(t){e.changeCube(t)}),i.append(n.view),this._dropDownControl=n,i},n}();t.CubeChoiceControl=n}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function i(i,n){this._panel=$(i),this._options=n;var o=this,r=$("<div/>");r.addClass("cubeExplorer_measureGroupSelector");var a=$("<div/>");a.addClass("cubeExplorer_treeMetadata"),this._currentCalculatedMembers=this._options.calculatedMembers,this._currentCalculatedNamedSets=this._options.calculatedNamedSets;var s=new t.TreeViewOptions;s.hasChildrenExpr="hasChildren",s.virtualModeEnabled=!0,s.countLoadedItems=15;var l=new t.MemberChoice.QueryManager(this._options.cubeName,null,15),c=new t.MemberChoice.DataService(this._options.connection),u=new t.VirtualConnectionProvider;u.getPromiseLoadChildren=function(e){var t=e.uniqueName,i="";if("level"===e.type)l.hierarchyUniqueName=e.parentHierarchyId,i=l.getQueryMembers(t,0);else{if("memberData"!==e.type)throw new Error("NotImplementedException");l.hierarchyUniqueName=e.hierarchyUniqueName,i=l.getQueryLoadChildren(t,0)}return c.getMembers(i).promise()},u.getPromiseLoadNeighbors=function(e,t){var i="";return"level"===e.type?(l.hierarchyUniqueName=e.parentHierarchyId,i=l.getQueryMembers(e.uniqueName,t)):"memberData"===e.type&&(l.hierarchyUniqueName=e.hierarchyUniqueName,i=l.getQueryLoadChildren(e.uniqueName,t)),c.getMembers(i).promise()},s.connectionProvider=u,s.keyExpr="id",s.displayExpr="caption",s.expandedExpr="isOpen",s.iconExpandedExpr="iconExpanded",s.iconExpr="icon";var p=n.draggableOptions;p||(p=new t.TreeViewDraggableOptions),p.draggableNodeExp="isDraggable",p.onStartDraggable=function(e,i){var n=jQuery.extend(!0,{},e.dataItem);jQuery.data(i.$treeViewItem.get(0),"data",n);var r=e;if("memberData"===r.dataItem.type)for(var a=r.parents.length-1;a>=0;a--){var s=r.parents[a].dataItem;if("level"===s.type){n=jQuery.extend(!0,{},s);var l=o.getMembersFilter(r),c=l.buildMdx(),u=new t.CustomFilterOptions;n.filter={isUsed:!0,membersFilter:{isUsed:!0,selectionNodes:new Array(l),set:c},customFilter:u},jQuery.data(i.$treeViewItem.get(0),"data",n);break}}},s.onRenderedTreeViewItem=function(e,t){t.$treeViewItem.attr("data-"+s.keyExpr,e.dataItem[s.keyExpr])},s.draggableOptions=p,s.onItemSelected=function(e){},this._onDataSourceChanged=function(e,t){n.onDataSourceChanged&&n.onDataSourceChanged(e,t)};var h={dataSource:null,selectedMeasureGroupName:n.selectedMeasureGroupName,onMeasureGroupSelectedChanged:function(i){e.UserActionsTracker.track("Change the group of measures"),o._currentSelectedMeasureGroup=i;var r=jQuery.extend(!0,[],o._currentDataSource.treeMetadata),a=e.Utility.TreeMetadataHelper.filterMeasureGroupMetadata(r,i);o._tree.dataSource=a,n.onMeasureGroupSelectedChanged&&n.onMeasureGroupSelectedChanged(o,new t.FilteredMetadataDescriptionArgs(i,a))}};this._tree=new t.TreeView(a[0],s),this._measureGroupSelector=new t.MeasureGroupSelector(r[0],h),this._layoutDropDownItems=n.layoutDropdownItems||[],this._layoutButton=this.initLayoutButton().hide(),this._panel.append(this._layoutButton),this._panel.append(r),this._panel.append(a),this._options.dataSource&&(this.dataSource=this._options.dataSource),this._isVisibleLayoutButton=!1}return Object.defineProperty(i.prototype,"currentCalculatedMembers",{get:function(){return this._currentCalculatedMembers},set:function(e){this._currentCalculatedMembers=e,this.repaintTreeView()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentCalculatedNamedSets",{get:function(){return this._currentCalculatedNamedSets},set:function(e){this._currentCalculatedNamedSets=e,this.repaintTreeView()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataSource",{get:function(){return this._currentDataSource},set:function(e){this._originalDataSource=e;var i=jQuery.extend(!0,{},e);this._currentDataSource=i,this.renderTreeView(),this._measureGroupSelector.dataSource=i.measureGroups,this._onDataSourceChanged(this,new t.MetadataDescriptionArgs(e))},enumerable:!0,configurable:!0}),i.prototype.getMapIdToMetadata=function(){return i.getPlainData(this._currentDataSource.treeMetadata,this._options.keyExpr)},i.getPlainData=function(e,t){var i={};if(void 0===t)return i;for(var n=0;n<e.length;n+=1){var o=e[n];if(void 0!==o[t]&&(i[o[t]]=o),void 0!==o.items){var r=this.getPlainData(o.items,t);for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];i[a]=s}}}return i},i.prototype.getCopyOriginalDataSource=function(){return jQuery.extend(!0,{},this._originalDataSource)},i.prototype.renderTreeView=function(){i.extendMetadataTreeCustomCalculations(this._currentDataSource.treeMetadata,this.currentCalculatedMembers,this.currentCalculatedNamedSets),this._tree.dataSource=this._currentDataSource.treeMetadata},i.prototype.repaintTreeView=function(){i.extendMetadataTreeCustomCalculations(this._currentDataSource.treeMetadata,this.currentCalculatedMembers,this.currentCalculatedNamedSets),i.extendMetadataTreeCustomCalculations(this._tree.dataSource,this.currentCalculatedMembers,this.currentCalculatedNamedSets),this._tree.repaint()},i.prototype.getMembersFilter=function(e){var i=null,n=null,o=e.dataItem.parents;if(o)for(var r=0;r<o.length;r++){var a=o[r],s=new t.MemberChoice.MemberChoiceTreeNode(a.uniqueName,!1,!1,!1);if(null===i)i=n=s;else{if(null===n)throw new Error("InvalidOperationException");n.childNodes.push(s),n=s}}var l=new t.MemberChoice.MemberChoiceTreeNode(e.dataItem.uniqueName,!0,!1,!1);return null===n?i=l:n.childNodes.push(l),i},i.extendMetadataTreeCustomCalculations=function(t,i,n){if(!t)throw new Error("ArgumentException");for(var o=[],r=0,a=0,s=void 0,l=0;l<t.length;l++){var c=t[l];if(c.id&&"rootCalculations"===c.id){(s=c).items=o;break}if("dimension"===c.type){a=l;break}}void 0===s&&(s={id:"rootCalculations",caption:e.Localization.localize("MdxDesigner_Calculations"),icon:"cubeExplorerCustomCalculations",type:"customCalculations",isDraggable:!1,items:o},t.splice(a,0,s)),void 0===i&&void 0===n||i&&0===i.length&&n&&0===n.length?e.Utility.ArrayUtility.removeItem(t,s):(i&&0!==i.length&&i.forEach(function(e){o.push({id:"customCalculation"+r++,caption:e.name,name:e.name,icon:"customMeasure",uniqueName:e.name,isDraggable:!0,type:"calculatedMember"})}),n&&0!==n.length&&n.forEach(function(e){o.push({id:"customCalculation"+r++,caption:e.name,name:e.name,icon:"customNamedSet",isDraggable:!0,type:"calculatedNamedSet"})}))},Object.defineProperty(i.prototype,"isVisibleLayoutButton",{get:function(){return this._isVisibleLayoutButton},set:function(e){e?this.showLayoutButton():this.hideLayoutButton()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layoutDropdownItems",{get:function(){return this._layoutDropDownItems},set:function(e){this._layoutDropDownItems=e;for(var t=this._panel.find(".dropdown-menu").empty(),i=0;i<this._layoutDropDownItems.length;i++){var n=$("<li />").on("click",this._layoutDropDownItems[i].onSelected),o=$("<a />").text(this._layoutDropDownItems[i].title);n.append(o),t.append(n)}},enumerable:!0,configurable:!0}),i.prototype.initLayoutButton=function(){for(var t=$("<div />").addClass("btn-group default-dropdown layout-button"),i=$("<button />").addClass("btn btn-default dropdown-toggle").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false").attr("title",e.Localization.localize("LayoutsOfDesignerButton_ToolTip")),n=$("<ul />").addClass("dropdown-menu"),o=0;o<this._layoutDropDownItems.length;o++){var r=$("<li />").on("click",this._layoutDropDownItems[o].onSelected),a=$("<a />"),s=$("<div class='"+this._layoutDropDownItems[o].icon+" cubeExplorer-dropDownImage'></div>"),l=$("<span>"+this._layoutDropDownItems[o].title+"</span>");a.append(s),a.append(l),r.append(a),n.append(r)}var c=$("<div />").addClass("button-contentImage imageLibrary_designPanel");return t.append(i),i.append(c),t.append(n),t},i.prototype.showLayoutButton=function(){this._layoutButton&&this._layoutButton.show(),this._panel.find(".cubeExplorer_measureGroupSelector").addClass("visible-layout-button"),this._isVisibleLayoutButton=!0},i.prototype.hideLayoutButton=function(){this._layoutButton&&this._layoutButton.hide(),this._panel.find(".cubeExplorer_measureGroupSelector").removeClass("visible-layout-button"),this._isVisibleLayoutButton=!1},i}();t.CubeExplorer=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetCubeExplorer=function(t,i){var n,o=this,r={},a=this;a.settings={},this.getCopyOriginalDataSource=function(){return n.getCopyOriginalDataSource()},this.getMapIdToMetadata=function(){return n.getMapIdToMetadata()},a.init=function(){o.settings=e.extend({},r,i),n=new Ranet.Controls.CubeExplorer(t,i)},a.option=function(e){e.hasOwnProperty("dataSource")&&(n.dataSource=e.dataSource),e.hasOwnProperty("calculatedMembers")&&(n.currentCalculatedMembers=e.calculatedMembers),e.hasOwnProperty("calculatedNamedSets")&&(n.currentCalculatedNamedSets=e.calculatedNamedSets)},a.isVisibleLayoutButton=function(e){if(void 0===e)return n.isVisibleLayoutButton;n.isVisibleLayoutButton=e},a.init()},e.fn.ranetCubeExplorer=function(t){return this.each(function(){if(void 0==e(this).data("ranetQueryDesigner")){var i=new e.ranetCubeExplorer(this,t);e(this).data("ranetCubeExplorer",i)}})}}(jQuery);var Ranet;!function(e){!function(e){var t=function(){return function(e,t){this.treeMetadata=t,this.measureGroup=e}}();e.FilteredMetadataDescriptionArgs=t;var i=function(){return function(e){this.metadataDescription=e}}();e.MetadataDescriptionArgs=i;var n=function(){return function(){this.selectedMeasureGroupName=null}}();e.CubeExplorerOptions=n}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e){this._options=e,this._selectedProps=e.selectedProperties}return Object.defineProperty(e.prototype,"selectedProperties",{get:function(){return this._selectedProps},enumerable:!0,configurable:!0}),e.prototype.getLayout=function(){var e=this,t=$("<div />");t.addClass("customPropertiesSelector-list");for(var i=0;i<this._options.hierarchyDescription.levelProperties.length;i++){var n=this._options.hierarchyDescription.levelProperties[i],o=$("<div/>");o.addClass("customPropertiesSelector-itemList");var r=$("<input type='checkbox'>");-1!==this._options.selectedProperties.indexOf(n.name)&&r.prop("checked",!0),r.click({checkBox:r,levelDescription:n},function(t){e.onChangeState(t.data.checkBox.is(":checked"),t.data.levelDescription)});var a=$("<span/>");a.addClass("customPropertiesSelector-levelCaptionLabel"),a.append(n.caption),a.click({checkBox:r,levelDescription:n},function(t){var i=!t.data.checkBox.is(":checked");t.data.checkBox.prop("checked",i),e.onChangeState(i,t.data.levelDescription)}),o.append(r),o.append(a),t.append(o)}return t},e.prototype.onChangeState=function(e,t){e?this.selectedProperties.push(t.name):this.selectedProperties.splice(this.selectedProperties.indexOf(t.name),1)},Object.defineProperty(e.prototype,"view",{get:function(){return this.getLayout()},enumerable:!0,configurable:!0}),e}();e.CustomPropertiesSelectorControl=t}(e.CustomPropertiesSelector||(e.CustomPropertiesSelector={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this._hierarchyDescription=e,this._selectedProps=t}return Object.defineProperty(e.prototype,"hierarchyDescription",{get:function(){return this._hierarchyDescription},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedProperties",{get:function(){return this._selectedProps},enumerable:!0,configurable:!0}),e}();e.CustomPropertiesSelectorOptions=t}(e.CustomPropertiesSelector||(e.CustomPropertiesSelector={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function i(n){var o=this;this._$rootLayout=$("<div class='drillThrough-rootLayout'/>"),this._options=n,this._loadPanel=new t.LoadPanel(n.$container.get(0),{visible:!1,position:{of:window},message:e.Localization.localize("Command_Export_Group")}),i._directoryTemplate=e.PathManager.templatesPath,i.getLayout().done(function(e){o._viewDescription=e,e.$cellDataText.text(n.cellData.displayValue);var t,i;for(i=0;i<n.rows.length;i++)t=$("<tr><td>"+n.rows[i].hierarchyCaption+"</td><td>"+n.rows[i].memberCaption+"</td></tr>"),e.$tableContent.append(t);for(i=0;i<n.columns.length;i++)t=$("<tr><td>"+n.columns[i].hierarchyCaption+"</td><td>"+n.columns[i].memberCaption+"</td></tr>"),e.$tableContent.append(t);e.$exportToExcelButton.click(function(){o.exportDataToExcel()}),setTimeout(function(){for(var t=new Array,i=new Array,r=0;r<o._options.dataSource.columns.length;r++)t.push({data:o._options.dataSource.columns[r].columnName}),i.push('<span title="'+o._options.dataSource.columns[r].caption+'">'+o._options.dataSource.columns[r].caption+"</span>");for(var a=new Array,s=0;s<n.dataSource.rows.length;s++){for(var l={},c=0;c<n.dataSource.rows[s].cells.length;c++)l[n.dataSource.rows[s].cells[c].name]=n.dataSource.rows[s].cells[c].value;a.push(l)}new Handsontable(e.$dataPanel.get(0),{manualColumnResize:!0,data:a,rowHeaders:!1,columns:t,colWidths:80,rowHeights:23,readOnly:!0,headerTooltips:!0,wordWrap:!1,autoRowSize:!1,autoColumnSize:!1,colHeaders:i,columnSorting:!0})},250),o._$rootLayout.append(e.$view)})}return i.prototype.exportDataToExcel=function(){var t,i=this,n=new Array;for(t=0;t<this._options.rows.length;t++)n.push({hierarchyCaption:this._options.rows[t].hierarchyCaption,memberCaption:this._options.rows[t].memberCaption});for(t=0;t<this._options.columns.length;t++)n.push({hierarchyCaption:this._options.columns[t].hierarchyCaption,memberCaption:this._options.columns[t].memberCaption});this._loadPanel.visible=!0,$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/export/exportDrillthroughData",data:{dataString:JSON.stringify(this._options.dataSource),cellValue:this._options.cellData.displayValue,tuples:n}}).done(function(t){var n=e.PathManager.applicationUrl+"api/export/download/"+t;window.location.href=n,i._loadPanel.visible=!1}).fail(function(t){i._loadPanel.visible=!1,e.LogService.error(t),e.UserMessageService.showServerError(t)})},Object.defineProperty(i.prototype,"view",{get:function(){return this._$rootLayout},enumerable:!0,configurable:!0}),i.prototype.showData=function(){},i.prototype.countString=function(){return" ( "+this._options.dataSource.rows.length+" "+e.Localization.localize("DrillThrough_Count")+" ) "},i.getLayout=function(){var t=$.Deferred();return $.ajax({url:i._directoryTemplate+"drillthrough-view.html"}).done(function(i){var n=$(e.Localization.localizeTemplate(i));t.resolve({$view:n,$cellDataText:n.find(".drillThrough-cellValue"),$tableContent:n.find(".drillThrough-tuplesData tbody"),$dataPanel:n.find(".drillThrough-data"),$exportToExcelButton:n.find(".drillThrough-exportToExcelButton")})}).fail(function(i){e.LogService.error(i),t.reject(i)}),t},i}();i.DrillThroughControl=n}(t.DrillThrough||(t.DrillThrough={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.DrillThroughControlOptions=t}(e.DrillThrough||(e.DrillThrough={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function i(e){this._options=e}return Object.defineProperty(i.prototype,"selectedHierarchy",{get:function(){return this._selectedHierarchy},enumerable:!0,configurable:!0}),i.prototype.createLayout=function(){var t=$("<div class='hierarchySelectorControl-rootLayout'/>"),i=$("<div class='hierarchySelectorControl-treeMetadata'/>"),n=this.getTreeViewOptions();n.isVisibleSearch=!0,new e.Controls.SearchTreeView.SearchTreeViewContent(i[0],n).init(),t.append(i);var o=$('<div class="hierarchySelectorControl-selectedHierarchyPanel"/>');return o.append('<div class="hierarchySelectorControl-labelSelectedHierarchy">'+e.Localization.localize("WindowSelectorHierarchy_LabelSelectedHierarchy")+"</div>"),this._$selectedHierarchyInput=$('<input type="text" class="form-control disabled" readonly/>'),o.append(this._$selectedHierarchyInput),t.append(o),t},i.prepareDataSource=function(e,t){e.splice(e.indexOf(e.filter(function(e){return"kpiRootNode"===e.type})[0]),1),e.splice(e.indexOf(e.filter(function(e){return"measuresRootNode"===e.type})[0]),1),e.splice(e.indexOf(e.filter(function(e){return"setsRootNode"===e.type})[0]),1);for(var n=new Array,o=0;o<e.length;o++){var r=e[o];i.updateNodes(r.items,t),0===r.items.length&&n.push(r)}if(n.length>0)for(var a=0;a<n.length;a++)e.splice(e.indexOf(n[a]),1);return e},i.updateNodes=function(e,t){for(var n=new Array,o=0;o<e.length;o++){var r=e[o];"hierarchy"===r.type?(-1!==t.indexOf(r.uniqueName)&&n.push(r),delete r.items):"folder"===r.type&&i.updateNodes(r.items,t)}if(n.length>0)for(var a=0;a<n.length;a++)e.splice(e.indexOf(n[a]),1)},i.findHierarchyInFolder=function(e){var t,n=void 0;for(t=0;t<e.items.length;t++)if("hierarchy"===e.items[t].type){n=e.items[t];break}if(n)return n;for(t=0;t<e.items.length;t++)if("folder"===e.items[t].type){var o=i.findHierarchyInFolder(e.items[t]);if(o){n=o;break}}return n},i.findHierarchyInDimension=function(e){var t,n=void 0;for(t=0;t<e.items.length;t++)if("hierarchy"===e.items[t].type){n=e.items[t];break}if(n)return n;for(t=0;t<e.items.length;t++)if("folder"===e.items[t].type){var o=i.findHierarchyInFolder(e.items[t]);if(o){n=o;break}}return n},i.prototype.onSelectNode=function(e){var t=void 0,n=e[0];if("hierarchy"===n.type?t=n:"folder"===n.type?t=i.findHierarchyInFolder(n):"dimension"===n.type&&(t=i.findHierarchyInDimension(n)),!t)throw new Error("InvalidOperationException");this._selectedHierarchy=t,this._$selectedHierarchyInput.val(t.caption),this._options.onSelectedItem&&this._options.onSelectedItem(t)},i.prototype.getTreeViewOptions=function(){var e=this,n=new t.TreeViewOptions;return n.dataSource=i.prepareDataSource(this._options.dataSource,this._options.exludedHierarchies),n.keyExpr="id",n.displayExpr="caption",n.expandedExpr="isOpen",n.iconExpandedExpr="iconExpanded",n.iconExpr="icon",n.onItemSelected=function(t){e.onSelectNode(t)},n},Object.defineProperty(i.prototype,"view",{get:function(){return this.createLayout()},enumerable:!0,configurable:!0}),i}();i.HierarchySelectorControl=n}(t.HierarchySelector||(t.HierarchySelector={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.HierarchySelectorOptions=t}(e.HierarchySelector||(e.HierarchySelector={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function t(e,t){this._$rootPanel=e,this._options=t}return Object.defineProperty(t.prototype,"selectedMeasures",{get:function(){return this._selectedMeasures},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.initSelectedMeasures();var t=this,i=new e.TreeViewOptions;i.keyExpr="id",i.selectedExpr="isSelected",i.dataSource=this.prepareTree(this._options.treeMeasures,this._options.selectedUniqueNames),i.displayExpr="caption",i.expandedExpr="isOpen",i.iconExpandedExpr="iconExpanded",i.iconExpr="icon",i.draggableOptions=new e.TreeViewDraggableOptions,i.draggableOptions.$dragContainer=$(this._$rootPanel),i.onItemSelected=function(e){"measure"===e.data.type&&(t._selectedMeasures=new Array,t._selectedMeasures.push(e.data)),t.onSelectedChanged(e.data)};new e.TreeView(this._$rootPanel,i)},t.prototype.initSelectedMeasures=function(){var e=this,i=t.getMapUniqueNameToDataItem(this._options.treeMeasures);this._selectedMeasures=new Array,this._options.selectedUniqueNames.forEach(function(t){e._selectedMeasures.push(i[t])})},t.getMapUniqueNameToDataItem=function(e){var t={};return e.items.forEach(function(e){if("folder"===e.type)e.items.forEach(function(e){t[e.uniqueName]=e});else{if("measure"!==e.type)throw new Error("NotImplementedException");t[e.uniqueName]=e}}),t},t.prototype.onSelectedChanged=function(e){if(this._options.onSelectedMeasuresChanged){var t=new Array;t.push(e),this._options.onSelectedMeasuresChanged(t)}},t.prototype.prepareTree=function(e,t){var i=new Array;return e.isOpen=!0,e.items.forEach(function(e){e.items.forEach(function(i){t.filter(function(e){return e===i.uniqueName&&(i.isSelected=!0,!0)}).length>0&&(e.isOpen=!0)})}),i.push(e),i},t}();e.MeasureChoiceControl=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function i(t,n){i._directoryTemplate=e.PathManager.templatesPath,this._$rootPanel=$(t),this._options=n,this._selectedUniqueNames=n.selectedUniqueNames}return Object.defineProperty(i.prototype,"selectedUniqueNames",{get:function(){return this._selectedUniqueNames},enumerable:!0,configurable:!0}),i.prototype.init=function(){var e=this;this.getTemplate().done(function(t){$(e._$rootPanel).append(t.button.$view),e._$imageContentButton=t.button.$imageContentButton,e._$textContentButton=t.button.$textContentButton,e._$measureChoicePanel=t.control.$view,e.initButtonState();var i=function(){t.control.$view.empty(),e.showWindow()};t.button.$showDialogButton0.click(function(){return i()}),t.button.$showDialogButton1.click(function(){return i()})})},i.prototype.initButtonState=function(){var e=t.MeasureChoiceControl.getMapUniqueNameToDataItem(this._options.treeMeasures),i=new Array;this._options.selectedUniqueNames.forEach(function(t){i.push(e[t])}),this.updateButtonState(i)},i.prototype.showWindow=function(){var e=this,i=null,n=this._options.getPopupContainer(),o=new t.MeasureChoiceSelectorWindow(n,function(t){e.onOkClosedWindow(i)});o.isEnabledOkButton=!1,o.show(this._$measureChoicePanel);var r=jQuery.extend(!0,{},e._options.treeMeasures),a=new t.MeasureChoiceOptions(r,e._options.isMultiSelect);a.selectedUniqueNames=this._selectedUniqueNames,a.onSelectedMeasuresChanged=function(t){!1===e._options.isMultiSelect&&("measure"!==t[0].type?o.isEnabledOkButton=!1:o.isEnabledOkButton=!0)},(i=new t.MeasureChoiceControl(this._$measureChoicePanel[0],a)).init()},i.prototype.onOkClosedWindow=function(e){var t=e.selectedMeasures;this.updateButtonState(t),this.onSelectedMeasuresChanged(t)},i.prototype.updateButtonState=function(e){var t="",i="",n=null;e.length>0&&!1===this._options.isMultiSelect&&(t=e[0].icon,i=n=e[0].caption),null===n?this._$rootPanel.removeAttr("title"):this._$rootPanel.attr("title",n),this.updateImage(t),this._$textContentButton.text(i)},i.prototype.updateImage=function(e){var t=this,n=i._imageLibraryPrefix+""+e,o=this._$imageContentButton.attr("class").split(/\s+/);$.each(o,function(e,n){0===n.indexOf(i._imageLibraryPrefix)&&t._$imageContentButton.removeClass(n)}),this._$imageContentButton.addClass(n)},i.prototype.onSelectedMeasuresChanged=function(e){var t=this;this._selectedUniqueNames=new Array,e.forEach(function(e){return t._selectedUniqueNames.push(e.uniqueName)}),this._options.onSelectedMeasuresChanged&&this._options.onSelectedMeasuresChanged(e)},i.prototype.getTemplate=function(){var t=$.Deferred();return $.when($.ajax({url:i._directoryTemplate+"measureChoiceSelector-button.html"}),$.ajax({url:i._directoryTemplate+"measureChoiceSelector-control.html"})).done(function(e,i){var n=$(e[0]),o=$(i[0]);t.resolve({button:{$view:n,$imageContentButton:n.find("#imageContentButton"),$textContentButton:n.find("#textContentButton"),$showDialogButton0:n.find("#showDialogButton0"),$showDialogButton1:n.find("#showDialogButton1")},control:{$view:o}})}).fail(function(i){e.LogService.error(i),t.reject(i)}),t},i._imageLibraryPrefix="imageLibrary_",i}();t.MeasureChoiceSelector=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(e,t){this._selectedUniqueName=new Array,this._isMultiSelect=t,this._treeMeasures=e}return Object.defineProperty(e.prototype,"treeMeasures",{get:function(){return this._treeMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMultiSelect",{get:function(){return this._isMultiSelect},set:function(e){this._isMultiSelect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedUniqueNames",{get:function(){return this._selectedUniqueName},set:function(e){this._selectedUniqueName=e},enumerable:!0,configurable:!0}),e}();e.MeasureChoiceOptions=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function t(i,n,o){t._directoryTemplate=e.PathManager.templatesPath,this._onOkClosed=n,this._onCancelClosed=o,this._container=i}return Object.defineProperty(t.prototype,"isEnabledOkButton",{get:function(){return this._isEnabledOkButton},set:function(e){this._isEnabledOkButton=e,this.setStateButton(e)},enumerable:!0,configurable:!0}),t.prototype.setStateButton=function(e){this._$okButton&&(e?this._$okButton.removeClass("disabled"):this._$okButton.addClass("disabled"))},t.prototype.show=function(e){var t=this;this.getWindow().done(function(i){i.$contentPanel.append(e),t.initWindow(i.$window,i.$cancelButton,i.$okButton,i.$xButton)})},t.prototype.initWindow=function(e,t,i,n){var o=this;this._$okButton=i,this.setStateButton(this.isEnabledOkButton),t.click(function(){o.clickCancelButton()}),n.click(function(){o.clickCancelButton()}),i.click(function(){o.clickOkButton()}),e.appendTo(this._container),e.modal({backdrop:!1}),e.on("hidden.bs.modal",function(){return e.remove()})},t.prototype.clickOkButton=function(){this._onOkClosed&&this._onOkClosed(this)},t.prototype.clickCancelButton=function(){this._onCancelClosed&&this._onCancelClosed(this)},t.prototype.getWindow=function(){var i=$.Deferred();return $.ajax({url:t._directoryTemplate+"measureChoiceSelector-window.html"}).done(function(t){var n=$(e.Localization.localizeTemplate(t)),o=n.find("#contentPanel"),r=n.find("#btnOk"),a=n.find("#btnCancel"),s=n.find("#btnX");i.resolve({$window:n,$okButton:r,$cancelButton:a,$xButton:s,$contentPanel:o})}).fail(function(t){e.LogService.error(t),i.reject(t)}),i},t}();t.MeasureChoiceSelectorWindow=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){this.events=new i,this.isVisibleSlicerButton=!1}}();e.MemberChoiceOptions=t;var i=function(){return function(){}}();e.EventMemberChoice=i}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(e){this._$treeViewItem=e}return Object.defineProperty(e.prototype,"$treeViewItem",{get:function(){return this._$treeViewItem},enumerable:!0,configurable:!0}),e}();e.TreeViewItemArgs=t;var i=function(){return function(){}}();e.TreeViewDraggableOptions=i;var n=function(){return function(){this.hoverStateEnabled=!1,this.connectionProvider=new o,this.draggableOptions=new i}}();e.TreeViewOptions=n;var o=function(){return function(){}}();e.VirtualConnectionProvider=o}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.VirtualConnectionProvider);t.VirtualConnectionProviderMemberChoice=i;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.TreeViewOptions);t.TreeViewMemberChoiceOptions=n}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n;!function(e){e[e.Caption=0]="Caption",e[e.Name=1]="Name",e[e.UniqueName=2]="UniqueName",e[e.Key0=3]="Key0"}(n||(n={})),function(e){e[e.Contain=0]="Contain",e[e.Equal=1]="Equal",e[e.BeginWith=2]="BeginWith"}(i.SearchOlapSearchType||(i.SearchOlapSearchType={}));var o=i.SearchOlapSearchType,r=function(){return function(e,t,i){this.text=e,this.property=t,this.searchType=i}}();i.SearchDescription=r;var a=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.propertyType=i,this.isSelected=n}}(),s=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.searchType=i,this.isSelected=n}}(),l=function(){function i(t,r,a){this.onSearch=r,this.onCancelSearch=a,this._searchPropertyType=n.Caption,this._searchType=o.Contain,this._$panel=t,i._directoryTemplate=e.PathManager.templatesPath}return Object.defineProperty(i.prototype,"isLoadingMembersNow",{get:function(){return this._isLoadingMembersNow},set:function(e){this._isLoadingMembersNow=e,this._layoutDescription.$searchButton.empty(),this._layoutDescription.$searchButton.removeClass("disabled"),this._isLoadingMembersNow?(this._layoutDescription.$searchButton.addClass("disabled"),this._layoutDescription.$searchButton.append('<div class="fa fa-spinner fa-spin"></div>')):this._layoutDescription.$searchButton.append('<div class="glyphicon glyphicon-search"></div>')},enumerable:!0,configurable:!0}),i.prototype.init=function(){var i=this;this.getLayout().done(function(l){i._layoutDescription=l,i._$panel.append(l.$rootLayout);var c=new t.DropDownControl;c.displayPropertyExpr="caption",c.imageCssClassExp="imageCssClass",c.selectedExpr="isSelected",c.itemSource=[new a(e.Localization.localize("Olap_Caption"),"imageLibrary_memberProperty",n.Caption,!0),new a(e.Localization.localize("Olap_Name"),"imageLibrary_memberProperty",n.Name),new a(e.Localization.localize("Olap_UniqueName"),"imageLibrary_memberProperty",n.UniqueName),new a("KEY0","imageLibrary_levelProperty",n.Key0)],c.selectionChanged.on(function(e){i._searchPropertyType=e.propertyType}),l.$dropDownPanel.append(c.view);var u=new t.DropDownControl;u.displayPropertyExpr="caption",u.imageCssClassExp="imageCssClass",u.selectedExpr="isSelected",u.itemSource=[new s(e.Localization.localize("LabelFilter_Contain"),"imageLibrary_fcopcontain",o.Contain,!0),new s(e.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",o.Equal),new s(e.Localization.localize("LabelFilter_BeginWith"),"imageLibrary_fcopbegin",o.BeginWith)],u.selectionChanged.on(function(e){i._searchType=e.searchType}),l.$searchTypeDropDownPanel.append(u.view);var p=function(){var e="";switch(i._searchPropertyType){case n.Caption:e="Caption";break;case n.Key0:e="KEY0";break;case n.Name:e="Name";break;case n.UniqueName:e="UNIQUE_NAME"}i.onSearch(new r(l.$searchTextBox.val(),e,i._searchType))};l.$searchButton.click(p),l.$searchTextBox.keypress(function(e){13===e.which&&p()}),l.$cancelSearchButton.click(function(){l.$searchTextBox.val(""),i.onCancelSearch&&i.onCancelSearch()})})},i.prototype.getLayout=function(){var t=$.Deferred();return $.ajax({url:i._directoryTemplate+"searchPanel-memberChoice-view.html"}).done(function(i){var n=$(e.Localization.localizeTemplate(i)),o=n.find(".memberChoice-searchPanel-searchButton"),r=n.find(".membersChoice-searchPanel-cancelSearchButton"),a=n.find(".memberChoice-searchPanel-propertiesDropDown"),s=n.find(".memberChoice-searchTextBox"),l=n.find(".memberChoice-searchPanel-comparisonDropDown");t.resolve({$rootLayout:n,$cancelSearchButton:r,$searchButton:o,$dropDownPanel:a,$searchTextBox:s,$searchTypeDropDownPanel:l})}).fail(function(i){e.LogService.error(i),t.reject(i)}),t},i}();i.SearchMembersControl=l}(t.MemberChoice||(t.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e){this._options=e,this._$textArea=$("<textarea class='form-control memberPropsViewerControl-textViewer' rows='15' readonly></textarea>"),this._$textArea.val(this.content)}return Object.defineProperty(e.prototype,"content",{get:function(){var t={};t.UniqueName=this._options.memberData.uniqueName,t.Caption=this._options.memberData.caption,t.ParentUniqueName=this._options.memberData.parentUniqueName,t.LevelDepth=this._options.memberData.levelDepth,t.ChildCount=this._options.memberData.childCount,t.Name=this._options.memberData.name,t.Description=this._options.memberData.description,t.LevelName=this._options.memberData.levelName;var i,n=0;for(i in t)t.hasOwnProperty(i)&&i.length>n&&(n=i.length);var o,r;if(this._options.memberData.memberProperties)for(o=0;o<this._options.memberData.memberProperties.length;o++)(r=this._options.memberData.memberProperties[o]).name.length>n&&(n=r.name.length);n+=1;var a="";for(i in t)t.hasOwnProperty(i)&&(a+=e.addSpace(i,n)+": "+t[i]+"\n");if(!this._options.memberData.memberProperties)return a;for(a+="\n",o=0;o<this._options.memberData.memberProperties.length;o++)r=this._options.memberData.memberProperties[o],a+=e.addSpace(r.name,n)+": "+r.value+"\n";return a},enumerable:!0,configurable:!0}),e.addSpace=function(e,t){for(var i=e,n=0;n<t-e.length;n++)i+=" ";return i},Object.defineProperty(e.prototype,"view",{get:function(){return this._$textArea},enumerable:!0,configurable:!0}),e}();e.MemberPropertiesViewerControl=t}(e.MemberPropertiesViewer||(e.MemberPropertiesViewer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(e){this.memberData=e}}();e.MemberPropertiesViewerOptions=t}(e.MemberPropertiesViewer||(e.MemberPropertiesViewer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){return function(e,t,i,n){this.caption=e,this.filterType=i,this.imageCssClass=t,this.isSelected=n}}(),n=function(){function n(i,o,r,a){var s=this;n._directoryTemplate=e.PathManager.templatesPath;var l=n.getLayout(),c=this;null===o&&(o=this.getDefaultValueForCustomFilter()),this._customFilterOptions=o,this._newCustomFilterOptions=jQuery.extend(!0,{},this._customFilterOptions),this._$measureChoiceContainer=a,l.done(function(e){c._layoutDescription=e,c.initFilterTypeSelector(),c._labelFilterControl=new t.LabelFilterControl(c._layoutDescription.customFilterPanels.$labelFilterPanel,o.labelFilter),c._labelFilterControl.init(),c._valueFilterControl=new t.ValueFilterControl(c._layoutDescription.customFilterPanels.$valueFilterPanel,o.valueFilter,r,s._$measureChoiceContainer),c._valueFilterControl.init(),c._topFilterControl=new t.TopFilterControl(c._layoutDescription.customFilterPanels.$topFilterPanel,o.topFilter,r,s._$measureChoiceContainer),c._topFilterControl.init(),$(i).append(c._layoutDescription.$rootLayout)})}return Object.defineProperty(n.prototype,"actualCustomFilterOptions",{get:function(){switch(this._newCustomFilterOptions.labelFilter=new t.LabelDataFilter,this._newCustomFilterOptions.topFilter=new t.TopDataFilter,this._newCustomFilterOptions.valueFilter=new t.ValueDataFilter,this._newCustomFilterOptions.currentDataFilter){case t.DataFilterType.LabelFilter:this._newCustomFilterOptions.labelFilter=this._labelFilterControl.actualOptions;break;case t.DataFilterType.TopFilter:this._newCustomFilterOptions.topFilter=this._topFilterControl.actualOptions;break;case t.DataFilterType.ValueFilter:this._newCustomFilterOptions.valueFilter=this._valueFilterControl.actualOptions;break;default:throw new Error("NotImplemetationException")}return this._newCustomFilterOptions},enumerable:!0,configurable:!0}),n.prototype.getDefaultValueForCustomFilter=function(){var e=new t.CustomFilterOptions;return e.currentDataFilter=t.DataFilterType.LabelFilter,e.labelFilter=new t.LabelDataFilter,e.topFilter=new t.TopDataFilter,e.valueFilter=new t.ValueDataFilter,e},n.prototype.initFilterTypeSelector=function(){var n=this,o=this._customFilterOptions.currentDataFilter;this.updateFilterPanel(o);var r=[new i(e.Localization.localize("LabelFilter_Name"),"imageLibrary_labelFilter",t.DataFilterType.LabelFilter,o===t.DataFilterType.LabelFilter),new i(e.Localization.localize("ValueFilter_Name"),"imageLibrary_valueFilter",t.DataFilterType.ValueFilter,o===t.DataFilterType.ValueFilter),new i(e.Localization.localize("TopFilter_Name"),"imageLibrary_topFilter",t.DataFilterType.TopFilter,o===t.DataFilterType.TopFilter)],a=new t.DropDownControl;a.displayPropertyExpr="caption",a.imageCssClassExp="imageCssClass",a.selectedExpr="isSelected",a.itemSource=r,a.selectionChanged.on(function(e){n._newCustomFilterOptions.currentDataFilter=e.filterType,n.updateFilterPanel(e.filterType)}),this._layoutDescription.$filterTypeDropDownPanel.append(a.view)},n.prototype.updateFilterPanel=function(e){switch(this._layoutDescription.customFilterPanels.$labelFilterPanel.hide(),this._layoutDescription.customFilterPanels.$topFilterPanel.hide(),this._layoutDescription.customFilterPanels.$valueFilterPanel.hide(),e){case t.DataFilterType.LabelFilter:this._layoutDescription.customFilterPanels.$labelFilterPanel.show();break;case t.DataFilterType.TopFilter:this._layoutDescription.customFilterPanels.$topFilterPanel.show();break;case t.DataFilterType.ValueFilter:this._layoutDescription.customFilterPanels.$valueFilterPanel.show();break;default:throw new Error("NotImplementationException")}},n.getLayout=function(){var t=$.Deferred();return $.ajax({url:n._directoryTemplate+"customFilter-view.html"}).done(function(i){var n=$(e.Localization.localizeTemplate(i));t.resolve({$rootLayout:n,customFilterPanels:{$labelFilterPanel:n.find("#labelFilterPanel"),$topFilterPanel:n.find("#topFilterPanel"),$valueFilterPanel:n.find("#valueFilterPanel")},$filterTypeDropDownPanel:n.find(".filterEditorWindow-filterTypeDropDown")})}).fail(function(i){t.reject(i),e.LogService.error(i)}),t},n}();t.CustomFilterControl=n}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.levelPropertyName=i,this.isSelected=n}}(),n=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n}}(),o=function(){function o(e,t){this._$view=e,this._options=t,this._newOptions=jQuery.extend(!0,{},this._options)}return Object.defineProperty(o.prototype,"actualOptions",{get:function(){return this._newOptions.text1=this._$textBox1.val(),this._newOptions.text2=this._$textBox2.val(),this._newOptions},enumerable:!0,configurable:!0}),o.prototype.parseView=function(e){this._$levelPropertyDropDownPanel=e.find(".filterEditorWindow-levelPropertyDropDownPanel"),this._$labelFilterTypeDropDownPanel=e.find(".filterEditorWindow-labelFilterTypeDropDownPanel"),this._$textBox1=e.find("#textBox1LabelFilterControl"),this._$textBox2=e.find("#textBox2LabelFilterControl"),this._$textBox1Panel=e.find("#textBox1LabelFilterControlPanel"),this._$textBox2Panel=e.find("#textBox2LabelFilterControlPanel"),this._$labelAndPanel=e.find("#andLabelFilterControlPanel")},o.prototype.init=function(){this.parseView(this._$view),this.initLevelPropName(),this.initFilterType(),this.initTextBoxes()},o.prototype.initTextBoxes=function(){this._$textBox1.val(this._options.text1),this._$textBox2.val(this._options.text2)},o.prototype.initLevelPropName=function(){var n=this,o=[new i(e.Localization.localize("Olap_Caption"),"imageLibrary_levelProperty","Caption","Caption".toUpperCase()===this._options.levelPropertyName.toUpperCase()),new i(e.Localization.localize("Olap_Name"),"imageLibrary_levelProperty","Name","Name".toUpperCase()===this._options.levelPropertyName.toUpperCase()),new i(e.Localization.localize("Olap_UniqueName"),"imageLibrary_levelProperty","UNIQUE_NAME","UNIQUE_NAME".toUpperCase()===this._options.levelPropertyName.toUpperCase())],r=new t.DropDownControl;r.displayPropertyExpr="caption",r.imageCssClassExp="imageCssClass",r.selectedExpr="isSelected",r.itemSource=o,r.selectionChanged.on(function(e){n._newOptions.levelPropertyName=e.levelPropertyName}),this._$levelPropertyDropDownPanel.append(r.view)},o.prototype.initFilterType=function(){var i=this;this.updateStateFilterType(this._options.filterType);var o=new Array;o.push(new n(e.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",t.LabelDataFilterType.Equal,t.LabelDataFilterType.Equal===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",t.LabelDataFilterType.NotEqual,t.LabelDataFilterType.NotEqual===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",t.LabelDataFilterType.Greater,t.LabelDataFilterType.Greater===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",t.LabelDataFilterType.GreaterOrEqual,t.LabelDataFilterType.GreaterOrEqual===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",t.LabelDataFilterType.Less,t.LabelDataFilterType.Less===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",t.LabelDataFilterType.LessOrEqual,t.LabelDataFilterType.LessOrEqual===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",t.LabelDataFilterType.Between,t.LabelDataFilterType.Between===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",t.LabelDataFilterType.BetweenNotIncluding,t.LabelDataFilterType.BetweenNotIncluding===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",t.LabelDataFilterType.NotBetween,t.LabelDataFilterType.NotBetween===this._options.filterType)),o.push(new n(e.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",t.LabelDataFilterType.NotBetweenNotIncluding,t.LabelDataFilterType.NotBetweenNotIncluding===this._options.filterType)),o.push(new n(e.Localization.localize("LabelFilter_BeginWith"),"imageLibrary_fcopbegin",t.LabelDataFilterType.BeginWith,t.LabelDataFilterType.BeginWith===this._options.filterType)),o.push(new n(e.Localization.localize("LabelFilter_NotBeginWith"),"imageLibrary_fcopbeginnot",t.LabelDataFilterType.NotBeginWith,t.LabelDataFilterType.NotBeginWith===this._options.filterType)),o.push(new n(e.Localization.localize("LabelFilter_EndWith"),"imageLibrary_fcopend",t.LabelDataFilterType.EndWith,t.LabelDataFilterType.EndWith===this._options.filterType)),o.push(new n(e.Localization.localize("LabelFilter_NotEndWith"),"imageLibrary_fcopendnot",t.LabelDataFilterType.NotEndWith,t.LabelDataFilterType.NotEndWith===this._options.filterType)),o.push(new n(e.Localization.localize("LabelFilter_Contain"),"imageLibrary_fcopcontain",t.LabelDataFilterType.Contain,t.LabelDataFilterType.Contain===this._options.filterType)),o.push(new n(e.Localization.localize("LabelFilter_NotContain"),"imageLibrary_fcopnotcontain",t.LabelDataFilterType.NotContain,t.LabelDataFilterType.NotContain===this._options.filterType));var r=new t.DropDownControl;r.displayPropertyExpr="caption",r.imageCssClassExp="imageCssClass",r.selectedExpr="isSelected",r.itemSource=o,r.selectionChanged.on(function(e){i.updateStateFilterType(e.filterType)}),this._$labelFilterTypeDropDownPanel.append(r.view)},o.prototype.updateStateFilterType=function(e){switch(this._newOptions.filterType=e,e){case t.LabelDataFilterType.Between:case t.LabelDataFilterType.BetweenNotIncluding:case t.LabelDataFilterType.NotBetween:case t.LabelDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},o.prototype.updateStateTextEditor=function(e){e?(this._$textBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$textBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$textBox2Panel.removeClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.removeClass("filterEditorWindow-visibility_collapsed")):(this._$textBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$textBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$textBox2Panel.addClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.addClass("filterEditorWindow-visibility_collapsed"))},o}();t.LabelFilterControl=o}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(){this.isUsed=!1,this.currentDataFilter=e.DataFilterType.LabelFilter,this.labelFilter=new e.LabelDataFilter,this.topFilter=new e.TopDataFilter,this.valueFilter=new e.ValueDataFilter}}();e.CustomFilterOptions=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.LabelFilter=0]="LabelFilter",e[e.ValueFilter=1]="ValueFilter",e[e.TopFilter=2]="TopFilter"}(e.DataFilterType||(e.DataFilterType={}));e.DataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(t){t?(this.text1=t.text1,this.text2=t.text2,this.levelPropertyName=t.levelPropertyName,this.filterType=t.filterType):(this.text1="",this.text2="",this.levelPropertyName="Caption",this.filterType=e.LabelDataFilterType.Equal)}}();e.LabelDataFilter=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.Greater=2]="Greater",e[e.GreaterOrEqual=3]="GreaterOrEqual",e[e.Less=4]="Less",e[e.LessOrEqual=5]="LessOrEqual",e[e.Between=6]="Between",e[e.BetweenNotIncluding=7]="BetweenNotIncluding",e[e.NotBetween=8]="NotBetween",e[e.NotBetweenNotIncluding=9]="NotBetweenNotIncluding",e[e.BeginWith=10]="BeginWith",e[e.NotBeginWith=11]="NotBeginWith",e[e.EndWith=12]="EndWith",e[e.NotEndWith=13]="NotEndWith",e[e.Contain=14]="Contain",e[e.NotContain=15]="NotContain"}(e.LabelDataFilterType||(e.LabelDataFilterType={}));e.LabelDataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(t){t?(this.filterType=t.filterType,this.count=t.count,this.filterTarget=t.filterTarget,this.measureUniqueName=t.measureUniqueName):(this.filterType=e.TopDataFilterType.Top,this.count=0,this.filterTarget=e.TopDataFilterTargetType.Items,this.measureUniqueName="")}}();e.TopDataFilter=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.Items=0]="Items",e[e.Percent=1]="Percent",e[e.Sum=2]="Sum"}(e.TopDataFilterTargetType||(e.TopDataFilterTargetType={}));e.TopDataFilterTargetType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"}(e.TopDataFilterType||(e.TopDataFilterType={}));e.TopDataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(t){t?(this.num1=t.num1,this.num2=t.num2,this.measureUniqueName=t.measureUniqueName,this.filterType=t.filterType):(this.num1=0,this.num2=0,this.measureUniqueName="",this.filterType=e.ValueDataFilterType.Equal)}}();e.ValueDataFilter=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.Greater=2]="Greater",e[e.GreaterOrEqual=3]="GreaterOrEqual",e[e.Less=4]="Less",e[e.LessOrEqual=5]="LessOrEqual",e[e.Between=6]="Between",e[e.BetweenNotIncluding=7]="BetweenNotIncluding",e[e.NotBetween=8]="NotBetween",e[e.NotBetweenNotIncluding=9]="NotBetweenNotIncluding"}(e.ValueDataFilterType||(e.ValueDataFilterType={}));e.ValueDataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n}}(),n=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterTargetType=i,this.isSelected=n}}(),o=function(){function o(e,t,i,n){this._$view=e,this._options=t,this._newOptions=jQuery.extend(!0,{},this._options),this._treeMeasures=i,this._$measureChoiceContainer=n}return Object.defineProperty(o.prototype,"actualOptions",{get:function(){return this._newOptions.count=parseInt(this._$countNumericDown.val()),isNaN(this._newOptions.count)&&(this._newOptions.count=0),this._newOptions},enumerable:!0,configurable:!0}),o.prototype.init=function(){this.parseView(this._$view),this.initFilterType(),this.initFilterTargetType(),this.initCountTextBox(),this.initMeasureChoiceControl()},o.prototype.initCountTextBox=function(){this._$countNumericDown.val(this._options.count.toString())},o.prototype.initFilterTargetType=function(){var i=new Array;i.push(new n(e.Localization.localize("Filter_Target_Items"),"imageLibrary_items",t.TopDataFilterTargetType.Items,t.TopDataFilterTargetType.Items===this.actualOptions.filterTarget)),i.push(new n(e.Localization.localize("Filter_Target_Percent"),"imageLibrary_percent",t.TopDataFilterTargetType.Percent,t.TopDataFilterTargetType.Percent===this.actualOptions.filterTarget)),i.push(new n(e.Localization.localize("Filter_Target_Sum"),"imageLibrary_sum",t.TopDataFilterTargetType.Sum,t.TopDataFilterTargetType.Sum===this.actualOptions.filterTarget));var o=this,r=new t.DropDownControl;r.displayPropertyExpr="caption",r.imageCssClassExp="imageCssClass",r.selectedExpr="isSelected",r.itemSource=i,r.selectionChanged.on(function(e){o._newOptions.filterTarget=e.filterTargetType}),this._$filterTargetTypeDropDownPanel.append(r.view)},o.prototype.initMeasureChoiceControl=function(){var e=this,i=new t.MeasureChoiceOptions(this._treeMeasures,!1),n=this;i.getPopupContainer=function(){return n._$measureChoiceContainer},i.isMultiSelect=!1,this._newOptions.measureUniqueName&&(i.selectedUniqueNames=[this._newOptions.measureUniqueName]),i.onSelectedMeasuresChanged=function(t){e._newOptions.measureUniqueName=t[0].uniqueName},new t.MeasureChoiceSelector(this._$measureChoicePanel[0],i).init()},o.prototype.initFilterType=function(){var n=this,o=new Array;o.push(new i(e.Localization.localize("Filter_Type_Top"),"imageLibrary_top",t.TopDataFilterType.Top,t.TopDataFilterType.Top===this._options.filterType)),o.push(new i(e.Localization.localize("Filter_Type_Bottom"),"imageLibrary_bottom",t.TopDataFilterType.Bottom,t.TopDataFilterType.Bottom===this._options.filterType));var r=new t.DropDownControl;r.displayPropertyExpr="caption",r.imageCssClassExp="imageCssClass",r.selectedExpr="isSelected",r.itemSource=o,r.selectionChanged.on(function(e){n._newOptions.filterType=e.filterType}),this._$topFilterDataTypeDropDownPanel.append(r.view)},o.prototype.parseView=function(e){this._$topFilterDataTypeDropDownPanel=e.find(".filterEditorWindow-topFilterPanel-filterTypeDropDownPanel"),this._$filterTargetTypeDropDownPanel=e.find(".filterEditorWindow-topFilterPanel-targetTypeDropDownPanel"),this._$measureChoicePanel=e.find("#measureChoicePanelTopFilter"),this._$countNumericDown=e.find("#countNumericDownFilterTargetType")},o}();t.TopFilterControl=o}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n}}(),n=function(){function n(e,t,i,n){this._$view=e,this._options=t,this._treeMeasures=i,this._$measureChoiceContainer=n,this._newOptions=jQuery.extend(!0,{},this._options)}return Object.defineProperty(n.prototype,"actualOptions",{get:function(){return this._newOptions.num1=Number(this._$numericBox1.val()),this._newOptions.num2=Number(this._$numericBox2.val()),isNaN(this._newOptions.num1)&&(this._newOptions.num1=0),isNaN(this._newOptions.num2)&&(this._newOptions.num2=0),this._newOptions},enumerable:!0,configurable:!0}),n.prototype.parseView=function(e){this._$valueFilterTypeDropDownPanel=e.find(".filterEditorWindow-valueFilterTypeDropDownPanel"),this._$numericBox1=e.find("#numericBox1ValueFilter"),this._$numericBox2=e.find("#numericBox2ValueFilter"),this._$numericBox1Panel=e.find("#numericBox1ValueFilterControlPanel"),this._$numericBox2Panel=e.find("#numericBox2ValueFilterControlPanel"),this._$labelAndPanel=e.find("#andValueFilterControlPanel"),this._$measureChoicePanel=e.find("#measureChoicePanelValueFilter")},n.prototype.init=function(){this.parseView(this._$view),this.initFilterType(),this.initNumeriUpDowns(),this.initMeasureChoiceControl()},n.prototype.initMeasureChoiceControl=function(){var e=this,i=new t.MeasureChoiceOptions(this._treeMeasures,!1);i.getPopupContainer=function(){return e._$measureChoiceContainer},i.isMultiSelect=!1,this._newOptions.measureUniqueName&&(i.selectedUniqueNames=[this._newOptions.measureUniqueName]),i.onSelectedMeasuresChanged=function(t){e._newOptions.measureUniqueName=t[0].uniqueName},new t.MeasureChoiceSelector(this._$measureChoicePanel[0],i).init()},n.prototype.initNumeriUpDowns=function(){this._$numericBox1.val(this._options.num1.toString()),this._$numericBox2.val(this._options.num2.toString())},n.prototype.initFilterType=function(){var n=this,o=new Array;o.push(new i(e.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",t.ValueDataFilterType.Equal,t.ValueDataFilterType.Equal===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",t.ValueDataFilterType.NotEqual,t.ValueDataFilterType.NotEqual===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",t.ValueDataFilterType.Greater,t.ValueDataFilterType.Greater===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",t.ValueDataFilterType.GreaterOrEqual,t.ValueDataFilterType.GreaterOrEqual===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",t.ValueDataFilterType.Less,t.ValueDataFilterType.Less===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",t.ValueDataFilterType.LessOrEqual,t.ValueDataFilterType.LessOrEqual===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",t.ValueDataFilterType.Between,t.ValueDataFilterType.Between===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",t.ValueDataFilterType.BetweenNotIncluding,t.ValueDataFilterType.BetweenNotIncluding===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",t.ValueDataFilterType.NotBetween,t.ValueDataFilterType.NotBetween===this._options.filterType)),o.push(new i(e.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",t.ValueDataFilterType.NotBetweenNotIncluding,t.ValueDataFilterType.NotBetweenNotIncluding===this._options.filterType)),this.updateStateFilterType(this._options.filterType);var r=new t.DropDownControl;r.displayPropertyExpr="caption",r.imageCssClassExp="imageCssClass",r.selectedExpr="isSelected",r.itemSource=o,r.selectionChanged.on(function(e){n.updateStateFilterType(e.filterType)}),this._$valueFilterTypeDropDownPanel.append(r.view)},n.prototype.updateStateFilterType=function(e){switch(this._newOptions.filterType=e,e){case t.ValueDataFilterType.Between:case t.ValueDataFilterType.BetweenNotIncluding:case t.ValueDataFilterType.NotBetween:case t.ValueDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},n.prototype.updateStateTextEditor=function(e){e?(this._$numericBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$numericBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$numericBox2Panel.removeClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.removeClass("filterEditorWindow-visibility_collapsed")):(this._$numericBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$numericBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$numericBox2Panel.addClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.addClass("filterEditorWindow-visibility_collapsed"))},n}();t.ValueFilterControl=n}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var a,Ranet;!function(e){!function(t){var i=function(){function i(t,n,o,r,a,s,l){this._customFilterControl=null,this._smartCustomFilterControl=null,this._useSimpleCustomFilter=!1,this._useSmartCustomFiter=!1,this._currentHierarchy=r,this._container=a,this._isVisibleCustomFilterPanel=o,this._filterOptions=t,this._newFilterOptionsArgs=jQuery.extend(!0,{},this._filterOptions),i._directoryTemplate=e.PathManager.templatesPath,this._treeMeasures=n,this._onOkClosed=s,this._onCancelClosed=l}return i.prototype.show=function(){e.UserActionsTracker.track("Open the 'Filter Editor'");var t=this;if(this._$filterWindow)throw Error("InvalidOperationException");this.getWindow().done(function(e){t.initWindow(e,t._filterOptions)})},i.prototype.initWindow=function(i,n){var o=this,r=this,a=!1;this._$filterWindow=i.$window,this._isVisibleCustomFilterPanel||(i.$useSimpleCustomFilterPanel.hide(),i.$useSmartCustomFilterPanel.hide(),i.$panelCustomFilterControl.hide(),i.$customFilterTab.hide());var s=n.customFilterOptions.isUsed||n.smartCustomFilterDescription.isUsed;if(this.setStatePanel(i.$panelCustomFilterControl,s),this.setStatePanel(i.$panelMemberChoiceControl,n.useMembersChoiceFilter),n.useMembersChoiceFilter&&i.$checkBoxUseMemberChoiceFilter.attr("checked",""),n.customFilterOptions.isUsed?(i.$useSmartCustomFilterPanel.hide(),this._useSimpleCustomFilter=!0,i.$useSimpleCustomFilterCheckBox.attr("checked","")):i.$useSimpleCustomFilterPanel.hide(),n.smartCustomFilterDescription.isUsed&&(this._useSmartCustomFiter=!0,i.$useSmartCustomFilterCheckBox.attr("checked","")),i.$useSimpleCustomFilterCheckBox.click(function(){var e=i.$useSimpleCustomFilterCheckBox.is(":checked");r._useSimpleCustomFilter=e,r.setStatePanel(i.$panelCustomFilterControl,e)}),i.$useSmartCustomFilterCheckBox.click(function(){var e=i.$useSmartCustomFilterCheckBox.is(":checked");r._useSmartCustomFiter=e,r.setStatePanel(i.$panelCustomFilterControl,e)}),i.$checkBoxUseMemberChoiceFilter.click(function(){var e=i.$checkBoxUseMemberChoiceFilter.is(":checked");r._newFilterOptionsArgs.useMembersChoiceFilter=e,r.setStatePanel(i.$panelMemberChoiceControl,e)}),i.$cancelButton.click(function(){r.clickCancelButton()}),i.$xButton.click(function(){r.clickCancelButton()}),i.$okButton.click(function(){e.UserActionsTracker.track("Apply filters from the 'Filter Editor'"),o._smartCustomFilterControl?(o._smartCustomFilterControl.isValid?(i.$validIndicator.addClass("validation-indicator-hidden"),r.clickOkButton(),$(i.$window).modal("hide")):i.$validIndicator.removeClass("validation-indicator-hidden"),a=!0):(r.clickOkButton(),$(i.$window).modal("hide"))}),this._memberChoiceControl=new t.MemberChoice.MemberChoiceControl(i.$panelMemberChoiceControl[0],n.membersChoiceFilterOptions),this._useSimpleCustomFilter)this._customFilterControl=new t.CustomFilterControl(i.$panelCustomFilterControl[0],n.customFilterOptions,this._treeMeasures,this._container);else{var l=new t.SmartFilter.CustomFilterOptions;l.hierarchyUniqueName=n.membersChoiceFilterOptions.hierarchyUniqueName,l.measureChoiceContainer=this._container,l.treeMeasures=this._treeMeasures,l.filterTreeDescription=n.smartCustomFilterDescription.filterTreeDescription,this._smartCustomFilterControl=new t.SmartFilter.CustomFilterControl(i.$panelCustomFilterControl[0],l),this._smartCustomFilterControl.onValueChanged.on(function(){i.$validIndicator.addClass("validation-indicator-hidden")}),this._memberChoiceControl.onLevelsChanged.on(function(e){var i=new Array,n=new t.SmartFilter.Options.LevelDescription;n.uniqueName=null,n.levelNumber=-1,n.caption=o._currentHierarchy.caption,n.imageClass="imageLibrary_"+o._currentHierarchy.icon.replace("_filter",""),n.order=0,i.push(n);for(var r=0;r<e.length;r++){var a=new t.SmartFilter.Options.LevelDescription;a.uniqueName=e[r].uniqueName,a.imageClass="imageLibrary_"+e[r].icon,a.caption=e[r].caption,a.levelNumber=e[r].levelNumber,a.order=r+1,i.push(a)}o._smartCustomFilterControl.levels=i})}this._$filterWindow.modal("show").appendTo(this._container),this._$filterWindow.on("shown.bs.modal",function(){r._$filterWindow.draggable({handle:".modal-header"})}),this._$filterWindow.on("hidden.bs.modal",function(){r._$filterWindow.draggable("destroy"),r._$filterWindow.remove()})},i.prototype.clickOkButton=function(){if(this._newFilterOptionsArgs.membersChoiceFilterOptions.selectionRootNodes=this._memberChoiceControl.selectionRootNodes,null!=this._customFilterControl&&(this._newFilterOptionsArgs.customFilterOptions=this._customFilterControl.actualCustomFilterOptions,this._newFilterOptionsArgs.customFilterOptions.isUsed=this._useSimpleCustomFilter),null!=this._smartCustomFilterControl){var e=this._smartCustomFilterControl.filterTreeDescription;this._newFilterOptionsArgs.smartCustomFilterDescription.isUsed=this._useSmartCustomFiter,this._newFilterOptionsArgs.smartCustomFilterDescription.filterTreeDescription=e}this._onOkClosed&&this._onOkClosed(this,this._newFilterOptionsArgs)},i.prototype.clickCancelButton=function(){this._onCancelClosed&&this._onCancelClosed(this)},i.prototype.setStatePanel=function(e,t){t?e.removeClass("memberChoice_disabled"):e.addClass("memberChoice_disabled")},i.prototype.getWindow=function(){var t=$.Deferred();return $.ajax({url:i._directoryTemplate+"filter-window.html"}).done(function(i){var n=$(e.Localization.localizeTemplate(i)),o=n.find(".filterEditorWindow-okButton"),r=n.find(".filterEditorWindow-cancelButton"),a=n.find(".filterEditorWindow-memberChoicePanel"),s=n.find(".filterEditorWindow-useMemberChoiceCheckbox input"),l=n.find(".close"),c=n.find("#customFilterTab"),u=n.find(".filterEditorWindow-customFilterPanel"),p=n.find(".filterEditorWindow-useSimpleCustomFilterCheckbox"),h=p.find("input"),d=n.find(".filterEditorWindow-useSmartCustomFilterCheckbox"),m=d.find("input"),f=n.find(".filterEditorWindow-validationIndicator");t.resolve({$window:n,$okButton:o,$cancelButton:r,$checkBoxUseMemberChoiceFilter:s,$panelMemberChoiceControl:a,$xButton:l,$panelCustomFilterControl:u,$customFilterTab:c,$useSimpleCustomFilterCheckBox:h,$useSimpleCustomFilterPanel:p,$useSmartCustomFilterCheckBox:m,$useSmartCustomFilterPanel:d,$validIndicator:f})}).fail(function(i){e.LogService.error(i),t.reject(i)}),t},i}();t.FilterEditorWindow=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetMeasureGroupSelector=function(t,i){var n,o=this,r={},a=this;a.settings={},a.init=function(){o.settings=e.extend({},r,i),n=new Ranet.Controls.MeasureGroupSelector(t,i)},a.option=function(e){},a.init()},e.fn.ranetMeasureGroupSelector=function(t){return this.each(function(){var i=new e.ranetMeasureGroupSelector(this,t);e(this).data("ranetMeasureGroupSelector",i)})}}(jQuery);var Ranet;!function(e){!function(t){var i=function(){function i(e,t){if(void 0===t.selectedMeasureGroupName||void 0===t.dataSource)throw new Error("ArgumentException");this._dropDownControl=this.getDropDownControl(function(e){t.onMeasureGroupSelectedChanged&&t.onMeasureGroupSelectedChanged(e)}),this._selectedMeasureGroupName=t.selectedMeasureGroupName,null!==t.dataSource&&(this.dataSource=t.dataSource),$(e).append(this._dropDownControl.view)}return Object.defineProperty(i.prototype,"dataSource",{get:function(){return this._dataSource},set:function(t){var i=this;this._dataSource=t,this._dataSource.splice(0,0,{caption:e.Localization.localize("MeasureGroup_All"),isSelected:null===this._selectedMeasureGroupName,isAll:!0}),null!==this._selectedMeasureGroupName&&this.dataSource.forEach(function(e){e.name===i._selectedMeasureGroupName&&(e.isSelected=!0)}),this._dropDownControl.itemSource=this._dataSource},enumerable:!0,configurable:!0}),i.prototype.getDropDownControl=function(e){var i=new t.DropDownControl;return i.selectionChanged.on(function(t){e(t.hasOwnProperty("isAll")?null:t)}),i.displayPropertyExpr="caption",i.selectedExpr="isSelected",i},i}();t.MeasureGroupSelector=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(e){this._connection=e}return t.prototype.getLevels=function(t,i){var n=$.Deferred();return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/memberchoice/getLevels",data:{connection:this._connection,cubeName:t,hierarchyUniqueName:i},success:function(e){n.resolve(e)},error:function(t){e.LogService.error(t),e.UserMessageService.showServerError(t),n.reject(t)}}),n},t.prototype.getMembers=function(t){var i=$.Deferred();return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/memberchoice/getMembers",data:{connection:this._connection,query:t},success:function(e){i.resolve(e)},error:function(n){e.LogService.error(n,t),e.UserMessageService.showServerError(n),console.log(n),i.reject(n)}}),i},t.prototype.actualizeSelectionTree=function(t,i,n){var o=$.Deferred();return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/memberchoice/actualizeSelectionTree",data:{connection:this._connection,hierarchyUniqueName:i,selectionTree:JSON.stringify(n),cubeName:t},success:function(e){o.resolve(e)},error:function(t){e.LogService.error(t,i,n),e.UserMessageService.showServerError(t),o.reject(t)}}),o},t}();t.DataService=i}(t.MemberChoice||(t.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(e){this._options=e,this._defaultColumnCount=1,this._defaultButtonWidth=70,this._defaultMaxHeight=300,void 0!==this._options&&(this._defaultColumnCount=this._options.defaultColumnCount,this._defaultButtonWidth=this._options.defaultButtonWidth,this._defaultMaxHeight=this._options.defaultMaxHeight)}return Object.defineProperty(t.prototype,"columnCount",{get:function(){return Number(this._$columnCountInput.val())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonWidth",{get:function(){return Number(this._$buttonWidthInput.val())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxHeight",{get:function(){return Number(this._$maxHeightInput.val())},enumerable:!0,configurable:!0}),t.prototype.createView=function(){var t=$("<div/>"),i=$("<div/>"),n=$("<span>"+e.Localization.localize("CountColumnsLabel")+"</label>"),o=$('<input class="form-control" type="number" step="1" value="'+this._defaultColumnCount+'">');this._$columnCountInput=o,i.append(n),i.append(o);var r=$("<div/>"),a=$("<span>"+e.Localization.localize("ColumnWidthLabel")+"</label>"),s=$('<input class="form-control" type="number" step="1" value="'+this._defaultButtonWidth+'">');this._$buttonWidthInput=s,r.append(a),r.append(s);var l=$("<div/>"),c=$("<span>"+e.Localization.localize("MaxHeightPanel")+"</label>"),u=$('<input class="form-control" type="number" step="1" value="'+this._defaultMaxHeight+'">');return this._$maxHeightInput=u,l.append(c),l.append(u),t.append(i),t.append(r),t.append(l),t},Object.defineProperty(t.prototype,"view",{get:function(){return this._$view||(this._$view=this.createView()),this._$view},enumerable:!0,configurable:!0}),t}();t.SlicerSettingsControl=i}(t.Slicer||(t.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.SlicerControlOptions=t}(e.Slicer||(e.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i,n){this.childNodes=new Array,this.selectedDescendants=n,this.selectedChildren=i,this.selectedSelf=t,this.uniqueName=e}return e.prototype.buildMdx=function(){if(this instanceof e!=!1){var t=this.buildMdx1();return void 0===t.includeSet?"{}":t.includeSet}},e.prototype.buildMdx1=function(t,i){if(this instanceof e!=!1){for(var n=new Array,o=new Array,r=0;r<this.childNodes.length;r++){var a=this.childNodes[r].buildMdx1(this.selectedChildren,void 0===this.selectedDescendants?i:this.selectedDescendants);void 0!==a.includeSet&&n.push(a.includeSet),void 0!==a.excludeSet&&o.push(a.excludeSet)}var s=this.combineToSet(n),l=this.combineToSet(o),c=new Array,u=new Array;void 0!==this.selectedDescendants?this.buildDescendants(c,u,t,i):(this.buildChildren(c,u,t,i),this.buildSelf(c,u,t,i));var p,h;return c.length>0?(c=c.concat(n),p=this.combineToSet(c),void 0!==l&&(p=this.buildExceptMdx(p,l))):p=s,u.length>0?(u=u.concat(o),h=this.combineToSet(u),void 0!==s&&(h=this.buildExceptMdx(h,s))):h=l,{includeSet:p,excludeSet:h}}},e.prototype.buildSelf=function(e,t,i,n){var o=void 0===i?n:i;if(void 0===this.selectedSelf||void 0===o||this.selectedSelf!==o)switch(this.selectedSelf){case!0:e.push(this.buildSelfMdx(this.uniqueName));break;case!1:t.push(this.buildSelfMdx(this.uniqueName));break;default:return}},e.prototype.buildChildren=function(e,t,i,n){if(void 0===this.selectedChildren||void 0===n||n!==this.selectedChildren)switch(this.selectedChildren){case!0:e.push(this.buildChildrenMdx(this.uniqueName));break;case!1:t.push(this.buildChildrenMdx(this.uniqueName));break;default:return}},e.prototype.buildDescendants=function(t,i,n,o){if(void 0!==this.selectedDescendants&&void 0!==o&&this.selectedDescendants===o)return this.buildChildren(t,i,n,o),void this.buildSelf(t,i,n,o);switch(this.selectedDescendants){case!0:t.push(this.buildDescendantsMdx(this.uniqueName,this.selectedSelf,this.selectedChildren)),!1===this.selectedSelf&&i.push(this.buildSelfMdx(this.uniqueName)),!1===this.selectedChildren&&i.push(this.buildChildrenMdx(this.uniqueName));break;case!1:i.push(this.buildDescendantsMdx(this.uniqueName,e.invertBooleanValue(this.selectedSelf),e.invertBooleanValue(this.selectedChildren))),this.selectedSelf&&t.push(this.buildSelfMdx(this.uniqueName)),this.selectedChildren&&t.push(this.buildChildrenMdx(this.uniqueName))}},e.invertBooleanValue=function(e){return void 0===e?e:!e},e.prototype.buildSelfMdx=function(e){return e},e.prototype.buildChildrenMdx=function(e){return e+".Children"},e.prototype.buildDescendantsMdx=function(e,t,i){return void 0===t&&void 0===i?"Descendants("+e+", 0, AFTER)":void 0===t?i?"Descendants("+e+", 0, AFTER)":"Descendants("+e+", 1, AFTER)":void 0===i?t?"Descendants("+e+")":"Descendants("+e+", 0, AFTER)":t&&i?"Descendants("+e+")":t&&!1===i?"Descendants("+e+", 1, BEFORE_AND_AFTER)":!1===t&&i?"Descendants("+e+", 0, AFTER)":!1===t&&!1===i?"Descendants("+e+", 1, AFTER)":null},e.prototype.combineToSet=function(t){if(this instanceof e!=!1&&0!==t.length){if(1===t.length){var i=t[0];if("{"===i[0]&&"}"===i[i.length-1])return i}return"{"+t.join(", ")+"}"}},e.prototype.buildExceptMdx=function(e,t){return"Except("+e+", "+t+")"},e.parse=function(t){var i=JSON.parse(t);return e.convertJsObject(i)},e.convertJsObject=function(t){for(var i=new Array,n=0;n<t.length;n++){var o=t[n],r=new e(o.uniqueName,o.selectedSelf,o.selectedChildren,o.selectedDescendants);o.childNodes.length>0&&(r.childNodes=e.convertJsObject(o.childNodes)),i.push(r)}return i},e.clearSelection=function(t){if(t.selectedChildren=t.selectedDescendants=t.selectedSelf=void 0,t.childNodes.length>0)for(var i=0;i<t.childNodes.length;i++)e.clearSelection(t.childNodes[i])},e}();e.MemberChoiceTreeNode=t}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=t.Windows.FloatingWindowOptions,o=t.Windows.WindowSize,r=t.Windows.FloatingWindow,a=function(){function a(e){var n=this;this._options=e,this._maxHeight=300,this._columnCount=1,this._buttonWidth=70,this._dataSource=null,this._items=new Array,this._onStateChanged=new t.Events.LiteEvent,this._onSlicerDeleted=new t.Events.LiteEvent,this._onSettingsChanged=new t.Events.LiteEvent,this._onSlicerMinimized=new t.Events.LiteEvent,this._isVisibleLoadingPanel=!1;var o=new Array;this._options.startSelectionTree&&(o=t.MemberChoice.MemberChoiceTreeNode.parse(JSON.stringify(this._options.startSelectionTree))),this.setActualSelectionTree(o),this._columnCount=this._options.columnCount,this._buttonWidth=this._options.buttonWidth,this._maxHeight=this._options.maxHeight;var r=new i.DataManager(this._options.connection,this._options.cubeName,this._options.hierarchyUniqueName,this._options.levelUniqueName),a=r.getMemberCount();this._view=this.getNewView(),this.isVisibleLoadingPanel=!0,a.done(function(e){r.getMembers(e).done(function(e){n.isVisibleLoadingPanel=!1,n._dataSource=e,n._$headerTitle.text(n._options.header),n.refreshView()})})}return Object.defineProperty(a.prototype,"onStateChanged",{get:function(){return this._onStateChanged},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onSlicerDeleted",{get:function(){return this._onSlicerDeleted},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onSettingsChanged",{get:function(){return this._onSettingsChanged},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onSlicerMinimized",{get:function(){return this._onSlicerMinimized},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"levelUniqueName",{get:function(){return this._options.levelUniqueName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hierarchyUniqueName",{get:function(){return this._options.hierarchyUniqueName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isVisibleLoadingPanel",{get:function(){return this._isVisibleLoadingPanel},set:function(t){this._isVisibleLoadingPanel=t,this._isVisibleLoadingPanel?(this.view.css("min-width",150),this.view.css("min-height",100),this._$loadingPanel=$('<div style="overflow:hidden;"><i class="fa fa-spinner fa-pulse fa-fw"></i>'+e.Localization.localize("Loading")+"</div>"),this._contentView.append(this._$loadingPanel)):this._$loadingPanel.remove()},enumerable:!0,configurable:!0}),a.transformTreeToMap=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];if(t[n.uniqueName]=n,n.childNodes.length>0){var o=a.transformTreeToMap(n.childNodes);for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])}}return t},a.prototype.setActualSelectionTree=function(e){this._currentSelectionTree=e;var t=a.transformTreeToMap(e);this._someMap=t},a.prototype.getNewView=function(){var t=this,i=$('<div style="position:absolute;background-color: white;border:1px solid silver; z-index:1000;" class="slicerControl"/>'),n=$('<div class="slicerControl-header" style="padding: 5px;"></div>'),o=$('<span style="font-weight: bold; font-size: 15px;">'+this._options.header+"</span>"),r=$('<i class="fa fa-trash-o" title="'+e.Localization.localize("Slicer_RemoveSlicerTooltip")+'" aria-hidden="true" style="margin-left:5px;float:right;font-size:14px; cursor:pointer;"></i>'),a=$('<i class="fa fa-cog" title="'+e.Localization.localize("Slicer_OpenSettingsTooltip")+'" aria-hidden="true" style="margin-left:5px;float:right;font-size:14px; cursor:pointer;"></i>'),s=$('<i class="fa fa-window-minimize" style="margin-left:5px;float:right;font-size:14px; cursor:pointer;" aria-hidden="true"></i>');return a.on("click",function(){t.openSlicerSettings()}),r.on("click",function(){t.remove()}),s.on("click",function(){t._view.remove(),t._onSlicerMinimized.trigger({sender:t})}),n.append(o),n.append(r),n.append(a),n.append(s),i.draggable({handle:".slicerControl-header"}),this._contentView=this.getContent(),this._$headerTitle=o,i.append(n),i.append(this._contentView),i},a.prototype.getContent=function(){var e=this,t=$("<div style='padding-left:5px; padding-right:5px; overflow-y: auto; overflow-x:hidden;'></div>");if(t.css("width",this._columnCount*(this._buttonWidth+28)+40),t.css("max-height",this._maxHeight),!1===(0!==this._items.length)){if(this._items.length=0,null!==this._dataSource)for(var n=0;n<this._dataSource.length;n++){0!==n&&n%this._columnCount==0&&t.append("<br/>");var o=this._dataSource[n],r=new i.SlicerItem(o);r.onStateChanged.on(function(t){e.changeMembersTreeState(t.e)}),r.isChecked=this.isSelectedMember(o),this._items.push(r),t.append(r.getView(this._buttonWidth))}}else for(var a=0;a<this._items.length;a++){var s=this._items[a];0!==a&&a%this._columnCount==0&&t.append("<br/>"),s.isChecked=this.isSelectedMember(s.memberData),t.append(s.getView(this._buttonWidth))}return t},a.prototype.isSelectedMember=function(e){var t=this._someMap[e.uniqueName];if(t&&void 0!==t.selectedSelf)return t.selectedSelf;if(null==e.parents)return!1;var i=e.parents[0];if(i){var n=this._someMap[i.uniqueName];if(n&&void 0!==n.selectedChildren)return n.selectedChildren;if(n&&void 0!==n.selectedDescendants)return n.selectedDescendants}if(e.parents.length>1)for(var o=e.parents.length-1;o>0;o--){var r=e.parents[o],a=this._someMap[r.uniqueName];if(a&&void 0!==a.selectedDescendants)return a.selectedDescendants}return!1},a.prototype.changeMembersTreeState=function(e){var n=new i.SlicerStateChangedArgs;n.hierarchyUniqueName=e.memberData.hierarchyUniqueName;var o=this._someMap[e.memberData.uniqueName];if(!o){var r=null;if(null!==e.memberData.parents)for(var s=0;s<e.memberData.parents.length;s++){var l=e.memberData.parents[s],c=this._someMap[l.uniqueName];if(c)r=c;else{var u=new t.MemberChoice.MemberChoiceTreeNode(l.uniqueName);null!==r?r.childNodes.push(u):this._currentSelectionTree.push(u),r=u}}o=new t.MemberChoice.MemberChoiceTreeNode(e.memberData.uniqueName),null!==r?r.childNodes.push(o):this._currentSelectionTree.push(o)}o.selectedSelf=this.getNewState(o,e.newState),n.selectionMembersTree=this._currentSelectionTree,this._someMap=a.transformTreeToMap(this._currentSelectionTree),this._onStateChanged.trigger({sender:this,e:n})},a.prototype.getNewState=function(e,t){if(t)return!0;if(!e.selectedSelf){if(void 0===e.selectedSelf)return!1;throw new Error("NotImplementedException")}},a.prototype.openSlicerSettings=function(){var t=this,a=new i.SlicerSettingsControlOptions;a.defaultButtonWidth=this._buttonWidth,a.defaultColumnCount=this._columnCount,a.defaultMaxHeight=this._maxHeight;var s=new i.SlicerSettingsControl(a),l=new n;l.content=s.view,l.title=e.Localization.localize("WindowTitleSlicerSettings"),l.size=o.Small,l.container=this._options.container,l.onClosed=function(e,n){if(!1!==n.dialogResult){t._buttonWidth=s.buttonWidth,t._columnCount=s.columnCount,t._maxHeight=s.maxHeight;var o=new i.SlicerSettingsControlOptions;o.defaultButtonWidth=t._buttonWidth,o.defaultColumnCount=t._columnCount,o.defaultMaxHeight=t._maxHeight,t._onSettingsChanged.trigger({sender:t,newSettings:o}),t.refreshView()}},new r(l).show()},a.prototype.refreshView=function(){this._view.css("height",""),this._view.css("width",""),this.view.css("min-width",""),this.view.css("min-height",""),this._contentView.remove(),this._contentView=this.getContent(),this._view.append(this._contentView)},Object.defineProperty(a.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),a.prototype.remove=function(){this._view.remove(),this._onSlicerDeleted.trigger({sender:this})},a}();i.SlicerControl=a}(t.Slicer||(t.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function n(o,r){this._showOnlySelectedItems=!1,this._isVisibleProperties=!1,this._onLevelsChanged=new t.Events.LiteEvent;var a=this;n._directoryTemplate=e.PathManager.templatesPath;var s=n.getLayout();this._$panel=$(o),this._options=r;var l=function(e){a._$panel.empty(),a._$panel.removeClass("filterEditorWindow-isLoading"),!1===r.isVisibleSlicerButton&&a._layoutDescription.$addSlicerButton.hide(),a._selectionRootNodes=e,a.initControl()};s.done(function(e){a._layoutDescription=e,void 0!==a._options.selectionRootNodes?new i.DataService(a._options.connection).actualizeSelectionTree(a._options.cubeName,a._options.hierarchyUniqueName,a._options.selectionRootNodes).done(function(e){var t=i.MemberChoiceTreeNode.parse(JSON.stringify(e));l(t)}).fail(function(){a._$panel.empty()}):l(a._options.selectionRootNodes)})}return Object.defineProperty(n.prototype,"onLevelsChanged",{get:function(){return this._onLevelsChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isVisibleSearchPanel",{get:function(){return this._isVisibleSearchPanel},set:function(e){this._isVisibleSearchPanel=e,this._layoutDescription.$membersPanel.removeClass("memberChoice-membersPanel_visibleSearchPanel"),this._layoutDescription.$membersPanel.removeClass("memberChoice-membersPanel_collapsedSearchPanel"),this._layoutDescription.$btnShowHideSearchPanel.removeClass("active"),!1===this._isVisibleSearchPanel?(this._layoutDescription.$btnShowOnlySelectedItems.removeClass("disabled"),this._layoutDescription.$searchPanel.hide(),this._layoutDescription.$membersPanel.addClass("memberChoice-membersPanel_collapsedSearchPanel")):(this._layoutDescription.$btnShowOnlySelectedItems.addClass("disabled"),this._layoutDescription.$searchPanel.show(),this._layoutDescription.$membersPanel.addClass("memberChoice-membersPanel_visibleSearchPanel"),this._layoutDescription.$btnShowHideSearchPanel.addClass("active"))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showOnlySelectedItems",{get:function(){return this._showOnlySelectedItems},set:function(e){e?this._layoutDescription.$btnShowOnlySelectedItems.addClass("active"):this._layoutDescription.$btnShowOnlySelectedItems.removeClass("active"),this._memberChoiceTreeView.showItemTextStatus=e,this._showOnlySelectedItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectionRootNodes",{get:function(){return this._selectionRootNodes},enumerable:!0,configurable:!0}),n.getLevelChoiceControl=function(e,i,n,o){var r=new t.DropDownControl;return r.displayPropertyExpr="caption",r.selectedExpr="isSelected",r.selectionChanged.on(function(e){o(e)}),e.done(function(e){for(var t=e.levels,n=void 0,o=0;o<t.length;o++)if(t[o].uniqueName===i){t[o].isSelected=!0,n=t[o];break}n||(t[0].isSelected=!0,n=t[0]),r.itemSource=t}),r},n.getMemberChoiceTreeView=function(e,n,o,r,a,s,l){var c=new i.TreeViewMemberChoiceOptions;return c.displayExpr="caption",c.hasChildrenExpr="hasChildren",c.virtualModeEnabled=!0,c.countLoadedItems=15,c.childCountExpr="childCount",c.connectionProvider.getPromiseLoadChildren=function(e){var t=e.uniqueName,i=r.getQueryLoadChildren(t,0);return a.getMembers(i).promise()},c.connectionProvider.getPromiseLoadNeighbors=function(e,t){var i="";if("level"===e.type)i=r.getQueryMembers(e.uniqueName,t);else{if("memberData"!==e.type)throw new Error("NotImplementedException");i=r.getQueryLoadChildren(e.uniqueName,t)}return a.getMembers(i)},c.connectionProvider.getPromiseLoadNeighborsSearchMode=function(e,t){var i=r.getQuerySearchMembers(e.text,t,e.property,e.searchType);return a.getMembers(i).done(function(e){for(var t=0;t<e.length;t++)e[t].hasChildren=!1}).promise()},c.onTreeStateChanged=function(e){o(e)},c.selectionRootNodes=n,c.draggableOptions=new t.TreeViewDraggableOptions,c.draggableOptions.$dragContainer=s,c.textStatusVisible=!1,c.onItemSelected=l,new i.MemberChoiceTreeView(e,c)},n.prototype.initControl=function(){var e=this,t=this;this.isVisibleSearchPanel=!1,this._properties=[];var o=this._dataService=new i.DataService(this._options.connection),r=this._queryManager=new i.QueryManager(this._options.cubeName,this._options.hierarchyUniqueName,this._options.step);this._$panel.append(this._layoutDescription.$rootLayout);var a=this._memberChoiceTreeView=n.getMemberChoiceTreeView(this._layoutDescription.$treeView[0],this._selectionRootNodes,function(i){void 0!==e._options.events.onChangedSelection&&e._options.events.onChangedSelection(i),t._selectionRootNodes=i,t.updateShowSelectedBtn()},r,o,this._options.container,function(t){e._selectedTreeItem=t.data,e.updatePropertyList()}),s=function(e){t.showOnlySelectedItems=!1;var i=r.getQueryMembers(e.uniqueName);o.getMembers(i).done(function(t){a.initTreeView(t,e)}),t.updateShowSelectedBtn()},l=o.getLevels(this._options.cubeName,this._options.hierarchyUniqueName);l.done(function(t){var i=t.levels;r.properties=e._properties=t.properties,e._onLevelsChanged.trigger(i)});var c=this._levelChoiceControl=n.getLevelChoiceControl(l,this._options.startLevelUniqueName,o,s);this._layoutDescription.$toolBar.append(c.view);var u=!1,p=new i.SearchMembersControl(this._layoutDescription.$searchPanel,function(e){p.isLoadingMembersNow=!0,u=!0;var t=r.getQuerySearchMembers(e.text,0,e.property,e.searchType);o.getMembers(t).done(function(t){for(var i=0;i<t.length;i++)t[i].hasChildren=!1;a.initTreeView(t,e)}).always(function(){p.isLoadingMembersNow=!1})},function(){u&&(s(c.selectedItem),u=!1)});p.init(),this._layoutDescription.$btnShowHideSearchPanel.click(function(){t.showOnlySelectedItems&&(t.showOnlySelectedItems=!1,t.syncStateOfTree()),t.isVisibleSearchPanel=!t.isVisibleSearchPanel,u&&!1===t.isVisibleSearchPanel&&(u=!1,s(c.selectedItem))}),this._layoutDescription.$buttonRefreshData.click(function(){t.showOnlySelectedItems=!1;var i=r.getQueryMembers(c.selectedItem.uniqueName);o.getMembers(i).done(function(e){a.dataSource=e}),e.updateShowSelectedBtn()}),this._layoutDescription.$buttonClearSelection.click(function(){a.clearSelectionDataTree()}),this._layoutDescription.$btnShowOnlySelectedItems.click(function(){t.showOnlySelectedItems=!t.showOnlySelectedItems,t.syncStateOfTree()}),this._layoutDescription.$btnToggleProperties.click(function(){t.toggleProperties()}),this._layoutDescription.$addSlicerButton.on("click",function(){e.selectionRootNodes;e._options.events.onCreateSlicer&&e._options.events.onCreateSlicer({caption:e._levelChoiceControl.selectedItem.caption,uniqueName:e._levelChoiceControl.selectedItem.uniqueName,hierarchyUniqueName:e._options.hierarchyUniqueName,selectionTree:e.selectionRootNodes})})},n.prototype.syncStateOfTree=function(){var e=this;if(this.showOnlySelectedItems){var t=n.getSelectedUniqueNames(this.selectionRootNodes),i=this._queryManager.getAllSelectedItemsQuery(t);this._dataService.getMembers(i).done(function(t){for(var i=0;i<t.length;i++)t[i].hasChildren=!1;e._memberChoiceTreeView.initTreeView(t,null)})}else{i=this._queryManager.getQueryMembers(this._levelChoiceControl.selectedItem.uniqueName);this._dataService.getMembers(i).done(function(t){e._memberChoiceTreeView.dataSource=t})}this.updateShowSelectedBtn()},n.getSelectedUniqueNames=function(e){var t=new Array;if(void 0===e)return t;for(var i=0;i<e.length;i++){var n=e[i];if((n.selectedChildren||n.selectedDescendants||n.selectedSelf)&&t.push(n.uniqueName),n.childNodes.length>0){var o=this.getSelectedUniqueNames(n.childNodes);o.length>0&&(t=t.concat(o))}}return t},n.prototype.toggleProperties=function(){this._isVisibleProperties=!this._isVisibleProperties,this._layoutDescription.$btnToggleProperties.toggleClass("active"),this._layoutDescription.$propertiesPanel.toggleClass("memberChoise-propertiesPanel_collapsed"),this._layoutDescription.$propertiesPanel.toggleClass("memberChoise-propertiesPanel_displayed"),this._layoutDescription.$treeView.toggleClass("membersChoice-membersPanel-treeView_collapsedPropertiesPanel"),this._layoutDescription.$treeView.toggleClass("membersChoice-membersPanel-treeView_displayedPropertiesPanel"),this.updatePropertyList()},n.prototype.updatePropertyList=function(){var t=this;this._layoutDescription.$propertyPanelAlert.text(e.Localization.localize("MemberChoise_NoProperties")).hide(),this._layoutDescription.$propertyPanelTable.empty().hide();var i,n=this._layoutDescription.$membersPanel.width();if(this._isVisibleProperties?(this._layoutDescription.$treeView.width(n-6-this._layoutDescription.$propertiesPanel.width()),i={handles:"e",minWidth:170,maxWidth:n-150,resize:function(){t._layoutDescription.$propertiesPanel.width(n-6-t._layoutDescription.$treeView.width())},disabled:!1}):(i={handles:"e",disabled:!0},this._layoutDescription.$treeView.width(n)),this._layoutDescription.$treeView.resizable(i),this._selectedTreeItem){var o=this._selectedTreeItem.memberProperties;if(this._layoutDescription.$propertyPanelTitle.text(this._selectedTreeItem.caption).show(),console.log(o),o)for(var r=0;r<o.length;r++){var a=$("<tr/>"),s=$("<td/>").text(o[r].name),l=$("<td/>").text(o[r].value);a.append(s).append(l),this._layoutDescription.$propertyPanelTable.append(a).show()}else this._layoutDescription.$propertyPanelAlert.text(e.Localization.localize("MemberChoise_NoProperties")).show()}else this._layoutDescription.$propertyPanelTitle.hide()},n.prototype.getSelectedUniqueNames=function(e){var t=new Array;if(void 0===e)return t;for(var i=0;i<e.length;i++){var n=e[i];if((n.selectedChildren||n.selectedDescendants||n.selectedSelf)&&t.push(n.uniqueName),n.childNodes.length>0){var o=this.getSelectedUniqueNames(n.childNodes);o.length>0&&(t=t.concat(o))}}return t},n.prototype.updateShowSelectedBtn=function(){0===this.getSelectedUniqueNames(this.selectionRootNodes).length?this._layoutDescription.$btnShowOnlySelectedItems.addClass("disabled"):this._layoutDescription.$btnShowOnlySelectedItems.removeClass("disabled")},n.getLayout=function(){var t=$.Deferred();return $.ajax({url:n._directoryTemplate+"memberChoice-view.html"}).done(function(i){var n=$(e.Localization.localizeTemplate(i)),o=n.find(".memberChoice-toolBar"),r=n.find(".membersChoice-membersPanel-treeView"),a=n.find(".memberChoice-searchPanel"),s=n.find(".memberChoice-membersPanel"),l=n.find(".memberChoice-statusSearchPanel"),c=n.find(".membersChoice-refreshButton"),u=n.find(".membersChoice-clearSelectionButton"),p=n.find(".membersChoice-showHideSearchPanelButton"),h=n.find(".membersChoice-showOnlySelectedItems"),d=n.find(".membersChoice-showPropertiesButton"),m=n.find(".memberChoise-propertiesPanel"),f=n.find(".memberChoise-propertiesPanel-table"),g=n.find(".memberChoise-propertiesPanel-alert"),_=n.find(".memberChoise-propertiesPanel-title"),y=n.find(".membersChoice-addSlicerButton");t.resolve({$rootLayout:n,$toolBar:o,$searchPanel:a,$treeView:r,$statusSearchPanel:l,$membersPanel:s,$buttonRefreshData:c,$buttonClearSelection:u,$btnShowHideSearchPanel:p,$btnShowOnlySelectedItems:h,$btnToggleProperties:d,$propertiesPanel:m,$propertyPanelTable:f,$propertyPanelAlert:g,$propertyPanelTitle:_,$addSlicerButton:y})}).fail(function(i){e.LogService.error(i),t.reject(i)}),t},n}();i.MemberChoiceControl=n}(t.MemberChoice||(t.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetMemberChoice=function(t,i){var n,o=this,r={},a=this;a.settings={},a.init=function(){o.settings=e.extend({},r,i),n=new Ranet.Controls.MemberChoice.MemberChoiceControl(t,i)},a.option=function(e){},a.init()},e.fn.ranetMemberChoice=function(t){return this.each(function(){var i=new e.ranetMemberChoice(this,t);e(this).data("ranetMemberChoice",i)})}}(jQuery);var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(t,i,n){this._dataItem=t,this._selectionTree=n,this._itemMemberChoiceTreeNode=i;var o=new Array;if(!1===e.getArrayParents(this._selectionTree,this._itemMemberChoiceTreeNode,o))throw new Error("invalidOperationException.StateMemberChoiceTreeViewItem");this._parents=o.reverse()}return Object.defineProperty(e.prototype,"selectedSelf",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.selectedSelf");return this._itemMemberChoiceTreeNode.selectedSelf},set:function(e){this._itemMemberChoiceTreeNode.selectedSelf=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inheritedSelectedSelf",{get:function(){if(0===this._parents.length)return!1;var e=this._parents[this._parents.length-1];return!!e.selectedChildren||!1!==e.selectedChildren&&this.hasParentWithSelectedDescendants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inheritedSelectedDescendants",{get:function(){return 0!==this._parents.length&&this.hasParentWithSelectedDescendants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasParentWithSelectedDescendants",{get:function(){for(var e=!1,t=0;t<this._parents.length;t++)this._parents[t].selectedDescendants?e=!0:void 0!==this._parents[t].selectedDescendants&&(e=!1);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedChildren",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.selectedChildren");return this._itemMemberChoiceTreeNode.selectedChildren},set:function(e){this._itemMemberChoiceTreeNode.selectedChildren=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedDescendants",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.selectedDescendants");return this._itemMemberChoiceTreeNode.selectedDescendants},set:function(e){this._itemMemberChoiceTreeNode.selectedDescendants=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSelectedDescedant",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.hasSelectedChildren");return this.getValuePropHasSelectedChildren(this._itemMemberChoiceTreeNode.childNodes)},enumerable:!0,configurable:!0}),e.prototype.getValuePropHasSelectedChildren=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.selectedChildren||i.selectedDescendants||i.selectedSelf)return!0;if(i.childNodes.length>0&&this.getValuePropHasSelectedChildren(i.childNodes))return!0}return!1},e.getArrayParents=function(t,i,n){if(t===i)return!0;for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes[o];if(r===i)return n.push(t),!0;if(r.childNodes.length>0&&e.getArrayParents(r,i,n))return n.push(t),!0}return!1},e.prototype.updatePropertySelectedDescendantsForParent=function(){var e=this._dataItem.parents[this._dataItem.parents.length-1].childCount,t=this._parents[this._parents.length-1];if(t.childNodes.length===e&&t.selectedDescendants){var i,n=0;for(i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];!1!==o.selectedDescendants||o.selectedSelf||n++}if(n===e)for(t.selectedDescendants=void 0,i=0;i<t.childNodes.length;i++)t.childNodes[i].selectedDescendants=void 0}},e.prototype.updatePropertySelectedChildrenForParent=function(){var e=this._dataItem.parents[this._dataItem.parents.length-1].childCount,t=this._parents[this._parents.length-1];if(t.childNodes.length===e&&t.selectedChildren){var i,n=0;for(i=0;i<t.childNodes.length;i++)!1===t.childNodes[i].selectedSelf&&n++;if(n===e)for(t.selectedChildren=void 0,i=0;i<t.childNodes.length;i++)t.childNodes[i].selectedSelf=void 0}},e.prototype.childrenClearSelectionSelectedSelf=function(){for(var e=this._itemMemberChoiceTreeNode.childNodes,t=0;t<e.length;t++)e[t].selectedSelf=void 0},e.prototype.descendantsClearSelection=function(){e.descendantsClearSelection(this._itemMemberChoiceTreeNode.childNodes)},e.descendantsClearSelection=function(t){for(var i=0;i<t.length;i++){var n=t[i];n.selectedSelf=void 0,n.selectedChildren=void 0,n.selectedDescendants=void 0,n.childNodes.length>0&&e.descendantsClearSelection(n.childNodes)}},e}();e.StateMemberChoiceTreeViewItem=t}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(e,t,i,n){this._cubeName=e,this._step=i,this.hierarchyUniqueName=t,this._propeties=n||[]}return Object.defineProperty(t.prototype,"properties",{get:function(){return this._propeties},set:function(e){this._propeties=e},enumerable:!0,configurable:!0}),t.prototype.getQueryMembers=function(e,t){return void 0===t&&(t=0),"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\' \n'+this.generatePropertiesWith()+"\nSELECT \nHierarchize(Subset(AddCalculatedMembers({"+e+".Members}), "+t+", "+this._step+")) \nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName+"\n"},t.prototype.getQueryLoadChildren=function(e,t){return"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\'\n'+this.generatePropertiesWith()+"\nSELECT \nHierarchize(Subset(AddCalculatedMembers({"+e+".Children}), "+t+", "+this._step+")) \nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"}on 1 \nFROM "+this._cubeName+"\n"},t.prototype.getQuerySearchMembers=function(t,i,n,o){var r;switch(o){case e.SearchOlapSearchType.Contain:r="(InStr("+this.hierarchyUniqueName+'.Properties("'+n+"\"),'"+t+"') <> 0))})";break;case e.SearchOlapSearchType.BeginWith:r="(InStr("+this.hierarchyUniqueName+'.Properties("'+n+"\"),'"+t+"') = 1))})";break;case e.SearchOlapSearchType.Equal:r="("+this.hierarchyUniqueName+'.Properties("'+n+"\") = '"+t+"'))})";break;default:throw new Error("InvalidOperationException")}return"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\'\n'+this.generatePropertiesWith()+" \nSELECT \nHierarchize(Subset(AddCalculatedMembers({FILTER("+this.hierarchyUniqueName+".ALLMEMBERS, "+r+", "+i+", "+this._step+")) \nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName},t.prototype.getQueryMemberWithParents=function(e){return"WITH\nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\' \n'+this.generatePropertiesWith()+"\nSELECT {"+e.join(", ")+"} Dimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName},t.prototype.getAllSelectedItemsQuery=function(e){return"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\' \n'+this.generatePropertiesWith()+"\nSELECT \n{"+e.join(", ")+"}\nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName+"\n"},t.prototype.generatePropertiesWith=function(){var e=this._propeties;if(0===e.length)return"";for(var t="",i=0;i<e.length;i++)i!==e.length-1?t+="MEMBER [Measures].["+e[i].Name+"] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("'+e[i].Name+"\")'\n":t+="MEMBER [Measures].["+e[i].Name+"] AS "+this.hierarchyUniqueName+'.CurrentMember.Properties("'+e[i].Name+'")';return t},t.prototype.generatePropertiesOn1=function(){var e=this._propeties;if(0===e.length)return"";for(var t=",",i=0;i<e.length;i++)i!==e.length-1?t+="[Measures].["+e[i].Name+"],":t+="[Measures].["+e[i].Name+"]";return t},t.prototype.generatePropertiesOn0=function(){var e=this._propeties;if(0===e.length)return"";for(var t=", ",i=0;i<e.length;i++)i!==e.length-1?t+=this.hierarchyUniqueName+".["+e[i].Name+"], ":t+=this.hierarchyUniqueName+".["+e[i].Name+"]";return t},t}();e.QueryManager=t}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function i(e,t,i,n){if(this._parents=new Array,this._children=new Array,this._options=t,this._onClick=i,!e)throw new Error("InvalidOperationException");this.dataItem=e,this._factoryVisualElements=n}return Object.defineProperty(i.prototype,"$treeViewItem",{get:function(){return this._$treeViewItem},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataItem",{get:function(){return this._dataItem},set:function(e){this._dataItem=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._children},set:function(e){this._children=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parents",{get:function(){return this._parents},set:function(e){this._parents=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isSelected",{get:function(){return this._isSelected},set:function(e){this._isSelected=e,this._isSelected?this.$header.addClass("treeView_treeViewItem_header_state_selected"):this.$header.removeClass("treeView_treeViewItem_header_state_selected")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLoadingChildrenNow",{get:function(){return this._isLoadingChildrenNow},set:function(e){this._isLoadingChildrenNow=e,this._isLoadingChildrenNow&&this.loadChildrenNow()},enumerable:!0,configurable:!0}),i.prototype.getLoadMoreTreeViewItem=function(){var e=this;return this._factoryVisualElements.getLoadMoreItemsTreeViewItem(this.dataItem,this.dataItem.items.length,this._options.connectionProvider.getPromiseLoadNeighbors,function(t,i){e.loadMoreChildren(t,i)})},i.prototype.onSuccessLoadedChildren=function(e){this.dataItem.items=e;var t=this.createTreeViewItems(e);if(this.children=t,this._options.countLoadedItems&&this._options.countLoadedItems<=e.length){var i=this.getLoadMoreTreeViewItem();t.push(i)}this._$panelAfterTreeViewItem=this.createChildrenPanel(t),this._$nodeStatus.addClass("fa-caret-down"),this._$nodeStatus.empty(),this._isLoadingChildrenNow=!1},i.prototype.onFailLoadedChildren=function(){this._$nodeStatus.addClass("fa-caret-right"),this._$nodeStatus.empty(),this._isOpenNow=!1,this._isLoadingChildrenNow=!1},i.prototype.loadChildrenNow=function(){var t=this;this._$nodeStatus.removeClass("fa-caret-down"),this._$nodeStatus.append('<i class="fa fa-spinner fa-spin"></i>'),this._options.connectionProvider.getPromiseLoadChildren(this.dataItem).done(function(e){t.onSuccessLoadedChildren(e)}).fail(function(i){e.LogService.error(i),t.onFailLoadedChildren()})},i.prototype.loadMoreChildren=function(e,t){var i=this.createTreeViewItems(t),n=this.children.indexOf(e);if(-1===n)throw new Error("InvalidOperationException.indexBtnLoadNextTreeViewItem");if(this.children.splice(n,1),this.dataItem.items=this.dataItem.items.concat(t),this._options.countLoadedItems&&this._options.countLoadedItems<=t.length){var o=this.getLoadMoreTreeViewItem();i.push(o)}this.children=this.children.concat(i),this.paintChildrenNodes(i,this._$childrenLayout)},i.prototype.onClickTreeViewItem=function(){this._onClick&&this._onClick(this)},i.prototype.changeIcon=function(){void 0!==this._options.iconExpr&&null!=this.dataItem[this._options.iconExpr]&&void 0!==this._options.iconExpandedExpr&&null!=this.dataItem[this._options.iconExpandedExpr]&&(this._isOpenNow?(this._$icon.removeClass(i.prefiximageLibrary+this.dataItem[this._options.iconExpr]),this._$icon.addClass(i.prefiximageLibrary+this.dataItem[this._options.iconExpandedExpr])):(this._$icon.addClass(i.prefiximageLibrary+this.dataItem[this._options.iconExpr]),this._$icon.removeClass(i.prefiximageLibrary+this.dataItem[this._options.iconExpandedExpr])))},i.prototype.changeState=function(){if(!this.isLoadingChildrenNow)if(this._isOpenNow=!this._isOpenNow,this.dataItem[this._options.expandedExpr]=this._isOpenNow,this.changeIcon(),this._isOpenNow?(this._$nodeStatus.removeClass("fa-caret-right"),this._$nodeStatus.addClass("fa-caret-down")):(this._$nodeStatus.removeClass("fa-caret-down"),this._$nodeStatus.addClass("fa-caret-right")),this._isOpenNow)if(void 0!==this.dataItem.items&&this.dataItem.items.length>0){if(void 0!==this._$panelAfterTreeViewItem)return void this._$panelAfterTreeViewItem.removeClass("treeView_treeViewItem_visibilty-colapsed");var e=this.createTreeViewItems(this.dataItem.items);this.children=e,this._$panelAfterTreeViewItem=this.createChildrenPanel(e)}else this._options.virtualModeEnabled&&(this.isLoadingChildrenNow=!0);else this._$panelAfterTreeViewItem.addClass("treeView_treeViewItem_visibilty-colapsed")},i.prototype.createChildrenPanel=function(e){var t=$("<tr/>"),i=$("<td/>");t.append(i);var n=$('<td colspan="3"/>');t.append(n);var o=$("<table/>");n.append(o),o.addClass("treeView_treeViewItem_contentTable");var r=$("<tbody/>");return o.append(r),this._$childrenLayout=r,this.paintChildrenNodes(e,this._$childrenLayout),this._$treeViewItem.after(t),t},i.prototype.paintChildrenNodes=function(e,t){for(var i in e)e.hasOwnProperty(i)&&e[i].render(t)},i.prototype.createTreeViewItems=function(e){for(var t=this._factoryVisualElements.getNewTreeViewItems(e),n=0;n<t.length;n++){var o=t[n],r=i.copyArrayTreeViewItems(this.parents);r.push(this),o.parents=r}return t},i.prototype.initNodeStatusVisualElement=function(){this._isOpenNow=!1,void 0!==this._options.expandedExpr&&void 0!==this.dataItem[this._options.expandedExpr]&&(this._isOpenNow=this.dataItem[this._options.expandedExpr])},i.prototype.getNodeStatusVisualElement=function(){var e=this;this.initNodeStatusVisualElement();var t=$("<td/>");t.addClass("treeView_treeViewItem_nodeStatus");var i=$("<div/>");return i.addClass("treeView_treeViewItem_fixContent-nodeStatus"),(void 0!==this.dataItem.items&&this.dataItem.items.length>0||this._options.virtualModeEnabled&&void 0!==this._options.hasChildrenExpr&&!0===this.dataItem[this._options.hasChildrenExpr])&&(this._isOpenNow?i.addClass("fa fa-caret-down"):i.addClass("fa fa-caret-right"),t.mousedown(function(){e.changeState()}),this._$nodeStatus=i),t.append(i),t},i.prototype.getNodeIconVisualElement=function(){var e=$("<td/>");e.addClass("treeView_treeViewItem_imageArea");var t=$("<div/>");return t.addClass("treeView_treeViewItem_fixContent-icon"),this._isOpenNow&&null!=this.dataItem[this._options.iconExpandedExpr]?t.addClass(i.prefiximageLibrary+this.dataItem[this._options.iconExpandedExpr]):null!=this.dataItem[this._options.iconExpr]&&t.addClass(i.prefiximageLibrary+this.dataItem[this._options.iconExpr]),e.append(t),this._$icon=t,e},i.prototype.render=function(e){var i=this,n=$("<tr />"),o=this.getNodeStatusVisualElement();n.append(o);var r=function(){i.onClickTreeViewItem()};if(void 0!==this._options.iconExpr){var a=this.getNodeIconVisualElement();n.append(a),a.click(function(){r()})}var s=$("<td/>");s.addClass("treeView_treeViewItem_header treeView_treeViewItem_header_state-nowrap"),this._options.hoverStateEnabled&&s.addClass("treeView-treeViewItem_hoverState"),s.click(function(){r()});var l=$("<span/>");if(l.append(this.dataItem[this._options.displayExpr]),s.append(l),n.append(s),e.append(n),this._$treeViewItem=n,this.$header=s,this._isOpenNow&&void 0!==this.dataItem.items&&this.dataItem.items.length>0){var c=this.createTreeViewItems(this.dataItem.items);this._children=c,this._$panelAfterTreeViewItem=this.createChildrenPanel(c)}void 0!==this._options.draggableOptions.draggableNodeExp&&void 0!==this.dataItem[this._options.draggableOptions.draggableNodeExp]&&this.initDraggableTreeViewItem(n,this.dataItem,this._options.iconExpr,this._options.displayExpr,this._options.draggableOptions),this._options.onRenderedTreeViewItem&&this._options.onRenderedTreeViewItem(this,new t.TreeViewItemArgs(this._$treeViewItem)),this.afterRender(n),this._options.selectedExpr&&this.dataItem[this._options.selectedExpr]&&r()},i.prototype.afterRender=function(e){},i.prototype.initDraggableTreeViewItem=function(e,n,o,r,a){var s=a.$dragContainer,l="default";a&&(a.appendTo&&(s=a.appendTo),a.scope&&(l=a.scope));var c=this,u={helper:function(){var e=$("<div/>");e.addClass("treeView_treeViewItem_dragAndDrop_draggableContent");var t=$("<div/>");t.addClass("treeView_treeViewItem_dragAndDrop_draggableContent_image"),null!=o&&null!=n[o]&&t.addClass(i.prefiximageLibrary+n[o]),e.append(t);var a=$("<span/>");return a.addClass("treeView_treeViewItem_dragAndDrop_draggableContent_text"),a.append(n[r]),e.append(a),e},start:function(){a.onStartDraggable&&a.onStartDraggable(c,new t.TreeViewItemArgs(c.$treeViewItem))},delay:150,scroll:!1,containment:"parent",appendTo:s,scope:l};$(e).draggable(u)},i.copyArrayTreeViewItems=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i];t.push(n)}return t},i.prefiximageLibrary="imageLibrary_",i}();t.TreeViewItem=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function t(t,i){void 0===i.draggableOptions&&(i.draggableOptions=new e.TreeViewDraggableOptions),this._treeViewOptions=i;var n=$("<div/>"),o=$("<div/>");n.append(o),n.addClass("treeView"),o.addClass("treeView_rootPanel"),this.$rootLayout=o,this.dataSource=i.dataSource,$(t).append(n)}return Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e,this.repaint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factoryVisualElements",{get:function(){return this},enumerable:!0,configurable:!0}),t.prototype.onClickTreeViewItem=function(e){void 0!==this._selectedTreeViewItem&&(this._selectedTreeViewItem.isSelected=!1),e.isSelected=!0,this._selectedTreeViewItem=e,void 0!==this._treeViewOptions.onItemSelected&&this._treeViewOptions.onItemSelected({data:e.dataItem})},t.prototype.repaint=function(){this.$rootLayout.empty();var e=this.items=this.factoryVisualElements.getNewTreeViewItems(this.dataSource);this.renderTree(e)},t.prototype.renderTree=function(e){var t=$("<table/>");t.addClass("treeView_treeViewItem_contentTable"),this.$rootLayout.append(t);var i=$("<tbody/>");t.append(i),this._$childrenLayout=i,this.paintChildrenNodes(e)},t.prototype.paintChildrenNodes=function(e){for(var t in e)e.hasOwnProperty(t)&&e[t].render(this._$childrenLayout)},t.prototype.getNewTreeViewItems=function(e){var t=this;return this.createTreeViewItems(e,this,function(e){t.onClickTreeViewItem(e)})},t.prototype.createTreeViewItems=function(e,t,i){var n=new Array,o=this;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r],s=this.getNewTreeViewItem(a,o._treeViewOptions,i,t);n.push(s)}return n},t.prototype.getNewTreeViewItem=function(t,i,n,o){return new e.TreeViewItem(t,i,n,o)},t.prototype.getLoadMoreItemsTreeViewItem=function(t,i,n,o){return new e.LoadNextTreeViewItem(t,i,n,o)},t}();e.TreeView=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(t){function i(e,i,n,o,r,a,s){if(t.call(this,e,n,o,i),this._optionsChoices=n,this._onMemberChoiceTreeViewItemStateChanged=a,this._view=r,this.stateTreeNode=s,this._selectedSelf=this.stateTreeNode.selectedSelf,this._selectedChildren=this.stateTreeNode.selectedChildren,this._selectedDescendants=this.stateTreeNode.selectedDescendants,!n.draggableOptions.$dragContainer.attr("class"))throw Error("Error creating popover. Unique class must be specified for root panel");this._containerClass=n.draggableOptions.$dragContainer.attr("class")}return __extends(i,t),Object.defineProperty(i.prototype,"stateTreeNode",{get:function(){return this._stateTreeNode},set:function(e){this._stateTreeNode=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedSelf",{get:function(){return this._selectedSelf},set:function(e){this._selectedSelf=e,this.updateSelectionStatus(),this.updateTextSelectionStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedChildren",{get:function(){return this._selectedChildren},set:function(e){0!==this.dataItem[this._optionsChoices.childCountExpr]&&(this._selectedChildren=e,this.updateSelectionStatus(),this.updateTextSelectionStatus())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedDescendants",{get:function(){return this._selectedDescendants},set:function(e){0!==this.dataItem[this._optionsChoices.childCountExpr]&&(this._selectedDescendants=e,this.updateSelectionStatus(),this.updateTextSelectionStatus())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasSelectedDescedant",{get:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];if(t.selectedSelf||t.hasSelectedDescedant)return!0}return!(!this.selectedChildren&&!this.selectedDescendants)||!!this.stateTreeNode.hasSelectedDescedant},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataChildCount",{get:function(){return this.dataItem[this._optionsChoices.childCountExpr]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"countMemberChoiceItemsInChildren",{get:function(){return this.children.filter(function(e){return e instanceof i}).length},enumerable:!0,configurable:!0}),i.prototype.onMemberChoiceTreeViewItemStateChanged=function(){this._onMemberChoiceTreeViewItemStateChanged&&this._onMemberChoiceTreeViewItemStateChanged()},i.prototype.updateSelectionStatus=function(){this._$panelSelectionStatus.removeClass("imageLibrary_treeNode_selectedTreeNode"),this._$panelSelectionStatus.removeClass("imageLibrary_treeNode_hasSelectedChildren"),this._$panelSelectionStatus.removeClass("imageLibrary_treeNode_selfSelectedAndChildSelected"),!this.hasSelectedDescedant||!1!==this.selectedSelf&&void 0!==this.selectedSelf?this.hasSelectedDescedant&&this.selectedSelf?this._$panelSelectionStatus.addClass("imageLibrary_treeNode_selfSelectedAndChildSelected"):this.selectedSelf&&this._$panelSelectionStatus.addClass("imageLibrary_treeNode_selectedTreeNode"):this._$panelSelectionStatus.addClass("imageLibrary_treeNode_hasSelectedChildren")},i.prototype.updateTextSelectionStatus=function(){if(this._optionsChoices.textStatusVisible){var e=this.getTextSelectionStatus();if(""!==e)return void this._$panelTextSelectionStatus.text("("+e+")")}this._$panelTextSelectionStatus.text("")},i.prototype.afterRender=function(e){var t=this,i=$('<td class="memberChoice_td_status"/>');this._$panelSelectionStatus=$("<div/>"),this._$panelSelectionStatus.addClass("memberChoice_selectionState_panel imageLibrary_treeNode_notSelectedTreeNode"),i.append(this._$panelSelectionStatus),this._$panelTextSelectionStatus=$("<span/>"),this._$panelTextSelectionStatus.addClass("memberChoise_selectionStateText");var n=$("<td class='memberChoice_td_menuButton' />");n.append(' <span class="glyphicon glyphicon-flash memberChoice_td_menuButton_image" aria-hidden="true"></span>'),this.initPopover(n),this._$panelSelectionStatus.click(function(){t.setNewValueSelectedSelf(!t.selectedSelf)}),e.find(".treeView_treeViewItem_nodeStatus").after(i),e.find(".treeView_treeViewItem_header").before(n),e.find(".treeView_treeViewItem_header").append(this._$panelTextSelectionStatus),this.initStartState()},i.prototype.initStartState=function(){this.initStartStateSelectedSelf(),this.initStartStateSetectedChildren(),this.initStartStateSelectedDescendants(),this.updateSelectionStatus(),this.updateTextSelectionStatus()},i.prototype.initStartStateSelectedSelf=function(){void 0===this.stateTreeNode.selectedSelf?this.selectedSelf=this.stateTreeNode.inheritedSelectedSelf:this.selectedSelf=this.stateTreeNode.selectedSelf},i.prototype.initStartStateSetectedChildren=function(){void 0===this.stateTreeNode.selectedChildren?this.selectedChildren=this.stateTreeNode.inheritedSelectedDescendants:this.selectedChildren=this.stateTreeNode.selectedChildren},i.prototype.initStartStateSelectedDescendants=function(){void 0===this.stateTreeNode.selectedDescendants?this.selectedDescendants=this.stateTreeNode.inheritedSelectedDescendants:this.selectedDescendants=this.stateTreeNode.selectedDescendants},i.prototype.initPopover=function(t){var i=this,n=this,o=$("<div/>"),r=$('<button type="button" class="btn btn-default btn-sm memberChoice-treeView-actionButton">'+e.Localization.localize("MemberChoice_ContextMenu_SelectSelf")+"</button>"),a=$('<button type="button" class="btn btn-default btn-sm memberChoice-treeView-actionButton">'+e.Localization.localize("MemberChoice_ContextMenu_SelectChildren")+"</button>"),s=$('<button type="button" class="btn btn-default btn-sm memberChoice-treeView-actionButton">'+e.Localization.localize("MemberChoice_ContextMenu_SelectDescendants")+"</button>");o.append(r),0!==this.dataItem.childCount&&(o.append(a),o.append(s));var l={content:o,placement:"bottom",container:"."+this._containerClass,html:!0,trigger:"manual"},c=t.popover(l),u=function(){c.popover("hide"),n.setNewValueSelectedSelf(!n.selectedSelf)},p=function(){c.popover("hide"),n.setNewValueSelectedChildren(!n.selectedChildren)},h=function(){c.popover("hide"),n.setNewValueSelectedDescendants(!n.selectedDescendants)},d=function(e){$(e.target).closest(".popover").length||$(".popover").each(function(){c.popover("hide")})};c.on("show.bs.popover",function(){r.one("click",u),0!==i.dataItem.childCount&&(a.one("click",p),s.one("click",h)),$("html").on("mousedown",d),n.selectedSelf?r.addClass("active"):r.removeClass("active"),n.selectedChildren?a.addClass("active"):a.removeClass("active"),n.selectedDescendants?s.addClass("active"):s.removeClass("active")}),c.on("hidden.bs.popover",function(){r.off("click",u),a.off("click",p),s.off("click",h),$("html").off("mousedown",d)}),$(this._view.$rootLayout).scroll(function(){c.popover("hide")}),t.click(function(){c.popover("show")})},i.prototype.setNewValueSelectedSelf=function(e){i.updateDataStatusTreeAfterUserActionSelectedSelf(e,this),i.updateVisualStatusTreeAfterUserActionSelectedSelf(e,this),this.updateStatusMemberChoiceTreeViewItems(),this.onMemberChoiceTreeViewItemStateChanged()},i.prototype.setNewValueSelectedChildren=function(e){i.updateDataStatusTreeAfterUserActionSelectedChildren(e,this),i.updateVisualStatusTreeAfterUserActionSelectedChildren(e,this),this.updateStatusMemberChoiceTreeViewItems(),this.onMemberChoiceTreeViewItemStateChanged()},i.prototype.setNewValueSelectedDescendants=function(e){i.updateDataStatusTreeAfterUserActionSelectedDescendants(e,this),i.updateVisualStatusTreeAfterUserActionSelectedDescendants(e,this),this.updateStatusMemberChoiceTreeViewItems(),this.onMemberChoiceTreeViewItemStateChanged()},i.updateDataStatusTreeAfterUserActionSelectedSelf=function(e,t){t.stateTreeNode.inheritedSelectedSelf?e?t.stateTreeNode.selectedSelf=void 0:(t.stateTreeNode.selectedSelf=!1,t.stateTreeNode.updatePropertySelectedChildrenForParent()):t.stateTreeNode.selectedSelf=!!e||void 0},i.updateDataStatusTreeAfterUserActionSelectedDescendants=function(e,t){t.stateTreeNode.inheritedSelectedDescendants?t.stateTreeNode.selectedDescendants=!!e&&void 0:t.stateTreeNode.selectedDescendants=!!e||void 0},i.updateDataStatusTreeAfterUserActionSelectedChildren=function(e,t){t.stateTreeNode.inheritedSelectedDescendants?t.stateTreeNode.selectedDescendants?t.stateTreeNode.selectedChildren=!!e&&void 0:t.stateTreeNode.selectedChildren=e:!1===e?t.stateTreeNode.selectedDescendants?t.stateTreeNode.selectedChildren=!1:t.stateTreeNode.selectedChildren=void 0:t.stateTreeNode.selectedChildren=!0,t.stateTreeNode.childrenClearSelectionSelectedSelf()},i.updateVisualStatusTreeAfterUserActionSelectedDescendants=function(e,t){t.selectedDescendants=e,t.selectedChildren=e,i.recursiveUpdateStatusChildrenAfterUserActionSelectedDescendants(t)},i.recursiveUpdateStatusChildrenAfterUserActionSelectedDescendants=function(e){var t;for(t=0;t<e.children.length;t++)if(e.children[t]instanceof i!=!1){var n=e.children[t];n.selectedSelf=e.selectedChildren||e.selectedDescendants,n.selectedDescendants=e.selectedDescendants,n.selectedChildren=e.selectedDescendants,n.children.length>0&&i.recursiveUpdateStatusChildrenAfterUserActionSelectedDescendants(n)}},i.updateVisualStatusTreeAfterUserActionSelectedChildren=function(e,t){t.selectedChildren=e;var n;for(n=0;n<t.children.length;n++)t.children[n]instanceof i!=!1&&(t.children[n].selectedSelf=t.selectedChildren)},i.updateVisualStatusTreeAfterUserActionSelectedSelf=function(e,t){t.selectedSelf=e;var n,o=t.parents[t.parents.length-1];if(o){var r=0;for(n=0;n<o.children.length;n++)o.children[n].selectedSelf&&r++;r!==o.dataItem[t._optionsChoices.childCountExpr]||!1!==o.selectedChildren&&void 0!==o.selectedChildren||(o.selectedChildren=!0),0===r&&o.selectedChildren&&o.dataItem[t._optionsChoices.childCountExpr]===o.children.filter(function(e){return e instanceof i}).length&&(o.selectedChildren=!1)}},i.prototype.updateStatusMemberChoiceTreeViewItems=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof i!=!1){var o=n;o.updateSelectionStatus(),o.children.length>0&&this.updateStatusMemberChoiceTreeViewItems(o.children)}}else{var r=this._view.children;this.updateStatusMemberChoiceTreeViewItems(r)}},i.prototype.getTextSelectionStatus=function(){var t="";return!this.stateTreeNode.selectedSelf||this.stateTreeNode.selectedDescendants||this.stateTreeNode.selectedChildren?this.stateTreeNode.selectedSelf||this.stateTreeNode.selectedDescendants||!this.stateTreeNode.selectedChildren?this.stateTreeNode.selectedSelf&&!this.stateTreeNode.selectedDescendants&&this.stateTreeNode.selectedChildren?t=e.Localization.localize("MemberChoice_State_Selected_With_Children"):!this.stateTreeNode.selectedSelf&&this.stateTreeNode.selectedDescendants?t=e.Localization.localize("MemberChoice_State_Selected_By_Parent_With_Descendants"):this.stateTreeNode.selectedSelf&&this.stateTreeNode.selectedDescendants?t=e.Localization.localize("MemberChoice_State_Selected_With_Descendants"):!this.stateTreeNode.selectedSelf&&this.stateTreeNode.hasSelectedDescedant?t=e.Localization.localize("MemberChoice_State_Selected_Selected_By_Parent_With_Descendants_Has_Excluded"):this.stateTreeNode.selectedSelf&&this.stateTreeNode.hasSelectedDescedant?t=e.Localization.localize("MemberChoice_State_Selected_With_Descendants_Has_Exclude"):t:t=e.Localization.localize("MemberChoice_State_Selected_Selected_Children"):t=e.Localization.localize("MemberChoice_State_Selected_Self")},i.prototype.clearSelection=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof i!=!1){var o=n;o.selectedChildren=void 0,o.selectedDescendants=void 0,o.selectedSelf=void 0,o.children.length>0&&this.clearSelection(o.children)}}else{var r=this._view.children;this.clearSelection(r),this.updateStatusMemberChoiceTreeViewItems()}},i}(t.TreeViewItem);i.MemberChoiceTreeViewItem=n}(t.MemberChoice||(t.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(e){function i(i,n){e.call(this,i,n),this._onTreeStateChanged=n.onTreeStateChanged,this._options=n,n.selectionRootNodes?this._selectionManager=new t.SelectionManager(n.selectionRootNodes):this._selectionManager=new t.SelectionManager}return __extends(i,e),Object.defineProperty(i.prototype,"children",{get:function(){return this.items},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showItemTextStatus",{get:function(){return this._options.textStatusVisible},set:function(e){this._options.textStatusVisible=e},enumerable:!0,configurable:!0}),i.prototype.initTreeView=function(e,i){this.$rootLayout.empty();var n=this,o=this.items=this.getNewTreeViewItems(e);if(this._options.countLoadedItems&&this._options.countLoadedItems<=e.length&&i){var r=void 0;r=i instanceof t.SearchDescription?this._options.connectionProvider.getPromiseLoadNeighborsSearchMode:this._options.connectionProvider.getPromiseLoadNeighbors;var a=this.factoryVisualElements.getLoadMoreItemsTreeViewItem(i,e.length,r,function(e,t){n.onLoadedNewChildren(e,t,i)});o.push(a)}this.renderTree(o)},i.prototype.onLoadedNewChildren=function(e,i,n){var o=this,r=this.getNewTreeViewItems(i),a=this.items.indexOf(e);if(-1===a)throw new Error("InvalidOperationException.indexBtnLoadNextTreeViewItem");this.items.splice(a,1);var s=this.items.length+r.length;if(this._options.countLoadedItems&&this._options.countLoadedItems<=i.length){var l;l=n instanceof t.SearchDescription?this._options.connectionProvider.getPromiseLoadNeighborsSearchMode:this._options.connectionProvider.getPromiseLoadNeighbors;var c=this.factoryVisualElements.getLoadMoreItemsTreeViewItem(n,s,l,function(e,t){o.onLoadedNewChildren(e,t,n)});r.push(c)}this.items=this.items.concat(r),this.paintChildrenNodes(r)},i.prototype.onTreeStateChanged=function(){void 0!==this._onTreeStateChanged&&this._onTreeStateChanged(this._selectionManager.currentSelectionTree)},i.prototype.getNewTreeViewItem=function(e,i,n,o){var r=this,a=this._selectionManager.getStateMemberChoiceTreeViewItem(e);return new t.MemberChoiceTreeViewItem(e,o,i,n,this,function(){r.onTreeStateChanged()},a)},i.prototype.clearSelectionDataTree=function(){this._selectionManager.clearSelection();for(var e=0;e<this.children.length;e++)this.children[e]instanceof t.MemberChoiceTreeViewItem!=!1&&this.children[e].clearSelection();this.onTreeStateChanged()},i}(e.TreeView);t.MemberChoiceTreeView=i}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(e){this._currentSelectionRootNodes=new Array,void 0!==e&&(this._currentSelectionRootNodes=e)}return Object.defineProperty(t.prototype,"currentSelectionTree",{get:function(){return t.optimizeSelectionTree(this._currentSelectionRootNodes)},enumerable:!0,configurable:!0}),t.prototype.clearSelection=function(){for(var t=0;t<this._currentSelectionRootNodes.length;t++)e.MemberChoiceTreeNode.clearSelection(this._currentSelectionRootNodes[t])},t.prototype.getStateMemberChoiceTreeViewItem=function(i){if(null===i.parents){if(0!==this._currentSelectionRootNodes.length)for(var n=0;n<this._currentSelectionRootNodes.length;n++)if(this._currentSelectionRootNodes[n].uniqueName===i.uniqueName)return new e.StateMemberChoiceTreeViewItem(i,this._currentSelectionRootNodes[n],this._currentSelectionRootNodes[n]);var o=new e.MemberChoiceTreeNode(i.uniqueName);return this._currentSelectionRootNodes.push(o),new e.StateMemberChoiceTreeViewItem(i,o,o)}var r,a;if(0===this._currentSelectionRootNodes.length)return r=new e.MemberChoiceTreeNode(i.uniqueName),a=t.getBuiltTree(i.parents,0,r),this._currentSelectionRootNodes.push(a),new e.StateMemberChoiceTreeViewItem(i,r,a);for(var s=0;s<this._currentSelectionRootNodes.length;s++){var l=this._currentSelectionRootNodes[s],c=t.findTreeNode(i.uniqueName,l);if(void 0!==c)return new e.StateMemberChoiceTreeViewItem(i,c,l);for(var u=i.parents.length-1;u>=0;u--){var p=i.parents[u].uniqueName,h=t.findTreeNode(p,l);if(void 0!==h)return r=new e.MemberChoiceTreeNode(i.uniqueName),t.extendSelectionTree(h,i.parents.splice(u+1,i.parents.length),r),new e.StateMemberChoiceTreeViewItem(i,r,l)}}return r=new e.MemberChoiceTreeNode(i.uniqueName),a=t.getBuiltTree(i.parents,0,r),this._currentSelectionRootNodes.push(a),new e.StateMemberChoiceTreeViewItem(i,r,a)},t.getBuiltTree=function(i,n,o){var r=new e.MemberChoiceTreeNode(i[n].uniqueName,void 0,void 0,void 0),a=n+1;return a<i.length?r.childNodes.push(t.getBuiltTree(i,a,o)):r.childNodes.push(o),r},t.findTreeNode=function(e,i){if(i.uniqueName===e)return i;for(var n=0;n<i.childNodes.length;n++){var o=i.childNodes[n];if(0===o.childNodes.length&&o.uniqueName===e)return o;var r=t.findTreeNode(e,o);if(void 0!==r)return r}},t.extendSelectionTree=function(e,i,n){t.addNewParents(e,i,0,n)},t.addNewParents=function(i,n,o,r){if(0!==n.length){var a=new e.MemberChoiceTreeNode(n[o].uniqueName);i.childNodes.push(a);var s=o+1;s<n.length?t.addNewParents(a,n,s,r):a.childNodes.push(r)}else i.childNodes.push(r)},t.optimizeSelectionTree=function(i){for(var n=Array(),o=0;o<i.length;o++){var r=i[o];if(t.canIncludeNodeInSelectionTree(r)){var a=new e.MemberChoiceTreeNode(r.uniqueName,r.selectedSelf,r.selectedChildren,r.selectedDescendants);r.childNodes.length>0&&(a.childNodes=t.optimizeSelectionTree(r.childNodes)),n.push(a)}}return n},t.canIncludeNodeInSelectionTree=function(e){if(void 0!==e.selectedChildren||void 0!==e.selectedSelf||void 0!==e.selectedDescendants)return!0;for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(t.canIncludeNodeInSelectionTree(n))return!0}return!1},t}();e.SelectionManager=t}(e.MemberChoice||(e.MemberChoice={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function n(i,o){var r=this;this._onValueChanged=new t.Events.LiteEvent,this._levelSelectors=new Array,n._directoryTemplate=e.PathManager.templatesPath,this._$parentElement=$(i),this._options=o,this._promiseDownloadTemplates=this.downloadTemplate().done(function(e){r._filterTemplates=e,r.init1()})}return Object.defineProperty(n.prototype,"isValid",{get:function(){for(var e=!0,t=0;t<this._levelSelectors.length;t++)this._levelSelectors[t].isValid||(e=!1);return e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},set:function(e){var t=this;this._levels=e,this._promiseDownloadTemplates.done(function(){t.init2()})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filterTreeDescription",{get:function(){for(var e=new Array,t=0;t<this._levelSelectors.length;t++){var i=this._levelSelectors[t].actualFilterDescription;e.push(i)}return e},enumerable:!0,configurable:!0}),n.prototype.init1=function(){var e=this,t=this;this._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.on("click",function(){e.addNewLevelFilter(null),t._levels.length===t._levelSelectors.length&&t._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.attr("disabled","true")}),this._$parentElement.append(this._filterTemplates.customFilterTemplate.$layout)},n.prototype.init2=function(){for(var e=0;e<this._options.filterTreeDescription.length;e++){var t=this._options.filterTreeDescription[e];this.addNewLevelFilter(t)}this._levels.length===this._levelSelectors.length&&this._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.attr("disabled","true")},n.prototype.addNewLevelFilter=function(e){var t=this,n=this._filterTemplates.$levelSelectorTemplate.clone(),o=this,r=new i.LevelSelectorOptions;r.initialFilterDescription=e,r.levels=this.getCopyAvailableLevels(),r.measuresTree=this._options.treeMeasures,r.$container=this._options.measureChoiceContainer,r.$groupFiltersTemplate=this._filterTemplates.$groupFiltersTemplate,r.$topFilterTemplate=this._filterTemplates.filterTemplates.$topFilterTemplate,r.$labelFilterTemplate=this._filterTemplates.filterTemplates.$labelFilterTemplate,r.$valueFilterTemplate=this._filterTemplates.filterTemplates.$valueFilterTemplate;var a=new i.LevelSelectorControl(n,r);a.onLevelSelectorRemoved.on(function(e){t._levelSelectors.splice(t._levelSelectors.indexOf(e),1),t._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.removeAttr("disabled"),o.updateAvailableLevels(),t._onValueChanged.trigger()}),a.onValueChanged.on(function(){t._onValueChanged.trigger()}),a.onSelectedLevelChanged.on(function(e){o.updateAvailableLevels()}),this._levelSelectors.push(a),a.init(),this._filterTemplates.customFilterTemplate.$treeLevelsLayout.append(n),this._onValueChanged.trigger()},n.prototype.updateAvailableLevels=function(){var e=this.getCopyAvailableLevels();this._levelSelectors.forEach(function(t){var i=JSON.parse(JSON.stringify(e));t.updateAvailableLevels(i)})},n.prototype.getCopyAvailableLevels=function(){for(var e=JSON.parse(JSON.stringify(this._levels)),t=0;t<this._levelSelectors.length;t++){var i=this._levelSelectors[t],n=e.filter(function(e){return i.selectedLevel.uniqueName===e.uniqueName})[0];e.splice(e.indexOf(n),1)}return e},n.prototype.downloadTemplate=function(){var t=$.Deferred();return $.when($.ajax({url:n._directoryTemplate+"label-filter-row-template.html"}),$.ajax({url:n._directoryTemplate+"top-filter-row-template.html"}),$.ajax({url:n._directoryTemplate+"value-filter-row-template.html"}),$.ajax({url:n._directoryTemplate+"custom-filter-template.html"}),$.ajax({url:n._directoryTemplate+"level-selector-row-template.html"}),$.ajax({url:n._directoryTemplate+"group-filter-row-template.html"})).done(function(i,n,o,r,a,s){var l=$(e.Localization.localizeTemplate(r[0]));t.resolve({customFilterTemplate:{$layout:l,$btnAddFilterToLevel:l.find(".smartFilter-addFilterToLevelButton"),$treeLevelsLayout:l.find(".smartFilter-levelsTreePanel")},filterTemplates:{$labelFilterTemplate:$(e.Localization.localizeTemplate(i[0])),$topFilterTemplate:$(e.Localization.localizeTemplate(n[0])),$valueFilterTemplate:$(e.Localization.localizeTemplate(o[0]))},$levelSelectorTemplate:$(e.Localization.localizeTemplate(a[0])),$groupFiltersTemplate:$(e.Localization.localizeTemplate(s[0]))})}).fail(function(i){t.reject(i),e.LogService.error(i)}),t},n}();i.CustomFilterControl=n}(t.SmartFilter||(t.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.DropDownItem=t;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.LevelDescription=i}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){this.filterTreeDescription=new Array,this.isUsed=!1}return t.parse=function(i){var n=JSON.parse(i),o=new t;o.isUsed=n.isUsed;for(var r=0;r<n.filterTreeDescription.length;r++){var a=n.filterTreeDescription[r],s=new e.LevelFilterDescription;s.level=a.level;for(var l=0;l<a.filters.length;l++){var c=a.filters[l];if(c.typeName===e.FilterGroupDescription.typeName)s.filters.push(t.parseFilterGroup(c));else{if(c.typeName!==e.TopDataFilter.typeName)throw new Error("InvalidOperationException");s.filters.push(new e.TopDataFilter(c))}}o.filterTreeDescription.push(s)}return o},t.parseFilterGroup=function(t){var i=new e.FilterGroupDescription;i.operation=t.operation;for(var n=0;n<t.filters.length;n++){var o=t.filters[n];if(o.typeName===e.ValueDataFilter.typeName){var r=new e.ValueDataFilter(o);i.filters.push(r)}else if(o.typeName===e.LabelDataFilter.typeName){var a=new e.LabelDataFilter(o);i.filters.push(a)}else{if(o.typeName!==e.FilterGroupDescription.typeName)throw new Error("InvalidOperationException");var s=this.parseFilterGroup(o);i.filters.push(s)}}return i},t}();e.SmartCustomFilterDescription=t}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.LabelFilter=0]="LabelFilter",e[e.ValueFilter=1]="ValueFilter",e[e.TopFilter=2]="TopFilter"}(e.DataFilterType||(e.DataFilterType={}));e.DataFilterType}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){this.typeName=t.typeName,this.operation=e.GroupOperation.And,this.filters=new Array}return t.typeName="filterGroup",t}();e.FilterGroupDescription=t}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.And=0]="And",e[e.Or=1]="Or",e[e.NotAnd=2]="NotAnd",e[e.NotOr=3]="NotOr"}(e.GroupOperation||(e.GroupOperation={}));e.GroupOperation}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t){t?(this.text1=t.text1,this.text2=t.text2,this.levelPropertyName=t.levelPropertyName,this.filterType=t.filterType):(this.text1="",this.text2="",this.levelPropertyName="Caption",this.filterType=e.LabelDataFilterType.Equal)}return Object.defineProperty(t.prototype,"typeName",{get:function(){return t.typeName},enumerable:!0,configurable:!0}),t.typeName="labelFilter",t}();e.LabelDataFilter=t}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.Greater=2]="Greater",e[e.GreaterOrEqual=3]="GreaterOrEqual",e[e.Less=4]="Less",e[e.LessOrEqual=5]="LessOrEqual",e[e.Between=6]="Between",e[e.BetweenNotIncluding=7]="BetweenNotIncluding",e[e.NotBetween=8]="NotBetween",e[e.NotBetweenNotIncluding=9]="NotBetweenNotIncluding",e[e.BeginWith=10]="BeginWith",e[e.NotBeginWith=11]="NotBeginWith",e[e.EndWith=12]="EndWith",e[e.NotEndWith=13]="NotEndWith",e[e.Contain=14]="Contain",e[e.NotContain=15]="NotContain"}(e.LabelDataFilterType||(e.LabelDataFilterType={}));e.LabelDataFilterType}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.level=null,this.filters=new Array}}();e.LevelFilterDescription=t}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t){t?(this.filterType=t.filterType,this.count=t.count,this.filterTarget=t.filterTarget,this.measureUniqueName=t.measureUniqueName):(this.filterType=e.TopDataFilterType.Top,this.count=0,this.filterTarget=e.TopDataFilterTargetType.Items,this.measureUniqueName="")}return Object.defineProperty(t.prototype,"typeName",{get:function(){return t.typeName},enumerable:!0,configurable:!0}),t.typeName="topFilter",t}();e.TopDataFilter=t}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Items=0]="Items",e[e.Percent=1]="Percent",e[e.Sum=2]="Sum"}(e.TopDataFilterTargetType||(e.TopDataFilterTargetType={}));e.TopDataFilterTargetType}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"}(e.TopDataFilterType||(e.TopDataFilterType={}));e.TopDataFilterType}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t){t?(this.num1=t.num1,this.num2=t.num2,this.measureUniqueName=t.measureUniqueName,this.filterType=t.filterType):(this.num1=0,this.num2=0,this.measureUniqueName="",this.filterType=e.ValueDataFilterType.Equal)}return Object.defineProperty(t.prototype,"typeName",{get:function(){return t.typeName},enumerable:!0,configurable:!0}),t.typeName="valueFilter",t}();e.ValueDataFilter=t}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.Greater=2]="Greater",e[e.GreaterOrEqual=3]="GreaterOrEqual",e[e.Less=4]="Less",e[e.LessOrEqual=5]="LessOrEqual",e[e.Between=6]="Between",e[e.BetweenNotIncluding=7]="BetweenNotIncluding",e[e.NotBetween=8]="NotBetween",e[e.NotBetweenNotIncluding=9]="NotBetweenNotIncluding"}(e.ValueDataFilterType||(e.ValueDataFilterType={}));e.ValueDataFilterType}(e.Options||(e.Options={}))}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.CustomFilterOptions=t;var i=function(){return function(){}}();e.LevelSelectorOptions=i;var n=function(){return function(){}}();e.FiltersGroupOptions=n}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function n(e,i){this._filterControlChildren=new Array,this._onGroupRemoved=new t.Events.LiteEvent,this._onValueChanged=new t.Events.LiteEvent,this._$view=e,this._options=i,this._$conditionSelectorPanel=this._$view.find(".groupFilter-conditionSelector"),this._$addLabelFilterButton=this._$view.find(".groupFilter-addCaptionFilterButton"),this._$addFiltersGroupButton=this._$view.find(".groupFilter-addFiltersGroupButton"),this._$addValueFilterButton=this._$view.find(".groupFilter-addValueFilterButton"),this._$removeGroupButton=this._$view.find(".groupFilter-removeGroupFilterButton"),this._$expandButton=this._$view.find(".groupFilter-caret"),this._$expandButton.addClass("hidden-caret"),this._$validationIndicator=this._$view.find(".validation-alert-indicator"),this._$childPanel=this._$view.find(".groupFilter-childPanel")}return Object.defineProperty(n.prototype,"onGroupRemoved",{get:function(){return this._onGroupRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValid",{get:function(){var e=!0;0===this._filterControlChildren.length&&(e=!1);for(var t=0;t<this._filterControlChildren.length;t++)this._filterControlChildren[t].isValid||(e=!1);return this.drawNotValidIndicator(),e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"actualGroupDescription",{get:function(){var e=new i.Options.FilterGroupDescription;e.operation=this._operationSelector.selectedItem.operation;for(var t=0;t<this._filterControlChildren.length;t++){var o=this._filterControlChildren[t];if(o instanceof i.LabelFilterControl){var r=o;e.filters.push(r.actualFilterDescription)}else if(o instanceof i.ValueFilterControl){var a=o;e.filters.push(a.actualFilterDescription)}else{if(!(o instanceof n))throw new Error("InvalidOperationException");var s=o;e.filters.push(s.actualGroupDescription)}}return e},enumerable:!0,configurable:!0}),n.prototype.init=function(){var e=this,o=this._operationSelector=new t.DropDownControl;o.displayPropertyExpr="caption",o.selectedExpr="isSelected",o.imageCssClassExp="imageClass",o.itemSource=n.getOperations(this._options.initialFilterGroupDescription.operation),o.selectionChanged.on(function(e){}),this._$conditionSelectorPanel.append(o.view),this._$addFiltersGroupButton.on("click",function(){var t=new i.Options.FilterGroupDescription;e.addFilterGroup(t),e.updateCaretState()}),this._$addLabelFilterButton.on("click",function(){var t=new i.Options.LabelDataFilter;e.addLabelFilter(t),e.updateCaretState()}),this._$addValueFilterButton.on("click",function(){e.addValueFilter(new i.Options.ValueDataFilter),e.updateCaretState()}),this._$removeGroupButton.on("click",function(){e._$view.remove(),e._onGroupRemoved.trigger(e)}),this._$expandButton.on("click",function(){e._$childPanel.toggle(),e._$expandButton.toggleClass("fa-caret-right"),e._$expandButton.toggleClass("fa-caret-down")}),this.init2(),this.updateCaretState()},n.prototype.addLabelFilter=function(e){var t=this,n=this._options.$labelFilterTemplate.clone(),o=new i.LabelFilterControl(n,e);o.onFilterRemoved.on(function(e){t._filterControlChildren.splice(t._filterControlChildren.indexOf(e),1),t.updateCaretState(),t._onValueChanged.trigger()}),o.onValueChanged.on(function(){t._onValueChanged.trigger()}),o.init(),this._filterControlChildren.push(o),this._$childPanel.append(n),this.drawNotValidIndicator(),this._onValueChanged.trigger()},n.prototype.addValueFilter=function(e){var t=this,n=this._options.$valueFilterTemplate.clone(),o=new i.ValueFilterControl(n,e,this._options.measuresTree,this._options.$container);o.onFilterRemoved.on(function(e){t._filterControlChildren.splice(t._filterControlChildren.indexOf(e),1),t.updateCaretState(),t._onValueChanged.trigger()}),o.onValueChanged.on(function(){t._onValueChanged.trigger()}),o.init(),this._filterControlChildren.push(o),this._$childPanel.append(n),this.drawNotValidIndicator(),this._onValueChanged.trigger()},n.prototype.addFilterGroup=function(e){var t=this,o=this._options.$groupFiltersTemplate.clone(),r=new i.FiltersGroupOptions;r.measuresTree=this._options.measuresTree,r.$container=this._options.$container,r.initialFilterGroupDescription=e,r.$groupFiltersTemplate=this._options.$groupFiltersTemplate,r.$labelFilterTemplate=this._options.$labelFilterTemplate,r.$valueFilterTemplate=this._options.$valueFilterTemplate;var a=new n(o,r);a.onGroupRemoved.on(function(e){t._filterControlChildren.splice(t._filterControlChildren.indexOf(e),1),t.updateCaretState(),t._onValueChanged.trigger()}),a._onValueChanged.on(function(){t._onValueChanged.trigger()}),a.init(),this._filterControlChildren.push(a),this._$childPanel.append(o),this.drawNotValidIndicator(),this._onValueChanged.trigger()},n.prototype.init2=function(){for(var e=0;e<this._options.initialFilterGroupDescription.filters.length;e++){var t=this._options.initialFilterGroupDescription.filters[e];if(t instanceof i.Options.LabelDataFilter)this.addLabelFilter(t);else if(t instanceof i.Options.ValueDataFilter)this.addValueFilter(t);else{if(!(t instanceof i.Options.FilterGroupDescription))throw new Error("InvalidOperationException");this.addFilterGroup(t)}}},n.prototype.updateCaretState=function(){0!==this._filterControlChildren.length?this._$expandButton.removeClass("hidden-caret"):this._$expandButton.addClass("hidden-caret")},n.getOperations=function(t){var n=new Array;return n.push(new o(e.Localization.localize("OperationType_And"),"imageLibrary_fcgroupand",i.Options.GroupOperation.And,t===i.Options.GroupOperation.And)),n.push(new o(e.Localization.localize("OperationType_Or"),"imageLibrary_fcgroupor",i.Options.GroupOperation.Or,t===i.Options.GroupOperation.Or)),n.push(new o(e.Localization.localize("OperationType_NotAnd"),"imageLibrary_fcgroupxor",i.Options.GroupOperation.NotAnd,t===i.Options.GroupOperation.NotAnd)),n.push(new o(e.Localization.localize("OperationType_NotOr"),"imageLibrary_fcgroupnot",i.Options.GroupOperation.NotOr,t===i.Options.GroupOperation.NotOr)),n},n.prototype.drawNotValidIndicator=function(){0===this._filterControlChildren.length?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},n}();i.FiltersGroupControl=n;var o=function(){return function(e,t,i,n){void 0===n&&(n=!1),this.caption=e,this.imageClass=t,this.operation=i,this.isSelected=n}}()}(t.SmartFilter||(t.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.levelPropertyName=i,this.isSelected=n}}(),o=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n}}(),r=function(){function r(e,i){this._onFilterRemoved=new t.Events.LiteEvent,this._onValueChanged=new t.Events.LiteEvent,this._$view=e,this._initialFilterDescription=i,this._actualFilterDescription=jQuery.extend(!0,{},this._initialFilterDescription)}return Object.defineProperty(r.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onFilterRemoved",{get:function(){return this._onFilterRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isValid",{get:function(){var e,t=""!==this._$textBox1.val(),n=this._$textBox2.val();switch(this._actualFilterDescription.filterType){case i.Options.LabelDataFilterType.Between:case i.Options.LabelDataFilterType.BetweenNotIncluding:case i.Options.LabelDataFilterType.NotBetween:case i.Options.LabelDataFilterType.NotBetweenNotIncluding:e=""!==n;break;default:e=!0}return t&&e?(this.drawNotValidIndicator(!1),!0):(this.drawNotValidIndicator(!0),!1)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualFilterDescription",{get:function(){return this._actualFilterDescription.text1=this._$textBox1.val(),this._actualFilterDescription.text2=this._$textBox2.val(),this._actualFilterDescription},enumerable:!0,configurable:!0}),r.prototype.parseView=function(e){this._$levelPropertyDropDownPanel=e.find(".labelFilter-propertySelector"),this._$labelFilterTypeDropDownPanel=e.find(".labelFilter-operationSelector"),this._$textBox1=e.find(".labelFilter-input1 input"),this._$textBox2=e.find(".labelFilter-input2 input"),this._$textBox1Panel=e.find(".labelFilter-input1"),this._$textBox2Panel=e.find(".labelFilter-input2"),this._$labelAndPanel=e.find(".labelFilter-andLabel"),this._$removeFilterButton=e.find(".labelFilter-removeFilterButton"),this._$validationIndicator=e.find(".validation-alert-indicator")},r.prototype.init=function(){var e=this;this.parseView(this._$view),this.initLevelPropName(),this.initFilterType(),this.initTextBoxes(),this._$removeFilterButton.on("click",function(){e._$view.remove(),e._onFilterRemoved.trigger(e)})},r.prototype.initTextBoxes=function(){var e=this;this._$textBox1.val(this._initialFilterDescription.text1),this._$textBox1.on("change",function(){e.drawNotValidIndicator(!1),e._onValueChanged.trigger()}),this._$textBox2.val(this._initialFilterDescription.text2),this._$textBox2.on("change",function(){e.drawNotValidIndicator(!1),e._onValueChanged.trigger()})},r.prototype.initLevelPropName=function(){var i=this,o=[new n(e.Localization.localize("Olap_Caption"),"imageLibrary_levelProperty","Caption","Caption".toUpperCase()===this._initialFilterDescription.levelPropertyName.toUpperCase()),new n(e.Localization.localize("Olap_Name"),"imageLibrary_levelProperty","Name","Name".toUpperCase()===this._initialFilterDescription.levelPropertyName.toUpperCase()),new n(e.Localization.localize("Olap_UniqueName"),"imageLibrary_levelProperty","UNIQUE_NAME","UNIQUE_NAME".toUpperCase()===this._initialFilterDescription.levelPropertyName.toUpperCase())],r=new t.DropDownControl;r.displayPropertyExpr="caption",r.imageCssClassExp="imageCssClass",r.selectedExpr="isSelected",r.itemSource=o,r.selectionChanged.on(function(e){i._actualFilterDescription.levelPropertyName=e.levelPropertyName}),this._$levelPropertyDropDownPanel.append(r.view)},r.prototype.initFilterType=function(){var n=this,r=this;this.updateStateFilterType(this._initialFilterDescription.filterType);var a=new Array;a.push(new o(e.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",i.Options.LabelDataFilterType.Equal,i.Options.LabelDataFilterType.Equal===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",i.Options.LabelDataFilterType.NotEqual,i.Options.LabelDataFilterType.NotEqual===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",i.Options.LabelDataFilterType.Greater,i.Options.LabelDataFilterType.Greater===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",i.Options.LabelDataFilterType.GreaterOrEqual,i.Options.LabelDataFilterType.GreaterOrEqual===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",i.Options.LabelDataFilterType.Less,i.Options.LabelDataFilterType.Less===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",i.Options.LabelDataFilterType.LessOrEqual,i.Options.LabelDataFilterType.LessOrEqual===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",i.Options.LabelDataFilterType.Between,i.Options.LabelDataFilterType.Between===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",i.Options.LabelDataFilterType.BetweenNotIncluding,i.Options.LabelDataFilterType.BetweenNotIncluding===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",i.Options.LabelDataFilterType.NotBetween,i.Options.LabelDataFilterType.NotBetween===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",i.Options.LabelDataFilterType.NotBetweenNotIncluding,i.Options.LabelDataFilterType.NotBetweenNotIncluding===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("LabelFilter_BeginWith"),"imageLibrary_fcopbegin",i.Options.LabelDataFilterType.BeginWith,i.Options.LabelDataFilterType.BeginWith===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("LabelFilter_NotBeginWith"),"imageLibrary_fcopbeginnot",i.Options.LabelDataFilterType.NotBeginWith,i.Options.LabelDataFilterType.NotBeginWith===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("LabelFilter_EndWith"),"imageLibrary_fcopend",i.Options.LabelDataFilterType.EndWith,i.Options.LabelDataFilterType.EndWith===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("LabelFilter_NotEndWith"),"imageLibrary_fcopendnot",i.Options.LabelDataFilterType.NotEndWith,i.Options.LabelDataFilterType.NotEndWith===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("LabelFilter_Contain"),"imageLibrary_fcopcontain",i.Options.LabelDataFilterType.Contain,i.Options.LabelDataFilterType.Contain===this._initialFilterDescription.filterType)),a.push(new o(e.Localization.localize("LabelFilter_NotContain"),"imageLibrary_fcopnotcontain",i.Options.LabelDataFilterType.NotContain,i.Options.LabelDataFilterType.NotContain===this._initialFilterDescription.filterType));var s=new t.DropDownControl;s.displayPropertyExpr="caption",s.imageCssClassExp="imageCssClass",s.selectedExpr="isSelected",s.itemSource=a,s.selectionChanged.on(function(e){r.updateStateFilterType(e.filterType),n._onValueChanged.trigger()}),this._$labelFilterTypeDropDownPanel.append(s.view)},r.prototype.updateStateFilterType=function(e){switch(this._actualFilterDescription.filterType=e,e){case i.Options.LabelDataFilterType.Between:case i.Options.LabelDataFilterType.BetweenNotIncluding:case i.Options.LabelDataFilterType.NotBetween:case i.Options.LabelDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},r.prototype.updateStateTextEditor=function(e){e?(this._$textBox1Panel.removeClass("labelFilter-input1_100pct"),this._$textBox1Panel.addClass("labelFilter-input1_40pct"),this._$textBox2Panel.removeClass("labelFilter-element_hidden"),this._$labelAndPanel.removeClass("labelFilter-element_hidden")):(this._$textBox1Panel.addClass("labelFilter-input1_100pct"),this._$textBox1Panel.removeClass("labelFilter-input1_40pct"),this._$textBox2Panel.addClass("labelFilter-element_hidden"),this._$labelAndPanel.addClass("labelFilter-element_hidden"))},r.prototype.drawNotValidIndicator=function(e){e?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},r}();i.LabelFilterControl=r}(t.SmartFilter||(t.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i;!function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove"}(i||(i={}));var n=function(){function n(t,i){this._onLevelSelectorRemoved=new e.Events.LiteEvent,this._isUpdateLevelsNow=!1,this._filterControlChildren=new Array,this._onValueChanged=new e.Events.LiteEvent,this._onSelectedLevelChanged=new e.Events.LiteEvent,this._options=i,this._$view=t,this._$levelSelector=this._$view.find(".levelSelector-levelsSelectorPanel"),this._$removeControlButton=this._$view.find(".levelSelector-removeSelectorButton"),this._$addFiltersGroupButton=this._$view.find(".levelSelector-addFiltersGroupButton"),this._$addTopFilterButton=this._$view.find(".levelSelector-addTopFilterButton"),this._$expandButton=this._$view.find(".levelSelector-caret"),this._$expandButton.addClass("hidden-caret"),this._$validationIndicator=this._$view.find(".validation-alert-indicator"),this._$childPanel=this._$view.find(".levelSelector-childPanel")}return Object.defineProperty(n.prototype,"onLevelSelectorRemoved",{get:function(){return this._onLevelSelectorRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedLevel",{get:function(){return this._levelChoiceControl.selectedItem},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValid",{get:function(){var e=!0,t=this._filterControlChildren;0===t.length&&(e=!1);for(var i=0;i<t.length;i++)t[i].isValid||(e=!1);return this.drawNotValidIndicator(),e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onSelectedLevelChanged",{get:function(){return this._onSelectedLevelChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"actualFilterDescription",{get:function(){var e=new t.Options.LevelFilterDescription;null!==this._levelChoiceControl.selectedItem.uniqueName?e.level=this._levelChoiceControl.selectedItem:e.level=null;for(var i=0;i<this._filterControlChildren.length;i++)if(this._filterControlChildren[i]instanceof t.TopFilterControl){var n=this._filterControlChildren[i];e.filters.push(n.actualFilterDescription)}else{if(!(this._filterControlChildren[i]instanceof t.FiltersGroupControl))throw new Error("InvalidOperationException");var o=this._filterControlChildren[i];e.filters.push(o.actualGroupDescription)}return e.isValid=this.isValid,e},enumerable:!0,configurable:!0}),n.prototype.changeChildrenControls=function(e,n){if(n===i.Add)this._filterControlChildren.push(e);else{if(n!==i.Remove)throw new Error("InvalidOperationException");this._filterControlChildren.splice(this._filterControlChildren.indexOf(e),1)}this._filterControlChildren.filter(function(e){return e instanceof t.TopFilterControl}).length>0?this._$addTopFilterButton.attr("disabled","true"):this._$addTopFilterButton.removeAttr("disabled"),this._filterControlChildren.filter(function(e){return e instanceof t.FiltersGroupControl}).length>0?this._$addFiltersGroupButton.attr("disabled","true"):this._$addFiltersGroupButton.removeAttr("disabled")},n.prototype.getLevels=function(e,t){for(var i=new Array,n=!1,o=0;o<e.length;o++)e[o].isSelected=!1,e[o].uniqueName===t&&(e[o].isSelected=!0,n=!0),i.push(e[o]);return!1===n&&(i[0].isSelected=!0),i.sort(function(e,t){return e.order>t.order?1:t.order>e.order?-1:0}),i},n.prototype.updateAvailableLevels=function(e){this._isUpdateLevelsNow=!0,e.push(this.selectedLevel),this._levelChoiceControl.itemSource=this.getLevels(e,this.selectedLevel.uniqueName),this._isUpdateLevelsNow=!1},n.prototype.init=function(){var i=this,n=this._levelChoiceControl=new e.DropDownControl;n.displayPropertyExpr="caption",n.selectedExpr="isSelected",n.imageCssClassExp="imageClass";var o=null;this._options.initialFilterDescription&&null!==this._options.initialFilterDescription.level&&(o=this._options.initialFilterDescription.level.uniqueName),n.itemSource=this.getLevels(this._options.levels,o),n.selectionChanged.on(function(e){i._isUpdateLevelsNow||i._onSelectedLevelChanged.trigger(e)}),this._$levelSelector.append(n.view),this._$addFiltersGroupButton.on("click",function(){i.addFilterGroup(new t.Options.FilterGroupDescription),i.updateCaretState()}),this._$addTopFilterButton.on("click",function(){i.addTopFilter(new t.Options.TopDataFilter),i.updateCaretState()}),this._$removeControlButton.on("click",function(){i._$view.remove(),i._onLevelSelectorRemoved.trigger(i),i.updateCaretState()}),this._$expandButton.on("click",function(){i._$childPanel.toggle(),i._$expandButton.toggleClass("fa-caret-right"),i._$expandButton.toggleClass("fa-caret-down")}),this.init2(),this.updateCaretState()},n.prototype.init2=function(){if(null!==this._options.initialFilterDescription)for(var e=0;e<this._options.initialFilterDescription.filters.length;e++){var i=this._options.initialFilterDescription.filters[e];if(i instanceof t.Options.TopDataFilter)this.addTopFilter(i);else{if(!(i instanceof t.Options.FilterGroupDescription))throw new Error("InvalidOperationException");this.addFilterGroup(i)}}},n.prototype.addFilterGroup=function(e){var n=this,o=this._options.$groupFiltersTemplate.clone(),r=new t.FiltersGroupOptions;r.initialFilterGroupDescription=e,r.measuresTree=this._options.measuresTree,r.$container=this._options.$container,r.$groupFiltersTemplate=this._options.$groupFiltersTemplate,r.$valueFilterTemplate=this._options.$valueFilterTemplate,r.$labelFilterTemplate=this._options.$labelFilterTemplate;var a=new t.FiltersGroupControl(o,r);a.onGroupRemoved.on(function(e){n.changeChildrenControls(e,i.Remove),n.updateCaretState(),n._onValueChanged.trigger()}),a.onValueChanged.on(function(){n._onValueChanged.trigger()}),a.init(),this.changeChildrenControls(a,i.Add),this._$childPanel.append(o),this._onValueChanged.trigger(),this.drawNotValidIndicator()},n.prototype.addTopFilter=function(e){var n=this,o=this._options.$topFilterTemplate.clone(),r=new t.TopFilterControl(o,e,this._options.measuresTree,this._options.$container);r.onFilterRemoved.on(function(e){n.changeChildrenControls(e,i.Remove),n.updateCaretState(),n._onValueChanged.trigger()}),r.onValueChanged.on(function(){n._onValueChanged.trigger()}),r.init(),this.changeChildrenControls(r,i.Add),this._$childPanel.prepend(o),this._onValueChanged.trigger(),this.drawNotValidIndicator()},n.prototype.updateCaretState=function(){0!==this._filterControlChildren.length?this._$expandButton.removeClass("hidden-caret"):this._$expandButton.addClass("hidden-caret")},n.prototype.drawNotValidIndicator=function(){0===this._filterControlChildren.length?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},n}();t.LevelSelectorControl=n}(e.SmartFilter||(e.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n}}(),o=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterTargetType=i,this.isSelected=n}}(),r=function(){function r(e,i,n,o){this._onFilterRemoved=new t.Events.LiteEvent,this._onValueChanged=new t.Events.LiteEvent,this._$view=e,this._initialFilterDescription=i,this._actualFilterDescription=jQuery.extend(!0,{},this._initialFilterDescription),this._treeMeasures=n,this._$measureChoiceContainer=o}return Object.defineProperty(r.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onFilterRemoved",{get:function(){return this._onFilterRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualFilterDescription",{get:function(){return this._actualFilterDescription.count=parseInt(this._$countNumericDown.val()),isNaN(this._actualFilterDescription.count)&&(this._actualFilterDescription.count=0),this._actualFilterDescription},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isValid",{get:function(){return!isNaN(parseInt(this._$countNumericDown.val()))&&this._actualFilterDescription.measureUniqueName?(this.drawNotValidIndicator(!1),!0):(this.drawNotValidIndicator(!0),!1)},enumerable:!0,configurable:!0}),r.prototype.init=function(){var e=this;this.parseView(this._$view),this.initFilterType(),this.initFilterTargetType(),this.initCountTextBox(),this.initMeasureChoiceControl(),this._$removeFilterButton.on("click",function(){e._$view.remove(),e._onFilterRemoved.trigger(e)})},r.prototype.initCountTextBox=function(){var e=this;this._$countNumericDown.val(this._initialFilterDescription.count.toString()),this._$countNumericDown.on("change",function(){e.drawNotValidIndicator(!1),e._onValueChanged.trigger()})},r.prototype.initFilterTargetType=function(){var n=new Array;n.push(new o(e.Localization.localize("Filter_Target_Items"),"imageLibrary_items",i.Options.TopDataFilterTargetType.Items,i.Options.TopDataFilterTargetType.Items===this.actualFilterDescription.filterTarget)),n.push(new o(e.Localization.localize("Filter_Target_Percent"),"imageLibrary_percent",i.Options.TopDataFilterTargetType.Percent,i.Options.TopDataFilterTargetType.Percent===this.actualFilterDescription.filterTarget)),n.push(new o(e.Localization.localize("Filter_Target_Sum"),"imageLibrary_sum",i.Options.TopDataFilterTargetType.Sum,i.Options.TopDataFilterTargetType.Sum===this.actualFilterDescription.filterTarget));var r=this,a=new t.DropDownControl;a.displayPropertyExpr="caption",a.imageCssClassExp="imageCssClass",a.selectedExpr="isSelected",a.itemSource=n,a.selectionChanged.on(function(e){r._actualFilterDescription.filterTarget=e.filterTargetType}),this._$filterTargetTypeDropDownPanel.append(a.view)},r.prototype.initMeasureChoiceControl=function(){var e=this,i=new t.MeasureChoiceOptions(this._treeMeasures,!1),n=this;i.getPopupContainer=function(){return n._$measureChoiceContainer},i.isMultiSelect=!1,this._actualFilterDescription.measureUniqueName&&(i.selectedUniqueNames=[this._actualFilterDescription.measureUniqueName]),i.onSelectedMeasuresChanged=function(t){e._actualFilterDescription.measureUniqueName=t[0].uniqueName,e.drawNotValidIndicator(!1),e._onValueChanged.trigger()},new t.MeasureChoiceSelector(this._$measureChoicePanel[0],i).init()},r.prototype.initFilterType=function(){var o=this,r=new Array;r.push(new n(e.Localization.localize("Filter_Type_Top"),"imageLibrary_top",i.Options.TopDataFilterType.Top,i.Options.TopDataFilterType.Top===this._initialFilterDescription.filterType)),r.push(new n(e.Localization.localize("Filter_Type_Bottom"),"imageLibrary_bottom",i.Options.TopDataFilterType.Bottom,i.Options.TopDataFilterType.Bottom===this._initialFilterDescription.filterType));var a=new t.DropDownControl;a.displayPropertyExpr="caption",a.imageCssClassExp="imageCssClass",a.selectedExpr="isSelected",a.itemSource=r,a.selectionChanged.on(function(e){o._actualFilterDescription.filterType=e.filterType}),this._$topFilterDataTypeDropDownPanel.append(a.view)},r.prototype.parseView=function(e){this._$topFilterDataTypeDropDownPanel=e.find(".topFilter-directionSelector"),this._$filterTargetTypeDropDownPanel=e.find(".topFilter-targetSelector"),this._$measureChoicePanel=e.find(".topFilter-measureSelector"),this._$countNumericDown=e.find(".topFilter-valueInputPanel input"),this._$removeFilterButton=e.find(".topFilter-removeGroupFilterButton"),this._$validationIndicator=e.find(".validation-alert-indicator")},r.prototype.drawNotValidIndicator=function(e){e?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},r}();i.TopFilterControl=r}(t.SmartFilter||(t.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){return function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n}}(),o=function(){function o(e,i,n,o){this._onFilterRemoved=new t.Events.LiteEvent,this._onValueChanged=new t.Events.LiteEvent,this._$view=e,this._initialFilterDescription=i,this._treeMeasures=n,this._$measureChoiceContainer=o,this._actualFilterDescription=jQuery.extend(!0,{},this._initialFilterDescription)}return Object.defineProperty(o.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isValid",{get:function(){var e,t=Number(this._$numericBox1.val()),n=!isNaN(t),o=Number(this._$numericBox2.val());switch(this._actualFilterDescription.filterType){case i.Options.ValueDataFilterType.Between:case i.Options.ValueDataFilterType.BetweenNotIncluding:case i.Options.ValueDataFilterType.NotBetween:case i.Options.ValueDataFilterType.NotBetweenNotIncluding:e=!isNaN(o);break;default:e=!0}return n&&e&&this._actualFilterDescription.measureUniqueName?(this.drawNotValidIndicator(!1),!0):(this.drawNotValidIndicator(!0),!1)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onFilterRemoved",{get:function(){return this._onFilterRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"actualFilterDescription",{get:function(){return this._actualFilterDescription.num1=Number(this._$numericBox1.val()),this._actualFilterDescription.num2=Number(this._$numericBox2.val()),isNaN(this._actualFilterDescription.num1)&&(this._actualFilterDescription.num1=0),isNaN(this._actualFilterDescription.num2)&&(this._actualFilterDescription.num2=0),this._actualFilterDescription},enumerable:!0,configurable:!0}),o.prototype.parseView=function(e){this._$valueFilterTypeDropDownPanel=e.find(".valueFilter-operationSelector"),this._$numericBox1=e.find(".valueFilter-input1 input"),this._$numericBox2=e.find(".valueFilter-input2 input"),this._$numericBox1Panel=e.find(".valueFilter-input1"),this._$numericBox2Panel=e.find(".valueFilter-input2"),this._$labelAndPanel=e.find(".valueFilter-andLabel"),this._$removeFilterButton=e.find(".valueFilter-removeFilterButton"),this._$measureChoicePanel=e.find(".valueFilter-measureSelector"),this._$validationIndicator=e.find(".validation-alert-indicator")},o.prototype.init=function(){var e=this;this.parseView(this._$view),this.initFilterType(),this.initNumeriUpDowns(),this.initMeasureChoiceControl(),this._$removeFilterButton.on("click",function(){e._$view.remove(),e._onFilterRemoved.trigger(e)})},o.prototype.initMeasureChoiceControl=function(){var e=this,i=this,n=new t.MeasureChoiceOptions(this._treeMeasures,!1);n.getPopupContainer=function(){return i._$measureChoiceContainer},n.isMultiSelect=!1,this._actualFilterDescription.measureUniqueName&&(n.selectedUniqueNames=[this._actualFilterDescription.measureUniqueName]),n.onSelectedMeasuresChanged=function(t){i._actualFilterDescription.measureUniqueName=t[0].uniqueName,e.drawNotValidIndicator(!1),e._onValueChanged.trigger()},new t.MeasureChoiceSelector(this._$measureChoicePanel[0],n).init()},o.prototype.initNumeriUpDowns=function(){var e=this;this._$numericBox1.val(this._initialFilterDescription.num1.toString()),this._$numericBox1.on("change",function(){e._onValueChanged.trigger(),e.drawNotValidIndicator(!1)}),this._$numericBox2.val(this._initialFilterDescription.num2.toString()),this._$numericBox2.on("change",function(){e._onValueChanged.trigger(),e.drawNotValidIndicator(!1)})},o.prototype.initFilterType=function(){var o=this,r=this,a=new Array;a.push(new n(e.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",i.Options.ValueDataFilterType.Equal,i.Options.ValueDataFilterType.Equal===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",i.Options.ValueDataFilterType.NotEqual,i.Options.ValueDataFilterType.NotEqual===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",i.Options.ValueDataFilterType.Greater,i.Options.ValueDataFilterType.Greater===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",i.Options.ValueDataFilterType.GreaterOrEqual,i.Options.ValueDataFilterType.GreaterOrEqual===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",i.Options.ValueDataFilterType.Less,i.Options.ValueDataFilterType.Less===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",i.Options.ValueDataFilterType.LessOrEqual,i.Options.ValueDataFilterType.LessOrEqual===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",i.Options.ValueDataFilterType.Between,i.Options.ValueDataFilterType.Between===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",i.Options.ValueDataFilterType.BetweenNotIncluding,i.Options.ValueDataFilterType.BetweenNotIncluding===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",i.Options.ValueDataFilterType.NotBetween,i.Options.ValueDataFilterType.NotBetween===this._initialFilterDescription.filterType)),a.push(new n(e.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",i.Options.ValueDataFilterType.NotBetweenNotIncluding,i.Options.ValueDataFilterType.NotBetweenNotIncluding===this._initialFilterDescription.filterType)),this.updateStateFilterType(this._initialFilterDescription.filterType);var s=new t.DropDownControl;s.displayPropertyExpr="caption",s.imageCssClassExp="imageCssClass",s.selectedExpr="isSelected",s.itemSource=a,s.selectionChanged.on(function(e){r.updateStateFilterType(e.filterType),o._onValueChanged.trigger()}),this._$valueFilterTypeDropDownPanel.append(s.view)},o.prototype.updateStateFilterType=function(e){switch(this._actualFilterDescription.filterType=e,e){case i.Options.ValueDataFilterType.Between:case i.Options.ValueDataFilterType.BetweenNotIncluding:case i.Options.ValueDataFilterType.NotBetween:case i.Options.ValueDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},o.prototype.updateStateTextEditor=function(e){e?(this._$numericBox1Panel.removeClass("valueFilter-input1_100pct"),this._$numericBox1Panel.addClass("valueFilter-input1_40pct"),this._$numericBox2Panel.removeClass("valueFilter-element_hidden"),this._$labelAndPanel.removeClass("valueFilter-element_hidden")):(this._$numericBox1Panel.removeClass("valueFilter-input1_40pct "),this._$numericBox1Panel.addClass("valueFilter-input1_100pct"),this._$numericBox2Panel.addClass("valueFilter-element_hidden"),this._$labelAndPanel.addClass("valueFilter-element_hidden"))},o.prototype.drawNotValidIndicator=function(e){e?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},o}();i.ValueFilterControl=o}(t.SmartFilter||(t.SmartFilter={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){this.hierarchiesRowsPanel=new Array,this.hierarchiesColumnsPanel=new Array}}();e.SortEditorOptions=t;var i=function(){return function(){}}();e.HierarchyDescription=i,function(e){e[e.SortingByContext=0]="SortingByContext",e[e.SortingByProperty=1]="SortingByProperty"}(e.SortingMode||(e.SortingMode={}));e.SortingMode;var n=function(){return function(){this.isUsed=!1,this.sortingByMeasure=new s,this.sortingByProperty=new u}}();e.SortingDescription=n,function(e){e[e.Descending=0]="Descending",e[e.Ascending=1]="Ascending",e[e.None=2]="None"}(e.SortingDirection||(e.SortingDirection={}));var o=e.SortingDirection;!function(e){e[e.Caption=0]="Caption",e[e.Key0=1]="Key0"}(e.HierarchyProperty||(e.HierarchyProperty={}));var r=e.HierarchyProperty,a=function(){return function(){}}();e.CurrentElementDescription=a;var s=function(){return function(){this.members=null,this.measureUniqueName=null,this.direction=o.Ascending}}();e.SortingByMeasureModel=s;var l=function(){return function(){this.uniqueName=null,this.caption=null}}();e.MemberDescription=l;var c=function(){return function(){this.hierarchyUniqueName=null,this.property=r.Caption,this.direction=o.None}}();e.SortingHierarchyDescription=c;var u=function(){return function(){this.items=new Array}}();e.SortingByPropertyModel=u}(e.SortingOptionsPivotTable||(e.SortingOptionsPivotTable={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=t.SortingOptionsPivotTable.SortingDirection,n=t.SortingOptionsPivotTable.HierarchyProperty,o=function(){function o(e,i,n,o){this.getMeasureCaptionFunction=o,this._placementMode=t.PlacementAreaItemMode.Layout1,this._sortingByContext=null,this._sortingItems=null,this._isEnabled=!0,this.areaType=e,this.dataItems=i,this._$appContainer=n}return Object.defineProperty(o.prototype,"sortingByContext",{get:function(){return this._sortingByContext},set:function(t){this._sortingByContext=t,this._$imgDescAreaSorting&&this._$imgAscAreaSorting&&(this._$imgDescAreaSorting.hide(),this._$imgAscAreaSorting.hide(),this._$imgAscAreaSorting.attr("title",""),this._$imgDescAreaSorting.attr("title",""),null!==this._sortingByContext&&null!==this._sortingByContext.measureUniqueName&&(this._sortingByContext.direction===i.Ascending?(this._$imgAscAreaSorting.attr("title",e.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)),this._$imgAscAreaSorting.show()):this._sortingByContext.direction===i.Descending&&(this._$imgDescAreaSorting.attr("title",e.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)),this._$imgDescAreaSorting.show())))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sortingItems",{get:function(){return this._sortingItems},set:function(e){this._sortingItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"placementMode",{get:function(){return this._placementMode},set:function(e){this._placementMode=e,this._$boxAreaItem&&(this._$boxAreaItem.removeClass("queryDesigner-areaItemBox_layout1"),this._$boxAreaItem.removeClass("queryDesigner-areaItemBox_layout2"),this.placementMode===t.PlacementAreaItemMode.Layout1?this._$boxAreaItem.addClass("queryDesigner-areaItemBox_layout1"):this.placementMode===t.PlacementAreaItemMode.Layout2&&this._$boxAreaItem.addClass("queryDesigner-areaItemBox_layout2"))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,this._isEnabled?this._$container.droppable("enable"):this._$container.droppable("disable")},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"listIdVisualItems",{get:function(){for(var e=new Array,t=this._$container.sortable("toArray"),i=0;i<t.length;i++)e.push(t[i]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isSortablePanel",{set:function(e){!1===e?this._$container.sortable("disable"):this._$container.sortable("enable")},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"view",{get:function(){return this._$boxAreaItem},enumerable:!0,configurable:!0}),o.prototype.render=function(e){var i=$("<div/>");i.addClass("queryDesigner-areaItemBoxContent");var n=this.getContentLayoutItemHeader(this.areaType),o=$("<div/>");this._$container=o,o.attr("id",this.getIdForPanel()),o.addClass("queryDesigner-listViewAreaItemBox"),i.append(n),i.append(o),this.initDroppableAreaItem(o),this.initSortableAreaItem(o);var r=$("<div/>");r.addClass("queryDesigner-areaItemBox"),this.placementMode===t.PlacementAreaItemMode.Layout1?r.addClass("queryDesigner-areaItemBox_layout1"):this.placementMode===t.PlacementAreaItemMode.Layout2&&r.addClass("queryDesigner-areaItemBox_layout2"),this._$boxAreaItem=r,r.append(i),e.append(r)},o.prototype.getIdForPanel=function(){switch(this.areaType){case t.AreaType.Columns:return"columnsPane";case t.AreaType.Rows:return"rowsPane";case t.AreaType.Filters:return"filtersPane";case t.AreaType.Data:return"dataPane";default:throw new Error("NotImplementedException")}},o.prototype.initDroppableAreaItem=function(e){var t=this;$(e).droppable({drop:function(e,i){$(i.draggable).hasClass("ui-draggable")&&!$(i.draggable).hasClass("modal")&&t.droppedItem(e,i,t)},tolerance:"intersect",hoverClass:"queryDesigner_panel_content_childPanel_selected-orange",accept:function(e){return $(e).hasClass("ui-draggable")&&!$(e).hasClass("modal-dialog")&&!$(e).hasClass("slicerControl")}})},o.prototype.getPropConnectWithPane=function(){switch(this.areaType){case t.AreaType.Filters:return"#columnsPane, #rowsPane";case t.AreaType.Rows:return"#columnsPane, #filtersPane";case t.AreaType.Columns:return"#rowsPane, #filtersPane";case t.AreaType.Data:return""}throw new Error},o.prototype.initSortableAreaItem=function(e){e.sortable({connectWith:this.getPropConnectWithPane(),placeholder:"queryDesigner-itemAreaSortableEmptySpace",appendTo:this._$appContainer,scroll:!1,distance:5,delay:150,helper:"clone"});var t=this;e.on("sortstart",function(i,n){var o=$(n.item).attr("id");if(!o)throw new Error("InvalidOperationException");t.onStartSortable(t,o),$(e).sortable("refresh")}),e.on("sortstop",function(e,i){var n=$(i.item).attr("id");if(!n)throw new Error("InvalidOperationException");t.onStopSortable(t,n)})},o.prototype.paintDataItems=function(){var t=new Array;this._$container.empty();var r=function(t){switch(t){case n.Caption:return e.Localization.localize("Title_SortingByCaption");case n.Key0:return e.Localization.localize("Title_SortingByKey0")}return""};if(void 0!==this.dataItems)for(var a=0;a<this.dataItems.length;a++){var s=this.dataItems[a],l=i.None,c=null;if(null!==this.sortingItems)for(var u=0,p=this.sortingItems;u<p.length;u++){var h=p[u];if("hierarchy"===s.type&&h.hierarchyUniqueName===s.uniqueName){l=h.direction,c=r(h.property);break}if("level"===s.type&&h.hierarchyUniqueName===s.parentHierarchyId){l=h.direction,c=r(h.property);break}}var d=o.getDomNodeForDataItem(s,this.onDeleteDataItem.bind(this,this,s),this.onOpenFilterEditor.bind(this,this,s),l,c,this.onOpenSortingEditor.bind(this));this._$container.append(d),t.push(d)}return t},o.getDomNodeForDataItem=function(n,r,a,s,l,c){var u=this,p=$("<div/>"),h=$('<table class="queryDesigner-layoutItemTable"/>'),d=$("<tbody/>");h.append(d);var m=$("<td class='queryDesigner-imageColumnLayoutItemTable'/>"),f=$("<td class='queryDesigner-textColumnLayoutItemTable'/>"),g=$("<td class='queryDesigner-buttonColumnLayoutItemTable'/>");if(g.click(r),d.append(m),d.append(f),s!==i.None){var _=$("<td class='queryDesigner-buttonColumnLayoutItemTable'/>"),y=$("<div/>");s===i.Ascending?y.addClass("queryDesigner-ascIconMark"):s===i.Descending&&y.addClass("queryDesigner-descIconMark"),_.attr("title",l),_.on("click",function(){c(u)}),_.append(y),d.append(_)}var v=null;if("level"===n.type||"hierarchy"===n.type){v=$("<td class='queryDesigner-buttonColumnLayoutItemTable'/>");var C=$("<div/>");C.addClass("queryDesigner-openFilterButton"),C.append('<div class="queryDesigner-iconOpenFilterButton"/>'),v.append(C),v.click(a),d.append(v)}d.append(g),p.attr("title",n.caption),p.addClass("queryDesigner-itemListView");var b=$("<div/>");b.addClass("queryDesigner-contentItemListView"),b.append(h);var w=$("<div/>");w.addClass("queryDesigner-iconLayoutItemPanel"),n.filter&&(!1===o.hasFilterIcon(n.icon)&&n.filter.isUsed?n.icon=n.icon+"_filter":!0===o.hasFilterIcon(n.icon)&&!1===n.filter.isUsed&&(n.icon=n.icon.replace("_filter",""))),w.addClass(t.QueryDesigner.prefiximageLibrary+n.icon),m.append(w);var S=$('<span class="queryDesigner-textLayoutItem">'+n.caption+"</span>");f.append(S);var x=$("<div/>");return x.addClass("queryDesigner-deleteLayoutItemButton"),g.append(x),!1===e.ClientInformation.isMobileBrowser()&&(g.hide(),null!==v&&v.hide(),p.mouseenter(function(){g.show(),null!==v&&v.show()}),p.mouseleave(function(){g.hide(),null!==v&&v.hide()})),p.append(b),p},o.hasFilterIcon=function(e){var t=e.lastIndexOf("_filter");return-1!==t&&t+"_filter".length===e.length},o.prototype.getContentLayoutItemHeader=function(n){var o,r,a,s=this,l=this._$imgAscAreaSorting=$("<div class='queryDesigner-ascIconMark queryDesigner-sortingIconArea' style='display:none;'/>"),c=this._$imgDescAreaSorting=$("<div class='queryDesigner-descIconMark queryDesigner-sortingIconArea' style='display:none;'/>");return l.on("click",function(){s.onOpenSortingEditor(s)}),c.on("click",function(){s.onOpenSortingEditor(s)}),null!==this.sortingByContext&&null!==this.sortingByContext.measureUniqueName&&(this.sortingByContext.direction===i.Ascending?(this._$imgAscAreaSorting.attr("title",e.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)),this._$imgAscAreaSorting.css("display","")):this.sortingByContext.direction===i.Descending&&(this._$imgDescAreaSorting.css("display",""),this._$imgDescAreaSorting.attr("title",e.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)))),n===t.AreaType.Columns?(o=$("<div/>"),(r=$("<div/>")).addClass("queryDesigner-columnsIconHeader"),a=$('<span class="queryDesigner-areaTitle">'+e.Localization.localize("MdxDesigner_ColumnsArea_Caption")+"</span>"),o.append(r),o.append(a),o.append(l),o.append(c),o):n===t.AreaType.Rows?(o=$("<div/>"),(r=$("<div/>")).addClass("queryDesigner-rowsIconHeader"),a=$('<span class="queryDesigner-areaTitle">'+e.Localization.localize("MdxDesigner_RowsArea_Caption")+"</span>"),o.append(r),o.append(a),o.append(l),o.append(c),o):n===t.AreaType.Data?(o=$("<div/>"),(r=$("<div/>")).addClass("queryDesigner-dataIconHeader"),a=$("<span>"+e.Localization.localize("MdxDesigner_DataArea_Caption")+"</span>"),o.append(r),o.append(a),o):n===t.AreaType.Filters?(o=$("<div/>"),(r=$("<div/>")).addClass("queryDesigner-filtersIconHeader"),a=$("<span>"+e.Localization.localize("MdxDesigner_FilterArea_Caption")+"</span>"),o.append(r),o.append(a),o):null},o.prototype.droppedItem=function(e,t,i){var n=jQuery.data(t.draggable.get(0),"data");i.onDroppedItem(n,i)},o}();t.AreaItem=o}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.Filters=0]="Filters",e[e.Rows=1]="Rows",e[e.Columns=2]="Columns",e[e.Data=3]="Data"}(e.AreaType||(e.AreaType={}));e.AreaType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(e,t,i,n,o,r){this.caption=e,this.uniqueName=t,this.hierarchyUniqueName=i,this.maxHeight=n,this.columnCount=o,this.buttonWidth=r}}();e.AvailableSlicerDescription=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(){}}();e.FilterOptions=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function i(e,t,i,n){this._filters=e,this._rows=t,this._columns=i,this._data=n}return i.prototype.dropItem=function(e,i){e===t.AreaType.Filters?this.dropInFilters(i):e===t.AreaType.Rows?this.dropInRows(i):e===t.AreaType.Columns?this.dropInColumns(i):e===t.AreaType.Data&&this.dropInData(i)},i.prototype.deleteDataItem=function(i,n){var o=new Array;switch(i){case t.AreaType.Columns:o=this._columns;break;case t.AreaType.Rows:o=this._rows;break;case t.AreaType.Data:o=this._data;break;case t.AreaType.Filters:o=this._filters}if(0===o.length)throw Error();if(e.Utility.ArrayUtility.removeItem(o,n),"values"===n.type&&(this._data.length=0),i===t.AreaType.Data&&o.length<2){var r=this._columns.filter(function(e){return"values"===e.type})[0];void 0===r?void 0!==(r=this._rows.filter(function(e){return"values"===e.type})[0])&&e.Utility.ArrayUtility.removeItem(this._rows,r):e.Utility.ArrayUtility.removeItem(this._columns,r)}},i.prototype.findElement=function(e,t,i){for(var n=void 0,o=0;o<e.length;o++)if(e[o][i]===t[i]){n=e[o];break}return n},i.prototype.findElementTwoProps=function(e,t,i,n){for(var o=void 0,r=0;r<e.length;r++)if(e[r][t]===i[n]){o=e[r];break}return o},i.prototype.findDataItem=function(e,t){var i=void 0;return"hierarchy"===t.type?void 0===(i=this.findElement(e,t,"uniqueName"))&&(i=this.findElementTwoProps(e,"parentHierarchyId",t,"uniqueName")):"level"===t.type?void 0===(i=this.findElement(e,t,"parentHierarchyId"))&&(i=this.findElementTwoProps(e,"uniqueName",t,"parentHierarchyId")):"namedSet"!==t.type&&"calculatedNamedSet"!==t.type||(i=this.findElement(e,t,"name")),i},i.prototype.deleteOpponentRowsColumns=function(t){var i=this.findDataItem(this._rows,t);void 0!==i&&e.Utility.ArrayUtility.removeItem(this._rows,i);var n=this.findDataItem(this._columns,t);void 0!==n&&e.Utility.ArrayUtility.removeItem(this._columns,n)},i.prototype.dropInFilters=function(t){var i=t;if(this.canDropDataItemInFilters(i)){"dimension"===i.type&&(i=i.items.filter(function(e){return"hierarchy"===e.type})[0]);var n=this.findDataItem(this._filters,i);void 0!==n&&e.Utility.ArrayUtility.removeItem(this._filters,n),this._filters.push(i)}},i.prototype.canDropDataItemInFilters=function(e){return"dimension"===e.type||"hierarchy"===e.type||"level"===e.type},i.prototype.canDropDataItemInRows=function(e){return"dimension"===e.type||"hierarchy"===e.type||"level"===e.type||"namedSet"===e.type||"values"===e.type||"calculatedNamedSet"===e.type},i.prototype.canDropDataItemInColumns=function(e){return"dimension"===e.type||"hierarchy"===e.type||"level"===e.type||"namedSet"===e.type||"values"===e.type||"calculatedNamedSet"===e.type},i.prototype.dropInRows=function(e){var t=e;this.canDropDataItemInRows(t)&&("dimension"===t.type&&(t=e.items.filter(function(e){return"hierarchy"===e.type})[0]),this.deleteOpponentRowsColumns(t),this._rows.push(t))},i.prototype.dropInColumns=function(e){var t=e;this.canDropDataItemInColumns(t)&&("dimension"===t.type&&(t=e.items.filter(function(e){return"hierarchy"===e.type})[0]),this.deleteOpponentRowsColumns(t),this._columns.push(t))},i.prototype.dropInData=function(t){var i=t;if("measure"===i.type||"kpiInfo"!==i.type||"kpiItem"!==i.type||"calculatedMember"===i.type){var n=new Array;if("measure"===i.type||"kpiItem"===i.type||"calculatedMember"===i.type)n.push(i);else if("kpiInfo"===i.type)for(var o=0;o<i.items.length;o++)n.push(i.items[o]);for(var r=0;r<n.length;r++){var a=n[r],s=this.findElement(this._data,a,"uniqueName");void 0!==s&&e.Utility.ArrayUtility.removeItem(this._data,s),this._data.push(a)}if(this._data.length>1){var l=this._rows.filter(function(e){return"values"===e.type});if(0===l.length&&(l=this._columns.filter(function(e){return"values"===e.type})),0===l.length){var c={caption:e.Localization.localize("MdxDesigner_ValuesNode_Caption"),type:"values",icon:"values"};this._columns.push(c)}}}},i}();t.IntegrityDataManager=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){e[e.Layout1=0]="Layout1",e[e.Layout2=1]="Layout2"}(e.PlacementAreaItemMode||(e.PlacementAreaItemMode={}));e.PlacementAreaItemMode}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function i(e,i){this._placementMode=t.PlacementAreaItemMode.Layout1,this._$slicerLabel=null,this._slicers=new Array,this._availableSlicers=new Array,this._panel=e,this._options=i,this._onLayoutChanged=function(e){i.hasOwnProperty("onLayoutChanged")&&i.onLayoutChanged(e)},this._availableSlicers=i.availableSlicers?i.availableSlicers:new Array,this._isVisibleLayoutButton=!1,this._layoutDropDownItems=i.layoutDropdownItems||[]}return Object.defineProperty(i.prototype,"plainDataSource",{get:function(){return this._plainDataSource},set:function(e){if(this._plainDataSource=e,void 0!==this.layout){var t=this.getActualLayout(this.layout);this.updateAreas(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e;var t=$(this._panel).find(".queryDesigner-layoutViewer");this._filtersPanel.isEnabled=this._rowsPanel.isEnabled=this._columnsPanel.isEnabled=this._dataPanel.isEnabled=this._isEnabled,this._isEnabled?(t.removeClass("queryDesigner-disabledPanel"),this._$defferedPanel.removeClass("queryDesigner-disabledPanel"),this._$defferedPanel.find(":input").removeAttr("disabled")):(t.addClass("queryDesigner-disabledPanel"),this._$defferedPanel.addClass("queryDesigner-disabledPanel"),this._$defferedPanel.find(":input").attr("disabled","true"))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"placementMode",{get:function(){return this._placementMode},set:function(e){this._placementMode=e,this._filtersPanel&&(this._filtersPanel.placementMode=e),this._rowsPanel&&(this._rowsPanel.placementMode=e),this._columnsPanel&&(this._columnsPanel.placementMode=e),this._dataPanel&&(this._dataPanel.placementMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mapDataSource",{get:function(){return this._plainDataSource},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"connection",{get:function(){return this._options.connection},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cubeName",{get:function(){return this._options.cubeName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layout",{get:function(){if(void 0!==this._filtersPanel&&void 0!==this._rowsPanel&&void 0!==this._columnsPanel&&void 0!==this._dataPanel)return{filters:this.cutOffExcess(jQuery.extend(!0,[],this._filtersPanel.dataItems)),rows:this.cutOffExcess(jQuery.extend(!0,[],this._rowsPanel.dataItems)),columns:this.cutOffExcess(jQuery.extend(!0,[],this._columnsPanel.dataItems)),data:this.cutOffExcess(jQuery.extend(!0,[],this._dataPanel.dataItems))}},set:function(e){var t=this.getActualLayout(e);this.updateAreas(t)},enumerable:!0,configurable:!0}),i.prototype.updateAreas=function(e){this._filtersPanel.dataItems.length=0,this._rowsPanel.dataItems.length=0,this._columnsPanel.dataItems.length=0,this._dataPanel.dataItems.length=0,this.addRangeDataToPanel(this._filtersPanel.dataItems,e.filters),this.addRangeDataToPanel(this._rowsPanel.dataItems,e.rows),this.addRangeDataToPanel(this._columnsPanel.dataItems,e.columns),this.addRangeDataToPanel(this._dataPanel.dataItems,e.data),this.mergeWithDataSource(this._plainDataSource,e),this.rePaintPanels()},Object.defineProperty(i.prototype,"dataItemsFilters",{get:function(){return this._dataItemsFilters},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataItemsRows",{get:function(){return this._dataItemsRows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataItemsColumns",{get:function(){return this._dataItemsColumns},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataItemsData",{get:function(){return this._dataItemsData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"treeMeasures",{get:function(){return this._treeMeasures},set:function(e){this._treeMeasures=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortingRowsOptions",{get:function(){return this._sortingRowsOptions},set:function(e){this._sortingRowsOptions=e,null!==this._sortingRowsOptions&&this._sortingRowsOptions.isUsed?this._rowsPanel.sortingItems=this._sortingRowsOptions.sortingByProperty.items:this._rowsPanel.sortingItems=null,null!==this._sortingRowsOptions&&this._sortingRowsOptions.sortingByMeasure?this._rowsPanel.sortingByContext=this._sortingRowsOptions.sortingByMeasure:this._rowsPanel.sortingByContext=null,this.rePaintPanels()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortingColumnsOptions",{get:function(){return this._sortingColumnsOptions},set:function(e){this._sortingColumnsOptions=e,null!==this._sortingColumnsOptions&&this._sortingColumnsOptions.isUsed?this._columnsPanel.sortingItems=this._sortingColumnsOptions.sortingByProperty.items:this._columnsPanel.sortingItems=null,null!==this._sortingColumnsOptions&&this._sortingColumnsOptions.sortingByMeasure?this._columnsPanel.sortingByContext=this._sortingColumnsOptions.sortingByMeasure:this._columnsPanel.sortingByContext=null,this.rePaintPanels()},enumerable:!0,configurable:!0}),i.prototype.onDeleteItem=function(t,i){e.UserActionsTracker.track("Change the structure of the report",{method:"DeleteItem",areaType:t.areaType}),this._integrityDataManager.deleteDataItem(t.areaType,i),this.rePaintPanels(),this.deleteSlicerByHierarchy("level"===i.type?i.parentHierarchyId:i.uniqueName),this._onLayoutChanged(this.layout)},i.prototype.onDroppedItem=function(t,i){if(void 0===t)throw Error("Element with this ID doesn't present in the data source.");e.UserActionsTracker.track("Change the structure of the report",{method:"DragAndDrop",areaType:i.areaType}),this._integrityDataManager.dropItem(i.areaType,t),this.rePaintPanels(),this._onLayoutChanged(this.layout)},i.prototype.rePaintPanels=function(){this._mapIdVisualElementToDataItem={};var t=function(t,i,n){for(var o=0;o<t.length;o++){var r=e.Utility.Guid.newGuid();t[o].attr("id",r),n[r]=i[o]}};t(this._filtersPanel.paintDataItems(),this._filtersPanel.dataItems,this._mapIdVisualElementToDataItem),t(this._rowsPanel.paintDataItems(),this._rowsPanel.dataItems,this._mapIdVisualElementToDataItem),t(this._columnsPanel.paintDataItems(),this._columnsPanel.dataItems,this._mapIdVisualElementToDataItem),t(this._dataPanel.paintDataItems(),this._dataPanel.dataItems,this._mapIdVisualElementToDataItem)},i.prototype.onStartSortable=function(t,i){e.UserActionsTracker.track("Change the structure of the report",{method:"SortableItems"});var n=this._mapIdVisualElementToDataItem[i];this._filtersPanel.isSortablePanel=this._integrityDataManager.canDropDataItemInFilters(n),this._rowsPanel.isSortablePanel=this._integrityDataManager.canDropDataItemInRows(n),this._columnsPanel.isSortablePanel=this._integrityDataManager.canDropDataItemInColumns(n)},i.prototype.onStopSortable=function(e,t){this._filtersPanel.isSortablePanel=this._rowsPanel.isSortablePanel=this._columnsPanel.isSortablePanel=!0;var n=this.dataItemsFilters.length<this._rowsPanel.listIdVisualItems.length&&this._filtersPanel.listIdVisualItems.length<this.dataItemsFilters.length,o=this.dataItemsColumns.length<this._columnsPanel.listIdVisualItems.length&&this._filtersPanel.listIdVisualItems.length<this.dataItemsFilters.length,r=this._columnsPanel.listIdVisualItems,a=this._rowsPanel.listIdVisualItems;if(n||o){var s=this._mapIdVisualElementToDataItem[t],l=void 0;for(l=0;l<r.length;l++){var c=this._mapIdVisualElementToDataItem[r[l]];if(s!==c&&s.type===c.type&&s.uniqueName===c.uniqueName){r.splice(l,1);break}}for(l=0;l<a.length;l++){var u=this._mapIdVisualElementToDataItem[a[l]];if(s!==u&&s.type===u.type&&s.uniqueName===u.uniqueName){a.splice(l,1);break}}}this.dataItemsFilters.splice(0),this.dataItemsRows.splice(0),this.dataItemsColumns.splice(0),this.dataItemsData.splice(0),i.fillDataItems(this.dataItemsFilters,this._filtersPanel.listIdVisualItems,this._mapIdVisualElementToDataItem),i.fillDataItems(this.dataItemsRows,a,this._mapIdVisualElementToDataItem),i.fillDataItems(this.dataItemsColumns,r,this._mapIdVisualElementToDataItem),i.fillDataItems(this.dataItemsData,this._dataPanel.listIdVisualItems,this._mapIdVisualElementToDataItem),this.rePaintPanels(),this._onLayoutChanged(this.layout)},i.fillDataItems=function(e,t,i){for(var n=0;n<t.length;n++){var o=i[t[n]];e.push(o)}},i.prototype.renderLayout=function(){var e=$("<div/>");e.addClass("queryDesigner-layoutViewer"),this._filtersPanel.render(e),this._rowsPanel.render(e),this._columnsPanel.render(e),this._dataPanel.render(e),$(this._panel).append(e)},i.prototype.onOpenSortingEditor=function(){this._options.onOpenSortingEditor&&this._options.onOpenSortingEditor()},i.prototype.createBottomToolBar=function(){var t=this,i=$("<div/>");i.addClass("queryDesigner-toolBar");var n=$('<div class="queryDesigner-deferredExecutionCheckBox"/>');this._$defferedPanel=n;var o=$('<input type="checkbox">');o.click(function(){t._options.onChangeAutoExecuteMdxQuery(!o.is(":checked"))}),!1===this._options.autoExecuteQuery&&o.attr("checked","true"),n.append(o);var r=$('<span class="queryDesigner-textDeferredExecution">'+e.Localization.localize("QueryDesigner_DeferredExecutionLabel")+"</span>");r.attr("title",e.Localization.localize("QueryDesigner_DeferredExecutionLabel")),r.click(function(){if(!1!==t.isEnabled){var e=!o.is(":checked");o.prop("checked",e),t._options.onChangeAutoExecuteMdxQuery(!e)}}),n.append(r),i.append(n);var a=$('<div class="queryDesigner-updateDataButtonPanel"/>'),s=$('<button class="btn btn-default queryDesigner-updateDataButton">'+e.Localization.localize("QueryDesigner_UpdateButton")+"</button>");a.append(s),s.click(function(){t._options.onUpdateData&&t._options.onUpdateData()}),i.append(a),$(this._panel).append(i)},i.prototype.localizeItems=function(t){var i=function(e){var t,i;for(t=0;t<e.length;t++)if("values"===(i=e[t]).type)return i},n=i(t.columns);n?n.caption=e.Localization.localize("MdxDesigner_ValuesNode_Caption"):(n=i(t.rows))&&(n.caption=e.Localization.localize("MdxDesigner_ValuesNode_Caption"))},i.prototype.mergeWithDataSource=function(e,t){this.extentMetaDataItems(e,t.rows,function(e){e.icon||"level"===e.type&&e.filter&&e.filter.isUsed&&(e.icon+="_filter")}),this.extentMetaDataItems(e,t.columns,function(e){e.icon||"level"===e.type&&e.filter&&e.filter.isUsed&&(e.icon+="_filter")}),this.extentMetaDataItems(e,t.filters,function(e){e.icon||"level"===e.type&&e.filter&&e.filter.isUsed&&(e.icon+="_filter")}),this.extentMetaDataItems(e,t.data,function(e){})},i.prototype.extentMetaDataItems=function(t,n,o){for(var r=0;r<n.length;r++){var a=n[r];switch(a.type){case"hierarchy":if(!(s=i.findMemberDataInDataSource(t,a.uniqueName,"uniqueName")))throw new Error("Not found item of metadata cube");delete(l=$.extend({},{},s)).items,i.copyProps(a,l),i.generateSetFromSelectionNodes(a);break;case"values":a.caption=e.Localization.localize("MdxDesigner_ValuesNode_Caption"),a.icon="values";break;case"kpiItem":case"measure":case"level":if(!(s=i.findMemberDataInDataSource(t,a.uniqueName,"uniqueName")))throw new Error("Not found item of metadata cube");l=$.extend({},{},s);i.copyProps(a,l),"level"===a.type&&i.generateSetFromSelectionNodes(a);break;case"namedSet":case"calculatedMember":case"calculatedNamedSet":var s=i.findMemberDataInDataSource(t,a.name,"name");if(!s)throw new Error("Not found item of metadata cube");var l=$.extend({},{},s);i.copyProps(a,l)}o(a)}},i.findMemberDataInDataSource=function(e,t,i){var n=void 0;for(var o in e)if(e.hasOwnProperty(o)&&e[o][i]===t){n=e[o];break}return n},i.copyProps=function(e,t){delete t.id,delete t.isDraggable;for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])},i.generateSetFromSelectionNodes=function(e){if(e.filter&&e.filter.isUsed&&e.filter.membersFilter.isUsed){var i=t.MemberChoice.MemberChoiceTreeNode.convertJsObject(e.filter.membersFilter.selectionNodes),n="";if(1===i.length)n=i[0].buildMdx();else{var o=new t.MemberChoice.MemberChoiceTreeNode("artificialRootNode",void 0,void 0,void 0);o.childNodes=i,n=o.buildMdx()}e.filter.membersFilter.set=n}},i.prototype.updateFilterDataItem=function(e,i,n){var o=n.membersChoiceFilterOptions.selectionRootNodes,r=null;if(o)if(1===o.length)r=o[0].buildMdx();else{var a=new t.MemberChoice.MemberChoiceTreeNode("artificialRootNode",void 0,void 0,void 0);a.childNodes=o,r=a.buildMdx()}e.filter={isUsed:n.useMembersChoiceFilter||n.customFilterOptions.isUsed||n.smartCustomFilterDescription.isUsed,membersFilter:{isUsed:n.useMembersChoiceFilter,set:r,selectionNodes:o}},e.filter.smartCustomFilterDescription=n.smartCustomFilterDescription,e.filter.customFilter=n.customFilterOptions,this.onFilterChanged(this.layout,i,e),this.rePaintPanels()},i.prototype.changeMembersFilter=function(e,i){for(var n=null,o=0,r=this._dataItemsFilters;o<r.length;o++){var a=r[o];if("level"===a.type&&a.parentHierarchyId===e){n=a;break}if("hierarchy"===a.type&&a.uniqueName===e){n=a;break}}var s=i,l=null;if(s)if(1===s.length)l=s[0].buildMdx();else{var c=new t.MemberChoice.MemberChoiceTreeNode("artificialRootNode",void 0,void 0,void 0);c.childNodes=s,l=c.buildMdx()}if(null===n)throw new Error("InvalidOperationException");n.filter={isUsed:!0,membersFilter:{isUsed:!0,set:l,selectionNodes:s},customFilter:new t.CustomFilterOptions},this.onFilterChanged(this.layout,t.AreaType.Filters,n),this.rePaintPanels()},i.prototype.onOpenFiltersEditor=function(e,t){this.openFiltersEditor(e.areaType,t)},i.prototype.openFiltersEditor=function(e,i){var n=this,o=null;if("hierarchy"===i.type)o=i;else{if("level"!==i.type)throw new Error("InvalidOperationException");for(var r in this.plainDataSource)if(this.plainDataSource.hasOwnProperty(r)){var a=this.plainDataSource[r];if("hierarchy"===a.type&&a.uniqueName===i.parentHierarchyId){o=a;break}}}if(null===o)throw new Error("InvalidOperationException");var s=this.getFilterOptions(i);s.membersChoiceFilterOptions.isVisibleSlicerButton=e===t.AreaType.Filters,new t.FilterEditorWindow(s,this._treeMeasures,e!==t.AreaType.Filters,o,this._options.container,function(t,o){n.updateFilterDataItem(i,e,o)}).show()},i.prototype.getFilterOptions=function(e){var i,n=this,o=null,r=void 0,a=!1,s=new t.CustomFilterOptions,l=new t.SmartFilter.Options.SmartCustomFilterDescription;if("level"===e.type)i=e.parentHierarchyId,o=e.uniqueName;else{if("hierarchy"!==e.type)throw new Error("NotImplementationException");i=e.uniqueName}null!==e.filter&&(null!==e.filter.membersFilter&&(void 0!==e.filter.membersFilter.selectionNodes&&null!==e.filter.membersFilter.selectionNodes&&(r=t.MemberChoice.MemberChoiceTreeNode.parse(JSON.stringify(e.filter.membersFilter.selectionNodes))),a=e.filter.membersFilter.isUsed),null!==e.filter.customFilter&&(s=e.filter.customFilter),null!==e.filter.smartCustomFilterDescription&&void 0!==e.filter.smartCustomFilterDescription&&(l=t.SmartFilter.Options.SmartCustomFilterDescription.parse(JSON.stringify(e.filter.smartCustomFilterDescription))));var c=new t.MemberChoice.MemberChoiceOptions;c.cubeName=this.cubeName,c.connection=this.connection,c.step=15,c.container=this._options.container,c.hierarchyUniqueName=i,c.startLevelUniqueName=o,c.selectionRootNodes=r,c.events.onCreateSlicer=function(e){n.createNewSlicerControl(e,function(e){n._availableSlicers.push(e)})};var u=new t.FilterOptions;return u.useMembersChoiceFilter=a,u.membersChoiceFilterOptions=c,u.customFilterOptions=s,u.smartCustomFilterDescription=l,u},i.prototype.addRangeDataToPanel=function(e,t){for(var i in t)t.hasOwnProperty(i)&&e.push(t[i])},i.prototype.cutOffExcess=function(e){for(var t=0;t<e.length;t++){var i=e[t];delete i.items,delete i.id,delete i.isDraggable}return e},i.prototype.getActualLayoutItems=function(e){for(var t=new Array,n=0;n<e.length;n++){var o=e[n];"calculatedNamedSet"===o.type||"calculatedMember"===o.type?void 0!==i.findMemberDataInDataSource(this._plainDataSource,o.name,"name")&&t.push(o):t.push(o)}return t},i.prototype.getActualLayout=function(e){return 0!==e.filters.length&&(e.filters=this.getActualLayoutItems(e.filters)),0!==e.columns.length&&(e.columns=this.getActualLayoutItems(e.columns)),0!==e.rows.length&&(e.rows=this.getActualLayoutItems(e.rows)),0!==e.data.length&&(e.data=this.getActualLayoutItems(e.data)),e},i.prototype.initQueryDesigner=function(){var e=this,n=this._options;void 0!==n.layout&&(this.mergeWithDataSource(this._plainDataSource,n.layout),this.localizeItems(n.layout)),this._dataItemsFilters=void 0!==n.layout?n.layout.filters:new Array,this._dataItemsRows=void 0!==n.layout?n.layout.rows:new Array,this._dataItemsColumns=void 0!==n.layout?n.layout.columns:new Array,this._dataItemsData=void 0!==n.layout?n.layout.data:new Array,this._integrityDataManager=new t.IntegrityDataManager(this.dataItemsFilters,this.dataItemsRows,this.dataItemsColumns,this.dataItemsData);var o=function(t){return i.findMemberDataInDataSource(e.plainDataSource,t,"uniqueName").caption},r=new t.AreaItem(t.AreaType.Filters,this.dataItemsFilters,this._options.container,o),a=new t.AreaItem(t.AreaType.Rows,this.dataItemsRows,this._options.container,o),s=new t.AreaItem(t.AreaType.Columns,this.dataItemsColumns,this._options.container,o),l=new t.AreaItem(t.AreaType.Data,this.dataItemsData,this._options.container,o);r.onOpenFilterEditor=a.onOpenFilterEditor=s.onOpenFilterEditor=l.onOpenFilterEditor=this.onOpenFiltersEditor.bind(this),r.onOpenSortingEditor=a.onOpenSortingEditor=s.onOpenSortingEditor=l.onOpenSortingEditor=this.onOpenSortingEditor.bind(this),l.onDroppedItem=r.onDroppedItem=a.onDroppedItem=s.onDroppedItem=this.onDroppedItem.bind(this),l.onDeleteDataItem=r.onDeleteDataItem=a.onDeleteDataItem=s.onDeleteDataItem=this.onDeleteItem.bind(this),l.onStartSortable=r.onStartSortable=a.onStartSortable=s.onStartSortable=this.onStartSortable.bind(this),l.onStopSortable=r.onStopSortable=a.onStopSortable=s.onStopSortable=this.onStopSortable.bind(this),this._filtersPanel=r,this._rowsPanel=a,this._columnsPanel=s,this._dataPanel=l,null!==n.sortingColumnsOptions&&n.sortingColumnsOptions.isUsed?(this._columnsPanel.sortingItems=n.sortingColumnsOptions.sortingByProperty.items,this._columnsPanel.sortingByContext=n.sortingColumnsOptions.sortingByMeasure):(this._columnsPanel.sortingItems=null,this._columnsPanel.sortingByContext=null),null!==n.sortingRowsOptions&&n.sortingRowsOptions.isUsed?(this._rowsPanel.sortingItems=n.sortingRowsOptions.sortingByProperty.items,this._rowsPanel.sortingByContext=n.sortingRowsOptions.sortingByMeasure):(this._rowsPanel.sortingItems=null,this._rowsPanel.sortingByContext=null),n.placementLayoutMode&&(this.placementMode=n.placementLayoutMode),this._layoutButton=this.initLayoutButton().hide(),$(this._panel).append(this._layoutButton),this.renderLayout(),this.createBottomToolBar(),this.isEnabled=n.isEnabled,this.refreshSlicerLabel(),0===this.dataItemsFilters.length&&0===this.dataItemsRows.length&&0===this.dataItemsColumns.length&&0===this.dataItemsData.length||this.rePaintPanels()},i.prototype.onFilterChanged=function(e,t,i){this._options.hasOwnProperty("onFilterChanged")&&this._options.onFilterChanged(e,t,i)},i.prototype.findReferenceLayoutItem=function(e,t){for(var i=0;i<e.length;i++)if(t.type===e[i].type&&t.uniqueName===e[i].uniqueName)return e[i];throw new Error("InvalidOperationException")},i.prototype.deleteActiveFilter=function(i,n){e.UserActionsTracker.track("Disable active filters.",{areatype:i});var o=void 0;switch(i){case t.AreaType.Filters:o=this.findReferenceLayoutItem(this._filtersPanel.dataItems,n);break;case t.AreaType.Rows:o=this.findReferenceLayoutItem(this._rowsPanel.dataItems,n);break;case t.AreaType.Columns:o=this.findReferenceLayoutItem(this._columnsPanel.dataItems,n);break;default:throw new Error("NotImplementedException")}o.filter.isUsed=!1,o.filter.customFilter.isUsed=!1,o.filter.membersFilter.isUsed=!1,this.onFilterChanged(this.layout,i,o),this.rePaintPanels()},i.prototype.showFilterEditor=function(e,i){var n=void 0;switch(e){case t.AreaType.Filters:n=this.findReferenceLayoutItem(this._filtersPanel.dataItems,i);break;case t.AreaType.Rows:n=this.findReferenceLayoutItem(this._rowsPanel.dataItems,i);break;case t.AreaType.Columns:n=this.findReferenceLayoutItem(this._columnsPanel.dataItems,i);break;default:throw new Error("NotImplementedException")}this.openFiltersEditor(e,n)},Object.defineProperty(i.prototype,"isVisibleLayoutButton",{get:function(){return this._isVisibleLayoutButton},set:function(e){e?this.showLayoutButton():this.hideLayoutButton()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layoutDropdownItems",{get:function(){return this._layoutDropDownItems},set:function(e){this._layoutDropDownItems=e;for(var t=$(this._panel).find(".dropdown-menu").empty(),i=0;i<this._layoutDropDownItems.length;i++){var n=$("<li/>").on("click",this._layoutDropDownItems[i].onSelected),o=$("<a/>").text(this._layoutDropDownItems[i].title);n.append(o),t.append(n)}},enumerable:!0,configurable:!0}),i.prototype.initLayoutButton=function(){for(var t=$("<div/>").addClass("btn-group default-dropdown layout-button").css("z-index","100"),i=$("<button/>").addClass("btn btn-default dropdown-toggle").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false").attr("title",e.Localization.localize("LayoutsOfDesignerButton_ToolTip")),n=$("<ul/>").addClass("dropdown-menu"),o=0;o<this._layoutDropDownItems.length;o++){var r=$("<li/>").on("click",this._layoutDropDownItems[o].onSelected),a=$("<a/>"),s=$("<div class='"+this._layoutDropDownItems[o].icon+" queryDesigner-dropDownImage'></div>"),l=$("<span>"+this._layoutDropDownItems[o].title+"</span>");a.append(s),a.append(l),r.append(a),n.append(r)}var c=$("<div/>").addClass("button-contentImage imageLibrary_designPanel");return t.append(i),i.append(c),t.append(n),t},i.prototype.showLayoutButton=function(){this._layoutButton&&this._layoutButton.show(),$(this._panel).find(".queryDesigner-layoutViewer").addClass("visible-layout-button"),this._isVisibleLayoutButton=!0},i.prototype.hideLayoutButton=function(){this._layoutButton&&this._layoutButton.hide(),$(this._panel).find(".queryDesigner-layoutViewer").removeClass("visible-layout-button"),this._isVisibleLayoutButton=!1},i.prototype.refreshSlicerLabel=function(){var e=this;null!==this._$slicerLabel&&this._$slicerLabel.remove();var t=$("<div/>").css("position","absolute").css("top",0).css("right",0),i=$("<div/>").addClass("dropdown-toggle").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false");i.append('<div class="queryDesigner-slicerLabel">'+this._availableSlicers.length+"</div>");for(var n=$("<ul/>").addClass("dropdown-menu"),o=0;o<this._availableSlicers.length;o++){var r=this._availableSlicers[o],a=$("<li/>").on("click",function(){for(var t=null,i=0;i<e._filtersPanel.dataItems.length;i++){var n=e._filtersPanel.dataItems[i];if(null!==n.filter&&null!==n.filter.membersFilter){if("level"===n.type&&n.parentHierarchyId===r.hierarchyUniqueName){t=n.filter.membersFilter.selectionNodes;break}if("hierarchy"===n.type&&n.uniqueName===r.hierarchyUniqueName){t=n.filter.membersFilter.selectionNodes;break}}}e.showSlicerControl(r,t)}),s=$("<a/>"),l=$("<span>"+r.caption+"</span>");s.append(l),a.append(s),n.append(a)}t.append(i),t.append(n),this._$slicerLabel=t,this._availableSlicers.length>0&&this._filtersPanel.view.append(t)},Object.defineProperty(i.prototype,"availableSlicers",{get:function(){return this._availableSlicers},enumerable:!0,configurable:!0}),i.prototype.createNewSlicerControl=function(i,n){var o=this,r=new t.Slicer.SlicerSettingsControl,a=new t.Windows.FloatingWindowOptions;a.content=r.view,a.title=e.Localization.localize("WindowTitleSlicerSettings"),a.size=t.Windows.WindowSize.Small,a.container=this._options.container,a.onClosed=function(e,a){if(!1!==a.dialogResult){var s=new t.AvailableSlicerDescription(i.caption,i.uniqueName,i.hierarchyUniqueName,r.maxHeight,r.columnCount,r.buttonWidth);n(s),o.showSlicerControl(s,i.selectionTree)}},new t.Windows.FloatingWindow(a).show()},i.prototype.showSlicerControl=function(e,i){var n=this,o=this;if(!(this._slicers.filter(function(t){return t.levelUniqueName===e.uniqueName}).length>0)){var r=new t.Slicer.SlicerControlOptions;r.maxHeight=e.maxHeight,r.columnCount=e.columnCount,r.buttonWidth=e.buttonWidth,r.container=this._options.container,r.cubeName=this._options.cubeName,r.connection=this._options.connection,r.header=e.caption,r.startSelectionTree=i,r.levelUniqueName=e.uniqueName,r.hierarchyUniqueName=e.hierarchyUniqueName;var a=new t.Slicer.SlicerControl(r);o._slicers.push(a),a.onStateChanged.on(function(e){o.changeMembersFilter(e.e.hierarchyUniqueName,e.e.selectionMembersTree)}),a.onSlicerDeleted.on(function(e){var t=n._availableSlicers.filter(function(t){return t.uniqueName===e.sender.levelUniqueName})[0];o._availableSlicers.splice(o._availableSlicers.indexOf(t),1),o._slicers.splice(o._slicers.indexOf(e.sender),1),n.refreshSlicerLabel()}),a.onSettingsChanged.on(function(e){var t=n._availableSlicers.filter(function(t){return t.uniqueName===e.sender.levelUniqueName})[0];t.buttonWidth=e.newSettings.defaultButtonWidth,t.columnCount=e.newSettings.defaultColumnCount,t.maxHeight=e.newSettings.defaultMaxHeight}),a.onSlicerMinimized.on(function(e){o._slicers.splice(o._slicers.indexOf(e.sender),1)}),this._options.container.append(a.view),o.refreshSlicerLabel()}},i.prototype.deleteSlicerByHierarchy=function(e){var t=this._slicers.filter(function(t){return t.hierarchyUniqueName===e})[0];if(t)t.remove();else{var i=this._availableSlicers.filter(function(t){return t.hierarchyUniqueName===e})[0];this._availableSlicers.splice(this._availableSlicers.indexOf(i),1)}},i.prefiximageLibrary="imageLibrary_",i}();t.QueryDesigner=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetQueryDesigner=function(t,i){var n,o=this,r={},a=this;a.settings={},this.getLayout=function(){return n.layout},this.getAvailableSlicers=function(){return n.availableSlicers},this.initQueryDesigner=function(){n.initQueryDesigner()},a.init=function(){o.settings=e.extend({},r,i),n=new Ranet.Controls.QueryDesigner(t,i)},a.deleteActiveFilter=function(e,t){n.deleteActiveFilter(e,t)},a.showFilterEditor=function(e,t){n.showFilterEditor(e,t)},a.option=function(e){e.hasOwnProperty("layout")&&(n.layout=e.layout),e.hasOwnProperty("dataSource")&&(n.plainDataSource=e.dataSource),e.hasOwnProperty("placementMode")&&(n.placementMode=e.placementMode),e.hasOwnProperty("treeMeasures")&&(n.treeMeasures=e.treeMeasures),e.hasOwnProperty("isEnabled")&&(n.isEnabled=e.isEnabled),e.hasOwnProperty("sortingRowsOptions")&&(n.sortingRowsOptions=e.sortingRowsOptions),e.hasOwnProperty("sortingColumnsOptions")&&(n.sortingColumnsOptions=e.sortingColumnsOptions)},a.isVisibleLayoutButton=function(e){if(void 0===e)return n.isVisibleLayoutButton;n.isVisibleLayoutButton=e},a.init()},e.fn.ranetQueryDesigner=function(t){return this.each(function(){if(void 0==e(this).data("ranetQueryDesigner")){var i=new e.ranetQueryDesigner(this,t);e(this).data("ranetQueryDesigner",i)}})}}(jQuery);var Ranet;!function(e){!function(e){var t=function(){return function(){this.isEnabled=!0,this.autoExecuteQuery=!0}}();e.QueryDesignerOptions=t}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function i(e,i,n,o){this._connection=e,this._cubeName=i,this._hierarchyUniqueName=n,this._levelUniqueName=o,this._queryManager=new t.QueryManager(this._cubeName,this._hierarchyUniqueName,this._levelUniqueName)}return i.prototype.getMemberCount=function(){var t=$.Deferred();return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/memberchoice/getMemberCount",data:{connection:this._connection,query:this._queryManager.getCountMembersQuery()},success:function(e){t.resolve(e)},error:function(i){e.LogService.error(i),e.UserMessageService.showServerError(i),t.reject(i)}}),t},i.prototype.getMembers=function(t){var i=$.Deferred();return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/memberchoice/getMembers",data:{connection:this._connection,query:this._queryManager.getMembersQuery(t)},success:function(e){i.resolve(e)},error:function(t){e.LogService.error(t),e.UserMessageService.showServerError(t),i.reject(t)}}),i},i}();t.DataManager=i}(t.Slicer||(t.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i){this._cubeName=e,this._hierarchyUniqueName=t,this._levelUniqueName=i}return e.prototype.getCountMembersQuery=function(){return"WITH  MEMBER[Measures].__ROslicermembercount as "+this._levelUniqueName+".MEMBERS.Count SELECT {[Measures].__ROslicermembercount } ON 0 FROM "+this._cubeName+" CELL PROPERTIES VALUE"},e.prototype.getMembersQuery=function(e){return"SELECT SUBSET("+this._levelUniqueName+".MEMBERS, 0, "+(e+1)+") DIMENSION PROPERTIES KEY0, HIERARCHY_UNIQUE_NAME ON 0 FROM "+this._cubeName},e}();e.QueryManager=t}(e.Slicer||(e.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(){function t(t){this._memberData=t,this._onStateChanged=new e.Events.LiteEvent;var i=$("<div style='white-space: nowrap; text-overflow: ellipsis; overflow-x: hidden;'/>");i.append(this._memberData.caption),this._viewContent=i;var n=$('<button type="button" class="btn btn-default" style="margin-right:3px;margin-bottom:3px;"></button>');n.append(i),this._view=n}return Object.defineProperty(t.prototype,"onStateChanged",{get:function(){return this._onStateChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memberData",{get:function(){return this._memberData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{get:function(){return this._view.hasClass("active")},set:function(e){e?!1===this._view.hasClass("active")&&this._view.addClass("active"):this._view.removeClass("active")},enumerable:!0,configurable:!0}),t.prototype.onClick=function(){this._view.toggleClass("active"),this._onStateChanged.trigger({sender:this,e:{memberData:this._memberData,newState:this._view.hasClass("active")}})},t.prototype.getView=function(e){return this._viewContent.css("width",e),this._view.unbind(),this._view.on("click",this.onClick.bind(this)),this._view},t}();t.SlicerItem=i}(e.Slicer||(e.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.SlicerSettingsControlOptions=t}(e.Slicer||(e.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.SlicerStateChangedArgs=t}(e.Slicer||(e.Slicer={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n=function(){function n(e,t,i){this._sortingHierarchyDescription=null,this._$template=e,this._hierarchyDescription=t,void 0!==i&&(this._sortingHierarchyDescription=i),this._$propertyDropDown=this._$template.find(".sortOptionsEditor-propertySelector"),this._$sortingDirectionDropDown=this._$template.find(".sortOptionsEditor-sortingDirectionSelector"),this._$hierarchyLabel=this._$template.find(".sortOptionsEditor-hierarchyCaption")}return Object.defineProperty(n.prototype,"sortingDescription",{get:function(){var e=new i.SortingHierarchyDescription;return e.hierarchyUniqueName=this._hierarchyDescription.uniqueName,e.direction=this._directionSelector.selectedItem.direction,e.property=this._propertySelector.selectedItem.property,e},enumerable:!0,configurable:!0}),n.prototype.init=function(){this._propertySelector=new t.DropDownControl,this._propertySelector.displayPropertyExpr="caption",this._propertySelector.imageCssClassExp="iconClass",this._propertySelector.selectedExpr="isSelected",this._propertySelector.itemSource=this.getProperties(),this._$propertyDropDown.append(this._propertySelector.view),this._directionSelector=new t.DropDownControl,this._directionSelector.displayPropertyExpr="caption",this._directionSelector.imageCssClassExp="iconClass",this._directionSelector.selectedExpr="isSelected",this._directionSelector.itemSource=this.getDirections(),this._$sortingDirectionDropDown.append(this._directionSelector.view),this._$hierarchyLabel.text(this._hierarchyDescription.caption)},n.prototype.getDirections=function(){var t=new Array,n=new a;n.caption=e.Localization.localize("Sorting_None_Label"),n.iconClass="imageLibrary_sortingDirectionNone",n.isSelected=!1,n.direction=i.SortingDirection.None;var o=new a;o.caption=e.Localization.localize("Sorting_Ascending_Label"),o.iconClass="imageLibrary_sortingDirectionAscending",o.isSelected=!1,o.direction=i.SortingDirection.Ascending;var r=new a;if(r.caption=e.Localization.localize("Sorting_Descending_Label"),r.iconClass="imageLibrary_sortingDirectionDescending",r.isSelected=!1,r.direction=i.SortingDirection.Descending,null===this._sortingHierarchyDescription)n.isSelected=!0;else if(this._sortingHierarchyDescription.direction===i.SortingDirection.Ascending)o.isSelected=!0;else{if(this._sortingHierarchyDescription.direction!==i.SortingDirection.Descending)throw new Error("InvalidOperationException");r.isSelected=!0}return t.push(n),t.push(o),t.push(r),t},n.prototype.getProperties=function(){var t=new Array,n=new r;n.caption=e.Localization.localize("Caption"),n.iconClass="imageLibrary_sortingProperty",n.isSelected=!1,n.property=i.HierarchyProperty.Caption;var o=new r;if(o.caption="Key0",o.iconClass="imageLibrary_sortingProperty",o.isSelected=!1,o.property=i.HierarchyProperty.Key0,null===this._sortingHierarchyDescription)n.isSelected=!0;else if(this._sortingHierarchyDescription.property===i.HierarchyProperty.Caption)n.isSelected=!0;else{if(this._sortingHierarchyDescription.property!==i.HierarchyProperty.Key0)throw new Error("InvalidOperationException");o.isSelected=!0}return t.push(n),t.push(o),t},n}();i.SortingHierarchyControl=n;var o=function(){return function(){}}(),r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(o),a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(o)}(t.SortingOptionsPivotTable||(t.SortingOptionsPivotTable={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(i){var n;!function(e){e[e.Columns=0]="Columns",e[e.Rows=1]="Rows"}(n||(n={}));var o=function(){function o(t){this.options=t,this._$view=$("<div/>"),this._sortingHerarchyControlsColumns=new Array,this._sortingHerarchyControlsRows=new Array,o._directoryTemplate=e.PathManager.templatesPath;var i=this;this.getTemplate().done(function(e){i._$view.append(e.$rootLayout),i._templateDescription=e,i.syncStateWithOptions(e.$sortingHierarchyTemplate,e.columns,t.measuresTree,t.sortingColumnsOptions,n.Columns),i.syncStateWithOptions(e.$sortingHierarchyTemplate,e.rows,t.measuresTree,t.sortingRowsOptions,n.Rows),i.initInteraction()})}return o.syncStateWithSortingMode=function(e,t){switch(t){case i.SortingMode.SortingByContext:e.sortByContext.$panel.show(),e.sortByProperty.$panel.hide();break;case i.SortingMode.SortingByProperty:e.sortByContext.$panel.hide(),e.sortByProperty.$panel.show();break;default:throw new Error("InvalidOperationException")}},o.prototype.setStateEditor=function(e,t){if(t===n.Columns)e?this._templateDescription.$rootLayout.find("#columns .sortOptionsEditor-partPanel").removeClass("disabled"):this._templateDescription.$rootLayout.find("#columns .sortOptionsEditor-partPanel").addClass("disabled");else{if(t!==n.Rows)throw new Error("InvalidOperationException");e?this._templateDescription.$rootLayout.find("#rows .sortOptionsEditor-partPanel").removeClass("disabled"):this._templateDescription.$rootLayout.find("#rows .sortOptionsEditor-partPanel").addClass("disabled")}},o.prototype.initInteraction=function(){var e=this;this._templateDescription.columns.$useSortingCheckBox.click(function(){e._templateDescription.columns.$useSortingCheckBox.is(":checked")?e.setStateEditor(!0,n.Columns):e.setStateEditor(!1,n.Columns)}),this._templateDescription.rows.$useSortingCheckBox.click(function(){e._templateDescription.rows.$useSortingCheckBox.is(":checked")?e.setStateEditor(!0,n.Rows):e.setStateEditor(!1,n.Rows)});var t=function(e){if(e.$setByPropertySortModeCheckBox.is(":checked"))o.syncStateWithSortingMode(e,i.SortingMode.SortingByProperty);else{if(!e.$setByContextSortModeCheckBox.is(":checked"))throw new Error("NotInvalidException");o.syncStateWithSortingMode(e,i.SortingMode.SortingByContext)}};this._templateDescription.columns.$setByPropertySortModeCheckBox.click(function(){t(e._templateDescription.columns)}),this._templateDescription.columns.$setByContextSortModeCheckBox.click(function(){t(e._templateDescription.columns)}),this._templateDescription.rows.$setByPropertySortModeCheckBox.click(function(){t(e._templateDescription.rows)}),this._templateDescription.rows.$setByContextSortModeCheckBox.click(function(){t(e._templateDescription.rows)})},Object.defineProperty(o.prototype,"sortingRowsOptions",{get:function(){return this.getCurrentState(this._templateDescription.rows,n.Rows)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sortingColumnsOptions",{get:function(){return this.getCurrentState(this._templateDescription.columns,n.Columns)},enumerable:!0,configurable:!0}),o.prototype.getCurrentState=function(e,t){if(!1===e.$useSortingCheckBox.is(":checked"))return null;var n;if(e.$setByPropertySortModeCheckBox.is(":checked"))n=i.SortingMode.SortingByProperty;else{if(!e.$setByContextSortModeCheckBox.is(":checked"))throw new Error("InvalidOperationException");n=i.SortingMode.SortingByContext}var o=new i.SortingDescription;if(o.isUsed=e.$useSortingCheckBox.is(":checked"),n===i.SortingMode.SortingByContext)o.sortingByMeasure=this.getSortingDescriptionByMeasure(e,t);else{if(n!==i.SortingMode.SortingByProperty)throw new Error("InvalidOperationException");o.sortingByProperty=this.getSortingDescriptionByProperty(t)}return null===o.sortingByMeasure&&n===i.SortingMode.SortingByContext&&(o.isUsed=!1),0===o.sortingByProperty.items.length&&n===i.SortingMode.SortingByProperty&&(o.isUsed=!1),o.mode=n,o},o.prototype.getSortingDescriptionByProperty=function(e){var t,o=new i.SortingByPropertyModel;switch(e){case n.Rows:t=this._sortingHerarchyControlsRows;break;case n.Columns:t=this._sortingHerarchyControlsColumns;break;default:throw new Error("InvalidOpearionException")}for(var r=0;r<t.length;r++){var a=t[r].sortingDescription;a.direction!==i.SortingDirection.None&&o.items.push(a)}return o},o.prototype.getSortingDescriptionByMeasure=function(e,t){var o=new i.SortingByMeasureModel;return e.sortByContext.$useSortingByMemberCheckBox.is(":checked")?o.members=t===n.Columns?this.options.sortingColumnsOptions.sortingByMeasure.members:this.options.sortingRowsOptions.sortingByMeasure.members:o.members=null,e.sortByContext.$useSortingByMeasureCheckbox.is(":checked")?o.measureUniqueName=t===n.Columns?this._measureChoiceSelectorColumns.selectedUniqueNames[0]:this._measureChoiceSelectorRows.selectedUniqueNames[0]:o.measureUniqueName=null,null===o.measureUniqueName&&null===o.members?null:(o.direction=e.$setAscendingRadio.is(":checked")?i.SortingDirection.Ascending:i.SortingDirection.Descending,o)},o.prototype.syncStateWithOptions=function(o,r,a,s,l){var c=new t.MeasureChoiceOptions(a,!1);c.isMultiSelect=!1;var u=this;c.getPopupContainer=function(){return u._$view.closest(".ranetDynamicPivotGrid")};for(var p=l===n.Columns?this.options.hierarchiesColumnsPanel:this.options.hierarchiesRowsPanel,h=0;h<p.length;h++){var d=p[h],m=s.sortingByProperty.items.filter(function(e){return e.hierarchyUniqueName===d.uniqueName})[0],f=o.clone(),g=new i.SortingHierarchyControl(f,d,m);if(g.init(),l===n.Columns)this._sortingHerarchyControlsColumns.push(g);else{if(l!==n.Rows)throw new Error("InvalidOperationException");this._sortingHerarchyControlsRows.push(g)}r.sortByProperty.$panel.append(f)}if(s.isUsed)if(r.$useSortingCheckBox.prop("checked",!0),s.mode===i.SortingMode.SortingByContext){if(r.$setByContextSortModeCheckBox.prop("checked",!0),r.sortByProperty.$panel.hide(),r.sortByContext.$panel.show(),r.$useSortingCheckBox.prop("checked",!0),this.setStateEditor(!0,l),s.sortingByMeasure.direction===i.SortingDirection.Ascending)r.$setAscendingRadio.prop("checked",!0);else{if(s.sortingByMeasure.direction!==i.SortingDirection.Descending)throw new Error("InvalidOperationException");r.$setDescendingRadio.prop("checked",!0)}null!==s.sortingByMeasure.members&&s.sortingByMeasure.members.length>0?(r.sortByContext.$useSortingByMemberCheckBox.prop("checked",!0),r.sortByContext.$sortingByMemberPanel.show(),r.sortByContext.$sortingByMemberLabel.text(e.Localization.localize("SortingEditor_SetSortingByMember")+' "'+s.sortingByMeasure.members.map(function(e){return e.caption}).join(", ")+'"')):r.sortByContext.$sortingByMemberPanel.hide(),null!==s.sortingByMeasure.measureUniqueName?(r.sortByContext.$useSortingByMeasureCheckbox.prop("checked",!0),c.selectedUniqueNames=[s.sortingByMeasure.measureUniqueName]):r.sortByContext.$useSortingByMeasureCheckbox.prop("checked",!1)}else{if(s.mode!==i.SortingMode.SortingByProperty)throw new Error("InvalidOperationException");r.$setByPropertySortModeCheckBox.prop("checked",!0),r.sortByContext.$panel.hide(),r.sortByProperty.$panel.show()}else r.$useSortingCheckBox.prop("checked",!1),this.setStateEditor(!1,l);var _=new t.MeasureChoiceSelector(r.sortByContext.$sortingByMeasureSelector.get(0),c);if(l===n.Columns)this._measureChoiceSelectorColumns=_;else{if(l!==n.Rows)throw new Error("InvalidOperationException");this._measureChoiceSelectorRows=_}_.init()},Object.defineProperty(o.prototype,"view",{get:function(){return this._$view},enumerable:!0,configurable:!0}),o.prototype.getTemplate=function(){var t=$.Deferred();return $.when($.ajax({url:o._directoryTemplate+"sort-options-editor.html"}),$.ajax({url:o._directoryTemplate+"sort-hierarchy-template.html"})).done(function(i,n){var o=$(e.Localization.localizeTemplate(i[0])),r=$(e.Localization.localizeTemplate(n[0])),a=o.find("#columns .sortOptionsEditor-usingSortingSwitcher"),s=o.find('#columns input[value="ascending"]'),l=o.find('#columns input[value="descending"]'),c=o.find("#columns .sortOptionsEditor-usingSortingByMemberPanel"),u=c.find(".sortOptionsEditor-inputLabel"),p=c.find("input"),h=o.find("#columns .sortOptionsEditor-usingSortingByMeasurePanel"),d=h.find("input"),m=h.find(".sortOptionsEditor-measureSelector"),f=o.find("#rows .sortOptionsEditor-usingSortingSwitcher"),g=o.find('#rows input[value="ascending"]'),_=o.find('#rows input[value="descending"]'),y=o.find('#rows input[value="byProperty"]'),v=o.find('#rows input[value="byContext"]'),C=o.find("#rows .sortOptionsEditor-sortByContextPanel"),b=o.find("#rows .sortOptionsEditor-sortByPropertyPanel"),w=o.find('#columns input[value="byProperty"]'),S=o.find('#columns input[value="byContext"]'),x=o.find("#columns .sortOptionsEditor-sortByContextPanel"),D=o.find("#columns .sortOptionsEditor-sortByPropertyPanel"),T=o.find("#rows .sortOptionsEditor-usingSortingByMemberPanel"),P=T.find(".sortOptionsEditor-inputLabel"),I=T.find("input"),M=o.find("#rows .sortOptionsEditor-usingSortingByMeasurePanel"),E=M.find("input"),F=M.find(".sortOptionsEditor-measureSelector");t.resolve({$rootLayout:o,$sortingHierarchyTemplate:r,columns:{$useSortingCheckBox:a,$setAscendingRadio:s,$setDescendingRadio:l,$setByPropertySortModeCheckBox:w,$setByContextSortModeCheckBox:S,sortByContext:{$panel:x,$sortingByMemberPanel:c,$sortingByMemberLabel:u,$useSortingByMemberCheckBox:p,$useSortingByMeasureCheckbox:d,$sortingByMeasureSelector:m},sortByProperty:{$panel:D}},rows:{$useSortingCheckBox:f,$setAscendingRadio:g,$setDescendingRadio:_,$setByPropertySortModeCheckBox:y,$setByContextSortModeCheckBox:v,sortByContext:{$panel:C,$sortingByMemberPanel:T,$sortingByMemberLabel:P,$useSortingByMemberCheckBox:I,$useSortingByMeasureCheckbox:E,$sortingByMeasureSelector:F},sortByProperty:{$panel:b}}})}).fail(function(i){e.LogService.error(i),t.reject(i)}),t},o}();i.SortOptionsEditorControl=o}(t.SortingOptionsPivotTable||(t.SortingOptionsPivotTable={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=e.Controls.MemberChoice.MemberChoiceTreeNode,n=e.Controls.CustomFilterOptions,o=function(){function e(){}return e.getFilterTreeWhereItemSelectedSelf=function(e){var t=null,n=null;if(null!==e.parents)for(var o=0;o<e.parents.length;o++){var r=e.parents[o],a=new i(r.uniqueName,void 0,void 0,void 0);null===t||null===n?t=n=a:(n.childNodes=new Array(a),n=a)}return null===n?t=new i(e.uniqueName,!0,void 0,void 0):n.childNodes=new Array(new i(e.uniqueName,!0,void 0,void 0)),t},e.getFilterTreeWhereItemsSelectedSelf=function(e){for(var t=new Array,n={},o=0;o<e.length;o++){var r=e[o],a=null;if(null!==r.parents)for(var s=0;s<r.parents.length;s++){var l,c=r.parents[s];n.hasOwnProperty(c.uniqueName)?l=n[c.uniqueName]:(l=new i(c.uniqueName,void 0,void 0,void 0),n[c.uniqueName]=l,0===s&&0===t.filter(function(e){return e.uniqueName===l.uniqueName}).length&&t.push(l)),null!==a&&-1===a.childNodes.indexOf(l)&&a.childNodes.push(l),a=l}var u=void 0;n.hasOwnProperty(r.uniqueName)?(u=n[r.uniqueName],n[r.uniqueName].selectedSelf=!0):u=new i(r.uniqueName,!0,void 0,void 0),null!==a?a.childNodes.push(u):t.push(u)}return t},e.getFilterInstance=function(e){return{isUsed:!0,membersFilter:{isUsed:!0,selectionNodes:e},customFilter:new n}},e.getActionsAfterDrillDownByHierarchy=function(e,t,i){var n=Array();for(var o in e)if(e.hasOwnProperty(o)){var r=e[o];r.header.axisType!==i&&n.push(r)}var a={};return a.actionType="expand",a.header={},a.header.axisType=i,a.header.uniqueName=t.defaultMember,a.header.hierarchyUniqueName=t.uniqueName,n.push(a),n},e.getLayoutAfterDetailedCellsAnalysisCurrentStructure=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){for(var n=0;n<e.rows.length;n++){var o=e.rows[n];if("hierarchy"===o.type&&o.uniqueName===i){o.filter=this.getFilterInstance(t[i]);break}if("level"===o.type&&o.parentHierarchyId===i){o.filter=this.getFilterInstance(t[i]);break}}for(var r=0;r<e.columns.length;r++){var a=e.columns[r];if("hierarchy"===a.type&&a.uniqueName===i){a.filter=this.getFilterInstance(t[i]);break}if("level"===a.type&&a.parentHierarchyId===i){a.filter=this.getFilterInstance(t[i]);break}}}return e},e.getLayoutAfterDetailedCellsAnalysisFilterAxis=function(e,t){var i=e.rows.filter(function(e){return"values"===e.type}),n=e.columns.filter(function(e){return"values"===e.type});e.rows.length=0,e.columns.length=0,0!==i.length?e.rows.push(i[0]):0!==n.length&&e.columns.push(n[0]);for(var o in t)t.hasOwnProperty(o)&&e.filters.push({type:"hierarchy",uniqueName:o,filter:this.getFilterInstance(t[o])});return e},e.getLayoutAfterDrillDownByHierarchy=function(e,t,i,n){var o;if("rows"===n)o=e.rows;else{if("columns"!==n)throw new Error("InvalidOperationException");o=e.columns}o.length=0,o.push({type:"hierarchy",uniqueName:t.uniqueName});for(var r in i)if(i.hasOwnProperty(r)){var a=void 0;for(var s in e.filters)if(e.filters.hasOwnProperty(s)){var l=e.filters[s];if("level"===l.type&&l.parentHierarchyId===r){a=l;break}if("hierarchy"===l.type&&l.uniqueName===r){a=l;break}}void 0!==a?a.filter=this.getFilterInstance(new Array(i[r])):e.filters.push({type:"hierarchy",uniqueName:r,filter:this.getFilterInstance(new Array(i[r]))})}return e},e}();t.DynamicPivotGridHelper=o}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(){}return e.filterMeasureGroupMetadata=function(t,i){if(!i)return t;for(var n=new Array,o=0;o<t.length;o++){var r=t[o];if("kpiRootNode"!==r.type)if("measuresRootNode"!==r.type)if("setsRootNode"!==r.type)if("customCalculations"!==r.type){if("dimension"===r.type)for(var a=0;a<i.dimensions.length;a++)i.dimensions[a]===r.uniqueName&&n.push(r)}else n.push(r);else n.push(r);else{var s=e.getNewMeasureNode(r,i.measures);s.items.length>0&&n.push(s)}else{var l=e.getNewKpiNode(r,i.kpis);l.items.length>0&&n.push(l)}}return n},e.getNewMeasureNode=function(t,i){var n=jQuery.extend(!0,{},t);return n.items=e.getNodeChildren(t.items,i,"measure","uniqueName"),n},e.getNewKpiNode=function(t,i){var n=jQuery.extend(!0,{},t);return n.items=e.getNodeChildren(t.items,i,"kpiInfo","caption"),n},e.getNodeChildren=function(t,i,n,o){for(var r=new Array,a=0;a<t.length;a++){var s=t[a];if("folder"===s.type){if(this.canIncludeFolder(s,i,o)){var l=jQuery.extend(!0,{},s);l.items=new Array,l.items=e.getNodeChildren(s.items,i,n,o),r.push(l)}}else if(s.type===n)for(var c=0;c<i.length;c++)s[o]===i[c]&&r.push(s)}return r},e.canIncludeFolder=function(e,t,i){for(var n=0;n<e.items.length;n++){var o,r=e.items[n];if("folder"!==r.type){for(o=0;o<t.length;o++)if(t[o]===r[i])return!0}else for(o=0;o<e.items.length;o++)if(this.canIncludeFolder(e.items[o],t,i))return!0}return!1},e}();e.TreeMetadataHelper=t}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"templatesPath",{get:function(){return e._templatesPath},enumerable:!0,configurable:!0}),Object.defineProperty(e,"resourcePath",{get:function(){return e._resourcePath},set:function(t){e._resourcePath=t,e._templatesPath=e._resourcePath+"templates/",e._mapsPath=e._resourcePath+"maps/"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mapPath",{get:function(){return e._mapsPath},enumerable:!0,configurable:!0}),Object.defineProperty(e,"applicationUrl",{get:function(){return e._applicationUrl},set:function(t){e._applicationUrl=t},enumerable:!0,configurable:!0}),e._resourcePath="/assets/",e._mapsPath="/assets/maps/",e._templatesPath="/assets/templates/",e._applicationUrl="/",e}();e.PathManager=t}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.palettes={default:["#565077","#6babac","#cbc87b","#9ab57e","#e55253","#7e4452","#e8c267"],pastel:["#ab394b","#dac599","#153459","#bb7862","#70b3a1","#bb626a","#057d85"],softpastel:["#90ba58","#456c68","#60a69f","#78b6d9","#6682bb","#a37182","#eeba69"]},e}();e.PaletteCollection=t;var i=function(){function e(e){this._currentPalette=e?t.palettes[e.toLowerCase()]:t.palettes["Default".toLowerCase()]}return e.prototype.getColor=function(e,t){t||(t=this._currentPalette.length);var i=e%t;return this._currentPalette[i]},e.prototype.checkForRepeating=function(e,t){return(e-1)%t==0},e.prototype.getRecomendedColorNumber=function(e,t){return t||(t=this._currentPalette.length),1===t?this._currentPalette.length:this.checkForRepeating(e,t)?this.getRecomendedColorNumber(e,t-1):t},e.prototype.getRecomendedColor=function(e,t,i){var n=this.getRecomendedColorNumber(t,i);return this.getColor(e,n)},e}();e.ColorGenerator=i;var n=function(){function e(){}return e.getColor=function(e,i,n){var o=t.palettes[e];return n||(n=o.length),o[i%n]},e.checkForRepeating=function(e,t){return(e-1)%t==0},e.getRecomendedColorNumber=function(e,i,n){var o=t.palettes[e];return n||(n=o.length),1===n?o.length:this.checkForRepeating(i,n)?this.getRecomendedColorNumber(e,i,n-1):n},e}();e.ColorGeneratorStatic=n}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.getPieData=function(t,i){for(var n=[],o=t.cells.values,r=t.cells.displayValues,a=new e.ColorGenerator(i),s=a.getRecomendedColorNumber(t.rows.positions.length),l=0;l<t.rows.positions.length;l++){for(var c="",u=0;u<t.rows.positions[l].positions.length;u++)""!==c&&(c+=", "),c+=t.rows.members[t.rows.positions[l].positions[u].id].caption;for(var p=c,h=0;h<t.columns.positions.length;h++){var d={};d.label=p,n[h]||(n[h]=[]);var m=o[l][h],f=r[l][h];null===m?d.value=0:m.toFixed?d.value=parseFloat(m.toFixed(3)):d.value=0,d.displayValue=f||"0",d.color=a.getColor(l,s);var g=this.getRowDescription(t,l),_=this.getColumnDescription(t,h);d.data={row:g,column:_},n[h].push(d)}}return n},t.getRowDescription=function(e,t){for(var i={},n=e.rows.positions[t].positions[0].id,o=e.rows.members[n],r="",a=0;a<e.rows.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.rows.members[e.rows.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.rows.hierarchies[0],i.place="rows",i.endRow=i.startRow=t,i.column=0,i.ancestors=[],i.data=o,i},t.getColumnDescription=function(e,t){for(var i={},n=e.columns.positions[t].positions[0].id,o=e.columns.members[n],r="",a=0;a<e.columns.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.columns.members[e.columns.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.columns.hierarchies[0],i.place="columns",i.endColumn=i.startColumn=t,i.row=0,i.ancestors=[],i.data=o,i},t.getPieLegendItems=function(t,i){for(var n=new e.ColorGenerator(i),o=n.getRecomendedColorNumber(t.rows.positions.length),r=[],a=0;a<t.rows.positions.length;a++){for(var s="",l=0;l<t.rows.positions[a].positions.length;l++)""!==s&&(s+=", "),s+=t.rows.members[t.rows.positions[a].positions[l].id].caption;r.push({name:s,color:n.getColor(a,o),visible:!0})}return r},t.getPieTitles=function(e){for(var t,i=[],n=0;n<e.columns.positions.length;n++){var o="";for(t=0;t<e.columns.positions[n].positions.length;t++)""!==o&&(o+=", "),o+=e.columns.members[e.columns.positions[n].positions[t].id].caption;i.push(o)}return i},t.getPieSeries=function(e){for(var t,i=[],n=0;n<e.columns.positions.length;n++){var o="";for(t=0;t<e.columns.positions[n].positions.length;t++)""!==o&&(o+=", "),o+=e.columns.members[e.columns.positions[n].positions[t].id].caption;i.push({index:n,title:o})}return i},t}();e.PieDataHelper=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(e,i,n){var o,r,a,s,l,c,u=arguments[0]||{},p=1,h=arguments.length,d=!1,m=Object.prototype.toString,f=Object.prototype.hasOwnProperty,g={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},_={isFunction:function(e){return"function"===_.type(e)},isArray:Array.isArray||function(e){return"array"===_.type(e)},isWindow:function(e){return null!==e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null===e?String(e):g[m.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==_.type(e)||e.nodeType)return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e);return void 0===t||f.call(e,t)}};for("boolean"==typeof u&&(d=u,u=arguments[1]||{},p=2),"object"==typeof u||_.isFunction(u)||(u={}),h===p&&(u=this,--p),p;p<h;p++)if(null!==(o=arguments[p]))for(r in o)a=u[r],u!==(s=o[r])&&(d&&s&&(_.isPlainObject(s)||(l=_.isArray(s)))?(l?(l=!1,c=a&&_.isArray(a)?a:[]):c=a&&_.isPlainObject(a)?a:{},u[r]=t(d,c,s)):void 0!==s&&(u[r]=s));return u},i=function(){function e(){}return e.getPie=function(e,i,n,o){var r,a=t(!0,e,a);return n&&0!==n.length&&(a.data.content=n,a.header.title.text=o||"",r=new d3pie(i.id,a)),r},e.setPieOptions=function(e,i){var n=e.options;e.options=t(!0,n,i)},e}();e.PieFactory=i}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var test,Ranet;!function(e){!function(e){!function(e){function t(e){if(null==e||"object"!=typeof e)return e;var i=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(i[n]=t(e[n]));return i}var i=function(){function i(e,i){this._htmlElement=e,this._element=d3.select(e),this._options=i,this._data=i.dataSource,this._rawData=i.dataSource,this._containers=[],this._piesOptions=[],this._pies=[],this._initialHeight=i.size.canvasHeight,this._minHeight=i.minHeight||0,this._titles=i.titles||[],this._options.specifiedSeries||(this._options.specifiedSeries=[]),this._options.labels.mainLabel.color=this._options.labels.mainLabel.color||"fff",this._options.columnLength=this._options.columnLength||1,this._options.rowLength=this._options.rowLength||1,this._element.classed("ranetPies",!0),this._pieOptions=t(this._options),this._pieOptions.tooltips={enabled:!1},this._initialHeight=this._currentHeight=this._options.size.canvasHeight,this._pieOptions.legend.legendItems||(this._pieOptions.legend.legendItems=[]),this._hiddenIndexes=[],this._dataUpdated=!0,this.draw()}return i.prototype.draw=function(){var e=this;this._element.classed("ranetPies",!0),this.resize();var t=this._element.node(),i=t.getBoundingClientRect();if(0!==i.width){this.drawLegend();var n;n=this._options.legend.visible&&(t=this._element.select(".pieLegend").node())?t.getBoundingClientRect().height:0,(i.height-n)/this._options.rowLength<200||i.width/this._options.columnLength<300?this._pieOptions.labels.outer.format="none":this._pieOptions.labels.outer.format=this._options.labels.outer.format;var o,r;"none"===this._options.labels.outer.format?(o=(i.height-n-18)/this._options.columnLength-2,r=i.width/this._options.rowLength):(o=(i.height-n-18)/this._options.columnLength-2,r=(i.width-60)/this._options.rowLength),this._pieOptions.size.canvasHeight=o,this._pieOptions.size.canvasWidth=r,this._container=this._element.append("div").classed("ranetPiesContainer",!0).style("height",i.height-n+"px");var a;if(0!==this._pieOptions.specifiedSeries.length)for(a=0;a<this._pieOptions.specifiedSeries.length;a++)this.createElement(this._pieOptions.specifiedSeries[a].index,this._pieOptions.specifiedSeries[a].title);else for(a=0;a<this._data.length;a++)this.createElement(a,this._titles[a]);this._options.tooltips.enabled&&setTimeout(function(){e.drawTooltips()},0)}},i.prototype.createElement=function(i,n){this._containers[i]=document.createElement("div"),this._containers[i].classList.add("ranetPieContainer"),this._containers[i].id="ranetPieContainer"+i,this._containers[i].style.width=100/this._options.rowLength+"%",this._containers[i].style.height=100/this._options.columnLength+"%",this._container.node().appendChild(this._containers[i]),this._pies[i]=e.PieFactory.getPie(this._pieOptions,this._containers[i],this._data[i],n),this._piesOptions[i]=t(this._pieOptions)},i.prototype.redraw=function(){this._container&&(this.clear(),this.updateData(),this._element=d3.select(this._htmlElement),this.draw(),this.resize())},i.prototype.clear=function(){if(this.clearError(),test=this,this._container){for(var e=0;e<this._pies.length;e++)this._container.select("div#ranetPieContainer"+e)&&this._container.select("div#ranetPieContainer"+e).remove(),this._pies[e]&&(this._pies[e].destroy(),this._pies[e]=null);this._container.remove(),this._container=null,this._piesOptions=[],this._containers=[],this._legend&&(this._legend.clear(),this._element.selectAll(".pieLegend").each(function(){""===d3.select(this).html()&&d3.select(this).remove()})),this._element.classed("ranetPies",!1)}},i.prototype.resize=function(){var e=this._element.node().getBoundingClientRect().height,t=(e=e>this._minHeight?e:this._minHeight)<this._initialHeight?e:this._initialHeight;t!==this._currentHeight&&(this._currentHeight=t,this._pieOptions.size.canvasHeight=this._currentHeight,this._currentHeight<300?this._pieOptions.labels.inner.format="none":this._pieOptions.labels.inner.format=this._options.labels.inner.format)},i.prototype.drawLegend=function(){var t=this;if(this._pieOptions.legend.visible&&this._pieOptions.legend.legendItems.length>0&&0!==this._options.dataSource.length){var i=this._element.insert("div",":first-child").attr("class","pieLegend");this._legend=new e.Legend(i,{visible:!0,onclickevent:function(e,i){var n=t._hiddenIndexes.indexOf(i);n>=0?t._hiddenIndexes.splice(n,1):t._hiddenIndexes.push(i),t.redraw()}},this._pieOptions.legend.legendItems),this._legend.clear(),this._legend.create()}},i.prototype.drawTooltips=function(){d3.selectAll("g[class*='_arc']").each(function(e){$(this).popover({container:".ranetPies",trigger:"manual",content:function(){return"<span color='"+e.color+"'>"+e.label+": "+e.displayValue+"<span>"},html:!0,delay:0,placement:"auto top",template:'<div class="popover piePopover hidden" role="tooltip" style="visibility: hidden;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})}).on("mousemove",function(){var e=d3.select("body").node(),t=d3.mouse(e),i=d3.select(".piePopover").node();if(i){var n=i.getBoundingClientRect(),o=n.width/2,r=n.height+15;d3.select(".piePopover").attr("style","top: "+(t[1]-r)+"px; left: "+(t[0]-o)+"px; display: block;").attr("class","popover piePopover")}}).on("mouseenter",function(){$(this).popover("show")}).on("mouseleave",function(e){$(this).popover("hide"),d3.select(".piePopover").attr("class","popover piePopover hidden")}),d3.selectAll("text[class*='_segmentValue-inner']").each(function(e){$(this).popover({container:".ranetPies",trigger:"manual",content:function(){return"<span color='"+e.color+"'>"+e.label+": "+e.displayValue+"<span>"},html:!0,delay:0,placement:"auto top",template:'<div class="popover piePopover hidden" role="tooltip" style="visibility: hidden;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})}).on("mousemove",function(){var e=d3.select("body").node(),t=d3.mouse(e),i=d3.select(".piePopover").node();if(i){var n=i.getBoundingClientRect(),o=n.width/2,r=n.height+15;d3.select(".piePopover").attr("style","top: "+(t[1]-r)+"px; left: "+(t[0]-o)+"px; display: block;").attr("class","popover piePopover")}}).on("mouseenter",function(){$(this).popover("show")}).on("mouseleave",function(e){$(this).popover("hide"),d3.select(".piePopover").attr("class","popover piePopover hidden")})},i.prototype.throwError=function(e){var t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-warning"),t.classList.add("fade"),t.classList.add("in"),t.innerHTML=e,t.setAttribute("id","pieError"),this._element.node().appendChild(t)},i.prototype.clearError=function(){var e=this._element.node().querySelector("#pieError");e&&d3.select(e).remove()},i.prototype.updateData=function(){this._data=t(this._options.dataSource);for(var e=0;e<this._rawData.length;e++)for(var i=0;i<this._rawData[e].length;i++)this._hiddenIndexes.indexOf(i)>=0?(this._data[e][i].value=null,this._pieOptions.legend.legendItems[i].visible=!1):this._pieOptions.legend.legendItems[i].visible=!0},Object.defineProperty(i.prototype,"options",{get:function(){return this._options},set:function(e){this._options.dataSource!==e.dataSource&&(this._dataUpdated=!0),this._options=e,this._rawData=this._options.dataSource,this._data=this._options.dataSource,this._options.legend.legendItems=e.legend.legendItems||[],this._pieOptions=t(this._options),this._pieOptions.tooltips={enabled:!1},this.redraw()},enumerable:!0,configurable:!0}),i}();e.Pies=i}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(e){function t(){e.call(this)}return __extends(t,e),t}(e.TreeViewOptions);t.SearchTreeViewContentOptions=i}(e.SearchTreeView||(e.SearchTreeView={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.filter=function(e,t,i,n){if(""===t)return e;for(var o=JSON.stringify(e),r=JSON.parse(o),a=[],s=0;s<r.length;s++)r[s].items?(r[s].items=this.filter(r[s].items,t,i,n),r[s].items.length>0&&(r[s][n]=!0,a.push(r[s]))):r[s][i].toLowerCase().indexOf(t.toLowerCase())>=0&&a.push(r[s]);return a},e}();e.SearchTreeFilter=t}(e.SearchTreeView||(e.SearchTreeView={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(t){var i=function(){function i(t,i){var n=this;this._isVisibleSearch=i.isVisibleSearch,this._dataSource=i.dataSource,this._treeViewOptions=i;var o=i.onItemSelected;this._treeViewOptions.onItemSelected=function(e){n._selectedItems=[e.data],o(n._selectedItems),n.selectItemInDataSource({data:n._selectedItems[0]},n._dataSource)},this._filteredDataSource=this._dataSource,this._$panel=$(t),this._$container=$("<div/>"),this._$container.addClass("ranet-searchTreeViewContainer"),this._treeView=new e.TreeView(this._$container[0],this._treeViewOptions),this._isVisibleSearch?this._$container.addClass("ranet-searchTreeViewContainer-withSearchPanel"):this._$container.addClass("ranet-searchTreeViewContainer-withoutSearchPanel")}return Object.defineProperty(i.prototype,"displayed",{get:function(){return this._displayed},set:function(e){this._displayed=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this.selectItemInDataSource({data:this._selectedItems[0]},this._dataSource)},enumerable:!0,configurable:!0}),i.prototype.repaint=function(){this._treeView.repaint()},i.prototype.selectItemInDataSource=function(e,t){for(var i=0;i<t.length;i++)"folder"===t[i].type?e.data[this._treeViewOptions.displayExpr]===t[i][this._treeViewOptions.displayExpr]&&e.data[this._treeViewOptions.keyExpr]===t[i][this._treeViewOptions.keyExpr]?(t[i][this._treeViewOptions.selectedExpr]=!0,this.selectItemInDataSource(e,t[i].items)):(t[i][this._treeViewOptions.selectedExpr]=!1,this.selectItemInDataSource(e,t[i].items)):t[i][this._treeViewOptions.keyExpr]===e.data[this._treeViewOptions.keyExpr]?t[i][this._treeViewOptions.selectedExpr]=!0:t[i][this._treeViewOptions.selectedExpr]=!1},i.prototype.update=function(){this._displayed&&(this._$panel.empty(),this._$panel.append(this.getView()))},i.prototype.init=function(){this._$panel.append(this.getView()),this._displayed=!0},i.prototype.setFocus=function(){this._searchBox&&this._searchBox.focus()},i.prototype.getView=function(){var e=this,i=$("<div/>");i.addClass("ranet-searchTreeViewContent"),this._filteredDataSource=this._dataSource;var n=this.getTreeViewContainer(this._filteredDataSource);if(this._isVisibleSearch){var o=$("<div/>");o.addClass("ranet-searchTreeViewContent-searchPanel"),i.append(o);var r=this._searchBox=$("<input/>");r.attr("spellcheck","false"),r.attr("autocomplete","off"),r.keyup(function(o){n.remove(),e._filteredDataSource=t.SearchTreeFilter.filter(e._dataSource,r.val(),e._treeViewOptions.displayExpr,e._treeViewOptions.expandedExpr),n=e.getTreeViewContainer(e._filteredDataSource),i.append(n)}),r.addClass("ranet-searchTreeViewContent-searchTextBox"),o.append(r)}return i.append(n),i},i.prototype.getTreeViewContainer=function(e){return this._treeView.dataSource=e,this._$container},i}();t.SearchTreeViewContent=i}(e.SearchTreeView||(e.SearchTreeView={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function t(e,t,i,n){this._startIndex=t,this._onLoadedNewItems=n,this._getPromiseLoadNeighbors=i,this.dataItem=e}return Object.defineProperty(t.prototype,"parents",{get:function(){throw new Error("NotImplementedException")},set:function(e){throw new Error("NotImplementedException")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("NotImplementedException")},set:function(e){throw new Error("NotImplementedException")},enumerable:!0,configurable:!0}),t.prototype.hide=function(){this._$viewTreeViewItem.remove()},t.prototype.goToStartState=function(){var t=this;this._$headerContent.empty();var i=$("<span>"+e.Localization.localize("MemberChoice_LoadNext")+"</span>"),n=$('<button type="button" class="btn btn-default btn-xs" style="font-size: 11px;"></button>');n.append(i),n.click(function(){t._$headerContent.empty();var i=$('<button type="button" class="btn btn-default btn-xs disabled" style="font-size: 11px;"></button>'),n=$('<i class="fa fa-spinner fa-spin"></i>'),o=$("<span style='margin-left:3px;'>"+e.Localization.localize("Loading")+"</span>");i.append(n),i.append(o),t._$headerContent.append(i),t.loadNewItems()}),this._$headerContent.append(n)},t.prototype.loadNewItems=function(){var t=this;this._getPromiseLoadNeighbors(this.dataItem,this._startIndex).done(function(e){t.hide(),t._onLoadedNewItems(t,e)}).fail(function(i){e.LogService.error(i),t.goToStartState()})},t.prototype.render=function(e){var t=e.find("tr").last().find("td").length,i=$("<tr/>");this._$viewTreeViewItem=i;var n=$("<td/>");this._$headerContent=n,this.goToStartState();for(var o=0;o<t-1;o++)i.append("<td/>");i.append(n),e.append(i)},t}();t.LoadNextTreeViewItem=i}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){e.ranetTreeView=function(t,i){var n=this,o={},r=this;r.settings={};var a;r.init=function(){n.settings=e.extend({},o,i),a=new Ranet.Controls.TreeView(t,i)},r.option=function(e){e.hasOwnProperty("dataSource")&&(a.dataSource=e.dataSource)},r.init()},e.fn.ranetTreeView=function(t){return this.each(function(){if(void 0==e(this).data("ranetTreeView")){var i=new e.ranetTreeView(this,t);e(this).data("ranetTreeView",i)}})}}(jQuery);var Ranet;!function(e){var t=function(){function e(){}return e.showServerError=function(e){e.responseText?alert(e.responseText):alert("Please check your connection.")},e.showError=function(e){alert(e)},e.showInfo=function(e){alert(e)},e}();e.UserMessageService=t}(Ranet||(Ranet={}));var Ranet;!function(e){var t=function(){function e(){}return e.track=function(e,t){try{mixpanel&&(t?mixpanel.track(e,t):mixpanel.track(e))}catch(e){}},e}();e.UserActionsTracker=t}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(){}return e.removeItem=function(e,t){for(var i=e.length;i--;)e[i]===t&&e.splice(i,1)},e}();e.ArrayUtility=t}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){var i=function(){function t(){}return t.getColors=function(){var t=new Array;return t.push(new n(e.Localization.localize("Color_Red"),"#FFFF0000")),t.push(new n(e.Localization.localize("Color_Green"),"#FF00FF21")),t.push(new n(e.Localization.localize("Color_White"),"#FFFFFFFF")),t.push(new n(e.Localization.localize("Color_DarkGray"),"#FFA9A9A9")),t.push(new n(e.Localization.localize("Color_Black"),"#FF000000")),t.push(new n(e.Localization.localize("Color_Blue"),"#FF0026FF")),t.push(new n(e.Localization.localize("Color_Brown"),"#FFA52A2A")),t.push(new n(e.Localization.localize("Color_Cyan"),"#FF00FFFF")),t.push(new n(e.Localization.localize("Color_Gray"),"#FF808080")),t.push(new n(e.Localization.localize("Color_Magenta"),"#FFFF00FF")),t.push(new n(e.Localization.localize("Color_Orange"),"#FFFFA500")),t.push(new n(e.Localization.localize("Color_Purple"),"#FF800080")),t.push(new n(e.Localization.localize("Color_Yellow"),"#FFFFFF00")),t.push(new n(e.Localization.localize("Color_LightBlue"),"#FFADD8E6")),t.push(new n(e.Localization.localize("Color_LightCyan"),"#FFE0FFFF")),t.push(new n(e.Localization.localize("Color_LightGoldenRodYellow"),"#FFFAFAD2")),t.push(new n(e.Localization.localize("Color_LightGrey"),"#FFD3D3D3")),t.push(new n(e.Localization.localize("Color_LightGreen"),"#FF90EE90")),t.push(new n(e.Localization.localize("Color_LightPink"),"#FFFFB6C1")),t.push(new n(e.Localization.localize("Color_LightSalmon"),"#FFFFA07A")),t.push(new n(e.Localization.localize("Color_LightSeaGreen"),"#FF20B2AA")),t.push(new n(e.Localization.localize("Color_LightSkyBlue"),"#FF87CEFA")),t.push(new n(e.Localization.localize("Color_LightSlateGray"),"#FF778899")),t.push(new n(e.Localization.localize("Color_LightSteelBlue"),"#FFB0C4DE")),t.push(new n(e.Localization.localize("Color_LightYellow"),"#FFFFFFE0")),t},t}();t.ColorHelper=i;var n=function(){function e(e,t){this._caption=e,this._hex=t;var i=this.hexToArgb(this._hex);this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._argb="rgba("+i.r+","+i.g+","+i.b+","+i.a+")"}return Object.defineProperty(e.prototype,"r",{get:function(){return this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this._a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caption",{get:function(){return this._caption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hex",{get:function(){return this._hex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"argbText",{get:function(){return this._argb},enumerable:!0,configurable:!0}),e.prototype.hexToArgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{a:parseInt(t[1],16),r:parseInt(t[2],16),g:parseInt(t[3],16),b:parseInt(t[4],16)}:null},e}()}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(){this._debouncerId=null}return e.debounce=function(e,t){clearTimeout(window.debouncerId),window.debouncerId=setTimeout(e(),t)},e}();e.Debouncer=t;var i=function(){function e(){}return e.addEventHandler=function(e,t,i){null!=e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},e.removeEventHandler=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1),e.detachEvent&&e.detachEvent("on"+t,i)},e}();e.EventHandlers=i}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){function e(){}return e.newGuid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)})},e}();e.Guid=t}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){var t=function(){return function(e,t){this.caption=e,this.imageClass=t}}();e.ImageDescription=t;var i=function(){function e(){}return e.getImages=function(){for(var i=new Array,n=0;n<e._imageClasses.length;n++){var o=e._imageClasses[n];i.push(new t(o.replace("imageLibrary_",""),o))}return i},e._imageClasses=["imageLibrary_status_cylinder_-1","imageLibrary_status_gauge-ascending_0","imageLibrary_status_gauge-ascending_1","imageLibrary_status_gauge-ascending_-1","imageLibrary_status_gauge-descending_0","imageLibrary_status_gauge-descending_1","imageLibrary_status_gauge-descending_-1","imageLibrary_status_roadsigns_0","imageLibrary_status_roadsigns_1","imageLibrary_status_roadsigns_-1","imageLibrary_status_shapes_0","imageLibrary_status_shapes_1","imageLibrary_status_shapes_-1","imageLibrary_status_thermometer_0","imageLibrary_status_thermometer_1","imageLibrary_status_thermometer_-1","imageLibrary_status_trafficlight_0","imageLibrary_status_trafficlight_1","imageLibrary_status_trafficlight_-1","imageLibrary_status_variancearrow_0","imageLibrary_status_variancearrow_-1","imageLibrary_status_variancearrow_1","imageLibrary_status_cube_0","imageLibrary_status_cube_-1","imageLibrary_status_cube_1","imageLibrary_status_cylinder_1","imageLibrary_status_cylinder_0","imageLibrary_trend_standardarrow_0","imageLibrary_trend_standardarrow_1","imageLibrary_trend_standardarrow_-1","imageLibrary_trend_statusarrow-ascending_0","imageLibrary_trend_statusarrow-ascending_1","imageLibrary_trend_statusarrow-ascending_-1","imageLibrary_trend_statusarrow-descending_0","imageLibrary_trend_statusarrow-descending_1","imageLibrary_trend_statusarrow-descending_-1","imageLibrary_trend_arrowcolor_0","imageLibrary_trend_arrowcolor_1","imageLibrary_trend_arrowColor_-1"],e}();e.ImageStorage=i}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){e[e.Chart=0]="Chart",e[e.VectorMap=1]="VectorMap",e[e.Pie=2]="Pie"}(e.ExtensionTypes||(e.ExtensionTypes={}));e.ExtensionTypes}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(e,t){this._mapData=e,this._countryList=t}return t.prototype.getMapData=function(t,i){var n=this,o=t||this._mapData,r=i||this._countryList;this._cachedMap=o,this._cachedCountryList=$.Deferred();var a=$.Deferred(),s=this;$.when($.ajax({url:o}),$.ajax({url:r})).done(function(e,t){var i={};jQuery.parseJSON(t[0]).forEach(function(e){i[parseInt(e["country-code"])]=e.name[0]});var o={};jQuery.parseJSON(t[0]).forEach(function(e){o[parseInt(e["country-code"])]=e["alpha-3"]}),n._cachedCountryList.resolve({data:jQuery.parseJSON(t[0])}),a.resolve({countryMap:i,map:jQuery.parseJSON(e[0]),iso:o})}).fail(function(t){e.LogService.error(t),a.reject(t)}),s._promice=a},t.prototype.compareMaps=function(e){return e===this._cachedMap},Object.defineProperty(t.prototype,"mapData",{set:function(e){this._mapData=e,this._promice=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"countryList",{set:function(e){this._countryList=e,this._promice=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._promice||this.getMapData(),this._promice},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"countryListDeferred",{get:function(){return this._cachedCountryList||this.getMapData(),this._cachedCountryList},enumerable:!0,configurable:!0}),t}();t.MapRequestHelper=i;var n=function(){function e(e){this._data=e}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),e}();t.MapRawDataCache=n;var o=function(){function t(){}return t.checkValidMapData=function(e){if(!e)return!1;if(!e.rows)return!1;if(!e.rows.hierarchies)return!1;for(var t=e.rows.hierarchies[e.rows.hierarchies.length-1].levelProperties,i=0;i<t.length;i++)if("Country"===t[i].name||"State-Province"===t[i].name)return!0;return!1},t.getRequest=function(){return this.mapData=e.PathManager.mapPath+"world-50m.txt",this.countryList=e.PathManager.mapPath+"countryList.txt",this.requestHelper?this.requestHelper.compareMaps(this.mapData)||(this.requestHelper.mapData=this.mapData):this.requestHelper=new i(this.mapData,this.countryList),this.requestHelper.data},t.parseData=function(e,t){this.dataCache?this.dataCache.data=e:this.dataCache=new n(e);for(var i=[],o=e.cells.values,r=e.cells.displayValues,a=0;a<e.rows.positions.length;a++){var s,l={},c="";for(s=0;s<e.rows.positions[a].positions.length-1;s++)""!==c&&(c+=", "),c+=e.rows.members[e.rows.positions[a].positions[s].id].caption;if(c===t){l.row=e.rows.members[e.rows.positions[a].positions[s].id].caption;for(var u=0;u<e.columns.positions.length;u++){var p=o[a][u],h=r[a][u];null!==p&&(l["column"+u]=p,l["displayValue"+u]=h)}i.push(l)}}return i},t.parseDataForMap=function(e,t,n){var o=this.parseData(e,n),r=$.Deferred(),a={};return this.requestHelper||(this.requestHelper=new i(this.mapData,this.countryList)),this.requestHelper.countryListDeferred.done(function(e){for(var i=e.data,n=0;n<o.length;n++)for(var s=0;s<i.length;s++)if(i[s].name.indexOf(o[n].row)>=0){var l=i[s]["alpha-3"],c=o[n]["column"+t],u=o[n]["displayValue"+t];a[l]={value:c,displayValue:u}}r.resolve({data:a})}),r},t.getDetailedMapData=function(t){var i=$.Deferred();return $.ajax(e.PathManager.mapPath+t+".txt").done(function(e){i.resolve({data:e})}),i},t.parseDataForDetailedMap=function(e,t,i,n){for(var o={},r=this.parseData(e,i),a=0;a<r.length;a++){var s=r[a]["column"+t],l=r[a]["displayValue"+t];"FRA"===n&&(r[a].row=r[a].row.replace(/\ /g,"-")),o[iso3166.subdivision(n,r[a].row).code]={value:s,displayValue:l}}return o},t.generateColumnList=function(e){var t=[];if(!e.columns)return t;for(var i=0;i<e.columns.positions.length;i++){for(var n="",o=e.columns.positions[i],r=0;r<o.positions.length;r++){var a=o.positions[r].id;n+=e.columns.members[a].caption+", "}""!==(n=n.substr(0,n.length-2))&&t.push(n)}return t},t.generateRowList=function(e){var t=[];if(!e.rows)return t;for(var i=0;i<e.rows.positions.length;i++){for(var n="",o=e.rows.positions[i],r=0;r<o.positions.length-1;r++){var a=o.positions[r].id;n+=e.rows.members[a].caption+", "}n=n.substr(0,n.length-2),t.indexOf(n)<0&&""!==n&&t.push(n)}return t},t.generateGroups=function(e,t){t||(t=5);var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push(e[n].value);for(var o=d3.max(i)-1,r=d3.min(i)+1,a=(o-r)/(t-2),s=[],l=0;l<t-1;l++)s[l]=Math.floor(r+a*l);return s},t.currentRow=function(e){return 0},t.calculateRowIndex=function(e,t,i){if(t&&iso3166.country(t)){var n;n=""!==e?e+", "+iso3166.country(t).name:iso3166.country(t).name;for(var o=0;o<i.rows.positions.length;o++){for(var r="",a=i.rows.positions[o],s=0;s<a.positions.length;s++){var l=a.positions[s].id;r+=i.rows.members[l].caption+", "}if((r=r.substr(0,r.length-2))===n)return o}}return-1},t.currentColumn=function(){return 0},t.createActionHeaderDescription=function(e,t,i){var n={};n.actionType="drillDown",n.place="rows",n.ancestors=[];var o=this.calculateRowIndex(i,e,t),r=t.rows.positions[o];if(r){n.data=t.rows.members[r.positions[r.positions.length-1].id],n.hierarchy=t.rows.hierarchies[r.positions.length-1],n.neighborsHierarchy=[];for(var a=0;a<r.positions.length-1;a++){n.neighborsHierarchy[a]={},n.neighborsHierarchy[a].data=t.rows.members[r.positions[a].id],n.neighborsHierarchy[a].hierarchy=t.rows.hierarchies[a];var s=r.positions[a].parentId;n.neighborsHierarchy[a].ancestors=[];for(var l=0;-1!==s;){var c=t.rows.members[s];n.neighborsHierarchy[a].ancestors[l]=c.uniqueName,s=this.getRowParentId(s,t,a).parentId,l++}}}return n},t.getCountryCode=function(t){this.mapData=e.PathManager.mapPath+"world-50m.txt",this.countryList=e.PathManager.mapPath+"countryList.txt",this.requestHelper||(this.requestHelper=new i(this.mapData,this.countryList));var n=this.requestHelper.countryListDeferred,o=$.Deferred();return n.done(function(e){for(var i=0;i<e.data.length;i++)for(var n=0;n<e.data[i].name.length;n++)e.data[i].name[n]===t&&o.resolve({iso:e.data[i]["alpha-3"]});o.resolve({iso:null})}),o},t.getRowParentId=function(e,t,i){for(var n=0;n<t.rows.positions.length;n++)if(t.rows.positions[n].positions[i].id===e)return t.rows.positions[n].positions[i];return null},t.mapData=e.PathManager.mapPath+"world-50m.txt",t.countryList=e.PathManager.mapPath+"countryList.txt",t}();t.MapDataHelper=o}(t.Extensions||(t.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Left=2]="Left",e[e.Right=3]="Right"}(e.Position||(e.Position={}));e.Position}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(t){this._palette=t.palette,this._element=t.element,this._groups=t.groups,this._groups.push(1/0),this._position=t.position,this._visible=t.visible,this._position===e.Position.Top||this._position===e.Position.Left?this._content=d3.select(this._element).insert("div","svg").attr("class","mapLegend"):this._content=d3.select(this._element).insert("div",".popOvers").attr("class","mapLegend"),this._position!==e.Position.Right&&this._position!==e.Position.Left||this._content.attr("class","mapLegend sideLegend"),!1===this._visible?this._content.style("display","none"):this._content.style("display","")}return t.prototype.draw=function(){var e=this;this._visible&&this._content.selectAll("items").data(this._groups).enter().append("xhtml:span").html(function(t,i){var n="<span style='color:"+(e._palette[i]||"black")+";font-size:18px;'>&#9632;</span>&nbsp;";return 0===i?n+="<&nbsp;"+t:i===e._groups.length-1?n+=">&nbsp;"+e._groups[i-1]:n+="от "+e._groups[i-1]+" до "+e._groups[i],n}).attr("class","legendItem")},Object.defineProperty(t.prototype,"palette",{set:function(e){var t=this;this._palette=e,this._content.selectAll("span > span").style("color",function(e,i){return t._palette[i]||"black"})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groups",{set:function(e){var t=this;this._content.selectAll("span").remove(),this._groups=e,this._groups[this._groups.length-1]!==1/0&&this._groups.push(1/0),this._content.selectAll("items").data(this._groups).enter().append("xhtml:span").html(function(e,i){var n="<span style='color:"+(t._palette[i]||"black")+";font-size:18px;'>&#9632;</span>&nbsp;";return 0===i?n+="<&nbsp;"+e:i===t._groups.length-1?n+=">&nbsp;"+t._groups[i-1]:n+="от "+t._groups[i-1]+" до "+t._groups[i],n}).attr("class","legendItem")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._content.remove(),this._position===e.Position.Top||this._position===e.Position.Left?this._content=d3.select(this._element).insert("div","svg").attr("class","mapLegend"):this._content=d3.select(this._element).insert("div",".popOvers").attr("class","mapLegend"),this._position!==e.Position.Right&&this._position!==e.Position.Left||this._content.attr("class","mapLegend sideLegend")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._visible},set:function(e){this._visible=e,!1===this._visible?this._content.style("display","none"):this._content.style("display","")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return console.log(parseFloat(this._content.style("height"))),parseFloat(this._content.style("height"))||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return parseFloat(this._content.style("width"))||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){return{position:this._position,visibility:this._visible}},enumerable:!0,configurable:!0}),t}();e.MapLegend=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(t,i,n,o,r){var a=this;this._updateData=r,this._detailedData=o,this._detailedMapSettings=i,this._popover=n,this._element=t,this._drawn=!1;var s=t.getBoundingClientRect(),l=parseInt(d3.select(t).select(".mapLegend").style("width"))+2;this._mapHeight=s.height,this._mapWidth=s.width-l,this._projection=d3.geo.albersUsa().scale(1).translate([0,0]),this._path=d3.geo.path().projection(this._projection),this._svg=d3.select(t).insert("svg","svg").attr("class","regions").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("display","inline-block"),this._background=this._svg.append("rect").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("class","ranetMapBackground"),d3.json(e.PathManager.mapPath+"USA.txt",function(e,t){if(e)throw e;a._feature=topojson.feature(t,t.objects.USA);var n=a._path.bounds(a._feature),o=.95/Math.max((n[1][0]-n[0][0])/a._mapWidth,(n[1][1]-n[0][1])/a._mapHeight),s=[(a._mapWidth-o*(n[1][0]+n[0][0]))/2,(a._mapHeight-o*(n[1][1]+n[0][1]))/2];if(a._projection.scale(o).translate(s),a._svg.selectAll("path").data(a._feature.features).enter().append("path").attr("d",a._path).attr("fill","gray").attr("fill",function(e){return"region-"+e.properties.HASC_1.replace(".","-")}),i.showRegionNames){for(var l=a._svg.append("g").attr("class","region-labels"),c=a,u=a._feature.features,p=0;p<u.length;p++)u[p].geometry&&(u[p].geometry.coordinates=[a.getLargestBoundingRegion(u[p])],u[p].geometry.type="Polygon");l.selectAll("text").data(u).enter().append("text").attr("x",function(e){var t=a._path.centroid(e.geometry);return t[0]?t[0]:""}).attr("y",function(e){var t=a._path.centroid(e.geometry);return t[1]?t[1]:""}).text(function(e){return e.properties.NAME}).attr("text-anchor","middle").attr("font-size",10).attr("visibility",function(e){return c.checkLabelVisibility(this,e)})}i.tooltip.enabled&&a._svg.selectAll("path").on("mouseover",function(e){if(e.properties.HASC_1){a.showTooltip();var t=i.tooltip.customizeTooltip.call(a,e);a.tooltipContent(t)}else a.hideTooltip()}).on("mouseleave",function(){a.hideTooltip()}),$(a._svg.node()).on("mousemove",function(e){a.updateTooptipPosition(e)}),a.updateDetailedMap(),r.call(a,"USA"),a._drawn=!0})}return t.prototype.updateDetailedMap=function(){var e=this;this._svg.selectAll("path").style("fill",function(t){var i=e.getDetailedGroup(t.properties.HASC_1);return-1===i?"gray":e._detailedMapSettings.palette[i]||"black"})},t.prototype.checkLabelVisibility=function(e,t){var i,n;return!this._detailedMapSettings.showRegionNames||"Admin-0 country"===t.properties.featurecla||!(i=this._svg.select(".region-"+t.properties.HASC_1.replace(".","-")).node())||(n=i.getBoundingClientRect(),e.getBoundingClientRect().width>n.width)?"hidden":"visible"},t.prototype.getLargestBoundingRegion=function(e){var t;if(null===e.geometry)return[0,0];if("MultiPolygon"===e.geometry.type){for(var i={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[0]}},n=1;n<e.geometry.coordinates.length;n++){var o={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[n]}};this._path.area(o)>this._path.area(i)&&(i=o,t=e.geometry.coordinates[n][0])}t||i.geometry.coordinates&&(t=i.geometry.coordinates[0])}else t=e.geometry.coordinates[0];return t},t.prototype.getDetailedGroup=function(e){if(!e)return-1;if(e=e.replace(".","-"),!this._detailedData[e])return-1;var t=this._detailedData[e].value;if(t<this._detailedMapSettings.groups[0])return 0;for(var i=0;i<this._detailedMapSettings.groups.length-1;i++)if(t>=this._detailedMapSettings.groups[i]&&t<this._detailedMapSettings.groups[i+1])return i+1;return t>=this._detailedMapSettings.groups[this._detailedMapSettings.groups.length-1]?this._detailedMapSettings.groups.length:-1},t.prototype.showTooltip=function(){$(this._popover).data("bs.popover").tip().hasClass("in")||$(this._svg.node().parentNode).find("svg.ranetMapContent").popover("show")},t.prototype.hideTooltip=function(){$(this._svg.node().parentNode).find("svg.ranetMapContent").popover("hide")},t.prototype.updateTooptipPosition=function(e){var t=$(this._popover).data("bs.popover");$(e.target)[0]!==$(this._background)[0][0]?t.$tip&&t.$tip.addClass(t.options.placement).attr("style","top: "+(e.pageY-t.$tip.height()-15)+"px; left: "+(e.pageX-t.$tip.width()/2)+"px; display: block;"):this.hideTooltip()},t.prototype.tooltipContent=function(e){var t=d3.event,i=$(this._popover).attr("data-content",e).data("bs.popover");i.setContent(),i.$tip.addClass(i.options.placement).attr("style","top: "+(t.pageY-i.$tip.height()-15)+"px; left: "+(t.pageX-i.$tip.width()/2)+"px; display: block;")},t.prototype.resize=function(){if(this._drawn){var e=this._element.getBoundingClientRect(),t=parseInt(d3.select(this._element).select(".mapLegend").style("width"))+4;this._mapHeight=e.height,this._mapWidth=e.width-t,this._projection.scale(1).translate([0,0]);var i=this._path.bounds(this._feature),n=.95/Math.max((i[1][0]-i[0][0])/this._mapWidth,(i[1][1]-i[0][1])/this._mapHeight),o=[(this._mapWidth-n*(i[1][0]+i[0][0]))/2,(this._mapHeight-n*(i[1][1]+i[0][1]))/2];this._projection.scale(n).translate(o),this._svg.attr("width",this._mapWidth).attr("height",this._mapHeight).selectAll("path").attr("d",this._path)}},Object.defineProperty(t.prototype,"data",{set:function(e){this._detailedData=e,this.updateDetailedMap()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"svg",{get:function(){return this._svg},enumerable:!0,configurable:!0}),t.prototype.delete=function(){this._svg.remove()},t}();t.UsaDetailedMap=i}(t.Extensions||(t.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={}));var Ranet;!function(e){!function(e){!function(e){var t=function(){function t(t,i){var n=this,o=t.getBoundingClientRect();t.setAttribute("class","mapContainer disableSelection"),this._prevMapWidth=-1,this._updateData=i.updateData,this._element=t,this._palette=[["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"]],this._paletteId=3,this._presetDetailedRegion=i.presetDetailedRegion||"",this._data=i.data,this._groups=i.groups||e.MapDataHelper.generateGroups(this._data,5),i.bounds.minLon?this._bounds=i.bounds:this._bounds={minLon:-180,maxLat:85,maxLon:180,minLat:-60},this._mapHeight=o.height,this._mapHeight<0&&(this._mapHeight=0),this._mapWidth=o.width,this._showCountryLabels=void 0===i.showCountryLabels||i.showCountryLabels,this._maxScale=i.maxScale||3200,this._minScale=i.minScale||900,this._tooltipOptions=i.tooltip||{enabled:!0},this._customizeTooltip=this._tooltipOptions.customizeTooltip||function(e){var t,i=n._data[e.properties.ADM0_A3];return t=i?i.displayValue:"N/A",(e.properties.NAME||"Disput territory")+" "+t},this._previousScale=this._minScale,this._detailedMapSettings=i.detailedMapSettings;var r=i.legend.position||e.Position.Right,a=this._palette[this._paletteId];this._detailedMapSettings.groups||(this._detailedMapSettings.groups=this._groups),this._detailedMapSettings.palette||(this._detailedMapSettings.palette=a),this._detailedMapSettings.tooltip?this._detailedMapSettings.tooltip.customizeTooltip||(this._detailedMapSettings.tooltip.customizeTooltip=function(e){var t,i=n._detailedData[e.properties.HASC_1.replace(".","-")];return t=i?i.displayValue:"N/A",(e.properties.NAME||"Disput territory")+" "+t}):this._detailedMapSettings.tooltip=this._tooltipOptions,this.createMap(),this._legend=new e.MapLegend({visible:i.legend.visible||!1,palette:a,groups:this._groups,element:this._element,position:r}),this._legend.draw(),this.createZoomButtons(),this.createTranslateButtons(),this.drawMap()}return t.prototype.drawMap=function(){var t=this;e.MapDataHelper.getRequest().done(function(e){t._mapData=e.map,t._countryList=e.countryMap;var i=t;t._group.append("g").attr("class","countries").selectAll("path").data(topojson.feature(t._mapData,t._mapData.objects.ne_10m_admin_0_countries).features).enter().append("path").attr("d",t._path).attr("class",function(e){return"country-"+e.properties.ADM0_A3}).style("fill",function(e){var i=t.getGroup(e.properties.ADM0_A3);return-1===i||t._detailedView?"gray":t._palette[t._paletteId][i]||"black"}).on("dblclick",function(e){t._detailedMapSettings.enable&&t._updateData.call(t,e.properties.ADM0_A3)});for(var n=topojson.feature(t._mapData,t._mapData.objects.ne_10m_admin_0_countries).features,o=0;o<n.length;o++)n[o].geometry&&(n[o].geometry.coordinates=[t.getLargestBoundingRegion(n[o])],n[o].geometry.type="Polygon");t._group.append("g").attr("class","labels").selectAll("text").data(n).enter().append("text").attr("x",function(e){if(e.geometry&&e.geometry.coordinates===[]){var t=i._path.centroid(e.geometry);if(t[0])return t[0]}return""}).attr("y",function(e){if(e.geometry&&e.geometry.coordinates===[]){var t=i._path.centroid(e.geometry);if(t[1])return t[1]+5}return""}).text(function(e){return e.properties.NAME}).attr("text-anchor","middle").attr("font-size",10).attr("visibility",function(e){return i.checkLabelVisibility(this,e)}).on("dblclick",function(e){t._detailedMapSettings.enable&&t._updateData.call(t,e.properties.ADM0_A3)}),t.createTooltip(),t.resize(),t._svg.on("mouseleave",function(){t.hideTooltip()}),t._presetDetailedRegion&&t.drawDetails(t._presetDetailedRegion),console.log("Drawn!")})},t.prototype.updateColors=function(){var e=this;this._group.selectAll(".countries path").style("fill",function(t){var i=e.getGroup(t.properties.ADM0_A3);return-1===i||e._detailedView?"gray":e._palette[e._paletteId][i]||"black"})},t.prototype.getGroup=function(e){if(!this._data[e])return-1;var t=this._data[e].value;if(t<this._groups[0])return 0;for(var i=0;i<this._groups.length-1;i++)if(t>=this._groups[i]&&t<this._groups[i+1])return i+1;return t>=this._groups[this._groups.length-1]?this._groups.length:-1},t.prototype.createMap=function(){this._projection=d3.geo.mercator().scale(this._minScale).rotate([0,0,0]).center([0,30]).translate([this._mapWidth/2,this._mapHeight/2]),this._path=d3.geo.path().projection(this._projection),this._zoom=d3.behavior.zoom().translate(this._projection.translate()).scale(this._projection.scale()).scaleExtent([this._minScale,this._maxScale]).on("zoom",function(){if(e._detailedView){var t=e._projection.translate();return e._zoom.translate(t),void e._group.selectAll("text").attr("visibility",function(t){return e.checkLabelVisibility(this,t)}).attr("x",function(t){return t.geometry&&t.geometry.coordinates!==[]?e._path.centroid(t.geometry)[0].toString():""}).attr("y",function(t){return t.geometry&&t.geometry.coordinates!==[]?e._path.centroid(t.geometry)[1].toString():""})}var i=d3.event,n=i.translate,o=i.scale;e.redrawScalePoint(o);var r=!1,a=1;e._previousScale!==o&&(r=!0,a=o/e._previousScale,e._previousScale=o);var s=e._projection(e._projection.center()),l=e._projection([e._bounds.minLon,e._bounds.maxLat]),c=e._projection([e._bounds.maxLon,e._bounds.minLat]),u=e._projection.translate(),p=Math.abs(l[0]-s[0]),h=Math.abs(c[0]-s[0]),d=Math.abs(l[1]-s[1]),m=Math.abs(c[1]-s[1]);r?(p*a<e._mapWidth/2?n[0]=e._mapWidth/2:(n[0]+h*a<e._mapWidth&&(n[0]=e._mapWidth-h*a),n[0]-p*a>0&&(n[0]=p*a)),d*a<e._mapHeight/2?n[1]=e._mapHeight/2:(n[1]+m*a<e._mapHeight&&(n[1]=e._mapHeight-m*a),n[1]-d*a>0&&(n[1]=d*a))):(l[0]>0&&c[0]<e._mapWidth?n[0]=u[0]:n[0]>u[0]?n[0]=d3.min([n[0],p]):n[0]=d3.max([n[0],e._mapWidth-h]),l[1]>0&&c[1]<e._mapHeight?n[1]=u[1]:n[1]>u[1]?n[1]=d3.min([n[1],d]):n[1]=d3.max([n[1],e._mapHeight-m])),e._zoom.translate(n),e._projection.scale(o).translate(n),e._path=d3.geo.path().projection(e._projection),e._group.selectAll("path").attr("d",e._path),e._group.selectAll("text").attr("x",function(t){var i=e._path.centroid(t.geometry);return i[0]?i[0]:""}).attr("y",function(t){var i=e._path.centroid(t.geometry);return i[1]?i[1]+5:""}).attr("visibility",function(t){return e.checkLabelVisibility(this,t)})});var e=this;this._svg=d3.select(this._element).append("svg").attr("class","ranetMapContent").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("overflow","hidden"),this._group=this._svg.append("g").call(this._zoom).on("dblclick.zoom",null),this._background=this._group.append("rect").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("class","ranetMapBackground"),this._tooltip=d3.select(this._element).append("div").attr("class","popOvers")},t.prototype.createZoomButtons=function(){var e=this;this._zoomButtons=this._svg.append("g").attr("transform","translate(40,100)").attr("class","disableSelection");var t=this._zoomButtons.append("g").attr("class","zoomUp").attr("style","cursor: pointer;").on("click",function(){if(!(Math.floor(e._zoom.scale())>=e._maxScale-5)){var t=2;e._zoom.scale()*t>e._maxScale&&(t=e._maxScale/e._zoom.scale());var i=e._zoom.scale()*t,n=e._mapWidth/2,o=e._mapHeight/2,r=e._projection.translate(),a=n-r[0],s=o-r[1],l=[];l[0]=n-a*t,l[1]=o-s*t,e._svg.on("dblclick.zoom",null).call(e._zoom.translate(l).scale(i).event)}}),i=(t.append("rect").attr("width",22).attr("height",22).attr("x",0).attr("y",0).attr("fill","white").attr("stroke","darkgrey"),t.append("text").attr("x",11).attr("y",16).text("+").attr("text-anchor","middle").attr("fill","#4a9fe2").attr("font-weight","bolder"),this._zoomButtons.append("g").attr("class","zoomDown").attr("style","cursor: pointer;").on("click",function(){if(!(e._zoom.scale()<=e._minScale+5)){var t=.5;e._zoom.scale()*t<e._minScale&&(t=e._minScale/e._zoom.scale());var i=e._zoom.scale()*t,n=e._mapWidth/2,o=e._mapHeight/2,r=e._projection.translate(),a=n-r[0],s=o-r[1],l=[];l[0]=n-a*t,l[1]=o-s*t,e._svg.on("dblclick.zoom",null).call(e._zoom.scale(i).translate(l).event)}})),n=(i.append("rect").attr("width",22).attr("height",22).attr("x",0).attr("y",140).attr("fill","white").attr("stroke","darkgrey"),i.append("text").attr("x",11).attr("y",156).text("-").attr("text-anchor","middle").attr("fill","#4a9fe2").attr("font-weight","bolder"),d3.behavior.drag().on("drag",function(){var e=d3.event,t=d3.scale.linear().range([r._minScale,r._maxScale]).domain([0,100]),i=d3.scale.linear().range([0,100]).domain([r._minScale,r._maxScale]),n=r._zoom.scale(),o=t(i(n)-e.dy);if(!(o>r._maxScale||o<r._minScale)){var a=o/n,s=r._mapWidth/2,l=r._mapHeight/2,c=r._projection.translate(),u=s-c[0],p=l-c[1],h=[];h[0]=s-u*a,h[1]=l-p*a,r._svg.call(r._zoom.scale(o).translate(h).event).on("dblclick.zoom",null)}})),o=this._zoomButtons.append("g").attr("class","zoomScale");o.append("line").attr("x1",11).attr("x2",11).attr("y1",22).attr("y2",140).attr("stroke","#4c4c4c").attr("stroke-width",4);this._zoomScalePoint=o.append("rect").attr("width",20).attr("height",6).attr("x",1).attr("y",128).attr("fill","white").attr("stroke","darkgrey").attr("style","cursor: pointer;").call(n);var r=this},t.prototype.createTooltip=function(){var e=this;if(this._tooltipOptions.enabled){var t=this;this._popover=$(this._svg.node()).popover({container:".mapContainer .popOvers",trigger:"manual",content:function(){return"123"},html:!0,delay:0,placement:"auto top",template:'<div class="popover chartPopover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),$(this._svg.node()).on("mousemove",function(t){e.updateTooptipPosition(t)}),this._group.selectAll(".countries > path").on("mouseenter",function(){d3.select(this).node()!==d3.select(".countryHovered").node()&&t.toggleCountryHover(this)}).on("mouseover",function(e){t.showTooltip();var i=t._customizeTooltip(e);t.tooltipContent(i)}),this._group.selectAll(".labels > text").on("mouseenter",function(t){e.showTooltip();var i=e._customizeTooltip(t);e.tooltipContent(i)}).on("mouseleave",function(){e.hideTooltip()})}},t.prototype.drawDetails=function(t){var i=this;if(this._detailedView&&(this._group.selectAll(".country-"+this._selectedCountry).style("visibility","visible"),this._group.selectAll(".regions").remove(),this._group.selectAll(".region-labels").remove(),this._returnButton.remove()),this._selectedCountry=t,"USA"===t)return this._usaDetails=new e.UsaDetailedMap(this._element,this._detailedMapSettings,this._popover,this._data,this._updateData),this.hideTooltip(),this.detailedView(!0),void this._svg.style("display","none");e.MapDataHelper.getDetailedMapData(t).done(function(e){var n=JSON.parse(e.data);"RUS"===t||"FJI"===t?i._projection.rotate()!==[-130,0,0]&&(i._projection.rotate([-130,0,0]),i._path=d3.geo.path().projection(i._projection),i._group.selectAll("path").attr("d",i._path)):i._projection.rotate()!==[0,0,0]&&(i._projection.rotate([0,0,0]),i._path=d3.geo.path().projection(i._projection),i._group.selectAll("path").attr("d",i._path));var o=topojson.feature(n,n.objects[t]);if(i._group.append("g").attr("class","regions").selectAll("path").data(o.features).enter().append("path").attr("class",function(e){return"region-"+e.properties.HASC_1.replace(".","-")}).attr("d",i._path),i._tooltipOptions.enabled&&i._group.selectAll(".regions > path").on("mouseover",function(e){if(e.properties.HASC_1){i.showTooltip();var t=i._detailedMapSettings.tooltip.customizeTooltip.call(i,e);i.tooltipContent(t)}else i.hideTooltip()}).on("mouseleave",function(){i.hideTooltip()}),i._detailedMapSettings.showRegionNames){for(var r=i,a=o.features,s=0;s<a.length;s++)a[s].geometry&&(a[s].geometry.coordinates=[i.getLargestBoundingRegion(a[s])],a[s].geometry.type="Polygon");i._group.append("g").attr("class","region-labels").selectAll("text").data(a).enter().append("text").attr("x",function(e){var t=r._path.centroid(e.geometry);return t[0]?t[0]:""}).attr("y",function(e){var t=r._path.centroid(e.geometry);return t[1]?t[1]:""}).text(function(e){return e.properties.NAME}).attr("text-anchor","middle").attr("font-size",10).attr("visibility",function(e){return"hidden"}),i._tooltipOptions.enabled&&i._group.selectAll(".region-labels > text").on("mouseover",function(e){if(e.properties.HASC_1){i.showTooltip();var t=i._detailedMapSettings.tooltip.customizeTooltip.call(i,e);i.tooltipContent(t)}else i.hideTooltip()}).on("mouseleave",function(){i.hideTooltip()})}i._detailedBounds=i._path.bounds(o);var l=i._detailedBounds,c=l[1][0]-l[0][0],u=l[1][1]-l[0][1],p=(l[0][0]+l[1][0])/2,h=(l[0][1]+l[1][1])/2,d=.9/Math.max(c/i._mapWidth,u/i._mapHeight),m=[i._mapWidth/2-d*p,i._mapHeight/2-d*h];i._group.on(".zoom",null),i._group.transition().duration(750).style("stroke-width",1.5/d+"px").attr("transform","translate("+m+")scale("+d+")").each("end",function(){i._group.selectAll("text").attr("font-size",function(){return 10/d}),i.resize()}),i.updateDetailedMap(),i.detailedView(!0),i._group.selectAll(".country-"+t).style("visibility","hidden")})},t.prototype.resizeDetailedMap=function(){var e=this,t=this._detailedBounds,i=t[1][0]-t[0][0],n=t[1][1]-t[0][1],o=(t[0][0]+t[1][0])/2,r=(t[0][1]+t[1][1])/2,a=.9/Math.max(i/this._mapWidth,n/this._mapHeight),s=[this._mapWidth/2-a*o,this._mapHeight/2-a*r];this._group.on(".zoom",null),this._group.transition().duration(750).style("stroke-width",1.5/a+"px").attr("transform","translate("+s+")scale("+a+")").each("end",function(){e._group.selectAll("text").attr("font-size",function(){return 10/a})})},t.prototype.updateDetailedMap=function(){var e=this;this._group.selectAll(".regions path").style("fill",function(t){var i=e.getDetailedGroup(t.properties.HASC_1);return-1===i?"#c8c8c8":e._detailedMapSettings.palette[i]||"black"})},t.prototype.getDetailedGroup=function(e){if(!e)return-1;if(e=e.replace(".","-"),!this._detailedData[e])return-1;var t=this._detailedData[e].value;if(t<this._detailedMapSettings.groups[0])return 0;for(var i=0;i<this._detailedMapSettings.groups.length-1;i++)if(t>=this._detailedMapSettings.groups[i]&&t<this._detailedMapSettings.groups[i+1])return i+1;return t>=this._detailedMapSettings.groups[this._detailedMapSettings.groups.length-1]?this._detailedMapSettings.groups.length:-1},t.prototype.detailedView=function(e){var t=this;this._detailedView=e,this._detailedView?(this._prevMapWidth=this._mapWidth,this._prevMapHeight=this._mapHeight,this.displayControls(!1)):("USA"===this._selectedCountry&&(this._svg.style("display","inline-block"),this._usaDetails.delete()),this.displayControls(!0),this._group.selectAll(".country-"+this._selectedCountry).style("visibility","visible"),this._group.selectAll(".regions").remove(),this._group.selectAll(".region-labels").remove(),this._selectedCountry=null,this._group.transition().duration(750).style("stroke-width","1.5px").attr("transform","").each("end",function(){t._group.selectAll("text").attr("font-size",10),t._group.call(t._zoom).on("dblclick.zoom",null),t._projection.rotate()!==[0,0,0]&&t._projection.rotate([0,0,0]),t.resize()})),this.updateColors()},t.prototype.closeDetails=function(){this.detailedView(!1)},t.prototype.displayControls=function(e){e?(this._transButtons.style("visibility","visible"),this._zoomButtons.style("visibility","visible")):(this._transButtons.style("visibility","hidden"),this._zoomButtons.style("visibility","hidden"))},t.prototype.createTranslateButtons=function(){var e=this;this._transButtons=this._svg.append("g").attr("transform","translate(20,20)").attr("class","disableSelection");var t=this._transButtons.append("g").attr("class","transUp").attr("style","cursor: pointer;").on("click",function(){var t=e._projection.translate();t[1]=t[1]+40,e._svg.call(e._zoom.translate(t).event).on("dblclick.zoom",null)}),i=(t.append("rect").attr("width",22).attr("height",22).attr("x",20).attr("y",-7).attr("fill","white").attr("stroke","darkgray"),t.append("image").attr("x",14).attr("y",9).attr("height",15).attr("width",15).attr("transform","rotate(90, 33, 14.5)").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII="),this._transButtons.append("g").attr("class","transLeft").attr("style","cursor: pointer;").on("click",function(){var t=e._projection.translate();t[0]=t[0]+40,e._svg.call(e._zoom.translate(t).event).on("dblclick.zoom",null)})),n=(i.append("rect").attr("width",22).attr("height",22).attr("x",-7).attr("y",20).attr("fill","white").attr("stroke","darkgray"),i.append("image").attr("x",-5).attr("y",23).attr("height",15).attr("width",15).attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII="),this._transButtons.append("g").attr("class","transRight").attr("style","cursor: pointer;").on("click",function(){var t=e._projection.translate();t[0]=t[0]-40,e._svg.call(e._zoom.translate(t).event).on("dblclick.zoom",null)})),o=(n.append("rect").attr("width",22).attr("height",22).attr("x",47).attr("y",20).attr("fill","white").attr("stroke","darkgray"),n.append("image").attr("x",46).attr("y",21).attr("height",15).attr("width",15).attr("transform","rotate(180, 56, 30)").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII="),this._transButtons.append("g").attr("class","transDown").attr("style","cursor: pointer;").on("click",function(){var t=e._projection.translate();t[1]=t[1]-40,e._svg.call(e._zoom.translate(t).event).on("dblclick.zoom",null)}));o.append("rect").attr("width",22).attr("height",22).attr("x",20).attr("y",47).attr("fill","white").attr("stroke","darkgray"),o.append("image").attr("x",14).attr("y",50).attr("height",15).attr("width",15).attr("transform","rotate(270, 27, 53.5)").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII=")},t.prototype.redrawScalePoint=function(e){var t=d3.scale.linear().range([0,100]).domain([this._minScale,this._maxScale])(e);this._zoomScalePoint.attr("transform","translate(0,"+-t+")")},t.prototype.getLargestBoundingRegion=function(e){var t;if(null===e.geometry)return[0,0];if("MultiPolygon"===e.geometry.type){for(var i={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[0]}},n=1;n<e.geometry.coordinates.length;n++){var o={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[n]}};this._path.area(o)>this._path.area(i)&&(i=o,t=e.geometry.coordinates[n][0])}t||i.geometry.coordinates&&(t=i.geometry.coordinates[0])}else t=e.geometry.coordinates[0];return t},t.prototype.showTooltip=function(){$(this._popover).data("bs.popover").tip().hasClass("in")||$(this._svg.node()).popover("show")},t.prototype.hideTooltip=function(){$(this._svg.node()).popover("hide")},t.prototype.updateTooptipPosition=function(e){var t=$(this._popover).data("bs.popover");$(e.target)[0]!==$(this._background)[0][0]?t.$tip&&t.$tip.addClass(t.options.placement).attr("style","top: "+(e.pageY-t.$tip.height()-15)+"px; left: "+(e.pageX-t.$tip.width()/2)+"px; display: block;"):this.hideTooltip()},t.prototype.toggleCountryHover=function(e){var t=this;this._group.select(".countryHovered").attr("class",function(e){return"country-"+e.properties.ADM0_A3}),e.parentNode.appendChild(e),d3.select(e).on("dblclick",function(e){t._detailedMapSettings.enable&&t._updateData.call(t,e.properties.ADM0_A3)}).attr("class",function(e){return"countryHovered country-"+e.properties.ADM0_A3})},t.prototype.tooltipContent=function(e){var t=d3.event,i=$(this._popover).attr("data-content",e).data("bs.popover");i.setContent(),i.$tip.addClass(i.options.placement).attr("style","top: "+(t.pageY-i.$tip.height()-15)+"px; left: "+(t.pageX-i.$tip.width()/2)+"px; display: block;")},t.prototype.checkLabelVisibility=function(e,t){var i,n;return(!this._showCountryLabels||"Admin-0 country"!==t.properties.featurecla||(i=this._group.select(".country-"+t.properties.ADM0_A3).node(),n=i.getBoundingClientRect(),e.getBoundingClientRect().width>n.width||t.properties.ADM0_A3===this._selectedCountry))&&(!this._detailedMapSettings.showRegionNames||"Admin-0 country"===t.properties.featurecla||(i=this._group.select(".region-"+t.properties.HASC_1.replace(".","-")).node(),n=i.getBoundingClientRect(),e.getBoundingClientRect().width>n.width||t.properties.ADM0_A3===this._selectedCountry))?"hidden":"visible"},t.prototype.hide=function(){$(this._element).css("display","none")},t.prototype.show=function(){$(this._element).css("display","inline-block"),this.resize()},t.prototype.resize=function(){this._detailedView||-1!==this._prevMapWidth||(this._prevMapWidth=this._mapWidth,this._prevMapHeight=this._mapHeight);var t=this._element.getBoundingClientRect();if(this._legend.position===e.Position.Bottom||this._legend.position===e.Position.Top?(this._mapHeight=t.height-this._legend.height,this._mapHeight<0&&(this._mapHeight=0),this._mapWidth=t.width):(this._mapHeight=t.height,this._mapHeight<0&&(this._mapHeight=0),Math.floor(t.width-this._legend.width-4)>=0?this._mapWidth=Math.floor(t.width-this._legend.width-4):this._mapWidth=0),this._svg.attr("width",this._mapWidth).attr("height",this._mapHeight),this._background.attr("width",this._mapWidth).attr("height",this._mapHeight),this._detailedView)this._usaDetails?this._usaDetails.resize():this.resizeDetailedMap();else{var i=this._projection.translate();i[0]-=this._prevMapWidth/2,i[1]-=this._prevMapHeight/2,this._prevMapWidth=-1,i[0]+=this._mapWidth/2,i[1]+=this._mapHeight/2,this._projection.translate(i),this._zoom.translate(i)}this._svg.call(this._zoom.event).on("dblclick.zoom",null)},t.prototype.test=function(){this._legend.visibility=!this._legend.visibility},t.prototype.throwError=function(e){this.hide();var t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-warning"),t.classList.add("fade"),t.classList.add("in"),t.innerHTML=e,t.setAttribute("id","vectorMapError"),this._element.parentElement.appendChild(t)},t.prototype.clearError=function(){var e=this._element.parentElement.querySelector("#vectorMapError");e&&d3.select(e).remove()},Object.defineProperty(t.prototype,"paletteId",{get:function(){return this._paletteId},set:function(e){this._paletteId=e%this._palette.length,this._legend.palette=this._palette[this._paletteId],this._detailedMapSettings.palette=this._palette[this._paletteId],this.updateColors()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pallete",{get:function(){return this._palette[this._paletteId]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e,this._zoom.scaleExtent([this._minScale,this._maxScale])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this._zoom.scaleExtent([this._minScale,this._maxScale])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this._groups},set:function(t){this._groups=t||e.MapDataHelper.generateGroups(this._data,5),this._legend.groups=t,this._detailedMapSettings.groups=this._groups,this.resize(),this.updateColors()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e,this.updateColors(),this._detailedData=e,this.updateDetailedMap(),this._usaDetails&&(this._usaDetails.data=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"details",{get:function(){return this._selectedCountry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return{data:this._data,groups:this._groups,maxScale:this._maxScale,minScale:this._minScale,palette:this._palette,bounds:this._bounds,tooltip:this._tooltipOptions,legend:this._legend.settings,detailedMapSettings:this._detailedMapSettings}},set:function(e){this._palette=e.palette||this._palette,this.data=e.data||this.data,this.minScale=e.minScale||this.minScale,this.maxScale=e.maxScale||this.maxScale},enumerable:!0,configurable:!0}),t}();e.VectorMap=t}(e.Extensions||(e.Extensions={}))}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){function t(e){if(null==e||"object"!=typeof e)return e;var i=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(i[n]=t(e[n]));return i}e.ranetVectorMap=function(i,n){var o=this,r={data:{},groups:[],showCountryLabels:!1,minScale:100,maxScale:3200,paletteId:0,tooltip:{enabled:!0},legend:{visible:!0},presetDetailedRegion:"",detailedMapSettings:{enable:!1,showRegionNames:!0,tooltip:{enabled:!0,customizeTooltip:function(e){var t,i=this._detailedData[e.properties.HASC_1.replace(".","-")];return t=i?i.displayValue:"N/A",(e.properties.NAME||"Disput territory")+" "+t}}}};this.settings=t(r);var a;this.option=function(t,n){if(void 0===n)return a&&(o.settings[t]=a[t]),o.settings[t];var r;if("details"===t)return a?a.details:null;"data"===t?e.isEmptyObject(n)?a?(o.settings[t]=n,a[t]=n):(a=new Ranet.Controls.Extensions.VectorMap(i,o.settings),o.error("No countries or regions specified in datasource.")):a?(o.settings[t]=n,a[t]=n):(o.settings.data=n,a=new Ranet.Controls.Extensions.VectorMap(i,o.settings)):(r="groups"===t||"paletteId"===t?n:a?e.extend({},a[t],n):n,o.settings[t]=r,a&&(a[t]=r)),a&&(o.settings=a.options)},this.options=function(){return a?a.options:o.settings},this.hide=function(){a&&a.hide()},this.show=function(){a&&a.show()},this.test=function(){a&&a.test()},this.drawDetails=function(e){a&&a.drawDetails(e)},this.closeDetails=function(){a&&a.closeDetails()},this.resize=function(){a&&a.resize()},this.error=function(e){a.throwError(e)},this.clearError=function(){a&&a.clearError()};var s=function(e){0!==i.getBoundingClientRect().width&&a&&a.resize()};this.destroy=function(){e(window).off("resize",s)},o.settings.minScale=n.minScale||o.settings.minScale,o.settings.maxScale=n.maxScale||o.settings.maxScale,o.settings.bounds=e.extend(o.settings.bounds,n.bounds),o.settings.tooltip=e.extend(o.settings.tooltip,n.tooltip),o.settings.data=e.extend(o.settings.data,n.data),o.settings.groups=e.extend(o.settings.groups,n.groups),o.settings.detailedMapSettings=e.extend(o.settings.detailedMapSettings,n.detailedMapSettings),o.settings.updateData=n.updateData,e.isEmptyObject(o.settings.data)||(a=new Ranet.Controls.Extensions.VectorMap(i,o.settings),o.settings=a.options),e(window).on("resize",s)},e.fn.ranetVectorMap=function(t){return this.each(function(){if(void 0==e(this).data("ranetVectorMap")){var i=new e.ranetVectorMap(this,t);e(this).data("ranetVectorMap",i)}})}}(jQuery);var Ranet;!function(e){!function(t){!function(t){var i=function(){function t(){this._$view=null,this._$headerTextArea=$('<textarea class="rightExtView_textArea" readonly></textarea>'),this._$footerTextArea=$('<textarea class="rightExtView_textArea" readonly></textarea>')}return Object.defineProperty(t.prototype,"headerText",{get:function(){return this._$headerTextArea.val()},set:function(e){this._$headerTextArea.val(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerText",{get:function(){return this._$footerTextArea.val()},set:function(e){this._$footerTextArea.val(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return null===this._$view&&(this._$view=this.getView()),this._$view},enumerable:!0,configurable:!0}),t.prototype.getView=function(){var t=this,i=$("<div class='rightExtView_container'/>"),n=e.Localization.localize("PivotGrid_EditHeaderAndFooter_ToolTip"),o=$('<div title="'+n+"\" class='imageLibrary_edit rightExtView_icon rightExtView_editButton'></div>");o.click(function(){o.toggleClass("rightExtView_editButton-active"),t._$headerTextArea.removeAttr("readonly"),t._$footerTextArea.removeAttr("readonly"),o.hasClass("rightExtView_editButton-active")||(t._$headerTextArea.attr("readonly","true"),t._$footerTextArea.attr("readonly","true"))}),i.append(o);var r=$("<div><div class='imageLibrary_pivotGridHeader rightExtView_icon'></div><span>"+e.Localization.localize("PivotGrid_HeaderText")+"</span></div>"),a=$('<div class="rightExtView_textAreaContainer"></div>');a.append(this._$headerTextArea);var s=$('<div class="rightExtView_itemLayout"/>');s.append(r),s.append(a);var l=$('<div class="rightExtView_itemLayout"/>'),c=$("<div><div class='imageLibrary_pivotGridFooter rightExtView_icon'></div><span>"+e.Localization.localize("PivotGrid_FooterText")+"</span></div>"),u=$('<div class="rightExtView_textAreaContainer"></div>');return u.append(this._$footerTextArea),l.append(c),l.append(u),i.append(s),i.append(l),this.activateResizable(a),this.activateResizable(u),i},t.prototype.activateResizable=function(e){e.resizable({helper:"resizable-helper",handles:"s",stop:function(t,i){e.css("width","")}})},t}();t.RightExtView=i}(t.RightExtensionView||(t.RightExtensionView={}))}(e.View||(e.View={}))}(Ranet||(Ranet={})),function(e){var t;!function(e){e[e.Right=0]="Right",e[e.Left=1]="Left",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom"}(t||(t={}));var i=function(){function e(){this.countRowsColumnsPane=0,this.countColumnsRowsPane=0,this.defaultCellHeight=22,this.defaultColumnWidth=130,this.minColumnWidth=10,this.minRowHeight=10,this.levelDepthOffset=20,this.additionalWithCellsPanel=80,this.additionalHeightCellsPanel=30,this.mapWidthCells={},this.mapHeightCells={},this.mapWidthColumnInRowsPanel={},this.mapHeightRowInColumnsPanel={}}function t(){for(var e=0,t=0;t<this.countColumnsRowsPane;t++)e+=this.getWidthColumnRowsPanel(t);return e}return Object.defineProperty(e.prototype,"widthContentRowsPanel",{get:function(){return t.call(this)-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"widthRowsPanel",{get:function(){return void 0===this._widthRowsPanel?t.call(this):this._widthRowsPanel},set:function(e){this._widthRowsPanel=e},enumerable:!0,configurable:!0}),e.prototype.columnsPanelHeight=function(){for(var e=0,t=0;t<this.countRowsColumnsPane;t++)e+=this.getHeightRowColumnsPanel(t);return e},e.prototype.getSizeColumn=function(e){return this.mapWidthCells.hasOwnProperty(e)?this.mapWidthCells[e]:this.defaultColumnWidth},e.prototype.setSizeColumn=function(e,t){this.mapWidthCells[e]=t},e.prototype.setSizeRow=function(e,t){this.mapHeightCells[e]=t},e.prototype.getSizeRow=function(e){return this.mapHeightCells.hasOwnProperty(e)?this.mapHeightCells[e]:this.defaultCellHeight},e.prototype.setWidthColumnRowsPanel=function(e,t){this.mapWidthColumnInRowsPanel[e]={value:t,isDefault:!1}},e.prototype.setDefaultWidthColumnInRowsPanel=function(e,t){e in this.mapWidthColumnInRowsPanel||(this.mapWidthColumnInRowsPanel[e]={value:t,isDefault:!0})},e.prototype.getWidthColumnRowsPanel=function(e){return this.mapWidthColumnInRowsPanel.hasOwnProperty(e)?this.mapWidthColumnInRowsPanel[e].value:200},e.prototype.setHeightRowColumnsPanel=function(e,t){this.mapHeightRowInColumnsPanel[e]={value:t,isDefault:!1}},e.prototype.setDefaultHeightRowInColumnsPanel=function(e,t){e in this.mapHeightRowInColumnsPanel||(this.mapHeightRowInColumnsPanel[e]={value:t,isDefault:!0})},e.prototype.getHeightRowColumnsPanel=function(e){return this.mapHeightRowInColumnsPanel.hasOwnProperty(e)?this.mapHeightRowInColumnsPanel[e].value:40},e.prototype.saveState=function(e){this._backupWidthCell={},this._backupHeightCell={},this._backupWithColumnRowsPanel={},this._backupHeightRowColumnsPanel={};var t,i,n,o;for(t in this.mapWidthCells)if(this.mapWidthCells.hasOwnProperty(t)){for(n="",o=0;o<e.countHierarchyInColumns;o++)""!==n&&(n+="+"),n+=e.getDataColumnAction(Number(t),o).uniqueName;this._backupWidthCell[n]=this.mapWidthCells[t]}for(t in this.mapHeightCells)if(this.mapHeightCells.hasOwnProperty(t)){for(n="",o=0;o<e.countHierarchyInRows;o++)""!==n&&(n+="+"),n+=e.getDataRowAction(o,Number(t)).uniqueName;this._backupHeightCell[n]=this.mapHeightCells[t]}var r,a;for(t in this.mapWidthColumnInRowsPanel)if(this.mapWidthColumnInRowsPanel.hasOwnProperty(t)&&!1===this.mapWidthColumnInRowsPanel[t].isDefault)if("hierarchy"===e.indexToTypeRows[t])a=e.absoluteIndexItemToHierarchyIndexRows[Number(t)],i=e.getHierarchyDescriptionInRows(a),this._backupWithColumnRowsPanel[i.uniqueName]=this.mapWidthColumnInRowsPanel[t].value;else{if("customProperty"!==e.indexToTypeRows[t])throw new Error("NotImplementedException");r=e.getLevelPropertyInRows(Number(t)).name,this._backupWithColumnRowsPanel[r]=this.mapWidthColumnInRowsPanel[t].value}for(t in this.mapHeightRowInColumnsPanel)if(this.mapHeightRowInColumnsPanel.hasOwnProperty(t)&&!1===this.mapHeightRowInColumnsPanel[t].isDefault)if("hierarchy"===e.indexToTypeColumns[t])a=e.absoluteIndexItemToHierarchyIndexColumns[Number(t)],i=e.getHierarchyDescriptionInColumns(a),this._backupHeightRowColumnsPanel[i.uniqueName]=this.mapHeightRowInColumnsPanel[t].value;else{if("customProperty"!==e.indexToTypeColumns[t])throw new Error("NotImplementedException");r=e.getLevelPropertyInColumns(Number(t)).name,this._backupHeightRowColumnsPanel[r]=this.mapHeightRowInColumnsPanel[t].value}},e.prototype.restoreState=function(e){this.mapWidthCells={},this.mapHeightCells={},this.mapWidthColumnInRowsPanel={},this.mapHeightRowInColumnsPanel={};var t,i,n;if(void 0!==this._backupWidthCell&&e.countHierarchyInColumns>0)for(var o=0;o<e.maxColumns;o++){for(n="",i=0;i<e.countHierarchyInColumns;i++)""!==n&&(n+="+"),n+=e.getDataColumnAction(o,i).uniqueName;n in this._backupWidthCell&&(this.mapWidthCells[o]=this._backupWidthCell[n])}if(void 0!==this._backupHeightCell&&e.countHierarchyInRows>0)for(var r=0;r<e.maxRows;r++){for(n="",i=0;i<e.countHierarchyInRows;i++)""!==n&&(n+="+"),n+=e.getDataRowAction(i,r).uniqueName;n in this._backupHeightCell&&(this.mapHeightCells[r]=this._backupHeightCell[n])}var a;if(void 0!==this._backupWithColumnRowsPanel)for(var s=0;s<e.countColumnsInRows;s++)if("hierarchy"===e.indexToTypeRows[s])a=e.absoluteIndexItemToHierarchyIndexRows[s],(t=e.getHierarchyDescriptionInRows(a)).uniqueName in this._backupWithColumnRowsPanel&&(this.mapWidthColumnInRowsPanel[s]={value:this._backupWithColumnRowsPanel[t.uniqueName],isDefault:!1});else{if("customProperty"!==e.indexToTypeRows[s])throw new Error("NotImplementedException");var l=e.getLevelPropertyInRows(s).name;l in this._backupWithColumnRowsPanel&&(this.mapWidthColumnInRowsPanel[s]={value:this._backupWithColumnRowsPanel[l],isDefault:!1})}if(void 0!==this._backupHeightRowColumnsPanel)for(var c=0;c<e.countRowsInColumns;c++)if("hierarchy"===e.indexToTypeColumns[c])a=e.absoluteIndexItemToHierarchyIndexColumns[c],(t=e.getHierarchyDescriptionInColumns(a)).uniqueName in this._backupHeightRowColumnsPanel&&(this.mapHeightRowInColumnsPanel[c]={isDefault:!1,value:this._backupHeightRowColumnsPanel[t.uniqueName]});else{if("customProperty"!==e.indexToTypeColumns[c])throw new Error("NotImplementedException");var u=e.getLevelPropertyInColumns(c).name;u in this._backupHeightRowColumnsPanel&&(this.mapHeightRowInColumnsPanel[c]={isDefault:!1,value:this._backupHeightRowColumnsPanel[u]})}},e}(),n=function(){function t(t,i){if(e(t).hasClass(i))return t;for(var n=e(t).parents(),o=0;o<n.length;o++)if(e(n[o]).hasClass(i))return n[o]}function i(e){var t="";return e.hasClass("fa-caret-right")?t="expand":e.hasClass("fa-caret-down")?t="collapse":e.hasClass("pivotTable-contentHeader")&&(t="drillDown"),t}function o(o,r,a){var s=e(o);if(s.hasClass("fa-caret-right")||s.hasClass("fa-caret-down")){var l=i(s),c=n.findHierarchyItem(o);if(c){var u=Number(e(c).attr("data-end-column")),p=Number(e(c).attr("data-start-column")),h=Number(e(t(c,"pivotTable-panel")).attr("data-index-hierarchy")),d={place:"columns",row:h,endColumn:u,startColumn:p,data:r.getDataColumnAction(u,h),hierarchy:r.getHierarchyInColumns(h),ancestors:r.getAncestorsInColumns(u,h),actionType:l};h>0&&(d.neighborsHierarchy=r.getNeighborsHierarchyInColumns(u,h)),a(c,d)}}}function r(o,r,a){var s=e(o);if(s.hasClass("fa-caret-right")||s.hasClass("fa-caret-down")){var l=i(s),c=n.findHierarchyItem(o);if(c){var u=Number(e(c).attr("data-end-row")),p=Number(e(c).attr("data-start-row")),h=Number(e(t(c,"pivotTable-panel")).attr("data-index-hierarchy")),d={place:"rows",endRow:u,startRow:p,column:h,data:r.getDataRowAction(h,u),hierarchy:r.getHierarchyInRows(h),ancestors:r.getAncestorsInRows(h,u),actionType:l};h>0&&(d.neighborsHierarchy=r.getNeighborsHierarchyInRows(h,u)),a(c,d)}}}function a(i,o,r){var a=n.findHierarchyItem(i);if(a){var s=Number(e(a).attr("data-end-column")),l=Number(e(a).attr("data-start-column")),c=Number(e(t(a,"pivotTable-panel")).attr("data-index-hierarchy")),u=o.getDataColumnAction(s,c),p=void 0;o.columnIsParent(s,c)?p="expanded":o.hasChildrenColumnsPanel(s,c)&&(p="collapsed");var h={place:"columns",row:c,endColumn:s,startColumn:l,data:u,hierarchy:o.getHierarchyInColumns(c),ancestors:o.getAncestorsInColumns(s,c),actionType:void 0,currentState:p};c>0&&(h.neighborsHierarchy=o.getNeighborsHierarchyInColumns(s,c)),r(a,h)}}function s(i,o,r){var a=n.findHierarchyItem(i);if(a){var s=Number(e(a).attr("data-start-row")),l=Number(e(a).attr("data-end-row")),c=Number(e(t(a,"pivotTable-panel")).attr("data-index-hierarchy")),u=o.getDataRowAction(c,l),p=void 0;o.rowIsParent(c,l)?p="expanded":o.hasChildrenRowsPanel(c,l)&&(p="collapsed");var h={place:"rows",endRow:l,column:c,startRow:s,data:u,hierarchy:o.getHierarchyInRows(c),ancestors:o.getAncestorsInRows(c,l),actionType:void 0,currentState:p};c>0&&(h.neighborsHierarchy=o.getNeighborsHierarchyInRows(c,l)),r(a,h)}}function l(i,o){var r=n.findHierarchyItem(i);if(!r)return null;var a=Number(e(r).attr("data-end-column")),s=Number(e(r).attr("data-start-column")),l=Number(e(t(r,"pivotTable-panel")).attr("data-index-hierarchy")),c=void 0;o.columnIsParent(a,l)?c="expanded":o.hasChildrenColumnsPanel(a,l)&&(c="collapsed");var u={place:"columns",row:l,endColumn:a,startColumn:s,data:o.getDataColumnAction(a,l),hierarchy:o.getHierarchyInColumns(l),ancestors:o.getAncestorsInColumns(a,l),currentState:c};return l>0&&(u.neighborsHierarchy=o.getNeighborsHierarchyInColumns(a,l)),{element:r,data:u}}function c(i,o){var r=n.findHierarchyItem(i);if(!r)return null;var a=Number(e(r).attr("data-end-row")),s=Number(e(r).attr("data-start-row")),l=Number(e(t(r,"pivotTable-panel")).attr("data-index-hierarchy")),c=void 0;o.rowIsParent(l,a)?c="expanded":o.hasChildrenRowsPanel(l,a)&&(c="collapsed");var u={place:"rows",endRow:a,startRow:s,column:l,data:o.getDataRowAction(l,a),hierarchy:o.getHierarchyInRows(l),ancestors:o.getAncestorsInRows(l,a),currentState:c};return l>0&&(u.neighborsHierarchy=o.getNeighborsHierarchyInRows(l,a)),{element:r,data:u}}function u(e,t,i,n,o,r){this._onContextMenuCallback=r,this._onActionHeader=n,this._onHeaderTouch=o,this._$paneColumns=e,this._$paneRows=t,this._dataManager=i}return u.prototype.activateMouseActions=function(){var t=this;e(this._$paneColumns).mousedown(function(e){if(Ranet.ClientInformation.isMobileBrowser())a(e.target,t._dataManager,t._onHeaderTouch);else{if(1!==e.which)return;o(e.target,t._dataManager,t._onActionHeader)}}),e(this._$paneRows).mousedown(function(e){if(Ranet.ClientInformation.isMobileBrowser())s(e.target,t._dataManager,t._onHeaderTouch);else{if(1!==e.which)return;r(e.target,t._dataManager,t._onActionHeader)}})},u.prototype.activateContextMenu=function(){var e=this;this._$paneColumns.on("contextmenu",function(t){var i=l(t.target,e._dataManager);if(!i)return!1;var n={elementDescription:i.data,eventArgs:t};return e._onContextMenuCallback(i.element,n),!1}),this._$paneRows.on("contextmenu",function(t){var i=c(t.target,e._dataManager);if(!i)return!1;var n={elementDescription:i.data,eventArgs:t};return e._onContextMenuCallback(i.element,n),!1})},u.findHierarchyItem=function(e){return t(e,"pivotTable-hierarchyItem")},u}(),o=function(){function t(e,t){for(var i=[],n=e.startColumn;n<=e.endColumn;n++)for(var o=e.startRow;o<=e.endRow;o++){var r=t.getCellData(n,o),a=t.getDescriptionOfTuplesForCell(n,o),s={cellData:r,rows:a.rows,columns:a.columns,rowIndex:o,columnIndex:n};i.push(s)}return i}function i(e,t){var i=null,n=(i=e.hasClass("pivotTable-cell")?e:e.parents(".pivotTable-cell")).parents(".pivotTable-panel"),o=Number(i.attr("data-row")),r=Number(n.attr("data-column"));if(NaN===o||NaN===r)throw new Error("InvalidOperationException");var a=t.getCellData(r,o),s=t.getDescriptionOfTuplesForCell(r,o);return{element:i,data:a,rows:s.rows,columns:s.columns,rowIndex:o,columnIndex:r}}function n(e,t,i,n){this._$cellsPanel=e,this._dataManager=t,this._selectedCellManager=i,this._onShowContextMenuCallback=n}return n.prototype.activateContextMenu=function(){var n=this;this._$cellsPanel.on("contextmenu",function(o){var r=e(o.target);if(r.hasClass("pivotTable-cellsPanel"))return!0;var a=i(r,n._dataManager);if(!a)return!0;if(n._selectedCellManager.hasSelectionCells&&n._selectedCellManager.selectionCellsContainsCell(a.columnIndex,a.rowIndex)){var s=n._selectedCellManager.focusedCell,l=n._dataManager.getCellData(s.columnFocusedCell,s.rowFocusedCell),c=n._dataManager.getDescriptionOfTuplesForCell(s.columnFocusedCell,s.rowFocusedCell),u={$cell:a.element,sender:o,focusedCellDescription:{cellData:l,rows:c.rows,columns:c.columns},selectedCells:t(n._selectedCellManager.rangeSelectedCells,n._dataManager)};n._onShowContextMenuCallback(u)}else{var p={$cell:a.element,sender:o,focusedCellDescription:{cellData:a.data,rows:a.rows,columns:a.columns},selectedCells:[{cellData:a.data,rows:a.rows,columns:a.columns}]};n._onShowContextMenuCallback(p)}return!1})},n}(),r=function(){function i(e,i){var n,o,r=!1;if(e===t.Bottom){if(!(n=i.offset()))return!0;o=this._$cellsScrollPanel.offset();var a=this._$cellsScrollPanel.height(),s=i.height();n.top+s+23>o.top+a&&(r=!0)}if(e===t.Top){if(o=this._$cellsScrollPanel.offset(),!(n=i.offset()))return!0;o.top>n.top&&(r=!0)}if(e===t.Left){if(!(n=i.offset()))return!0;(o=this._$cellsScrollPanel.offset()).left>n.left&&(r=!0)}if(e===t.Right){if(!(n=i.offset()))return!0;o=this._$cellsScrollPanel.offset();var l=this._$cellsScrollPanel.width(),c=i.width();o.left+l-23<n.left+c&&(r=!0)}return r}function n(e,n){var o=this.maxIndexColumn,r=this.maxIndexRow,a=null===this.focusedCell?-1:this.focusedCell.columnFocusedCell,s=null===this.focusedCell?-1:this.focusedCell.rowFocusedCell,l=i.call(this,n,e);if(!e.length||l){if(n===t.Left||n===t.Right){var c=this._$cellsScrollPanel.scrollLeft();if(n===t.Right)for(var u=a-1;u<=a;u++)c+=this.sizeManager.getSizeColumn(u);if(n===t.Left)for(var p=a+1;p>=a;p--)c-=this.sizeManager.getSizeColumn(p);a===o&&(c=this._$paneCells.width()-this._$cellsScrollPanel.width()+15),this._$cellsScrollPanel.scrollLeft(c)}else if(n===t.Top||n===t.Bottom){var h=this._$cellsScrollPanel.scrollTop();if(n===t.Bottom)for(var d=s-1;d<=s;d++)h+=this.sizeManager.getSizeRow(d);if(n===t.Top)for(var m=s+1;m>=s;m--)h-=this.sizeManager.getSizeRow(m);s===r&&(h=this._$paneCells.height()-this._$cellsScrollPanel.height()+15),this._$cellsScrollPanel.scrollTop(h)}}else 0===a&&this._$cellsScrollPanel.scrollLeft(0),0===s&&this._$cellsScrollPanel.scrollTop(0),a===o&&this._$cellsScrollPanel.scrollLeft(this._$paneCells.width()-this._$cellsScrollPanel.width()+15),s===r&&this._$cellsScrollPanel.scrollTop(this._$paneCells.height()-this._$cellsScrollPanel.height()+15)}function o(t,i,n){var o=e(t).find("[data-column='"+i+"']").first();return e(o).find("[data-row='"+n+"']").first()}function r(t,i){var n=e(t).children().last();return e(n).find("[data-end-column='"+i+"']").first()}function a(t,i){var n=e(t).children().last();return e(n).find("[data-end-row='"+i+"']").first()}function s(e,t,i,n,o){r(e,t).addClass("pivotTable-headerColumn_state_selectedCell"),a(i,n).addClass("pivotTable-headerRow_state_selectedCell")}function l(e,t,i,n,o){r(e,t).removeClass("pivotTable-headerColumn_state_selectedCell"),a(i,n).removeClass("pivotTable-headerRow_state_selectedCell")}function c(e,t,i,n){var r=this;r.removeCellsSelection();var a,l="",c=0,u=0;if(i>=e)for(l="bottom",a=e;a<=i;a++)c+=r.sizeManager.getSizeRow(a);else if(i<=e)for(l="top",a=i;a<=e;a++)c+=r.sizeManager.getSizeRow(a);var p;if(n>=t)for(l+="right",p=t;p<=n;p++)u+=r.sizeManager.getSizeColumn(p);else if(n<=t)for(l+="left",p=n;p<=t;p++)u+=r.sizeManager.getSizeColumn(p);var h,d,m,f;n>=t?(h=t,d=n):n<t&&(h=n,d=t),i>=e?(m=e,f=i):i<e&&(m=i,f=e);for(var g=h;g<=d;g++){var _=r._$paneCells.find("[data-column='"+g+"']");if(0!==_.length)for(var y=m;y<=f;y++){var v=_.find("[data-row='"+y+"']");0!==v.length&&(s(r._$paneColumns,g,r._$paneRows,y,null),y===r.focusedCell.rowFocusedCell&&g===r.focusedCell.columnFocusedCell||v.addClass("pivotTable-selectedCell"))}}r._userSelectionDescription={startColumn:h,endColumn:d,startRow:m,endRow:f},o.call(r,r._$paneCells,r.focusedCell.columnFocusedCell,r.focusedCell.rowFocusedCell).removeClass("pivotTable-cell_state_selected");var C=0,b=0,w=o.call(r,r._$paneCells,t,e);if(1===w.length)"bottomright"!==l&&"bottomleft"!==l||(C=parseInt(w.css("top"),10)),"bottomright"!==l&&"topright"!==l||(b=parseInt(w.parent().first().css("left"),10));else{if("bottomright"===l||"bottomleft"===l)for(var S=0;S<e;S++)C+=r.sizeManager.getSizeRow(S);if("bottomright"===l||"topright"===l)for(var x=0;x<t;x++)b+=r.sizeManager.getSizeColumn(x)}var D=o(this._$paneCells,n,i);"topleft"!==l&&"topright"!==l||(C=parseInt(D.css("top"),10)),"topleft"!==l&&"bottomleft"!==l||(b=parseInt(D.parent().first().css("left"),10)),b-=2,C-=2;var T=c+1,P=u+1;this._$topBorder.css("width",P),this._$topBorder.css("left",b),this._$topBorder.css("top",C),this._$leftBorder.css("left",b),this._$leftBorder.css("height",T),this._$leftBorder.css("top",C),this._$rightBorder.css("top",C),this._$rightBorder.css("left",b+P),this._$rightBorder.css("height",T),this._$bottomBorder.css("top",C+T),this._$bottomBorder.css("width",P),this._$bottomBorder.css("left",b),r._$cellsScrollPanel.append(r._selectionPanel)}function u(e,t,i,n,o,r,a){this._selectedRanges=[],this._$paneCells=e,this._$cellsScrollPanel=t,this.sizeManager=o,this._dataManager=r,this._$paneColumns=i,this._$paneRows=n,this.onValueChanged=a,this._userSelectionDescription=null,this._focusedCell=null,this.activateCellsSelection()}return Object.defineProperty(u.prototype,"focusedCell",{get:function(){return this._focusedCell},set:function(e){this._focusedCell=e,this.onValueChanged(this._focusedCell)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"maxIndexColumn",{get:function(){return this._maxIndexColumn},set:function(e){this._maxIndexColumn=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"maxIndexRow",{get:function(){return this._maxIndexRow},set:function(e){this._maxIndexRow=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"hasSelectionCells",{get:function(){return null!==this._userSelectionDescription},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"rangeSelectedCells",{get:function(){return this._userSelectionDescription},enumerable:!0,configurable:!0}),u.prototype.selectionCellsContainsCell=function(e,t){return!1!==this.hasSelectionCells&&(this._userSelectionDescription.startColumn<=e&&this._userSelectionDescription.endColumn>=e&&this._userSelectionDescription.startRow<=t&&this._userSelectionDescription.endRow>=t)},u.prototype.selectionCellsContainsColumn=function(e){return null!==this.focusedCell&&(this.focusedCell.columnFocusedCell===e||null!==this._userSelectionDescription&&(this._userSelectionDescription.startColumn<=e&&this._userSelectionDescription.endColumn>=e))},u.prototype.selectionCellsContainsRow=function(e){return null!==this.focusedCell&&(this.focusedCell.rowFocusedCell===e||null!==this._userSelectionDescription&&(this._userSelectionDescription.startRow<=e&&this._userSelectionDescription.endRow>=e))},u.prototype.removeCellsSelection=function(){this._$paneCells.find(".pivotTable-selectedCell").each(function(){e(this).removeClass("pivotTable-selectedCell")}),this._$paneColumns.find(".pivotTable-headerColumn_state_selectedCell").each(function(){e(this).removeClass("pivotTable-headerColumn_state_selectedCell")}),this._$paneRows.find(".pivotTable-headerRow_state_selectedCell").each(function(){e(this).removeClass("pivotTable-headerRow_state_selectedCell")}),this._selectionPanel&&this._selectionPanel.remove();(function(){this.focusedCell&&(o(this._$paneCells,this.focusedCell.columnFocusedCell,this.focusedCell.rowFocusedCell).addClass("pivotTable-cell_state_selected"),s(this._$paneColumns,this.focusedCell.columnFocusedCell,this._$paneRows,this.focusedCell.rowFocusedCell,this.sizeManager))}).call(this),this._userSelectionDescription=null},u.prototype.activateCellsSelection=function(){var t=this;this._isLeftMouseButtonPressed=!1,this._$cellsScrollPanel.mousedown(function(e){3!==e.which&&(t._isLeftMouseButtonPressed=!0)}),this._$cellsScrollPanel.mouseup(function(e){t._isLeftMouseButtonPressed=!1}),e(document).mouseup(function(e){t._isLeftMouseButtonPressed=!1}),e(document).mousedown(function(e){3!==e.which&&!1===t._isLeftMouseButtonPressed&&t.removeCellsSelection()});var i=e("<div style='position: absolute; top: 0px; left: 0px;'/>");this._$topBorder=e("<div style='position: absolute; background-color: black; height: 2px;  display: block; top: 111px; left: 239px;'/>"),this._$leftBorder=e("<div style='position: absolute; background-color: black; width: 2px;  display: block; top: 111px; left: 239px;'/>"),this._$rightBorder=e("<div style='position: absolute; background-color: black; width: 2px;  display: block; top: 111px; left: 239px;'/>"),this._$bottomBorder=e("<div style='position: absolute; background-color: black; height: 2px; display: block; top: 111px; left: 239px;'/>"),i.append(this._$topBorder),i.append(this._$leftBorder),i.append(this._$rightBorder),i.append(this._$bottomBorder),this._selectionPanel=i,this._$cellsScrollPanel.mousemove(function(i){if(!1===t._isLeftMouseButtonPressed)return!0;if(null===t.focusedCell)return!0;var n=e(i.target);if(!1===n.hasClass("pivotTable-cell")&&(n=n.parents(".pivotTable-cell")),!n.hasClass("pivotTable-cell"))return!0;var o=Number(e(n).attr("data-row")),r=Number(e(n).parent().first().attr("data-column"));return c.call(t,t.focusedCell.rowFocusedCell,t.focusedCell.columnFocusedCell,o,r),!0})},u.prototype.move=function(e){var i=null,r=this.focusedCell.columnFocusedCell,a=this.focusedCell.rowFocusedCell,c=o(this._$paneCells,r,a);if(0===c.length)return!1;switch(c.removeClass("pivotTable-cell_state_selected"),l(this._$paneColumns,r,this._$paneRows,a,this.sizeManager),e){case t.Left:r-=1;break;case t.Top:a-=1;break;case t.Right:if(r===this.maxIndexColumn)break;r+=1;break;case t.Bottom:if(this.maxIndexRow===a)break;a+=1}r<0&&(r=0),a<0&&(a=0),(i=o(this._$paneCells,r,a)).addClass("pivotTable-cell_state_selected"),s(this._$paneColumns,r,this._$paneRows,a,this.sizeManager),n.call(this,i,e),this.focusedCell={rowFocusedCell:a,columnFocusedCell:r}},u.prototype.initKeyBoardController=function(){var i=this;e(this._$paneCells).keydown(function(e){if(37===e.which||38===e.which||39===e.which||40===e.which)switch(i.removeCellsSelection(),e.which){case 37:i.move(t.Left);break;case 38:i.move(t.Top);break;case 39:i.move(t.Right);break;case 40:i.move(t.Bottom)}return!1})},u.prototype.initMouseController=function(){var r=this;e(this._$paneCells).mousedown(function(a){var c=e(a.target);if(!1===c.hasClass("pivotTable-cell")&&(c=c.parents(".pivotTable-cell")),!c.hasClass("pivotTable-cell"))return!0;var u=Number(e(c).attr("data-row")),p=Number(e(c).parent().first().attr("data-column"));if(3===a.which&&null!=r._userSelectionDescription&&r._userSelectionDescription.startRow<=u&&r._userSelectionDescription.endRow>=u&&r._userSelectionDescription.startColumn<=p&&r._userSelectionDescription.endColumn>=p)return!0;r.removeCellsSelection();var h=i.call(r,t.Bottom,c),d=i.call(r,t.Top,c),m=i.call(r,t.Left,c);!0===i.call(r,t.Right,c)&&n.call(r,c,t.Right),m&&n.call(r,c,t.Left),d&&n.call(r,c,t.Top),h&&n.call(r,c,t.Bottom);var f=null===r.focusedCell?-1:r.focusedCell.columnFocusedCell,g=null===r.focusedCell?-1:r.focusedCell.rowFocusedCell;-1!==f&&-1!==g&&(e(o(r._$paneCells,f,g)).removeClass("pivotTable-cell_state_selected"),l(r._$paneColumns,f,r._$paneRows,g,r.sizeManager)),e(c).addClass("pivotTable-cell_state_selected"),g=u,f=p,s(r._$paneColumns,f,r._$paneRows,g,r.sizeManager),r.focusedCell={rowFocusedCell:g,columnFocusedCell:f}})},u.prototype.refresh=function(e,t){this.maxIndexColumn=e-1,this.maxIndexRow=t-1,this._selectedRanges=[]},u}(),a=function(){function i(t,i,n){var o=e(t).find("[data-column='"+i+"']").first();return e(o).find("[data-row='"+n+"']").first()}function n(e,t,i,n,o){this._$panelCells=e,this._$scrollPanelCells=t,this._celectedCellManager=i,this._dataManager=n,this._isVisibleEditor=!1,this._onDataChangedCallback=o}function o(){this._$paneTextBox=e("<div style='z-index:2;position:absolute;background-color:white;display:block;'></div>"),this._$textBox=e('<textarea style="width:100%;width:100%;height:100%;outline-style: none;padding: 6px; box-sizing: border-box; overflow-y: hidden;font-size: 13px;font-family: Helvetica, Arial;resize: none; border:none;box-shadow: 0 0 0 2px #ff8800 inset;"></textarea>'),this._$paneTextBox.append(this._$textBox),this._$panelCells.append(this._$paneTextBox)}function r(){var e=i(this._$panelCells,this.focusedCell.columnFocusedCell,this.focusedCell.rowFocusedCell),t=e.height()+5,n=e.width()+5,o=e.offset().left-this._$panelCells.offset().left-2,r=e.offset().top-this._$panelCells.offset().top-2;this._$paneTextBox.css("height",t),this._$paneTextBox.css("width",n),this._$paneTextBox.css("left",o),this._$paneTextBox.css("top",r)}function a(n){if(!0===this._isVisibleEditor)throw new Error("InvalidOperationException");this._isVisibleEditor=!0,o.call(this),r.call(this),this._currentColumnOfEditor=this.focusedCell.columnFocusedCell,this._currentRowOfEditor=this.focusedCell.rowFocusedCell;var a=this;this._$textBox.keydown(function(n){if(n.stopPropagation(),setTimeout(function(){e.countLines(a._$textBox).visual>1&&a._$paneTextBox.width(a._$paneTextBox.width()+7)}),13===n.keyCode||37===n.keyCode||38===n.keyCode||39===n.keyCode||40===n.keyCode){switch(s.call(a,!0),n.keyCode){case 40:case 13:a._celectedCellManager.move(t.Bottom);break;case 37:a._celectedCellManager.move(t.Left);break;case 38:a._celectedCellManager.move(t.Top);break;case 39:a._celectedCellManager.move(t.Right)}return n.preventDefault(),Ranet.ClientInformation.isIE()?i(a._$panelCells,a.focusedCell.columnFocusedCell,a.focusedCell.rowFocusedCell).focus():a._$panelCells.focus(),!1}return!1!==c(n)}),this._$textBox.mousedown(function(e){e.stopPropagation()}),this._$textBox.focus(),this._$textBox.text(n)}function s(e){this._isVisibleEditor=!1,this._$paneTextBox.remove();var t=this._currentColumnOfEditor,n=this._currentRowOfEditor,o=i(this._$panelCells,t,n);e&&(this._dataManager.setNewValue(t,n,this._$textBox.val()),this._onDataChangedCallback&&this._onDataChangedCallback(o,t,n))}function l(e){var t=e.which?e.which:e.keyCode;return!(t<47||t>57)||!(t<96||t>105)}function c(e){var t=e.which?e.which:e.keyCode;return!(t>31&&(t<46||t>57)&&"."!==e.key&&110!==t&&(t<96||t>105))}return n.prototype.activate=function(){var t=this;this._$panelCells.keydown(function(e){if(t._dataManager.isUpdateableData&&!1!==t._dataManager.canUpdate(t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell)){if(46===e.which&&t._dataManager.isUpdated(t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell)){t._dataManager.deleteUpdatedValue(t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell);var n=i(t._$panelCells,t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell);return t._onDataChangedCallback(n,t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell),void(Ranet.ClientInformation.isIE()&&i(t._$panelCells,t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell).focus())}!1!==l(e)&&37!==e.which&&38!==e.which&&39!==e.which&&40!==e.which&&13!==e.which&&a.call(t,e.key)}}),e("body").mousedown(function(){t._dataManager.isUpdateableData&&!0===t._isVisibleEditor&&s.call(t,!1)}),this._$panelCells.mousedown(function(){t._dataManager.isUpdateableData&&!0===t._isVisibleEditor&&(s.call(t,!0),Ranet.ClientInformation.isIE()&&i(t._$panelCells,t.focusedCell.columnFocusedCell,t.focusedCell.rowFocusedCell).focus())}),this._$scrollPanelCells.scroll(function(){t._dataManager.isUpdateableData&&t._isVisibleEditor&&s.call(t,!0)})},Object.defineProperty(n.prototype,"focusedCell",{get:function(){return this._focusedCell},set:function(e){this._prevFocusedCell=this._focusedCell,this._focusedCell=e},enumerable:!0,configurable:!0}),n}(),s=function(){function t(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1),e.detachEvent&&e.detachEvent("on"+t,i)}function s(){for(var e=0;e<q.length;e++){var t=q[e];t.resetScrolls(),t.reDraw()}}function u(t,i){var n=e("<div/>");n.attr("id",t+"-content"),this._$panelPivotTable=n,e("#"+t).append(n),this._$panelPivotTable.addClass("pivotTable"),this.onShowingSparklines=function(e){},this.onActionHeader=function(e,t){},this.onHeaderTouch=function(e,t){},this.onContextMenuHeaderCallback=function(e,t){},this._onCellValueChanged=function(e,t,i){},this._onChangeValueCellDeleted=function(e){},i.hasOwnProperty("onShowingSparklines")&&(this.onShowingSparklines=i.onShowingSparklines),i.hasOwnProperty("onActionHeader")&&(this.onActionHeader=i.onActionHeader),i.hasOwnProperty("onHeaderTouch")&&(this.onHeaderTouch=i.onHeaderTouch),i.hasOwnProperty("onContextMenuHeaderCallback")&&(this.onContextMenuHeaderCallback=i.onContextMenuHeaderCallback),i.hasOwnProperty("onContextMenuCellsCallback")&&(this.onContextMenuCellsCallback=i.onContextMenuCellsCallback),i.hasOwnProperty("onCellValueChanged")&&(this._onCellValueChanged=i.onCellValueChanged),i.hasOwnProperty("onChangeValueCellDeleted")&&(this._onChangeValueCellDeleted=i.onChangeValueCellDeleted),this.createLayout(),this.init(),q.push(this)}function p(t,i){var n=e(t).find("[data-sparkline]");if(0!==n.length){for(var o=[],r=0;r<n.length;r++){for(var a=n[r],s=e(a).parents(),l=void 0,c=void 0,u=0;u<s.length;u++)if(s[u].hasAttribute("column")){if(l=e(s[u]).attr("column"),void 0!==c)break}else if(s[u].hasAttribute("row")){if(c=e(s[u]).attr("row"),void 0!==l)break}else;o.push({column:l,row:c,element:a})}i(o)}}function h(t,i,n,o){for(var r=0;r<t.children().length;r++)for(var a=t.children().eq(r).children(),s=0;s<a.length;s++){var l=a[s];null==l.getAttribute("data-end-row")&&null==l.getAttribute("data-end-column")||(e(l).resizable({grid:5,helper:"resizable-helper",handles:"e,s",stop:function(e,r){o(e,r,t,i),n()}}),e(l).css("position","absolute"))}}function d(t,i,n,o){if(i.size.width!==i.originalSize.width){var r,a=e(i.element).parent().first().attr("data-row"),s=n.children().last().attr("data-row"),l=e(i.element).attr("data-end-column");if(a===s)r=i.size.width;else{var c=i.size.width-i.originalSize.width;r=o.getSizeColumn(l)+c}r<o.minColumnWidth&&(r=o.minColumnWidth),o.setSizeColumn(l,r)}if(i.size.height!==i.originalSize.height){var u=parseInt(e(i.element).css("top"),10),p=i.size.height+u,h=e(i.element).parent().first().attr("data-row");o.setHeightRowColumnsPanel(h,p)}}function m(t,i,n,o){if(i.size.height!==i.originalSize.height){var r,a=e(i.element).parent().first().attr("data-column"),s=n.children().last().attr("data-column"),l=e(i.element).attr("data-end-row");if(a===s)r=i.size.height;else{var c=i.size.height-i.originalSize.height;r=o.getSizeRow(l)+c}r<o.minRowHeight&&(r=o.minRowHeight),o.setSizeRow(l,r)}if(i.size.width!==i.originalSize.width){var u=parseInt(e(i.element).css("left"),10),p=i.size.width+u,h=e(i.element).parent().first().attr("data-column");o.setWidthColumnRowsPanel(h,p)}}function f(e,t){for(var i=0,n=0;n<e;n++)i+=this._sizeManager.getSizeColumn(n);this._$cellsArea.css("width",i+this._sizeManager.additionalWithCellsPanel+"px");for(var o=0,r=0;r<t;r++)o+=this._sizeManager.getSizeRow(r);this._$cellsArea.css("height",o+this._sizeManager.additionalHeightCellsPanel+"px")}function g(){return e('<div tabindex="0" class="pivotTable-areaNoSelect pivotTable-cellsPanel"></div>')}function _(){this._$scrollPanelCells.css("height",this._$panelPivotTable.height()-this._sizeManager.columnsPanelHeight()),this._$scrollPanelCells.css("width",this._$panelPivotTable.width()-this._sizeManager.widthRowsPanel),this._$scrollPanelCells.css("margin-left",this._sizeManager.widthRowsPanel),this._$scrollPanelCells.css("margin-top",this._sizeManager.columnsPanelHeight())}function y(){return e('<div class="pivotTable-cellsScrollPanel"></div>')}function v(){this._rowsDescriptionPanel.$panel.addClass("pivotTable-rowsPanel"),this._sizeManager.widthRowsPanel=void 0,this._sizeManager.widthContentRowsPanel>.7*this._$panelPivotTable.width()&&(this._sizeManager.widthRowsPanel=.6*this._$panelPivotTable.width());var e=this._sizeManager.widthRowsPanel;this._rowsDescriptionPanel.$panel.css("width",e),this._rowsDescriptionPanel.$panel.css("height",this._$panelPivotTable.height()),this._rowsDescriptionPanel.$rowsArea.css("width",this._sizeManager.widthContentRowsPanel),this._rowsDescriptionPanel.$rowsArea.css("height",this._$panelPivotTable.height()-this._sizeManager.columnsPanelHeight()),this._rowsDescriptionPanel.$titlePanel.css("width",this._sizeManager.widthContentRowsPanel),this._rowsDescriptionPanel.$titlePanel.css("height",this._sizeManager.columnsPanelHeight()-1),this._rowsDescriptionPanel.$titlePanel.css("padding-top",this._sizeManager.columnsPanelHeight()-20)}function C(){var t=e("<div/>");t.addClass("pivotTable-blockPanels pivotTable-areaNoSelect");var i=e("<div/>");i.addClass("pivotTable-blockPanels");var n=e("<div/>");return t.append(n),t.append(i),{$panel:t,$titlePanel:n,$rowsArea:i}}function b(){this._columnsDescriptionPanel.$panel.css("width",this._$panelPivotTable.width()-this._sizeManager.widthRowsPanel),this._columnsDescriptionPanel.$panel.css("height",this._sizeManager.columnsPanelHeight());var e=this._sizeManager.widthRowsPanel;this._columnsDescriptionPanel.$panel.css("margin-left",e-1)}function w(){return{$panel:e('<div class="pivotTable-blockPanels pivotTable-areaNoSelect"></div>')}}function S(e,t){var i=e.scrollLeft(),n=e.scrollTop();e.scroll(function(){i!==e.scrollLeft()&&(i=e.scrollLeft()),n!==e.scrollTop()&&(n=e.scrollTop()),t(i,n)})}function x(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+":"+e[i]+";");return t}function D(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+"='"+e[i]+"' ");return t}function T(e,t){var i={},n=null;if(e.appearance.options.useBackColor&&(i["background-color"]=e.appearance.backColor),e.appearance.options.useForeColor&&(i.color=e.appearance.foreColor),e.appearance.options.useImage)if(e.appearance.options.showValue){var o="<div class='pivotTable-cellImage pivotTable-cellImage_left "+e.appearance.cssClassImage+"'></div>",r='<span class="pivotTable-cell-content">'+t+"</span>";n="<div class='pivotTable-cellPanel' style='"+x(i)+"'>"+o+r+"</div>"}else{var a="<div class='pivotTable-cellImageContainer'>"+("<div class='pivotTable-cellImage pivotTable-cellImage_center "+e.appearance.cssClassImage+"'></div>")+"</div>";n="<div class='pivotTable-cellPanel' style='"+x(i)+"'>"+a+"</div>"}else if(e.appearance.options.showValue){var s='<span class="pivotTable-cell-content">'+t+"</span>";n="<div class='pivotTable-textCellPanel' style='"+x(i)+"'>"+s+"</div>"}else n="<div style='"+x(i)+"' class='pivotTable-cellPanel'></div>";return n}function P(e,t,i,n,o){var r=t.getTuplesForCell(i,n),a=r.columns.concat(r.rows),s=t.getDisplayValueForCell(i,n),l=null,c=t.getValueCell(i,n);if(null!==c){e&&1===e.length&&a.push(e[0].uniqueName);for(var u=0;u<a.length;u++)for(var p=a[u],h=0;h<o.length;h++){var d=o[h];if(p===d.memberUniqueName)for(var m=0;m<d.conditions.length;m++){var f=d.conditions[m];if(f.conditionType===Ranet.Controls.CellConditionType.Less&&c<f.value1){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.Greater&&c>f.value1){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.Equal&&f.value1===c){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.NotEqual&&f.value1!==c){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.GreaterOrEqual&&c>=f.value1){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.LessOrEqual&&c<=f.value1){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.Between&&c>=f.value1&&c<=f.value2){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.NotBetween&&(c<=f.value1||c>=f.value2)){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.BetweenNotIncluding&&c>f.value1&&c<f.value2){l=T(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.NotBetweenNotIncluding&&(c<f.value1||c>f.value2)){l=T(f,s);break}}}return l}}function I(e,t,i,n,o,r,a){var s=e.getDisplayValueForCell(t,i),l="",c="";"#error"===s.toLowerCase()&&(c=e.getValueCell(t,i));var u='<span class="pivotTable-cell-content" '+(void 0===c?"":"title='"+c+"'")+">"+s+"</span>",p={},h=e.getBackColorForCell(t,i),d=e.getForeColorForCell(t,i);return""!==h&&(p.background=h),""!==d&&(p.color=d),e.isUpdateableData&&e.canUpdate(t,i)&&(p["background-color"]="#FFFFE1"),e.isUpdateableData&&e.isUpdated(t,i)&&(p["background-color"]="#C5EECD"),n&&n.length&&(l=P(o,e,t,i,n)),e.isSparkline(t,i)&&(l="<div style='height:"+r+"px;' data-sparkline='"+s+"'>"+s+"</div>"),l||(l="<div class='pivotTable-textCellPanel' style='"+x(p)+" '>"+u+"</div>"),l}function M(e,t,i,n,o,r,a,s,l){for(var c=n.offsetCurrentColumnAbsolute,u=0,p="",h=n.currentColumn;h<i.maxColumns;h++){var d=t.getSizeColumn(h),m={},f={},g=["pivotTable-panel"];f["data-column"]=h,m.left=c+"px",m.width=d+"px";for(var _=0,y="",v=n.offsetCurrentRowAbsolute,C=n.currentRow;C<i.maxRows;C++){var b=t.getSizeRow(C),w=I(i,h,C,a,s,b),S=0===i.countColumnsInRows&&h===n.currentColumn,T=0===i.countRowsInColumns&&C===n.currentRow,P="",M={},E=["pivotTable-cell"],F={};if(F["data-row"]=C,M.top=v+"px",M.height=b+"px",M.width=d+"px",M["line-height"]=b-1+"px",S&&(M["border-left-width"]="1px",M.left="2px",M.width=d-2+"px",m.width=d-2+"px"),T&&(M["border-top-width"]="1px",M.top="2px"),!1===l.hasSelectionCells?null!=l.focusedCell&&C===l.focusedCell.rowFocusedCell&&l.focusedCell.columnFocusedCell===h&&E.push("pivotTable-cell_state_selected"):l.selectionCellsContainsCell(h,C)&&(C===l.focusedCell.rowFocusedCell&&l.focusedCell.columnFocusedCell===h||E.push("pivotTable-selectedCell")),P="<div style='"+x(M)+"' class='"+E.join(" ")+"' "+D(F)+">"+w+"</div>",v+=b,y+=P,(_+=b)>o)break}if(c+=d,p+="<div style='"+x(m)+"' class='"+g.join(" ")+"' "+D(f)+">"+y+"</div>",(u+=d)>r)break}e.get(0).innerHTML=p}function E(t,i,n){for(var o=0,r=0;r<n.countColumnsInRows;r++){var a;if("hierarchy"===n.indexToTypeRows[r]){var s=n.absoluteIndexItemToHierarchyIndexRows[r];a=n.getHierarchyDescriptionInRows(s).caption}else{if("customProperty"!==n.indexToTypeRows[r])throw new Error("NotImplementedException");a=n.getLevelPropertyInRows(r).name}"Measures"===a&&Ranet&&Ranet.Localization&&(a=Ranet.Localization.localize("Measures"));var l=i.getWidthColumnRowsPanel(r),c=e("<div/>");c.append(a),c.addClass("pivotTable-headItemRowsPane"),c.css("width",l-4),c.css("margin-left",o),c.attr("title",a),o+=l,t.append(c)}}function F(e,t,i,n,o,r,a,s,l){for(var c="",u=o,p=e.absoluteIndexItemToHierarchyIndexRows[r],h=a;h<e.maxRows;){var d=t.rangeSizeRows(p,h),m=h;p+1!==e.countHierarchyInRows&&(m=h+d.Count-1);var f=m+1===e.maxRows,g=e.getDataRowAction(p,h).caption,_=e.rowIsParent(p,m),y=e.getRowLevelDepth(p,h),v={},C={},b=[];C.title=g,b.push("pivotTable-contentHeader"),u<0&&(v.top=Math.abs(u)+"px");for(var w=y*i.levelDepthOffset,S=0;S<y;S++){var T=["pivotTable-panel-indent","pivotTable-panel-indent_border_bottom"],P={};P.left=S*i.levelDepthOffset+"px",P.height=d.Size+1+"px",P.width=i.levelDepthOffset+"px",P.top=u+"px",f&&(P["border-bottom-width"]="1px"),c+="<div class='"+T.join(" ")+"' style='"+x(P)+"'></div>"}var I={},M={},E=[];E.push("pivotTable-header"),E.push("pivotTable-rowHeader"),E.push("pivotTable-hierarchyItem"),l&&s.selectionCellsContainsRow(h)&&E.push("pivotTable-headerRow_state_selectedCell"),M["data-start-row"]=h,M["data-end-row"]=m,I.left=w+"px",I.top=u+"px",I.width=i.getWidthColumnRowsPanel(r)-w+"px",f&&(I["border-bottom-width"]="1px"),I.height=d.Size+1+"px";var F="";_?F='<span class="pivotTable-headerItem-icon fa fa-caret-down"></span>':e.hasChildrenRowsPanel(p,m)&&(F='<span class="pivotTable-headerItem-icon fa fa-caret-right"></span>');var N="<span class='"+b.join(" ")+"' style='"+x(v)+"' "+D(C)+">"+F+g+"</span>";if(c+="<div class='"+E.join(" ")+"' style='"+x(I)+"' "+D(M)+">"+N+"</div>",h+=d.Count,(u+=d.Size)>n)break}return c}function N(e,t,i,n,o,r,a,s,l){for(var c="",u=o,p=e.absoluteIndexItemToHierarchyIndexRows[r],h=a;h<e.maxRows;){var d=t.rangeSizeRows(p,h),m=h;p+1!==e.countHierarchyInRows&&(m=h+d.Count-1);var f=m+1===e.maxRows,g=e.getValueCustomPropRows(r,h).value,_={},y={},v=[];y.title=g,v.push("pivotTable-contentHeader"),u<0&&(_.top=Math.abs(u)+"px");var C={},b={},w=[];w.push("pivotTable-header"),w.push("pivotTable-rowHeader"),w.push("pivotTable-customPropertyItem"),l&&s.selectionCellsContainsRow(h)&&w.push("pivotTable-headerRow_state_selectedCell"),l&&(C["border-right-width"]="1px"),b["data-start-row"]=h,b["data-end-row"]=m,C.left="0px",C.top=u+"px",C.width=i.getWidthColumnRowsPanel(r)+"px",f&&(C["border-bottom-width"]="1px"),C.height=d.Size+1+"px";var S="<span class='"+v.join(" ")+"' style='"+x(_)+"' "+D(y)+">"+g+"</span>";if(c+="<div class='"+w.join(" ")+"' style='"+x(C)+"' "+D(b)+">"+S+"</div>",h+=d.Count,(u+=d.Size)>n)break}return c}function $(e,t,i,n,o){for(var r=n.currentRow,a=n.offsetCurrentRow,s=e.height(),l="",c=0,u=0;u<i.countColumnsInRows;u++){var p={},h={},d=[];d.push("pivotTable-panel"),h.left=c+"px",h.width=t.getWidthColumnRowsPanel(u)+"px";var m,f=u+1===i.countColumnsInRows;if(p["data-column"]=u,"hierarchy"===i.indexToTypeRows[u])p["data-index-hierarchy"]=i.absoluteIndexItemToHierarchyIndexRows[u],m=F(i,n,t,s,a,u,r,o,f);else{if("customProperty"!==i.indexToTypeRows[u])throw new Error("InvalidOperationException");m=N(i,n,t,s,a,u,r,o,f)}var g="<div class='"+d.join(" ")+"' style='"+x(h)+"' "+D(p)+">"+m+"</div>";c+=t.getWidthColumnRowsPanel(u),l+=g}e.get(0).innerHTML=l}function O(e,t,i,n,o,r,a,s){for(var l=o,c=o,u="",p=e.absoluteIndexItemToHierarchyIndexColumns[n],h=s;h<e.maxColumns;){var d=t.rangeSizeColumns(p,h),m=h;p+1!==e.countHierarchyInColumns&&(m=h+d.Count-1);var f=m+1===e.maxColumns,g=e.getDataColumnAction(h,p).caption,_=e.columnIsParent(m,p),y=e.getColumnLevelDepth(h,p),v="";_?v='<span class="pivotTable-headerItem-icon fa fa-caret-down"></span>':e.hasChildrenColumnsPanel(m,p)&&(v='<span class="pivotTable-headerItem-icon fa fa-caret-right"></span>');var C={},b=[],w=[];b.title=g,w.push("pivotTable-contentHeader"),l<0&&(C.left=Math.abs(l)+"px");for(var S=0;S<y;S++){var T=["pivotTable-panel-indent","pivotTable-panel-indent_border_top"],P={};P.top=S*i.levelDepthOffset+"px",P.left=l+"px",P.width=d.Size+1+"px",P.height=i.levelDepthOffset+"px",f&&(P["border-right-width"]="1px"),u+="<div class='"+T.join(" ")+"' style='"+x(P)+"'></div>"}var I=y*i.levelDepthOffset,M={},E=["pivotTable-header","pivotTable-columnHeader","pivotTable-hierarchyItem"],F={};n+1===e.countRowsInColumns&&r.selectionCellsContainsColumn(h)&&E.push("pivotTable-headerColumn_state_selectedCell"),M["data-end-column"]=m,M["data-start-column"]=h,F.top=I+"px",F.left=l+"px",F.height=i.getHeightRowColumnsPanel(n)-I+"px",f?(F["border-right-width"]="1px",F.width=d.Size+1+"px"):F.width=d.Size+"px",0===e.countColumnsInRows&&0===h&&(F.left="3px",F.width=d.Size-2+"px",C.left="0px"),n+1===e.countRowsInColumns&&(F["border-bottom-width"]="1px");var N="<span class='"+w.join(" ")+"' style='"+x(C)+"' "+D(b)+">"+v+g+"</span>";if(u+="<div class='"+E.join(" ")+"' style='"+x(F)+"' "+D(M)+">"+N+"</div>",h+=d.Count,l+=d.Size,(c+=d.Size)>a)break}return u}function L(e,t,i,n,o,r,a,s){for(var l=o,c=o,u="",p=e.absoluteIndexItemToHierarchyIndexColumns[n],h=s;h<e.maxColumns;){var d=t.rangeSizeColumns(p,h),m=h;p+1!==e.countHierarchyInColumns&&(m=h+d.Count-1);var f=m+1===e.maxColumns,g=e.getValueCustomPropColumns(h,n).value,_={},y=[],v=[];y.title=g,v.push("pivotTable-contentHeader"),l<0&&(_.left=Math.abs(l)+"px");var C={},b=["pivotTable-header","pivotTable-columnHeader","pivotTable-customPropertyItem"],w={};n+1===e.countRowsInColumns&&r.selectionCellsContainsColumn(h)&&b.push("pivotTable-headerColumn_state_selectedCell"),C["data-end-column"]=m,C["data-start-column"]=h,w.top="0px",w.left=l+"px",w.height=i.getHeightRowColumnsPanel(n)-0+"px",f?(w["border-right-width"]="1px",w.width=d.Size+1+"px"):w.width=d.Size+"px",0===e.countColumnsInRows&&0===h&&(w.left="3px",w.width=d.Size-2+"px",_.left="0px"),n+1===e.countRowsInColumns&&(w["border-bottom-width"]="1px");var S="<span class='"+v.join(" ")+"' style='"+x(_)+"' "+D(y)+">"+g+"</span>";if(u+="<div class='"+b.join(" ")+"' style='"+x(w)+"' "+D(C)+">"+S+"</div>",h+=d.Count,l+=d.Size,(c+=d.Size)>a)break}return u}function A(e,t,i,n,o){for(var r=n.currentColumn,a=n.offsetCurrentColumn,s=0,l="",c=e.width(),u=0;u<i.countRowsInColumns;u++){var p=["pivotTable-panel"],h={},d={};h.top=s+"px",h.height=t.getHeightRowColumnsPanel(u)+"px",d["data-row"]=u;var m="";if("hierarchy"===i.indexToTypeColumns[u])d["data-index-hierarchy"]=i.absoluteIndexItemToHierarchyIndexColumns[u],m=O(i,n,t,u,a,o,c,r);else{if("customProperty"!==i.indexToTypeColumns[u])throw new Error("InvalidOperationException");m=L(i,n,t,u,a,o,c,r)}var f="<div class='"+p.join(" ")+"' style='"+x(h)+"' "+D(d)+">"+m+"</div>";s+=t.getHeightRowColumnsPanel(u),l+=f}e.get(0).innerHTML=l}function R(t,i,n){var o=I(this._dataManager,i,n,this.cellConditions,this.measuresInDataSource,this._sizeManager.getSizeRow(n)),r=t.children()[0];e(r).replaceWith(o)}function B(){var t=function(t,i){for(var n=0;n<t.length;n++){var o=e(t[n]);o.detach(),i&&setTimeout(function(e){e.remove()},10,o)}};t(this._rowsDescriptionPanel.$titlePanel.children(),!1),t(this._rowsDescriptionPanel.$rowsArea.children(),!0),t(this._$cellsArea.children(),!1),t(this._columnsDescriptionPanel.$panel.children(),!0)}function V(){var e=-1,t=-1;this._selectedCellManager.focusedCell&&(e=this._selectedCellManager.focusedCell.columnFocusedCell,t=this._selectedCellManager.focusedCell.rowFocusedCell);var i=this._dataManager.maxColumns,n=this._dataManager.maxRows,o=this._$panelPivotTable.height()-this._columnsDescriptionPanel.$panel.height(),r=this._$panelPivotTable.width()-this._rowsDescriptionPanel.$panel.width();v.call(this),b.call(this),_.call(this),f.call(this,i,n),k.call(this,t,e,o,r),Q.call(this,V.bind(this))}function k(e,t,i,n){B.call(this),this._dataManager.countColumnsInRows>0&&this._dataManager.columns&&E(this._rowsDescriptionPanel.$titlePanel,this._sizeManager,this._dataManager),null!==this._dataManager.columns&&null!==this._dataManager.columns.members&&null!==this._dataManager.rows&&null!==this._dataManager.rows.hierarchies&&this._rowsDescriptionPanel.$panel.css("border-right-width","1px"),$(this._rowsDescriptionPanel.$rowsArea,this._sizeManager,this._dataManager,this._visualStateHelper,this._selectedCellManager),A(this._columnsDescriptionPanel.$panel,this._sizeManager,this._dataManager,this._visualStateHelper,this._selectedCellManager),M(this._$cellsArea,this._sizeManager,this._dataManager,this._visualStateHelper,i,n,this.cellConditions,this.measuresInDataSource,this._selectedCellManager),p(this._$cellsArea,this.onShowingSparklines)}function z(){var e,t,i=this;S(this._$scrollPanelCells,function(n,o){i._visualStateHelper.horizontalScrollValue=n,i._visualStateHelper.verticalScrollValue=o;var r=i._selectedCellManager.focusedCell?i._selectedCellManager.focusedCell.columnFocusedCell:-1,a=i._selectedCellManager.focusedCell?i._selectedCellManager.focusedCell.rowFocusedCell:-1,s=i._$panelPivotTable.width()-i._rowsDescriptionPanel.$panel.width()+(n-i._visualStateHelper.offsetCurrentColumnAbsolute),l=i._$panelPivotTable.height()-i._columnsDescriptionPanel.$panel.height()+(o-i._visualStateHelper.offsetCurrentRowAbsolute);k.call(i,a,r,l,s),i._dataManager.isUpdateableData&&Ranet.ClientInformation.isIE()&&i._$cellsArea.find(".pivotTable-cell_state_selected").focus(),e&&clearTimeout(e),t&&clearTimeout(t),e=setTimeout(Q.bind(i,V.bind(i)),500),t=setTimeout(function(){},50)})}var q=[],U=function(e){return{items:this._dataManager.getNeighborsHierarchyInRows(this._dataManager.countHierarchyInRows,e)}},H=function(e){return{items:this._dataManager.getNeighborsHierarchyInColumns(e,this._dataManager.countHierarchyInColumns)}};Object.defineProperty(u.prototype,"focusedCell",{get:function(){if(this._selectedCellManager.focusedCell&&(-1!==this._selectedCellManager.focusedCell.rowFocusedCell||-1!==this._selectedCellManager.focusedCell.columnFocusedCell)){var e={coordinates:this._selectedCellManager.focusedCell,cellData:this._dataManager.getCellData(this._selectedCellManager.focusedCell.columnFocusedCell,this._selectedCellManager.focusedCell.rowFocusedCell)};return e.rows=U.call(this,this._selectedCellManager.focusedCell.rowFocusedCell),e.columns=H.call(this,this._selectedCellManager.focusedCell.columnFocusedCell),e}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cellConditions",{get:function(){return this._cellConditions},set:function(e){this._cellConditions=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"measuresInDataSource",{get:function(){return this._measuresInDataSource},set:function(e){this._measuresInDataSource=e},enumerable:!0,configurable:!0}),u.prototype.resetScrolls=function(){this._visualStateHelper&&(this._visualStateHelper.horizontalScrollValue=0,this._visualStateHelper.verticalScrollValue=0)},u.prototype.reDraw=function(){this.updateDataSource(this.currentDataSource)},u.prototype.dispose=function(){q.pop(this),0===q.length&&t(window,"resize",s)},u.prototype.resetState=function(){this.currentDataSource=void 0,this._selectedCellManager.focusedCell=void 0};var j=function(e,t){if(this._selectedCellManager.focusedCell){"expand"===t.actionType||"collapse"===t.actionType?"rows"===t.place?(0,t.startRow):"columns"===t.place&&(t.startColumn,0):"drillDown"===t.actionType&&(-1,-1)}this.onActionHeader(e,t)},W=function(){for(var e,t,i=0;i<this._dataManager.countColumnsInRows;i++)if("hierarchy"===this._dataManager.indexToTypeRows[i])t=this._dataManager.absoluteIndexItemToHierarchyIndexRows[i],e=this._dataManager.getCountLevelDepthInColumnFromRowsPane(t),this._sizeManager.setDefaultWidthColumnInRowsPanel(i,120+15*e);else{if("customProperty"!==this._dataManager.indexToTypeRows[i])throw new Error("InvalidOperationException");this._sizeManager.setDefaultWidthColumnInRowsPanel(i,110)}for(var n=0;n<this._dataManager.countRowsInColumns;n++)if("hierarchy"===this._dataManager.indexToTypeColumns[n])t=this._dataManager.absoluteIndexItemToHierarchyIndexColumns[n],e=this._dataManager.getCountLevelDepthInRowFromColumnsPane(t),this._sizeManager.setDefaultHeightRowInColumnsPanel(n,14+22*e);else{if("customProperty"!==this._dataManager.indexToTypeColumns[n])throw new Error("InvalidOperationException");this._sizeManager.setDefaultHeightRowInColumnsPanel(n,23)}},Q=function(e){h(this._rowsDescriptionPanel.$rowsArea,this._sizeManager,e,m),h(this._columnsDescriptionPanel.$panel,this._sizeManager,e,d)};return u.prototype.createLayout=function(){var e=this._$panelPivotTable;if(null==e.height()||null==e.width())throw new Error("Size equal null.");this._rowsDescriptionPanel=C(),e.append(this._rowsDescriptionPanel.$panel),this._columnsDescriptionPanel=w(),e.append(this._columnsDescriptionPanel.$panel),this._$scrollPanelCells=y();var t=this._$scrollPanelCells;e.append(t),this._$cellsArea=g(),t.append(this._$cellsArea)},u.prototype.init=function(){this._dataManager=new l(this._onCellValueChanged,this._onChangeValueCellDeleted);var e=new n(this._columnsDescriptionPanel.$panel,this._rowsDescriptionPanel.$rowsArea,this._dataManager,j.bind(this),this.onHeaderTouch.bind(this),this.onContextMenuHeaderCallback.bind(this));e.activateMouseActions(),e.activateContextMenu(),this._sizeManager=new i,this._visualStateHelper=new c(this._sizeManager,this._dataManager);var t=this;this._selectedCellManager=new r(this._$cellsArea,this._$scrollPanelCells,this._columnsDescriptionPanel.$panel,this._rowsDescriptionPanel.$rowsArea,this._sizeManager,this._dataManager,function(e){t._editorCellsManager.focusedCell=e}),this._selectedCellManager.initMouseController(),this._selectedCellManager.initKeyBoardController(),new o(this._$cellsArea,this._dataManager,this._selectedCellManager,this.onContextMenuCellsCallback.bind(this)).activateContextMenu(),z.call(this),this._editorCellsManager=new a(this._$cellsArea,this._$scrollPanelCells,this._selectedCellManager,this._dataManager,function(e,i,n){R.call(t,e,i,n)}),this._editorCellsManager.activate()},u.prototype.updateDataSource=function(t){if(void 0!==t){var i=!1;this._dataManager.hasLocalChanges&&(i=!0,this._dataManager.saveLocalChanges()),void 0!==this.currentDataSource&&this.currentDataSource!==t&&this._sizeManager.saveState(this._dataManager),this._dataManager.setNewDataSource(t),this._sizeManager.countRowsColumnsPane=this._dataManager.countRowsInColumns,this._sizeManager.countColumnsRowsPane=this._dataManager.countColumnsInRows,void 0!==this.currentDataSource&&this.currentDataSource!==t&&this._sizeManager.restoreState(this._dataManager),i&&this._dataManager.restoreLocalChanges(),this.currentDataSource=t,W.call(this);var n=this._dataManager.maxColumns,o=this._dataManager.maxRows;this._selectedCellManager.refresh(n,o),this._selectedCellManager.focusedCell&&(n<=this._selectedCellManager.focusedCell.columnFocusedCell||o<=this._selectedCellManager.focusedCell.rowFocusedCell)&&(this._selectedCellManager.focusedCell={rowFocusedCell:-1,columnFocusedCell:-1}),v.call(this),b.call(this),_.call(this),f.call(this,n,o),e(this._$scrollPanelCells).scrollTop(this._visualStateHelper.verticalScrollValue),e(this._$scrollPanelCells).scrollLeft(this._visualStateHelper.horizontalScrollValue);var r=this._selectedCellManager.focusedCell?this._selectedCellManager.focusedCell.columnFocusedCell:-1,a=this._selectedCellManager.focusedCell?this._selectedCellManager.focusedCell.rowFocusedCell:-1;k.call(this,a,r,this._$panelPivotTable.height()-this._columnsDescriptionPanel.$panel.height(),this._$panelPivotTable.width()-this._rowsDescriptionPanel.$panel.width()),Q.call(this,V.bind(this))}},u.prototype.clearLocalChanges=function(){this._dataManager.clearLocalChanges()},u}(),l=function(){function e(e,t,i){for(var n=t,o=i,r=[],a=[],s=[],l=[],c=[],u=[],p=0;p<o;p++)a[p]=new Array(n),l[p]=new Array(n),c[p]=new Array(n),s[p]=new Array(n),r[p]=new Array(n),u[p]=new Array(n);return e.cells?(r=e.cells.values,a=e.cells.displayValues,s=e.cells.foreColors,l=e.cells.backColors,c=e.cells.formatStrings,u=e.cells.canUpdateStates,{displayValueCells:a,backColorCells:l,formatStringCells:c,foreColorCells:s,valueCells:r,canUpdateStates:u}):{displayValueCells:a,backColorCells:l,formatStringCells:c,foreColorCells:s,valueCells:r,canUpdateStates:u}}function t(e,t){if(!e)return{countItems:0};for(var i=e.length,n=[],o=0,r={},a={},s=0;s<e.length;s++){var l=t[e[s].uniqueName];if(n[o]="hierarchy",r[o]=s,l){for(var c=0;c<l.length;c++)n[++o]="customProperty",r[o]=s,a[o]=c;i+=l.length}o++}return{countItems:i,indexItemToType:n,absoluteIndexItemToHierarchyIndex:r,absoluteIndexItemToIndexProp:a}}function i(e){for(var t={},i=0;i<e.positions.length;i++)for(var n=e.positions[i],o=0;o<n.positions.length;o++){var r=e.members[n.positions[o].id],a=e.hierarchies[o];r.memberProperties&&(t[a.uniqueName]=r.memberProperties.map(function(e){return e.name}))}return t}function n(e,t){this.isUpdateableData=!1,this._onCellValueChanged=e,this._onChangeValueCellDeleted=t}function o(e){for(var t={},i=[],n=e.length,o=0,r=0;r<n;r++){var a=e[r];1!==t[a]&&(t[a]=1,i[o++]=a)}return i}function r(e,t){for(var i=this.getTuplesForCell(e,t),n={},o=0;o<i.columns.length;o++)n[this.getHierarchyInColumns(o).uniqueName]=i.columns[o];for(var r=0;r<i.rows.length;r++)n[this.getHierarchyInRows(r).uniqueName]=i.rows[r];return n}function a(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}return n.prototype.setNewDataSource=function(n){if(this.maxRows=this.maxColumns=0,this.countColumnsInRows=this.countRowsInColumns=0,this.countHierarchyInRows=this.countHierarchyInColumns=0,n.cells.hasOwnProperty("canUpdateStates")?this.isUpdateableData=!0:this.isUpdateableData=!1,n.rows){var o=i(n.rows),r=t(n.rows.hierarchies,o);this.countColumnsInRows=r.countItems,this.indexToTypeRows=r.indexItemToType,this.absoluteIndexItemToHierarchyIndexRows=r.absoluteIndexItemToHierarchyIndex,this._absoluteIndexItemToIndexPropRows=r.absoluteIndexItemToIndexProp,this.hierarchyInRows=n.rows.hierarchies,this.countHierarchyInRows=n.rows.positions[0].positions.length}if(n.columns){var a=i(n.columns),s=t(n.columns.hierarchies,a);this.countRowsInColumns=s.countItems,this.indexToTypeColumns=s.indexItemToType,this.absoluteIndexItemToHierarchyIndexColumns=s.absoluteIndexItemToHierarchyIndex,this._absoluteIndexItemToIndexPropColumns=s.absoluteIndexItemToIndexProp,this.hierarchyInColumns=n.columns.hierarchies,this.countHierarchyInColumns=n.columns.positions[0].positions.length}0!==n.cells.values.length?(this.maxColumns=n.cells.values[0].length,this.maxRows=n.cells.values.length):null!=n.rows&&(this.maxRows=n.rows.positions.length);var l=e(n,this.maxColumns,this.maxRows);this.displayValueCells=l.displayValueCells,this.backColorCells=l.backColorCells,this.formatStringCells=l.formatStringCells,this.rows=n.rows,this.columns=n.columns,this.foreColorCells=l.foreColorCells,this.valueCells=l.valueCells,this.isUpdateableData&&(this.canUpdateStates=l.canUpdateStates)},n.prototype.getHierarchyDescriptionInRows=function(e){return this.hierarchyInRows[e]},n.prototype.getHierarchyDescriptionInColumns=function(e){return this.hierarchyInColumns[e]},n.prototype.getLevelPropertyInRows=function(e){var t=this.absoluteIndexItemToHierarchyIndexRows[e];return this.rows.members[this.rows.positions[0].positions[t].id].memberProperties[this._absoluteIndexItemToIndexPropRows[e]]},n.prototype.getLevelPropertyInColumns=function(e){var t=this.absoluteIndexItemToHierarchyIndexColumns[e];return this.columns.members[this.columns.positions[0].positions[t].id].memberProperties[this._absoluteIndexItemToIndexPropColumns[e]]},n.prototype.getCellData=function(e,t){return{displayValue:this.getDisplayValueForCell(e,t),value:this.getValueCell(e,t),backColor:this.getBackColorForCell(e,t),foreColor:this.getForeColorForCell(e,t),formatString:this.getFormatStringForCell(e,t)}},n.prototype.getTuplesForCell=function(e,t){for(var i=[],n=[],o=0;o<this.countHierarchyInRows;o++)i.push(this.rows.members[this.rows.positions[t].positions[o].id].uniqueName);for(var r=0;r<this.countHierarchyInColumns;r++)n.push(this.columns.members[this.columns.positions[e].positions[r].id].uniqueName);return{rows:i,columns:n}},n.prototype.getDescriptionOfTuplesForCell=function(e,t){for(var i=[],n=[],o=0;o<this.countHierarchyInRows;o++)i.push({memberUniqueName:this.rows.members[this.rows.positions[t].positions[o].id].uniqueName,memberCaption:this.rows.members[this.rows.positions[t].positions[o].id].caption,hierarchyUniqueName:this.rows.hierarchies[o].uniqueName,hierarchyCaption:this.rows.hierarchies[o].caption,isCalculatedMember:this.rows.members[this.rows.positions[t].positions[o].id].isCalculated});for(var r=0;r<this.countHierarchyInColumns;r++)n.push({memberUniqueName:this.columns.members[this.columns.positions[e].positions[r].id].uniqueName,memberCaption:this.columns.members[this.columns.positions[e].positions[r].id].caption,hierarchyUniqueName:this.columns.hierarchies[r].uniqueName,hierarchyCaption:this.columns.hierarchies[r].caption,isCalculatedMember:this.columns.members[this.columns.positions[e].positions[r].id].isCalculated});return{rows:i,columns:n}},n.prototype.getValueCustomPropRows=function(e,t){var i=this.absoluteIndexItemToHierarchyIndexRows[e],n=this.rows;return n.members[n.positions[t].positions[i].id].memberProperties[this._absoluteIndexItemToIndexPropRows[e]]},n.prototype.getValueCustomPropColumns=function(e,t){var i=this.absoluteIndexItemToHierarchyIndexColumns[t],n=this.columns;return n.members[n.positions[e].positions[i].id].memberProperties[this._absoluteIndexItemToIndexPropColumns[t]]},n.prototype.getValueCell=function(e,t){return this.valueCells[t][e]},n.prototype.getDisplayValueForCell=function(e,t){return this.isUpdated(e,t)?this.getUpatedValue(e,t):this.displayValueCells[t][e]},n.prototype.getFormatStringForCell=function(e,t){return this.formatStringCells[t][e]},n.prototype.isSparkline=function(e,t){return"Sparkline"===this.getFormatStringForCell(e,t)},n.prototype.getHierarchyInColumns=function(e){return this.columns.hierarchies[e]},n.prototype.getHierarchyInRows=function(e){return this.rows.hierarchies[e]},n.prototype.getAncestorsInRows=function(e,t){var i=this.rows,n=i.positions[t].positions[e].parentId,o=[];if(-1===n)return o;for(var r=n,a=t-1;a>=0;a--)if(i.positions[a].positions[e].id===r){if(o.push(i.members[r].uniqueName),-1===i.positions[a].positions[e].parentId)break;r=i.positions[a].positions[e].parentId}return o},n.prototype.getAncestorsInColumns=function(e,t){var i=this.columns,n=i.positions[e].positions[t].parentId,o=[];if(-1===n)return o;for(var r=n,a=e-1;a>=0;a--)if(i.positions[a].positions[t].id===r){if(o.push(i.members[r].uniqueName),-1===i.positions[a].positions[t].parentId)break;r=i.positions[a].positions[t].parentId}return o},n.prototype.getBackColorForCell=function(e,t){return this.backColorCells[t][e]},n.prototype.getForeColorForCell=function(e,t){return this.foreColorCells[t][e]},n.prototype.getDataRowAction=function(e,t){var i=this.rows,n=i.members[i.positions[t].positions[e].id];return n.countChildren=this.getCountChildrenRowsPanel(e,t),n},n.prototype.getDataColumnAction=function(e,t){var i=this.columns,n=i.members[i.positions[e].positions[t].id];return n.countChildren=this.getCountChildrenColumnsPanel(e,t),n},n.prototype.rowIsParent=function(e,t){var i=this.rows.positions[t].positions[e].id;if(this.rows.positions.length<=t+1)return!1;if(this.rows.positions[t+1].positions[e].id===i){for(var n=t+2;t<this.rows.positions.length;n++)if(this.rows.positions[n].positions[e].id!==i){var o=this.rows.positions[n].positions[e].parentId;if(-1===o)return!1;if(i===o)return!0}return!1}var r=this.rows.positions[t+1].positions[e].parentId;return-1!==r&&i===r},n.prototype.hasChildrenRowsPanel=function(e,t){return 0!==this.rows.positions[t].positions[e].childCount},n.prototype.hasChildrenColumnsPanel=function(e,t){return 0!==this.columns.positions[e].positions[t].childCount},n.prototype.getCountChildrenColumnsPanel=function(e,t){return this.columns.positions[e].positions[t].childCount},n.prototype.getCountChildrenRowsPanel=function(e,t){return this.rows.positions[t].positions[e].childCount},n.prototype.columnIsParent=function(e,t){var i=this.columns.positions[e].positions[t].id;if(this.columns.positions.length<=e+1)return!1;if(this.columns.positions[e+1].positions[t].id===i){for(var n=e+2;n<this.columns.positions.length;n++)if(this.columns.positions[n].positions[t].id!==i){var o=this.columns.positions[n].positions[t].parentId;if(-1===o)return!1;if(i===o)return!0}return!1}var r=this.columns.positions[e+1].positions[t].parentId;return-1!==r&&i===r},n.prototype.getRowLevelDepth=function(e,t){var i=this.rows.positions[t].positions[e].parentId;if(-1===i)return 0;for(var n=0,o=t;;){if(--o<0)break;if(this.rows.positions[o].positions[e].parentId!==i&&(this.rows.positions[o].positions[e].id===i&&(i=this.rows.positions[o].positions[e].parentId,n+=1),-1===this.rows.positions[o].positions[e].parentId))break}return n},n.prototype.getColumnLevelDepth=function(e,t){var i=this.columns.positions[e].positions[t].parentId;if(-1===i)return 0;for(var n=0,o=e;;){if(--o<0)break;if(this.columns.positions[o].positions[t].parentId!==i&&(this.columns.positions[o].positions[t].id===i&&(i=this.columns.positions[o].positions[t].parentId,n+=1),-1===this.columns.positions[o].positions[t].parentId))break}return n},n.prototype.getCountLevelDepthInColumnFromRowsPane=function(e){for(var t=[],i=0;i<this.rows.positions.length;i++){var n=this.rows.positions[i].positions[e];t.push(this.rows.members[n.id].levelDepth)}return o(t).length},n.prototype.getCountLevelDepthInRowFromColumnsPane=function(e){for(var t=[],i=0;i<this.columns.positions.length;i++){var n=this.columns.positions[i].positions[e];t.push(this.columns.members[n.id].levelDepth)}return o(t).length},n.prototype.getNeighborsHierarchyInColumns=function(e,t){for(var i=[],n=t-1;n>=0;n--)i.push({ancestors:this.getAncestorsInColumns(e,n),data:this.getDataColumnAction(e,n),hierarchy:this.getHierarchyInColumns(n)});return i},n.prototype.getNeighborsHierarchyInRows=function(e,t){for(var i=[],n=e-1;n>=0;n--)i.push({ancestors:this.getAncestorsInRows(n,t),data:this.getDataRowAction(n,t),hierarchy:this.getHierarchyInRows(n)});return i},n.prototype.getCountRowsMemberData=function(e,t){for(var i=0,n=this.rows,o=n.positions[t].positions[e].id,r=t;r>=0&&n.positions[r].positions[e].id===o;r--)i++;return i},n.prototype.getCountColumnsMemberData=function(e,t){for(var i=0,n=this.columns,o=n.positions[e].positions[t].id,r=e;r>=0&&n.positions[r].positions[t].id===o;r--)i++;return i},n.prototype.setNewValue=function(e,t,i){void 0===this._updatedCells&&(this._updatedCells=new Array),!1===this._updatedCells.hasOwnProperty(e)&&(this._updatedCells[e]=new Array),this._updatedCells[e][t]=i;var n=this.getValueCell(e,t),o=r.call(this,e,t);this._onCellValueChanged(o,i,n)},n.prototype.isUpdated=function(e,t){return!(void 0===this._updatedCells||!this._updatedCells.hasOwnProperty(e)||!this._updatedCells[e].hasOwnProperty(t))},n.prototype.canUpdate=function(e,t){return this.canUpdateStates[t][e]},n.prototype.deleteUpdatedValue=function(e,t){delete this._updatedCells[e][t];var i=r.call(this,e,t);this._onChangeValueCellDeleted(i)},n.prototype.getUpatedValue=function(e,t){return this._updatedCells[e][t]},n.prototype.clearLocalChanges=function(){this._updatedCells=void 0,this._localChanges=void 0},n.prototype.saveLocalChanges=function(){void 0===this._localChanges&&(this._localChanges={});var e=this._updatedCells;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];for(var n in i)if(i.hasOwnProperty(n)){var o=this.getTuplesForCell(t,n),r=o.rows.concat(o.columns).join(",");this._localChanges[r]=e[t][n]}}},n.prototype.restoreLocalChanges=function(){this._updatedCells={};for(var e=0;e<this.maxColumns;e++)for(var t=0;t<this.maxRows;t++){var i=this.getTuplesForCell(e,t),n=i.rows.concat(i.columns).join(",");this._localChanges.hasOwnProperty(n)&&(void 0===this._updatedCells&&(this._updatedCells=new Array),!1===this._updatedCells.hasOwnProperty(e)&&(this._updatedCells[e]=new Array),this._updatedCells[e][t]=this._localChanges[n],delete this._localChanges[n])}},Object.defineProperty(n.prototype,"hasLocalChanges",{get:function(){return void 0!==this._updatedCells&&0!==this._updatedCells.length||a(this._localChanges)},enumerable:!0,configurable:!0}),n}(),c=function(){function e(e,t,i){for(var n=0,o=0;o<e.maxColumns;o++){var r=n;if((n+=t.getSizeColumn(o))>i)return{currentColumn:o,offsetCurrentColumn:r}}}function t(e,t,i){for(var n=0,o=0;o<e.maxRows;o++){var r=n;if((n+=t.getSizeRow(o))>i)return{currentRow:o,offsetCurrentRow:r}}}function i(e,t){this.sizeManager=e,this.dataManager=t,this._horizontalScrollValue=0,this._verticalScrollValue=0,this.currentColumn=0,this.offsetCurrentColumn=0,this.offsetCurrentColumnAbsolute=0,this.currentRow=0,this.offsetCurrentRow=0,this.offsetCurrentRowAbsolute=0}return Object.defineProperty(i.prototype,"horizontalScrollValue",{get:function(){return this._horizontalScrollValue},set:function(t){this._horizontalScrollValue=t;var i=e(this.dataManager,this.sizeManager,this._horizontalScrollValue);i&&(this.currentColumn=i.currentColumn,this.offsetCurrentColumn=i.offsetCurrentColumn-this._horizontalScrollValue,this.offsetCurrentColumnAbsolute=i.offsetCurrentColumn)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"verticalScrollValue",{get:function(){return this._verticalScrollValue},set:function(e){this._verticalScrollValue=e;var i=t(this.dataManager,this.sizeManager,this._verticalScrollValue);i&&(this.currentRow=i.currentRow,this.offsetCurrentRow=i.offsetCurrentRow-this._verticalScrollValue,this.offsetCurrentRowAbsolute=i.offsetCurrentRow)},enumerable:!0,configurable:!0}),i.prototype.rangeSizeRows=function(e,t){for(var i=0,n=0,o=t;o<this.dataManager.rows.positions.length&&(i+=this.sizeManager.getSizeRow(o),n++,this.dataManager.rows.positions.length>o+1!=!1)&&this.dataManager.rows.positions[o].positions[e].id===this.dataManager.rows.positions[o+1].positions[e].id;o++);return{Count:n,Size:i}},i.prototype.rangeSizeColumns=function(e,t){for(var i=0,n=0,o=t;o<this.dataManager.columns.positions.length&&(i+=this.sizeManager.getSizeColumn(o),n++,this.dataManager.columns.positions.length>o+1!=!1)&&this.dataManager.columns.positions[o].positions[e].id===this.dataManager.columns.positions[o+1].positions[e].id;o++);return{Count:n,Size:i}},i}();e.pivotTable=function(t,i){var n={},o=this;o.settings={};var r={};o.init=function(){o.settings=e.extend({},n,i),r=new s(t.id,o.settings),o.settings.hasOwnProperty("dataSource")&&r.updateDataSource(o.settings.dataSource)},o.resetScrolls=function(){r.resetScrolls()},o.getInfoFocusedCell=function(){return r.focusedCell},o.getAllHierarchies=function(){if(void 0===r.currentDataSource||null===r.currentDataSource)return[];var e=null==r.currentDataSource.rows?[]:r.currentDataSource.rows.hierarchies,t=null==r.currentDataSource.columns?[]:r.currentDataSource.columns.hierarchies;return e.concat(t)},Object.defineProperty(o,"currentDataSource",{get:function(){return r.currentDataSource},enumerable:!0,configurable:!0}),o.clear=function(){e(t).empty(),r.resetState()},o.clearLocalChanges=function(){r.clearLocalChanges()},o.destroy=function(){r.dispose()},o.reDraw=function(){r.reDraw()},o.option=function(e){e.hasOwnProperty("onActionHeader")&&(r.onActionHeader=e.onActionHeader),e.hasOwnProperty("cellConditions")&&(r.cellConditions=e.cellConditions),e.hasOwnProperty("measuresInDataSource")&&(r.measuresInDataSource=e.measuresInDataSource),e.hasOwnProperty("dataSource")&&r.updateDataSource(e.dataSource)},o.init()},e.fn.pivotTable=function(t){return this.each(function(){if(void 0==e(this).data("pivotTable")){var i=new e.pivotTable(this,t);e(this).data("pivotTable",i)}})},function(e){e.countLines=function(t,i){var n={recalculateCharWidth:!0,charsMode:"random",fontAttrs:["font-family","font-size","text-decoration","font-style","font-weight"]};i=e.extend({},n,i);var o,r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";t.jquery||(t=e(t));var a=t.val();switch(i.charsMode){case"random":for(i.chars="",r+=".,?!-+;:'\"",o=1;o<=12;o++)i.chars+=r[Math.floor(Math.random()*r.length)];break;case"alpha":i.chars=r;break;case"alpha_extended":i.chars=r+".,?!-+;:'\"";break;case"from_ta":if(a.length<15)i.chars=r;else for(o=1;o<=15;o++)i.chars+=a[Math.floor(Math.random()*a.length)]}e.isArray(i.chars)||(i.chars=i.chars.split(""));var s="";for(o=1;o<=10;o++)s+=Math.floor(10*Math.random())+1;t.after("<span id='s"+s+"'></span>");var l=e("#s"+s);l.hide(),e.each(i.fontAttrs,function(e,i){l.css(i,t.css(i))});var c,u=a.split("\n"),p=u.length;if(i.recalculateCharWidth||null==t.data("average_char")){var h=i.chars,d=h.length,m=0;e.each(h,function(e,t){l.text(t),m+=l.width()}),t.data("average_char",Math.ceil(m/d))}c=t.data("average_char"),l.remove();var f,g=2*(t.outerWidth()-t.width()),_=0,y=0,v=0;e.each(u,function(i,n){if((f=(n.length+1)*c+g)>=t.outerWidth()){var o=Math.floor(f/t.outerWidth());y+=o,_++}""===e.trim(n)&&v++});var C={};return C.actual=p,C.wrapped=_,C.wraps=y,C.visual=p+y,C.blank=v,C}}(e)}(jQuery);var pageDynamicPivotGrid=function(e){function t(t){return t.treeMetadata.filter(function(t){switch(t.type){case"kpiRootNode":t.caption=e.Localization.localize("KPIS");break;case"measuresRootNode":t.caption=e.Localization.localize("Measures");break;case"setsRootNode":t.caption=e.Localization.localize("CalculationsListControl_NamedSets_TreeNode")}}),t}function i(e){return e||(e={calculatedMembers:[],calculatedNamedSets:[]}),void 0===e.calculatedMembers&&(e.calculatedMembers=[]),void 0===e.calculatedNamedSets&&(e.calculatedNamedSets=[]),e}function n(e){var t=[];for(var i in e.data)e.data.hasOwnProperty(i)&&t.push(e.data[i].uniqueName);return t}function o(e,t){var i={},n={};if(i.actionType=e.actionType,n.uniqueName=e.data.uniqueName,n.hierarchyUniqueName=e.hierarchy.uniqueName,n.axisType=e.place,!0===t&&("rows"===n.axisType?n.axisType="columns":"columns"===n.axisType&&(n.axisType="rows")),n.ancestors=e.ancestors,e.neighborsHierarchy){n.neighbors=[];for(var o=0;o<e.neighborsHierarchy.length;o++){var r=e.neighborsHierarchy[o];n.neighbors.push({uniqueName:r.data.uniqueName,hierarchyUniqueName:r.hierarchy.uniqueName,ancestors:r.ancestors})}}return i.header=n,i}function r(e,t,i,n){var o={},r={};o.actionType="expand","hierarchy"===t.type?(r.uniqueName=t.defaultMember,r.hierarchyUniqueName=t.uniqueName):"level"===t.type&&(r.uniqueName=t.uniqueName,r.hierarchyUniqueName=t.uniqueName),r.axisType=i,!0===n&&("rows"===r.axisType?r.axisType="columns":"columns"===r.axisType&&(r.axisType="rows")),r.neighbors=[];for(var a=0;a<e.items.length;a++){var s=e.items[a];r.neighbors.push({uniqueName:s.data.uniqueName,hierarchyUniqueName:s.hierarchy.uniqueName,ancestors:s.ancestors})}return o.header=r,o}function a(t,i,n,o,r,a){for(var s=jQuery.Deferred(),l=void 0,c=0;c<r.length;c++){var u=r[c],p=!1;if(0===a.length){l=u;break}for(var h=0;h<a.length;h++){var d=a[h];switch(d.type){case"hierarchy":d.uniqueName===u.uniqueName&&(p=!0);break;case"level":d.parentHierarchyId===u.parentHierarchyId&&(p=!0);break;case"values":d.type===u.type&&(p=!0);break;case"calculatedNamedSet":case"namedSet":d.name===u.name&&(p=!0)}if(!1===p){l=u;break}}if(l)break}if(!l)throw new Error("NotImplementedException");switch(l.type){case"hierarchy":s.resolve([l.uniqueName]);break;case"level":s.resolve([l.parentHierarchyId]);break;case"values":s.resolve(["[Measures]"]);break;case"calculatedNamedSet":for(var m=void 0,f=0;f<i.length;f++)i[f].name===l.name&&(m=i[f]);if(!m)throw new Error("InvalidOperationException");var g={cubeName:n,connection:o,expression:m.expression,name:m.name};$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/getHierarchiesForCustomCalculationSet",contentType:"application/json; charset=utf-8",data:JSON.stringify(g)}).done(function(e){s.resolve(e)}).fail(function(t){e.LogService.error(t),s.resolve([])});break;case"namedSet":for(var _ in t)t.hasOwnProperty(_)&&t[_].name===l.name&&s.resolve(t[_].dimensions)}return s}function s(e){for(var t=0,i=0;i<e.length;i++){var n=e[i];n instanceof Array?t+=s(n):null!=n&&n instanceof String==!1&&t++}return t}function l(e){var t=[];if(void 0===e||null===e)return t;if(null!==e.hierarchies)for(var i=0;i<e.hierarchies.length;i++)t.push(e.hierarchies[i].uniqueName);return t}function c(t,i){for(var n={},o=0;o<t.length;o++){for(var r=t[o],a=0;a<r.columns.length;a++){var s=r.columns[a];if("[Measures]"!==s.hierarchyUniqueName)if(n.hasOwnProperty(s.hierarchyUniqueName)){if(-1!==n[s.hierarchyUniqueName].indexOf(s.memberUniqueName))continue;n[s.hierarchyUniqueName].push(s.memberUniqueName)}else n[s.hierarchyUniqueName]=[s.memberUniqueName]}for(var l=0;l<r.rows.length;l++){var c=r.rows[l];if("[Measures]"!==c.hierarchyUniqueName)if(n.hasOwnProperty(c.hierarchyUniqueName)){if(-1!==n[c.hierarchyUniqueName].indexOf(c.memberUniqueName))continue;n[c.hierarchyUniqueName].push(c.memberUniqueName)}else n[c.hierarchyUniqueName]=[c.memberUniqueName]}}var u=[];for(var p in n)if(n.hasOwnProperty(p)){var h=new e.Controls.MemberChoice.QueryManager(i,p).getQueryMemberWithParents(n[p]);u.push(h)}return u}function u(t,i){var n=this;this._$currentPanel=$("<div/>"),this._$parentPanel=$(t),this._$parentPanel.append(this._$currentPanel);var o=function(e){var t=e.queryDesignerSetting;t.hideEmptyRows!==n.queryDesignerSetting.hideEmptyRows&&(n.queryDesignerSetting.hideEmptyRows=t.hideEmptyRows),t.hideEmptyColumns!==n.queryDesignerSetting.hideEmptyColumns&&(n.queryDesignerSetting.hideEmptyColumns=t.hideEmptyColumns),e.rotateAxes!==n.rotateAxes&&(n._rotateAxes=e.rotateAxes),n._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:e})};L.call(this,i),this._historyManager=new _(function(e,t){void 0!==n.onHistoryChangedCallback&&n.onHistoryChangedCallback(n,e),t!==f.Add&&y.call(n)},function(e,t){if(n._$elementPivotTable.data("pivotTable").resetScrolls(),e.type===g.State){var i=e.point;o(i),k.call(n,i,t)}else{if(e.type!==g.Query)throw new Error("InvalidOperationException");z.call(n,e.point,t)}});this._contexId=e.Utility.Guid.newGuid(),this._updatedCellsStorage=new e.Controls.UpdatedCellsStorage(function(e,t){n.onStateUpdateStorageChangedCallback&&n.onStateUpdateStorageChangedCallback(e,t)})}function p(){var t=this.currentDataSource.filterMembers,i=e.Controls.UpdateScriptBuilder.build(this.cubeName,this.currentUpdateScriptTemplate,this._updatedCellsStorage.entries,t),n=this;this.visibleBusyIndicator=!0,this.messageBusyIndicator=e.Localization.localize("LoadPanel_ExecuteUpdateScript");var o={connection:this.connection,contextId:this._contexId,updateScript:i};return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/update",contentType:"application/json; charset=utf-8",data:JSON.stringify(o)}).done(function(){n._updatedCellsStorage.setStateAfterRecalculate(),n._$elementPivotTable.data("pivotTable").clearLocalChanges(),n.visibleBusyIndicator=!1}).fail(function(t){n.visibleBusyIndicator=!1,e.UserMessageService.showServerError(t),e.LogService.error(t)})}function h(){this.visibleBusyIndicator=!0,this.messageBusyIndicator=e.Localization.localize("LoadPanel_ExecuteUpdateScript");var t=this,i={connection:this.connection,contextId:this._contexId};return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/save",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(){t._updatedCellsStorage.setStateAfterSave()}).fail(function(i){t.visibleBusyIndicator=!1,e.UserMessageService.showServerError(i),e.LogService.error(i)})}function d(){this.visibleBusyIndicator=!0,this.messageBusyIndicator=e.Localization.localize("LoadPanel_RollbackCommand");var t=this,i={connection:this.connection,contextId:this._contexId};return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/rollback",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(){t._updatedCellsStorage.setStateAfterRollback()}).fail(function(i){t.visibleBusyIndicator=!1,e.UserMessageService.showServerError(i),e.LogService.error(i)})}function m(){this._$elementPivotTable.data("pivotTable").clearLocalChanges(),this._updatedCellsStorage.clearLocalChanges()}var f;!function(e){e[e.Add=0]="Add",e[e.Clear=1]="Clear",e[e.Navigate=2]="Navigate"}(f||(f={}));var g;!function(e){e[e.State=0]="State",e[e.Query=1]="Query"}(g||(g={}));var _=function(){function e(e){for(var t=[],i=0;i<e.length;i++)t.push(jQuery.extend(!0,{},e[i]));return t}function t(e){var t=jQuery.extend(!0,{},e);this._indexCurrentPoint<this._historyItems.length-1&&(this._historyItems.length=this._indexCurrentPoint+1),this._historyItems.push({action:t}),this._indexCurrentPoint++}function i(t,i,n){if(this._indexCurrentPoint<this._historyItems.length-1&&(this._historyItems.length=this._indexCurrentPoint+1),i===g.State){var o=jQuery.extend(!0,{},t);this._historyItems.push({point:o,type:i,startActions:e(n)})}else i===g.Query&&this._historyItems.push({point:t,type:i,startActions:e(n)});this._indexCurrentPoint++}function n(e,t){this._indexCurrentPoint=-1,this._historyItems=[],this.onHistoryChanged=function(t,i){e(t,i)},this._onUpdateDataCallback=t}function o(e){var t=$.extend(!0,{},e);if(e.hasOwnProperty("point"))this._onUpdateDataCallback(t,this.getAllActions());else if(e.hasOwnProperty("action"))for(var i=this._indexCurrentPoint;i>=0;i--){var n=this._historyItems[i];if(n.hasOwnProperty("point")){var o=$.extend(!0,{},n);this._onUpdateDataCallback(o,this.getAllActions());break}}}return Object.defineProperty(n.prototype,"canGoToStart",{get:function(){return this.canGoToBack},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canGoToBack",{get:function(){return this._historyItems.length>1&&0!==this._indexCurrentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canGoToNext",{get:function(){return this._historyItems.length-1>this._indexCurrentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canGoToEnd",{get:function(){return this.canGoToNext},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastInitialHistoryPoint",{get:function(){for(var e=null,t=this._indexCurrentPoint;t>=0;t--){var i=this._historyItems[t];if(i.hasOwnProperty("point")){e=i;break}}return e},enumerable:!0,configurable:!0}),n.prototype.goToStart=function(){this.canGoToStart&&(this._indexCurrentPoint=0,o.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,f.Navigate))},n.prototype.goToBack=function(){this.canGoToBack&&(this._indexCurrentPoint--,o.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,f.Navigate))},n.prototype.goToNext=function(){this.canGoToNext&&(this._indexCurrentPoint++,o.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,f.Navigate))},n.prototype.goToEnd=function(){this.canGoToEnd&&(this._indexCurrentPoint=this._historyItems.length-1,o.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,f.Navigate))},n.prototype.getAllActions=function(){for(var e=[],t=this._indexCurrentPoint;t>=0;t--){var i=this._historyItems[t];if(i.hasOwnProperty("action"))e.push(i.action);else if(e=e.reverse(),i.hasOwnProperty("point")){e=i.startActions.concat(e);break}}return e},n.prototype.addAction=function(e){t.call(this,e),this.onHistoryChanged(this,f.Add)},n.prototype.addStatePoint=function(e,t){i.call(this,e,g.State,t),this.onHistoryChanged(this,f.Add)},n.prototype.addQueryPoint=function(e,t){i.call(this,e,g.Query,t),this.onHistoryChanged(this,f.Add)},n.prototype.clear=function(){-1===this._indexCurrentPoint&&0===this._historyItems.length||(this._indexCurrentPoint=-1,this._historyItems.length=0,this.onHistoryChanged(this,f.Clear))},n}();$.fn.percWidth=function(){return this.outerWidth()/this.parent().outerWidth()*100},$.fn.percHeight=function(){return this.outerHeight()/this.parent().outerHeight()*100};var y=function(){if(this._$elementQueryDesigner){var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();this._$elementActiveFilters.data("ranetActiveFilters")&&this._$elementActiveFilters.data("ranetActiveFilters").setLayout(e)}},v=function(){var e=this._$elementPivotTable.data("pivotTable");e&&e.reDraw(),this._$elementChart.data("ranetChart")&&this._$elementChart.data("ranetChart").resize(),this._$elementVectorMap.data("ranetVectorMap")&&this._$elementVectorMap.data("ranetVectorMap").resize()},C=function(){var t=this._$viewContainer,i=$('<div class="ranetDynamicPivotGrid_rightExtPanel" style="display:none;"/>'),n=$("<i class='fa fa-caret-right ranetDynamicPivotGrid_showHideExtPanelButton'></i>"),o=$("<i class='fa fa-caret-left ranetDynamicPivotGrid_showHideExtPanelButton' style='display:none;'></i>"),r=$('<div class="ranetDynamicPivotGrid_extPanelContainer"></div>'),a=this,s=function(e){if(!1===e)i.css("width",""),t.css("width",""),i.hasClass("ui-resizable")&&i.resizable("option","disabled",!0),r.hide(),n.hide(),o.show(),i.css("width","14px"),t.addClass("ranetDynamicPivotGrid_viewContainer-collapsedExtension"),t.removeClass("ranetDynamicPivotGrid_viewContainer-visibledExtension");else{if(!0!==e)throw new Error("InvalidOperationException");i.css("width",""),t.css("width",""),i.hasClass("ui-resizable")&&i.resizable("option","disabled",!1),r.show(),n.show(),o.hide(),i.css("width","30%"),t.removeClass("ranetDynamicPivotGrid_viewContainer-collapsedExtension"),t.addClass("ranetDynamicPivotGrid_viewContainer-visibledExtension")}};n.on("click",function(e){e.stopPropagation(),a.isVisibleExtensionPanel=!1,s(!1),v.call(a)}),o.on("click",function(e){e.stopPropagation(),a.isVisibleExtensionPanel=!0,s(!0),v.call(a)});var l=new e.View.RightExtensionView.RightExtView;l.headerText=this.headerText,l.footerText=this.footerText,r.append(l.view);var c=$('<div class="ranetDynamicPivotGrid_buttonsContainerExtPanel" />');c.on("click",function(){s(!a.isVisibleExtensionPanel),a.isVisibleExtensionPanel=!a.isVisibleExtensionPanel,v.call(a)}),c.append(n),c.append(o),i.append(c),i.append(r),this._$viewPanel.append(i),this._$rightExtensionPanel=i,this._rightExtensionView=l,s(this.isVisibleExtensionPanel)},b=function(){var e=this._$elementQueryDesigner.percWidth(),t=this._$elementCubeExplorer.percWidth();switch(this.placementLayoutModeQueryDesigner){case 0:this._$elementQueryDesigner.css("width",e+"%"),this._$elementQueryDesigner.css("height","100%"),this._$elementCubeExplorer.css("width",t+"%"),this._$elementCubeExplorer.css("height","100%"),this._$viewPanel.css("width",98-e-t+"%");break;case 1:var i=this._$queryDesignerAndCubeExplorerPanel.percWidth();this._$queryDesignerAndCubeExplorerPanel.css("width",i+"%"),this._$queryDesignerAndCubeExplorerPanel.css("height","100%"),this._$viewPanel.css("width",98-i+"%");break;case 2:this._$elementCubeExplorer.css("width",t+"%"),this._$elementCubeExplorer.css("height","100%"),this._$viewPanel.css("width",98-t+"%");break;case 3:case 4:this._$elementQueryDesigner.css("width",e+"%"),this._$elementQueryDesigner.css("height","100%"),this._$viewPanel.css("width",98-e+"%")}v.call(this)},w=function(){var e=this;switch(this._$elementCubeExplorer.hasClass("ui-resizable")&&this._$elementCubeExplorer.resizable("destroy"),this._$elementQueryDesigner.hasClass("ui-resizable")&&this._$elementQueryDesigner.resizable("destroy"),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.hasClass("ui-resizable")&&this._$queryDesignerAndCubeExplorerPanel.resizable("destroy"),this.placementLayoutModeQueryDesigner){case 0:this._$elementQueryDesigner.resizable({helper:"resizable-helper",handles:"e",stop:function(t,i){b.call(e)}}),this._$elementCubeExplorer.resizable({helper:"resizable-helper",handles:"e",stop:function(t,i){b.call(e)}});break;case 1:this._$queryDesignerAndCubeExplorerPanel.resizable({helper:"resizable-helper",handles:"e",stop:function(t,i){b.call(e)}}),this._$elementCubeExplorer.resizable({helper:"resizable-helper",handles:"s",stop:function(t,i){var n=e._$elementCubeExplorer.percHeight();e._$elementQueryDesigner.css("height",100-n+"%"),e._$elementCubeExplorer.css("height",n+"%"),e._$elementQueryDesigner.css("width","100%"),e._$elementCubeExplorer.css("width","100%")}});break;case 2:this._$elementCubeExplorer.resizable({helper:"resizable-helper",handles:"e",stop:function(t,i){b.call(e)}});break;case 4:case 3:this._$elementQueryDesigner.resizable({helper:"resizable-helper",handles:"e",stop:function(t,i){b.call(e)}})}},S=function(){this._$elementActiveFilters.hasClass("ui-resizable")&&this._$elementActiveFilters.resizable("destroy");var e=this;this._$elementActiveFilters.css("height",""),this._$elementDataViewer.css("height",""),this._$elementActiveFilters.resizable({helper:"resizable-helper",handles:"s",stop:function(t,i){var n=Math.round(e._$elementActiveFilters.percHeight());e._$elementActiveFilters.css("width",""),e._$elementActiveFilters.css("height",n+"%"),e._$elementDataViewer.css("height",100-n+"%"),v.call(e)}})},x=function(){var e=this._$rightExtensionPanel,t=this._$viewContainer,i=this;e.resizable({helper:"resizable-helper",handles:"w",stop:function(n,o){var r=Math.round(e.percWidth());e.css("width",r+"%"),e.css("height",""),e.css("left",""),t.css("width",100-r+"%"),v.call(i)}}),!1===this.isVisibleExtensionPanel&&e.resizable("option","disabled",!0)},D=function(){for(var e=0;e<2;e++)this._$elementDataViewer.removeClass("ranetDataViewerPanel_layout"+e),this._$elementActiveFilters.removeClass("ranetDynamicPivotGrid_activeFilters_layout"+e);!1===this.isVisibleActiveFilters?(this._$elementDataViewer.addClass("ranetDataViewerPanel_layout0"),this._$elementActiveFilters.addClass("ranetDynamicPivotGrid_activeFilters_layout0")):!0===this.isVisibleActiveFilters&&(this._$elementDataViewer.addClass("ranetDataViewerPanel_layout1"),this._$elementActiveFilters.addClass("ranetDynamicPivotGrid_activeFilters_layout1")),S.call(this),v.call(this)},T=function(){for(var t=this.placementLayoutModeQueryDesigner,i=0;i<5;i++)this._$viewPanel.removeClass("ranetViewPanel_layout"+i),this._$elementQueryDesigner.removeClass("ranetQueryDesigner_layout"+i),this._$elementCubeExplorer.removeClass("ranetCubeExplorer_layout"+i);this._$elementCubeExplorer.show(),this._$elementQueryDesigner.show(),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.show();var n,o;switch(t){case 0:this._$viewPanel.addClass("ranetViewPanel_layout0"),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout0"),this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout0"),(n=this._$elementQueryDesigner.data("ranetQueryDesigner"))&&(n.option({placementMode:e.Controls.PlacementAreaItemMode.Layout1}),n.isVisibleLayoutButton(!1)),(o=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&o.isVisibleLayoutButton(!0),this._$currentPanel.prepend(this._$elementQueryDesigner),this._$currentPanel.prepend(this._$elementCubeExplorer),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.remove(),!1===this.showMetadataAndQueryDesigner&&(this._$elementQueryDesigner.hide(),this._$elementCubeExplorer.hide());break;case 1:this._$queryDesignerAndCubeExplorerPanel=$("<div/>"),this._$queryDesignerAndCubeExplorerPanel.addClass("queryDesignerAndCubeExplorerPanel"),this._$viewPanel.addClass("ranetViewPanel_layout1"),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout1"),this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout1"),this._$queryDesignerAndCubeExplorerPanel.append(this._$elementCubeExplorer),this._$queryDesignerAndCubeExplorerPanel.append(this._$elementQueryDesigner),(n=this._$elementQueryDesigner.data("ranetQueryDesigner"))&&(n.option({placementMode:e.Controls.PlacementAreaItemMode.Layout2}),n.isVisibleLayoutButton(!1)),(o=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&o.isVisibleLayoutButton(!0),!1===this.showMetadataAndQueryDesigner&&this._$queryDesignerAndCubeExplorerPanel.hide(),this._$currentPanel.prepend(this._$queryDesignerAndCubeExplorerPanel);break;case 2:this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout2"),this._$viewPanel.addClass("ranetViewPanel_layout2"),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout2"),!1===(1===this._$currentPanel.has(this._$elementCubeExplorer).lenght)&&(this._$currentPanel.prepend(this._$elementQueryDesigner),this._$currentPanel.prepend(this._$elementCubeExplorer)),!1===this.showMetadataAndQueryDesigner&&this._$elementCubeExplorer.hide(),(o=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&o.isVisibleLayoutButton(!0),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.remove();break;case 4:case 3:this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout"+t),this._$viewPanel.addClass("ranetViewPanel_layout"+t),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout"+t),(n=this._$elementQueryDesigner.data("ranetQueryDesigner"))&&(3===t?n.option({placementMode:e.Controls.PlacementAreaItemMode.Layout2}):4===t&&n.option({placementMode:e.Controls.PlacementAreaItemMode.Layout1}),n.isVisibleLayoutButton(!0)),(o=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&o.isVisibleLayoutButton(!1),!1===(1===this._$currentPanel.has(this._$elementQueryDesigner).lenght)&&(this._$currentPanel.prepend(this._$elementQueryDesigner),this._$currentPanel.prepend(this._$elementCubeExplorer)),!1===this.showMetadataAndQueryDesigner&&this._$elementQueryDesigner.hide(),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.remove();break;default:throw new Error("NotImplementedException")}this.showMetadataAndQueryDesigner?(this._$viewPanel.css("height",""),this._$viewPanel.css("width",""),v.call(this)):(this._$viewPanel.css("width","98%"),v.call(this)),this._$elementCubeExplorer.css("height",""),this._$elementCubeExplorer.css("width",""),this._$elementQueryDesigner.css("height",""),this._$elementQueryDesigner.css("width",""),w.call(this)},P=function(){switch(this.placementLayoutModeDataViewer){case 2:case 1:var e=this._$elementPivotTable.percHeight();this._$elementPivotTable.css("height",e+"%"),this._$elementExtensionPanel.css("height",100-e+"%"),this._$elementPivotTable.css("width",""),this._$elementExtensionPanel.css("width",""),this._$elementPivotTable.css("top","0px");break;case 4:case 3:var t=this._$elementPivotTable.percWidth();this._$elementPivotTable.css("width",t+"%"),this._$elementExtensionPanel.css("width",100-t+"%"),this._$elementPivotTable.css("height","100%"),this._$elementExtensionPanel.css("height","100%"),this._$elementPivotTable.css("left","0px")}v.call(this)},I=function(){var e=this;switch(this._$elementPivotTable.hasClass("ui-resizable")&&this._$elementPivotTable.resizable("destroy"),this.placementLayoutModeDataViewer){case 1:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"n",stop:function(t,i){P.call(e)}});break;case 2:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"s",stop:function(t,i){P.call(e)}});break;case 3:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"e",stop:function(t,i){P.call(e)}});break;case 4:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"w",stop:function(t,i){P.call(e)}})}},M=function(){this.extensionSettings.extensionType!==e.Controls.Extensions.ExtensionTypes.Chart&&this.extensionSettings.extensionType!==e.Controls.Extensions.ExtensionTypes.Pie||(this._$elementChart.css("height","100%"),this._$elementChart.css("width","100%"),this._$elementChart.css("display","block"),this._$elementChart.css("overflow","hidden"),this._$elementChart.css("overflow-y","auto"),this._$elementVectorMap.css("display","none")),this.extensionSettings.extensionType===e.Controls.Extensions.ExtensionTypes.VectorMap&&(this._$elementVectorMap.css("height","100%"),this._$elementVectorMap.css("width","100%"),this._$elementVectorMap.css("display","block"),this._$elementChart.css("display","none"))},E=function(){for(var e=0;e<6;e++)this._$elementPivotTable.removeClass("ranetPivotTable_layout"+e),this._$elementExtensionPanel.removeClass("ranetExtension_layout"+e);switch(this._$elementPivotTable.css("height",""),this._$elementPivotTable.css("width",""),this._$elementExtensionPanel.css("width",""),this._$elementExtensionPanel.css("height",""),this.placementLayoutModeDataViewer){case 0:this._$elementPivotTable.addClass("ranetPivotTable_layout0"),this._$elementExtensionPanel.addClass("ranetExtension_layout0");break;case 1:0===this._$elementDataViewer.children().index(this._$elementPivotTable)&&this._$elementDataViewer.prepend(this._$elementExtensionPanel),this._$elementPivotTable.addClass("ranetPivotTable_layout1"),this._$elementExtensionPanel.addClass("ranetExtension_layout1");break;case 2:0===this._$elementDataViewer.children().index(this._$elementExtensionPanel)&&this._$elementDataViewer.prepend(this._$elementPivotTable),this._$elementPivotTable.addClass("ranetPivotTable_layout2"),this._$elementExtensionPanel.addClass("ranetExtension_layout2");break;case 3:0===this._$elementDataViewer.children().index(this._$elementExtensionPanel)&&this._$elementDataViewer.prepend(this._$elementPivotTable),this._$elementPivotTable.addClass("ranetPivotTable_layout3"),this._$elementExtensionPanel.addClass("ranetExtension_layout3");break;case 4:0===this._$elementDataViewer.children().index(this._$elementPivotTable)&&this._$elementDataViewer.prepend(this._$elementExtensionPanel),this._$elementPivotTable.addClass("ranetPivotTable_layout4"),this._$elementExtensionPanel.addClass("ranetExtension_layout4");break;case 5:this._$elementPivotTable.addClass("ranetPivotTable_layout5"),this._$elementExtensionPanel.addClass("ranetExtension_layout5");break;default:throw new Error("NotImplementedException")}I.call(this)},F=function(){if(this._$elementCubeExplorer.data("ranetCubeExplorer")){this._$elementCubeExplorer.data("ranetCubeExplorer").option({calculatedMembers:this.customCalculatedItems.calculatedMembers,calculatedNamedSets:this.customCalculatedItems.calculatedNamedSets});var e=this._$elementCubeExplorer.data("ranetCubeExplorer").getMapIdToMetadata();this._$elementQueryDesigner.data("ranetQueryDesigner").option({dataSource:e})}},N=function(){this._$currentPanel.addClass("ranetDynamicPivotGrid");var t=$("<div/>");t.addClass("ranetCubeExplorer"),t.attr("id","ranetCubeExplorer-"+e.Utility.Guid.newGuid()),this._$elementCubeExplorer=t;var i=$("<div/>");i.addClass("ranetQueryDesigner"),i.attr("id","ranetQueryDesigner-"+e.Utility.Guid.newGuid()),this._$elementQueryDesigner=i;var n=$("<div/>");n.addClass("ranetDataViewerPanel");var o=$("<div/>");o.attr("id","ranetPivotTable-"+e.Utility.Guid.newGuid()),this._$elementPivotTable=o;var r=$("<div/>"),a=$("<div/>");a.attr("id","ranetChart-"+e.Utility.Guid.newGuid()),this._$elementChart=a;var s=$("<div/>");s.attr("id","ranetVectorMap-"+e.Utility.Guid.newGuid()),this._$elementVectorMap=s,r.append(this._$elementVectorMap),r.append(this._$elementChart),this._$elementExtensionPanel=r,n.append(this._$elementPivotTable),n.append(this._$elementExtensionPanel),this._$elementDataViewer=n,this._$elementActiveFilters=$("<div/>"),this._$elementActiveFilters.addClass("ranetDynamicPivotGrid_activeFilters");var l=$("<div/>");l.addClass("ranetDynamicPivotGrid_viewPanel");var c=$('<div class="ranetDynamicPivotGrid_viewContainer ranetDynamicPivotGrid_viewContainer-visibledExtension"/>');c.append(this._$elementActiveFilters),c.append(this._$elementDataViewer),this._$viewContainer=c,l.append(this._$viewContainer),this._$viewPanel=l,C.call(this);var u=$("<div/>");this._$elementLoadPanel=u,u.ranetLoadPanel({message:"Loading...",visible:!1}),this._$currentPanel.append(this._$elementCubeExplorer),this._$currentPanel.append(this._$elementQueryDesigner),this._$currentPanel.append(this._$viewPanel),this._$currentPanel.append(this._$elementLoadPanel)},O=function(){F.call(this)},L=function(e){this._rotateAxes=!1,this._showMetadataAndQueryDesigner=!0,this._isVisibleActiveFilters=!1,this.connection=e.connection,this.cubeName=e.cubeName,this.autoExecuteMdxQuery=e.autoExecuteMdxQuery,this.layout=e.layout,this._customCalculatedItems=i(e.customCalculatedItems),this._queryDesignerSetting=e.queryDesignerSetting,this._isVisibleActiveFilters=e.isVisibleActiveFilters,this._initialQuery=e.initialQuery,this._initialSourceType=e.initialSourceType,this._customCellsConditions=e.customCellsConditions,this._extensionOptions=e.extensionOptions||{},void 0!==e.showMetadataAndQueryDesigner&&(this._showMetadataAndQueryDesigner=e.showMetadataAndQueryDesigner),this._placementLayoutModeQueryDesigner=e.placementLayoutModeQueryDesigner,this._placementLayoutModeDataViewer=e.placementLayoutModeDataViewer,this.loadStateFromHistory=e.loadStateFromHistory,this._selectedMeasureGroupName=void 0===e.selectedMeasureGroupName?null:e.selectedMeasureGroupName,e.onHistoryChanged&&(this._onHistoryChangedCallback=e.onHistoryChanged),this.useCustomUpdateScriptTemplate=void 0!==e.useCustomUpdateScriptTemplate&&e.useCustomUpdateScriptTemplate,this.useChangesCache=void 0!==e.useChangesCache&&e.useChangesCache,this._isEnabledWhatIfAnalysis=void 0!==e.isEnabledWhatIfAnalysis&&e.isEnabledWhatIfAnalysis,this.currentUpdateScriptTemplate=e.currentUpdateScriptTemplate,this.sortingRowsOptions=void 0===e.sortingRowsOptions?null:e.sortingRowsOptions,this.sortingColumnsOptions=void 0===e.sortingColumnsOptions?null:e.sortingColumnsOptions,void 0!==e.isVisibleExtensionPanel?this.isVisibleExtensionPanel=e.isVisibleExtensionPanel:this.isVisibleExtensionPanel=!1,this.headerText=e.headerText,this.footerText=e.footerText,this._availableSlicers=e.availableSlicers,this._options=e},A=function(e){e.cubeName=this.cubeName,e.rotateAxes=this.rotateAxes;var t=jQuery.extend(!0,[],this.customCalculatedItems.calculatedNamedSets),i=jQuery.extend(!0,[],this.customCalculatedItems.calculatedMembers),n=jQuery.extend(!0,{},this.queryDesignerSetting);e.calculatedNamedSets=t,e.calculatedMembers=i,e.queryDesignerSetting=n},R=function(t){var i=[];if(!e||!e.Controls)return console.log("We don't find Ranet namespace."),i;if(!t)return i;for(var n=0;n<t.length;n++){var o=t[n];if("kpiItem"===o.type&&("status"===o.kpiType||"trend"===o.kpiType)){var r=new e.Controls.CellConditionsDescriptor(o.uniqueName),a=o.valueGraphic.replace(/\s/g,"").toLowerCase(),s=new e.Controls.CellCondition;s.appearance.options.showValue=!1,s.appearance.options.useImage=!0,s.appearance.cssClassImage="imageLibary_"+o.kpiType+"_"+a+"_-1",s.conditionType=e.Controls.CellConditionType.Less,s.value1=0;var l=new e.Controls.CellCondition;l.appearance.options.showValue=!1,l.appearance.options.useImage=!0,l.appearance.cssClassImage="imageLibary_"+o.kpiType+"_"+a+"_0",l.conditionType=e.Controls.CellConditionType.Equal,l.value1=0;var c=new e.Controls.CellCondition;c.appearance.options.showValue=!1,c.appearance.options.useImage=!0,c.appearance.cssClassImage="imageLibary_"+o.kpiType+"_"+a+"_1",c.conditionType=e.Controls.CellConditionType.Greater,c.value1=0,r.conditions.push(s),r.conditions.push(l),r.conditions.push(c),i.push(r)}}return i},B=function(e){for(var t=0;t<e.length;t++){var i=e[t];0===this.customCellsConditions.filter(function(e){return e.memberUniqueName===this.memberUniqueName},{memberUniqueName:i.memberUniqueName}).length&&this.customCellsConditions.push(i)}},V=function(t){var i=this,o=$.Deferred();this._currentMdxQuery=t,this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var r={connection:this.connection,query:t,contextId:this._contexId,isEnabledWhatIfAnalysis:this.isEnabledWhatIfAnalysis,orderMeasures:n(this.layout),sortingColumnsOptions:this.sortingColumnsOptions,sortingRowsOptions:this.sortingRowsOptions};return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/select",contentType:"application/json; charset=utf-8",data:JSON.stringify(r)}).done(function(e){var t=i._$elementQueryDesigner.data("ranetQueryDesigner").getLayout().data,n=R.call(i,t);B.call(i,n),i._$elementPivotTable.data("pivotTable").option({dataSource:e,measuresInDataSource:t,cellConditions:i.customCellsConditions}),pe.call(i,e),o.resolve({cellSetData:e})}).fail(function(i,n,r){e.UserMessageService.showServerError(i),e.LogService.error(i,t),o.reject(i,n,r)}).always(function(){i.visibleBusyIndicator=!1}),o},k=function(t,i){var n=$.Deferred(),o=this,r=t;this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var a={state:r,actions:i,connection:this.connection,customPropertiesRows:this.customPropertiesRows,customPropertiesColumns:this.customPropertiesColumns,sortingColumnsOptions:this.sortingColumnsOptions,sortingRowsOptions:this.sortingRowsOptions};return $.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/transformStateToMdx",contentType:"application/json; charset=utf-8",data:JSON.stringify(a)}).done(function(e){o._initialQuery=e.initialQuery;var t=e.query;V.call(o,t).done(function(e){n.resolve(e)})}).fail(function(t,i,a){e.LogService.error(t,r),e.UserMessageService.showServerError(t),o.visibleBusyIndicator=!1,n.reject(t,i,a)}),n},z=function(t,i){var n=$.Deferred(),o=this;this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var r={query:t,actions:i,connection:this.connection,customPropertiesRows:this.customPropertiesRows,customPropertiesColumns:this.customPropertiesColumns,hideEmptyColumns:this.queryDesignerSetting.hideEmptyColumns,hideEmptyRows:this.queryDesignerSetting.hideEmptyRows,rotateAxes:!1,sortingColumnsOptions:this.sortingColumnsOptions,sortingRowsOptions:this.sortingRowsOptions};return 0!==r.actions.length&&void 0!==this.currentDataSource&&(r.columnsPaneHierarchies=l(this.currentDataSource.columns),r.rowsPaneHierarchies=l(this.currentDataSource.rows)),$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/transformMdxToMdx",contentType:"application/json; charset=utf-8",data:JSON.stringify(r)}).done(function(e){o._initialQuery=e.initialQuery;var t=e.query;V.call(o,t).done(function(e){n.resolve(e)})}).fail(function(t,i,a){e.LogService.error(t,r),e.UserMessageService.showServerError(t),o.visibleBusyIndicator=!1,n.reject(t,i,a)}),n},q=function(e,t){if(void 0===t)throw new Error("ArgumentException");var i=e;A.call(this,i),null!==t?this.historyManager.addStatePoint(i,t):this.historyManager.addStatePoint(i,this.historyManager.getAllActions()),!1!==this.autoExecuteMdxQuery&&k.call(this,i,this.historyManager.getAllActions())},U=function(e,t){null!==t?this.historyManager.addQueryPoint(e,t):this.historyManager.addQueryPoint(e,this.historyManager.getAllActions()),z.call(this,e,this.historyManager.getAllActions())},H=function(t){"drillDown"!==t.actionType&&"collapse"!==t.actionType&&"drillDownWithParent"!==t.actionType||this._$elementPivotTable.data("pivotTable").resetScrolls(),e.UserActionsTracker.track("Action in the pivotTable",{action:t.actionType});var i=o(t,this.rotateAxes);this.historyManager.addAction(i);var n=this.historyManager.lastInitialHistoryPoint;if(n.type===g.State){var r=n.point;A.call(this,r),k.call(this,r,this.historyManager.getAllActions())}else{if(n.type!==g.Query)throw new Error("InvalidOperationException");z.call(this,n.point,this.historyManager.getAllActions())}},j=function(e){var t=this.historyManager.lastInitialHistoryPoint;if(void 0===t)throw new Error("InvalidOperationException");if(this._$elementPivotTable.data("pivotTable").resetScrolls(),null!==t){if(t.type!==g.State)throw new Error("InvalidOperationException");var i=t.point,n=this.currentFocusedCell;if(n){var o;i.columns.length<e.columns.length?o=r(n.columns,e.columns[e.columns.length-1],"columns",this.rotateAxes):i.rows.length<e.rows.length&&(o=r(n.rows,e.rows[e.rows.length-1],"rows",this.rotateAxes)),o&&o.header.uniqueName&&this.historyManager.addAction(o)}var s;if(i.columns.length>e.columns.length?s=a(this._$elementCubeExplorer.data("ranetCubeExplorer").getMapIdToMetadata(),this.customCalculatedItems.calculatedNamedSets,this.cubeName,this.connection,i.columns,e.columns):i.rows.length>e.rows.length&&(s=a(this._$elementCubeExplorer.data("ranetCubeExplorer").getMapIdToMetadata(),this.customCalculatedItems.calculatedNamedSets,this.cubeName,this.connection,i.rows,e.rows)),s){var l=this;return void s.done(function(t){for(var i=[],n=l.historyManager.getAllActions(),o=0;o<n.length;o++){var r=n[o];0===t.filter(function(e){return e===this.actionHierarchyUniqueName},{actionHierarchyUniqueName:r.header.hierarchyUniqueName}).length&&i.push(r)}q.call(l,e,i)})}}var c=this.historyManager.getAllActions();q.call(this,e,c)},W=function(t){var i,n,o,r=this,a=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),s=[];for(n=0;n<a.rows.length;n++)"level"===(o=a.rows[n]).type&&s.push(o.parentHierarchyId),"hierarchy"===o.type&&s.push(o.uniqueName),"namedSet"===o.type&&s.push(o.dimensions);for(n=0;n<a.columns.length;n++)"level"===(o=a.columns[n]).type&&s.push(o.parentHierarchyId),"hierarchy"===o.type&&s.push(o.uniqueName),"namedSet"===o.type&&s.push(o.dimensions);var l=new e.Controls.HierarchySelector.HierarchySelectorOptions;l.dataSource=this.cubeMetaData.treeMetadata,l.exludedHierarchies=s,l.onSelectedItem=function(e){i.isEnabledOkButton=!0};var c=new e.Controls.HierarchySelector.HierarchySelectorControl(l),u=new e.Controls.Windows.FloatingWindowOptions;u.content=c.view,u.title=e.Localization.localize("WindowSelectorHierarchy_Title"),u.size=e.Controls.Windows.WindowSize.Small,u.onClosed=function(i,n){if(n.dialogResult){e.UserActionsTracker.track("DrillDown by selected hierarchy");var o=t.data,s=t.hierarchy,l=new e.Controls.MemberChoice.QueryManager(r.cubeName,s.uniqueName),u=l.getQueryMemberWithParents([o.uniqueName]),p=new e.Controls.MemberChoice.DataService(r.connection),h=[p.getMembers(u)];if(void 0!==t.neighborsHierarchy)for(var d=0;d<t.neighborsHierarchy.length;d++){var m=t.neighborsHierarchy[d];u=(l=new e.Controls.MemberChoice.QueryManager(r.cubeName,m.hierarchy.uniqueName)).getQueryMemberWithParents([m.data.uniqueName]),h.push(p.getMembers(u))}r.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),r.visibleBusyIndicator=!0,$.when.apply($,h).done(function(){for(var i={},n=0;n<arguments.length;n++){var o=arguments[n][0],s=e.Utility.DynamicPivotGridHelper.getFilterTreeWhereItemSelectedSelf(o);i[o.hierarchyUniqueName]=s}var l=e.Utility.DynamicPivotGridHelper.getLayoutAfterDrillDownByHierarchy(a,c.selectedHierarchy,i,t.place),u=e.Utility.DynamicPivotGridHelper.getActionsAfterDrillDownByHierarchy(r.historyManager.getAllActions(),c.selectedHierarchy,t.place);r._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:l}),y.call(r),r.visibleBusyIndicator=!1,q.call(r,l,u)}).fail(function(t){e.LogService.error(t),r.visibleBusyIndicator=!1})}},u.container=r._$currentPanel,(i=new e.Controls.Windows.FloatingWindow(u)).isEnabledOkButton=!1,i.show()},Q=function(t){for(var i=this,n=c(t.selectedCells,this.cubeName),o=new e.Controls.MemberChoice.DataService(this.connection),r=[],a=0;a<n.length;a++){var s=n[a];r.push(o.getMembers(s))}this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0,$.when.apply($,r).done(function(){for(var t={},n=0;n<arguments.length;n++){var o=arguments[n],r=e.Utility.DynamicPivotGridHelper.getFilterTreeWhereItemsSelectedSelf(o);t[o[0].hierarchyUniqueName]=r}var a=i._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),s=e.Utility.DynamicPivotGridHelper.getLayoutAfterDetailedCellsAnalysisCurrentStructure(a,t);i._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:s}),y.call(i),i.visibleBusyIndicator=!1,q.call(i,s,null)}).fail(function(t){e.LogService.error(t),i.visibleBusyIndicator=!1})},G=function(t){for(var i=this,n=c(t.selectedCells,this.cubeName),o=new e.Controls.MemberChoice.DataService(this.connection),r=[],a=0;a<n.length;a++){var s=n[a];r.push(o.getMembers(s))}this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0,$.when.apply($,r).done(function(){for(var t={},n=0;n<arguments.length;n++){var o=arguments[n],r=e.Utility.DynamicPivotGridHelper.getFilterTreeWhereItemsSelectedSelf(o);t[o[0].hierarchyUniqueName]=r}var a=i._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),s=e.Utility.DynamicPivotGridHelper.getLayoutAfterDetailedCellsAnalysisFilterAxis(a,t);i._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:s}),y.call(i),i.visibleBusyIndicator=!1,q.call(i,s,null)}).fail(function(t){e.LogService.error(t),i.visibleBusyIndicator=!1})},Y=function(t){var i=new e.Controls.CellPropertiesViewer.CellPropertiesViewerControl(new e.Controls.CellPropertiesViewer.CellPropertiesViewerOptions(t)),n=new e.Controls.Windows.FloatingWindowOptions;n.content=i.view,n.title=e.Localization.localize("CellPropertiesDialog_Caption"),n.size=e.Controls.Windows.WindowSize.Medium,n.isVisibleCancelButton=!1,n.resizable=!0,n.container=this._$currentPanel,new e.Controls.Windows.FloatingWindow(n).show()},Z=function(t){var i=this,n=[];t.hierarchy.levelProperties&&(n=t.hierarchy.levelProperties.map(function(e){return e.uniqueName}));var o={uniqueName:t.data.uniqueName,connection:this.connection,cubeName:this.cubeName,customMemberPropsUniqueNames:n,calculatedNamedSets:this.customCalculatedItems.calculatedNamedSets,calculatedMembers:this.customCalculatedItems.calculatedMembers};$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/getMember",contentType:"application/json; charset=utf-8",data:JSON.stringify(o)}).done(function(t){var n=new e.Controls.MemberPropertiesViewer.MemberPropertiesViewerControl(new e.Controls.MemberPropertiesViewer.MemberPropertiesViewerOptions(t)),o=new e.Controls.Windows.FloatingWindowOptions;o.content=n.view,o.title=e.Localization.localize("MemberPropertiesDialog_Caption"),o.size=e.Controls.Windows.WindowSize.Medium,o.isVisibleCancelButton=!1,o.container=i._$currentPanel,o.resizable=!0,new e.Controls.Windows.FloatingWindow(o).show()})},J=function(t,i){var n,o=this;if("rows"===i)n=this.rotateAxes?this.customPropertiesColumns[t.uniqueName]:this.customPropertiesRows[t.uniqueName];else{if("columns"!==i)throw new Error("InvalidOperationException");n=this.rotateAxes?this.customPropertiesRows[t.uniqueName]:this.customPropertiesColumns[t.uniqueName]}void 0===n&&(n=[]);var r=new e.Controls.CustomPropertiesSelector.CustomPropertiesSelectorOptions(t,n),a=new e.Controls.CustomPropertiesSelector.CustomPropertiesSelectorControl(r),s=new e.Controls.Windows.FloatingWindowOptions;s.content=a.view,s.title=e.Localization.localize("CustomPropertiesDialog_Caption"),s.size=e.Controls.Windows.WindowSize.Small,s.onClosed=function(n,r){if(r.dialogResult){if(e.UserActionsTracker.track("Add custom properties in pivot table"),!1===o.rotateAxes)if("rows"===i)o.customPropertiesRows[t.uniqueName]=a.selectedProperties;else{if("columns"!==i)throw new Error("InvalidOperationException");o.customPropertiesColumns[t.uniqueName]=a.selectedProperties}else if("rows"===i)o.customPropertiesColumns[t.uniqueName]=a.selectedProperties;else{if("columns"!==i)throw new Error("InvalidOperationException");o.customPropertiesRows[t.uniqueName]=a.selectedProperties}o.updateData()}},s.container=o._$currentPanel,new e.Controls.Windows.FloatingWindow(s).show()},K=function(){var t=new e.Controls.SortingOptionsPivotTable.SortEditorOptions;t.hierarchiesRowsPanel=this.currentDataSource.rows.hierarchies,t.hierarchiesColumnsPanel=this.currentDataSource.columns.hierarchies,void 0===this.sortingRowsOptions||null===this.sortingRowsOptions?t.sortingRowsOptions=new e.Controls.SortingOptionsPivotTable.SortingDescription:t.sortingRowsOptions=this.sortingRowsOptions,void 0===this.sortingColumnsOptions||null===this.sortingColumnsOptions?t.sortingColumnsOptions=new e.Controls.SortingOptionsPivotTable.SortingDescription:t.sortingColumnsOptions=this.sortingColumnsOptions,t.measuresTree=this.cubeMetaData.treeMetadata.filter(function(e){return"measuresRootNode"===e.type})[0];var i=new e.Controls.SortingOptionsPivotTable.SortOptionsEditorControl(t),n=this,o=new e.Controls.Windows.FloatingWindowOptions;o.content=i.view,o.title=e.Localization.localize("ContextMenu_SortingDetails"),o.size=e.Controls.Windows.WindowSize.Medium,o.onClosed=function(e,t){t.dialogResult&&(n.sortingColumnsOptions=i.sortingColumnsOptions,n.sortingRowsOptions=i.sortingRowsOptions,n.updateData())},o.container=this._$currentPanel,new e.Controls.Windows.FloatingWindow(o).show()},X=function(t,i){var n,o,r,a;if("columns"===t.place){if(this.sortingRowsOptions=new e.Controls.SortingOptionsPivotTable.SortingDescription,this.sortingRowsOptions.mode=e.Controls.SortingOptionsPivotTable.SortingMode.SortingByContext,this.sortingRowsOptions.isUsed=!0,this.sortingRowsOptions.sortingByMeasure=new e.Controls.SortingOptionsPivotTable.SortingByMeasureModel,-1===t.data.uniqueName.indexOf("[Measures]")){if(o=[],r=new e.Controls.SortingOptionsPivotTable.MemberDescription,r.caption=t.data.caption,r.uniqueName=t.data.uniqueName,o.push(r),t.neighborsHierarchy)for(n=0;n<t.neighborsHierarchy.length;n++)(a=new e.Controls.SortingOptionsPivotTable.MemberDescription).caption=t.neighborsHierarchy[n].data.caption,a.uniqueName=t.neighborsHierarchy[n].data.uniqueName,o.push(a);this.sortingRowsOptions.sortingByMeasure.members=o}else this.sortingRowsOptions.sortingByMeasure.measureUniqueName=t.data.uniqueName;this.sortingRowsOptions.sortingByMeasure.direction=i}else{if("rows"!==t.place)throw new Error("InvalidOperationException");this.sortingRowsOptions||(this.sortingRowsOptions=new e.Controls.SortingOptionsPivotTable.SortingDescription),this.sortingRowsOptions.isUsed=!0,this.sortingRowsOptions.mode=e.Controls.SortingOptionsPivotTable.SortingMode.SortingByProperty;var s=new e.Controls.SortingOptionsPivotTable.SortingHierarchyDescription;s.hierarchyUniqueName=t.hierarchy.uniqueName,s.property=e.Controls.SortingOptionsPivotTable.HierarchyProperty.Caption,s.direction=i;var l=this.sortingRowsOptions.sortingByProperty.items.filter(function(e){return e.hierarchyUniqueName===s.hierarchyUniqueName});l.length>0&&this.sortingRowsOptions.sortingByProperty.items.splice(this.sortingRowsOptions.sortingByProperty.items.indexOf(l[0]),1),this.sortingRowsOptions.sortingByProperty.items.push(s)}this.updateData()},ee=function(t){for(var i=this,n=t.rows.map(function(e){return e.memberUniqueName}).concat(t.columns.map(function(e){return e.memberUniqueName})),o=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),r=this.cubeName,a=0;a<o.filters.length;a++){var s=o.filters[a];if(s.filter&&s.filter.isUsed){var l="SELECT "+s.filter.membersFilter.set+" ON COLUMNS FROM "+this.cubeName;r=r.replace(this.cubeName,"( "+l+" )")}}this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var c={connection:this.connection,query:"DRILLTHROUGH SELECT( "+n.join(", ")+" ) ON 0 FROM "+r+" CELL PROPERTIES BACK_COLOR , CELL_ORDINAL , FORE_COLOR , FONT_NAME , FONT_SIZE , FONT_FLAGS , FORMAT_STRING , VALUE , FORMATTED_VALUE , UPDATEABLE , ACTION_TYPE"};$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/selectDrillThroughQuery",contentType:"application/json; charset=utf-8",data:JSON.stringify(c)}).done(function(n){var o=new e.Controls.DrillThrough.DrillThroughControlOptions;o.dataSource=n,o.rows=t.rows,o.columns=t.columns,o.cellData=t.cellData,o.$container=i._$parentPanel;var r=new e.Controls.DrillThrough.DrillThroughControl(o),a=new e.Controls.Windows.FloatingWindowOptions;a.content=r.view,a.title=e.Localization.localize("DrillthroughDialog_Caption")+r.countString(),a.size=e.Controls.Windows.WindowSize.Large,a.onClosed=function(e,t){},a.container=i._$currentPanel,new e.Controls.Windows.FloatingWindow(a).show(),i.visibleBusyIndicator=!1}).fail(function(t){i.visibleBusyIndicator=!1,e.LogService.error(t),e.UserMessageService.showServerError(t)})},te=function(t){var i=this,n=[];return"[Measures]"!==t.hierarchy.uniqueName?(n.push({disabled:"expanded"===t.currentState||void 0===t.currentState,text:e.Localization.localize("PivotGrid_Expand"),onMenuItemClick:function(e){t.actionType="expand",H.call(i,t)}}),n.push({text:e.Localization.localize("PivotGrid_Collapse"),disabled:"collapsed"===t.currentState||void 0===t.currentState,afterInsertSeparator:!0,onMenuItemClick:function(e){t.actionType="collapse",H.call(i,t)}}),n.push({text:e.Localization.localize("PivotGrid_DrillDown"),onMenuItemClick:function(e){t.actionType="drilldown",H.call(i,t)}}),n.push({text:e.Localization.localize("PivotDesigner_DrillDownBy"),disabled:this.initialSourceType!==g.State||this._updatedCellsStorage.hasAnyChanges,onMenuItemClick:function(n){e.UserActionsTracker.track("Open window 'DrillDown by'"),W.call(i,t)}}),n.push({text:e.Localization.localize("PivotGrid_DetalizeWithParent"),afterInsertSeparator:!0,onMenuItemClick:function(e){t.actionType="drillDownWithParent",H.call(i,t)}}),n.push({text:e.Localization.localize("ContextMenu_SortAscending"),onMenuItemClick:function(n){e.UserActionsTracker.track("Set sorting",{direction:"Ascending"}),X.call(i,t,e.Controls.SortingOptionsPivotTable.SortingDirection.Ascending)}}),n.push({text:e.Localization.localize("ContextMenu_SortDescending"),onMenuItemClick:function(n){e.UserActionsTracker.track("Set sorting",{direction:"Descending"}),X.call(i,t,e.Controls.SortingOptionsPivotTable.SortingDirection.Descending)}}),n.push({text:e.Localization.localize("ContextMenu_SortingDetails"),afterInsertSeparator:!0,onMenuItemClick:function(n){e.UserActionsTracker.track("Open the sorting editor"),K.call(i,t)}}),n.push({text:e.Localization.localize("ContextMenu_ShowMemberProperties"),disabled:null===t.hierarchy.levelProperties||0===t.hierarchy.levelProperties.length,onMenuItemClick:function(n){e.UserActionsTracker.track("Open window 'Selector custom props'"),J.call(i,t.hierarchy,t.place)}})):(n.push({text:e.Localization.localize("ContextMenu_SortAscending"),onMenuItemClick:function(n){e.UserActionsTracker.track("Set sorting",{direction:"Ascending"}),X.call(i,t,e.Controls.SortingOptionsPivotTable.SortingDirection.Ascending)}}),n.push({text:e.Localization.localize("ContextMenu_SortDescending"),onMenuItemClick:function(n){e.UserActionsTracker.track("Set sorting",{direction:"Descending"}),X.call(i,t,e.Controls.SortingOptionsPivotTable.SortingDirection.Descending)}}),n.push({text:e.Localization.localize("ContextMenu_SortingDetails"),afterInsertSeparator:!0,onMenuItemClick:function(n){e.UserActionsTracker.track("Open the sorting editor"),K.call(i,t)}})),n.push({text:e.Localization.localize("ContextMenu_Properties"),onMenuItemClick:function(n){e.UserActionsTracker.track("Open window 'Member Props'"),Z.call(i,t)}}),n},ie=function(t,i){var n=this,o=[];return o.push({text:t.caption+", "+e.Localization.localize("PivotGrid_DrillDown"),onMenuItemClick:function(e){t.actionType="drilldown",H.call(n,t)}}),o.push({text:t.caption+", "+e.Localization.localize("PivotDesigner_DrillDownBy"),disabled:this.initialSourceType!==g.State||this._updatedCellsStorage.hasAnyChanges,onMenuItemClick:function(i){e.UserActionsTracker.track("Open window 'DrillDown by'"),W.call(n,t)}}),o.push({text:t.caption+", "+e.Localization.localize("PivotGrid_DetalizeWithParent"),afterInsertSeparator:!0,onMenuItemClick:function(e){t.actionType="drillDownWithParent",H.call(n,t)}}),o.push({text:i.caption+", "+e.Localization.localize("PivotGrid_DrillDown"),onMenuItemClick:function(e){i.actionType="drilldown",H.call(n,i)}}),o.push({text:i.caption+", "+e.Localization.localize("PivotDesigner_DrillDownBy"),disabled:this.initialSourceType!==g.State||this._updatedCellsStorage.hasAnyChanges,onMenuItemClick:function(t){e.UserActionsTracker.track("Open window 'DrillDown by'"),W.call(n,i)}}),o.push({text:i.caption+", "+e.Localization.localize("PivotGrid_DetalizeWithParent"),onMenuItemClick:function(e){i.actionType="drillDownWithParent",H.call(n,i)}}),o},ne=function(t){var i=[],n=this,o=0!==t.focusedCellDescription.rows.length&&t.focusedCellDescription.rows.filter(function(e){return e.isCalculatedMember}).length>0||0!==t.focusedCellDescription.columns.length&&t.focusedCellDescription.columns.filter(function(e){return e.isCalculatedMember}).length>0;return i.push({text:e.Localization.localize("ContextMenu_Copy"),afterInsertSeparator:!0,onMenuItemClick:function(e){for(var i=t.selectedCells,n="",o=[],r=0;r<i.length;r++){var a=i[r];void 0===o[a.rowIndex]&&(o[a.rowIndex]=[]),o[a.rowIndex].push(a)}for(var s in o)if(o.hasOwnProperty(s)){for(var l=0;l<o[s].length;l++){var c=o[s][l];0!==l&&(n+="\t"),null!==c.cellData.value&&(n+=c.cellData.value.toLocaleString())}n+="\r\n"}var u=$("<textarea>");$("body").append(u),u.val(n).select(),document.execCommand("copy"),u.remove()}}),i.push({text:e.Localization.localize("ContextMenu_DrillThrough"),disabled:0===t.focusedCellDescription.rows.length&&0===t.focusedCellDescription.columns.length||o,afterInsertSeparator:!0,onMenuItemClick:function(i){e.UserActionsTracker.track("DrillThrough"),ee.call(n,t.focusedCellDescription)}}),i.push({text:e.Localization.localize("ContextMenu_Properties"),afterInsertSeparator:!0,onMenuItemClick:function(i){e.UserActionsTracker.track("Open window 'Cell Props'"),Y.call(n,t.focusedCellDescription)}}),i.push({text:e.Localization.localize("ContextMenu_DetailedCellsAnalysis_FilterAxis"),onMenuItemClick:function(e){G.call(n,t)}}),i.push({text:e.Localization.localize("ContextMenu_DetailedCellsAnalysis_CurrentSruct"),onMenuItemClick:function(e){Q.call(n,t)}}),i},oe=function(){var e=this;if(this.initialSourceType===g.State){if(this.loadStateFromHistory&&this._options.actions&&this._options.actions.length>0){var t=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();A.call(this,t),this._historyManager.addStatePoint(t,[]),this._options.actions.forEach(function(t){e.historyManager.addAction(t)})}}else{if(this.initialSourceType!==g.Query)throw new Error("NotImplementationException");this._historyManager.addQueryPoint(this.initialQuery,[])}},re=function(){if(this.initialSourceType===g.State){if(y.call(this),0!==this.historyManager.getAllActions().length){if(!1===this.autoExecuteMdxQuery)return;var e=this.historyManager.lastInitialHistoryPoint.point;return void k.call(this,e,this.historyManager.getAllActions())}j.call(this,this.layout)}else{if(this.initialSourceType!==g.Query)throw new Error("NotImplementationException");z.call(this,this._initialQuery,[])}},ae=function(){for(var t=[],i=0;i<5;i++){var n={};n.title=e.Localization.localize("ViewLayout_Layout"+i),n.icon="imageLibrary_viewLayout"+i,n.onSelected=function(e){this.placementLayoutModeQueryDesigner=e}.bind(this,i),t.push(n)}return t},se=function(){var t=this;this._$elementActiveFilters.ranetActiveFilters({cubeName:this.cubeName,isEnabled:this.initialSourceType===g.State&&!1===this._isEnabledWhatIfAnalysis,connection:this.connection,onDeleteFilter:function(e,i){t._$elementQueryDesigner.data("ranetQueryDesigner").deleteActiveFilter(e,i)},onShowFilterEditor:function(e,i){t._$elementQueryDesigner.data("ranetQueryDesigner").showFilterEditor(e,i)}}),this._$elementChart.ranetChart(this.extensionSettings.chartOptions||{}),this._$elementVectorMap.ranetVectorMap({data:{},groups:[],updateData:function(i){if(i){var n=e.Controls.Extensions.MapDataHelper.createActionHeaderDescription(i,t.currentDataSource,t.extensionSettings.vectorMapSettings.dataSettings.row);n.data&&H.call(t,n)}pe.call(t)}}),e.Controls.Extensions.MapDataHelper.getRequest();var i=e.Controls.PlacementAreaItemMode.Layout1;3!==t.placementLayoutModeQueryDesigner&&1!==t.placementLayoutModeQueryDesigner||(i=e.Controls.PlacementAreaItemMode.Layout2);var n=ae.call(this);this._$elementQueryDesigner.ranetQueryDesigner({layout:this.layout,placementLayoutMode:i,connection:this.connection,cubeName:this.cubeName,autoExecuteQuery:this.autoExecuteMdxQuery,container:this._$currentPanel,isEnabled:this.initialSourceType===g.State&&!1===this._isEnabledWhatIfAnalysis,onLayoutChanged:function(e){y.call(t),j.call(t,e)},onFilterChanged:function(i,n,o){var r=t.historyManager.getAllActions();if(r.length>0&&o.filter.isUsed&&o.filter.membersFilter.isUsed){var a=o.filter.membersFilter.set,s=0;switch(n){case e.Controls.AreaType.Columns:s=0;break;case e.Controls.AreaType.Rows:s=1}var l={actions:r,set:a,axisType:s,connection:this.connection,cubeName:this.cubeName};$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/getActualActions",contentType:"application/json; charset=utf-8",data:JSON.stringify(l)}).done(function(e){q.call(t,i,e)})}else q.call(t,i,t.historyManager.getAllActions());y.call(t)},onUpdateData:function(){e.UserActionsTracker.track("Click a button 'UpdateData'."),t.updateData()},onChangeAutoExecuteMdxQuery:function(i){e.UserActionsTracker.track("Click a button 'AutoExecute'.",{value:i}),t.autoExecuteMdxQuery=i},onOpenSortingEditor:function(){K.call(t)},layoutDropdownItems:n,sortingRowsOptions:this.sortingRowsOptions,sortingColumnsOptions:this.sortingColumnsOptions,availableSlicers:this._availableSlicers}),this._$elementPivotTable.pivotTable({onShowingSparklines:function(e){},onActionHeader:function(e,i){H.call(t,i)},onHeaderTouch:function(i,n){var o=$("<div/>"),r=$("<textarea class='form-control' readonly>"+n.data.caption+"</textarea>"),a=$("<button  class='btn btn-default ranetDynamicPivotGrid-touchActionPivotTableButton'>"+e.Localization.localize("PivotGrid_DrillDown")+"</button>"),s=$("<button class='btn btn-default ranetDynamicPivotGrid-touchActionPivotTableButton'>"+e.Localization.localize("PivotGrid_Expand")+"</button>"),l=$("<button class='btn btn-default ranetDynamicPivotGrid-touchActionPivotTableButton'>"+e.Localization.localize("PivotGrid_Collapse")+"</button>");if(o.append(r),o.append(a),a.click(function(){n.actionType="drilldown",H.call(t,n)}),s.click(function(){n.actionType="expand",H.call(t,n)}),l.click(function(){n.actionType="collapse",H.call(t,n)}),void 0!==n.currentState)if("expanded"===n.currentState)o.append(l);else{if("collapsed"!==n.currentState)throw new Error("NotImplementedException");o.append(s)}var c={html:!0,container:t._$currentPanel,viewport:i,content:o,trigger:"hover"};if("rows"===n.place)c.placement="right";else{if("columns"!==n.place)throw new Error("NotImplementedException");c.placement="bottom"}$(i).popover(c),$(i).popover("show")},onContextMenuHeaderCallback:function(i,n){var o=t._$parentPanel.offset();e.UserActionsTracker.track("Show context menu in pivot table"),$(i).ranetContextMenu({container:t._$currentPanel,dataSource:te.call(t,n.elementDescription),position:{top:n.eventArgs.clientY-o.top,left:n.eventArgs.clientX-o.left}}),$(i).data("ranetContextMenu").show()},onContextMenuCellsCallback:function(i){var n=t._$parentPanel.offset();e.UserActionsTracker.track("Show context menu in pivot table"),i.$cell.ranetContextMenu({container:t._$currentPanel,dataSource:ne.call(t,i),position:{top:i.sender.clientY-n.top,left:i.sender.clientX-n.left}}),i.$cell.data("ranetContextMenu").show()},onCellValueChanged:function(i,n,o){t._updatedCellsStorage.add(new e.Controls.UpdateEntry(i,n)),!1===t.useChangesCache&&t.recalculate()},onChangeValueCellDeleted:function(i){t._updatedCellsStorage.remove(new e.Controls.UpdateEntry(i))}}),this._$elementCubeExplorer.ranetCubeExplorer({keyExpr:"id",calculatedMembers:this.customCalculatedItems.calculatedMembers,calculatedNamedSets:this.customCalculatedItems.calculatedNamedSets,connection:this.connection,selectedMeasureGroupName:this.selectedMeasureGroupName,cubeName:this.cubeName,draggableOptions:{$dragContainer:t._$currentPanel},onDataSourceChanged:function(e,i){var n=i.metadataDescription.treeMetadata,o=e.getMapIdToMetadata(),r=n.filter(function(e){return"measuresRootNode"===e.type})[0];t._$elementQueryDesigner.data("ranetQueryDesigner").option({dataSource:o,treeMeasures:r}),t._$elementActiveFilters.data("ranetActiveFilters").setCubeMetaData(o),t._$elementQueryDesigner.data("ranetQueryDesigner").initQueryDesigner(),oe.call(t),re.call(t)},onMeasureGroupSelectedChanged:function(e,i){t._selectedMeasureGroupName=null===i.measureGroup?null:i.measureGroup.name},layoutDropdownItems:n}),e.Utility.EventHandlers.addEventHandler(window,"resize",function(){e.Utility.Debouncer.debounce(v.bind(t),50)})},le=function(){var i=this;this.messageBusyIndicator=e.Localization.localize("LoadPanel_GetMetadata"),this.visibleBusyIndicator=!0;var n=this._$elementCubeExplorer.is(":visible");this._$elementCubeExplorer.hide();var o={connection:this.connection,cubeName:this.cubeName};$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/getMetadata",contentType:"application/json; charset=utf-8",data:JSON.stringify(o)}).done(function(e){!0===n&&i._$elementCubeExplorer.show(),i._$rightExtensionPanel.show(),i.visibleBusyIndicator=!1;var o=t(e);i._$elementCubeExplorer.data("ranetCubeExplorer").option({dataSource:o})}).fail(function(t){i.visibleBusyIndicator=!1,e.LogService.error(t),e.UserMessageService.showServerError(t)}).always(function(){void 0===i.layout&&(i.visibleBusyIndicator=!1)})},ce=function(t){var i=[],n=[],o=[],r=$.extend({},this.extensionSettings.chartOptions);if(r.seriesOptions=[],r.extensionType=this.extensionSettings.extensionType,r.dataSource=[],this.extensionSettings.chartOptions&&(n=this.extensionSettings.chartOptions.seriesOptions||[]),0!==this.placementLayoutModeDataViewer){var a=this.extensionSettings.chartOptions.palette||"default";if(t.columns&&t.rows)if(t.columns.members&&t.rows.members){if(s(t.cells.values)>(this.extensionSettings.chartOptions.cellNumber>0?this.extensionSettings.chartOptions.cellNumber:1e4))return this._$elementChart.data("ranetChart").error(e.Localization.localize("ChartMessage_ToMuchCells")),null;if(this.extensionSettings.extensionType===e.Controls.Extensions.ExtensionTypes.Pie&&t.columns.positions.length>50)return console.log(t),this._$elementChart.data("ranetChart").error(e.Localization.localize("ChartMessage_ToMuchCells")),null;this._$elementChart.data("ranetChart").clearError(),this.extensionSettings.extensionType!==e.Controls.Extensions.ExtensionTypes.Chart&&this.extensionSettings.extensionType?this.extensionSettings.extensionType===e.Controls.Extensions.ExtensionTypes.Pie&&(i=e.Controls.Extensions.PieDataHelper.getPieData(t,a),o=e.Controls.Extensions.PieDataHelper.getPieLegendItems(t,a),this.extensionSettings.chartOptions.pie.pieSeries&&(n=this.extensionSettings.chartOptions.pie.pieSeries),0===n.length&&(n=e.Controls.Extensions.PieDataHelper.getPieSeries(t)),r.pie.dataSource=i,r.specifiedSeries=n,r.pie.legend.legendItems=o):(i=e.Controls.Extensions.Chart.ChartDataHelper.getDataSource(t),this.extensionSettings.chartOptions.autogenerate?!1===this.extensionSettings.chartOptions.useMultipleCharts?n=e.Controls.Extensions.Chart.ChartDataHelper.getSeries(t,[],a,this.extensionSettings.chartOptions.defaultDiagramType):this.extensionSettings.chartOptions.useMultipleCharts&&(n=e.Controls.Extensions.Chart.ChartDataHelper.generateOrgeredSeries(t,[],a,this.extensionSettings.chartOptions.defaultDiagramType)):n=e.Controls.Extensions.Chart.ChartDataHelper.getSeries(t,n,a))}else n=[];else n=[];var l=this;r.pie.callbacks||(r.pie.callbacks={}),r.onContextCallback=r.pie.callbacks.onContextSegment=function(e,t,i){var n=$(e),o={};o.container=l._$currentPanel,o.dataSource=ie.call(l,t.data.row,t.data.column),o.position={top:i.clientY,left:i.clientX},n.ranetContextMenu(o),n.data("ranetContextMenu").show()},this._$elementChart.data("ranetChart").options(r),this._$elementChart.data("ranetChart").option("seriesOptions",n),this._$elementChart.data("ranetChart").option("dataSource",i),this._$elementChart.data("ranetChart").redraw()}},ue=function(t){if(e.Controls.Extensions.MapDataHelper.checkValidMapData(t)){this._$elementVectorMap.data("ranetVectorMap").show();var i=this,n=this.extensionSettings.vectorMapSettings.dataSettings.col,o=this.extensionSettings.vectorMapSettings.dataSettings.row,r=e.Controls.Extensions.MapDataHelper.generateRowList(t);if(void 0!==o&&-1!==r.indexOf(o)||void 0===e.Controls.Extensions.MapDataHelper.generateRowList(t)[0]&&""===o)o=this.extensionSettings.vectorMapSettings.dataSettings.row;else{o=e.Controls.Extensions.MapDataHelper.generateRowList(t)[0]||"";var a=this.extensionSettings;a.vectorMapSettings.dataSettings.row=o,this.extensionSettings=a}for(var s,l=!0,c=i._$elementVectorMap.data("ranetVectorMap").option("details"),u=t.rows.hierarchies,p=u[u.length-1],h=t.rows.positions,d="",m=[],f=0;f<h.length;f++){var g=h[f].positions[h[f].positions.length-1].id,_=t.rows.members[g];-1===m.indexOf(_.uniqueName)&&(d+=_.uniqueName+", ",m.push(_.uniqueName))}d=d.slice(0,d.length-2);var y={connection:i.connection,query:"SELECT {"+d+"} DIMENSION PROPERTIES PARENT_UNIQUE_NAME, "+p.uniqueName+".[Country], "+p.uniqueName+".[State-Province] on 0, {} DIMENSION PROPERTIES PARENT_UNIQUE_NAME , KEY0 ON 1 FROM "+i.cubeName};$.ajax({type:"POST",url:e.PathManager.applicationUrl+"api/olap/select",contentType:"application/json; charset=utf-8",data:JSON.stringify(y)}).done(function(r){var a=0;for(var u in r.columns.members)""===r.columns.members[u].memberProperties[0].value&&""===r.columns.members[u].memberProperties[1].value&&(l=!1),a++;if(l){for(var p=0;!s&&p<a;)r.columns.members[p].memberProperties[0].value?s=e.Controls.Extensions.MapDataHelper.getCountryCode(r.columns.members[p].memberProperties[0].value):p++;s?s.done(function(r){i._$elementVectorMap.data("ranetVectorMap").clearError(),c!==r.iso&&(c=r.iso,i._$elementVectorMap.data("ranetVectorMap").drawDetails(c));var a=e.Controls.Extensions.MapDataHelper.parseDataForDetailedMap(t,n,o,c);i._$elementVectorMap.data("ranetVectorMap").option("data",a);var s=e.Controls.Extensions.MapDataHelper.generateGroups(a);i._$elementVectorMap.data("ranetVectorMap").option("groups",s),i._$elementVectorMap.data("ranetVectorMap").option("paletteId",parseInt(n))}):i._$elementVectorMap.data("ranetVectorMap").error(e.Localization.localize("VectorMapMessage_NotDisplayed"))}else e.Controls.Extensions.MapDataHelper.parseDataForMap(t,n,o).done(function(t){c&&i._$elementVectorMap.data("ranetVectorMap").closeDetails(),i._$elementVectorMap.data("ranetVectorMap").option("data",t.data);var o=e.Controls.Extensions.MapDataHelper.generateGroups(t.data);i._$elementVectorMap.data("ranetVectorMap").option("groups",o),i._$elementVectorMap.data("ranetVectorMap").option("paletteId",parseInt(n))})}).fail(function(t){i.visibleBusyIndicator=!1,e.UserMessageService.showServerError(t),e.LogService.error(t)})}else this._$elementVectorMap.data("ranetVectorMap").hide()},pe=function(t){t||(t=this.currentDataSource),this._$elementChart.data("ranetChart").clearError(),this._$elementVectorMap.data("ranetVectorMap").clearError(),this.extensionSettings.extensionType!==e.Controls.Extensions.ExtensionTypes.Chart&&this.extensionSettings.extensionType!==e.Controls.Extensions.ExtensionTypes.Pie||ce.call(this,t),this.extensionSettings.extensionType===e.Controls.Extensions.ExtensionTypes.VectorMap&&ue.call(this,t)};return Object.defineProperty(u.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible=e,this._isVisible?(this._$currentPanel.show(),v.call(this)):this._$currentPanel.hide()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"customPropertiesRows",{get:function(){return void 0===this._customPropertiesRows&&(this._customPropertiesRows={}),this._customPropertiesRows},set:function(e){this._customPropertiesRows=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"customPropertiesColumns",{get:function(){return void 0===this._customPropertiesColumns&&(this._customPropertiesColumns={}),this._customPropertiesColumns},set:function(e){this._customPropertiesColumns=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showMetadataAndQueryDesigner",{get:function(){return this._showMetadataAndQueryDesigner},set:function(e){if(this._showMetadataAndQueryDesigner=e,this._showMetadataAndQueryDesigner){switch(this.placementLayoutModeQueryDesigner){case 0:this._$elementCubeExplorer.show(),this._$elementQueryDesigner.show();break;case 1:this._$queryDesignerAndCubeExplorerPanel.show();break;case 2:this._$elementCubeExplorer.show();break;case 4:case 3:this._$elementQueryDesigner.show()}b.call(this)}else{switch(this.placementLayoutModeQueryDesigner){case 0:this._$elementCubeExplorer.hide(),this._$elementQueryDesigner.hide();break;case 1:this._$queryDesignerAndCubeExplorerPanel.hide();break;case 2:this._$elementCubeExplorer.hide();break;case 4:case 3:this._$elementQueryDesigner.hide()}this._$viewPanel.css("width","99%"),v.call(this)}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isVisibleActiveFilters",{get:function(){return this._isVisibleActiveFilters},set:function(e){this._isVisibleActiveFilters=e,D.call(this),this._$elementActiveFilters.data("ranetActiveFilters").isVisible=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"descriptionActiveFilters",{get:function(){return this._$elementActiveFilters.data("ranetActiveFilters").descriptionActiveFilters},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"placementLayoutModeQueryDesigner",{get:function(){return this._placementLayoutModeQueryDesigner},set:function(e){this._placementLayoutModeQueryDesigner!==e&&(this._placementLayoutModeQueryDesigner=e,T.call(this))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"placementLayoutModeDataViewer",{get:function(){return this._placementLayoutModeDataViewer},set:function(e){var t=this._placementLayoutModeDataViewer;this._placementLayoutModeDataViewer!==e&&(this._placementLayoutModeDataViewer=e,E.call(this),v.call(this),0!==t&&0===e||pe.call(this))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"autoExecuteMdxQuery",{get:function(){return this._autoExecuteMdxQuery},set:function(e){this._autoExecuteMdxQuery=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"rotateAxes",{get:function(){return this._rotateAxes},set:function(t){!0!==t||this.initialSourceType!==g.Query&&!this.isEnabledWhatIfAnalysis?(this._rotateAxes=t,this.updateData()):e.UserMessageService.showInfo(e.Localization.localize("InfoMessage_QueryIsNotRotated"))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"historyManager",{get:function(){return this._historyManager},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"connection",{get:function(){return this._connection},set:function(e){e!==this._connection&&(this._connection=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"loadStateFromHistory",{get:function(){return this._loadStateFromHistory},set:function(e){this._loadStateFromHistory=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"currentMdxQuery",{get:function(){return this._currentMdxQuery},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cubeName",{get:function(){return this._cubeName},set:function(e){e!==this._cubeName&&(this._cubeName=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"messageBusyIndicator",{get:function(){return this._busyIndicatorMessage},set:function(e){this._busyIndicatorMessage=e,this._$elementLoadPanel.data("ranetLoadPanel").option({message:this._busyIndicatorMessage})},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"visibleBusyIndicator",{get:function(){return this._visibleBusyIndicator},set:function(e){this._visibleBusyIndicator=e,this._$elementLoadPanel.data("ranetLoadPanel").option({visible:this._visibleBusyIndicator})},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"layout",{get:function(){var e=this._$elementQueryDesigner.data("ranetQueryDesigner");if(e){var t=e.getLayout();void 0!==t&&(this._layout=t)}return this._layout},set:function(e){e!==this._layout&&(this._layout=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"customCalculatedItems",{get:function(){return this._customCalculatedItems},set:function(e){this._customCalculatedItems=i(e),O.call(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"queryDesignerSetting",{get:function(){return this._queryDesignerSetting},set:function(e){var t=this._queryDesignerSetting;if(this._queryDesignerSetting=e,t.hideEmptyRows!==this._queryDesignerSetting.hideEmptyRows||t.hideEmptyColumns!==this._queryDesignerSetting.hideEmptyColumns){var i=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();q.call(this,i,this.historyManager.getAllActions())}else this.autoExecuteMdxQuery&&this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cubeMetaData",{get:function(){var e=this._$elementCubeExplorer.data("ranetCubeExplorer").getCopyOriginalDataSource();return{measureGroups:e.measureGroups,treeMetadata:e.treeMetadata}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"currentFocusedCell",{get:function(){var e=this._$elementPivotTable.data("pivotTable");if(e)return e.getInfoFocusedCell()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onHistoryChangedCallback",{get:function(){return this._onHistoryChangedCallback},set:function(e){this._onHistoryChangedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"extensionSettings",{get:function(){if(this._$elementChart.data("ranetChart")){this._extensionOptions.chartOptions||(this._extensionOptions.chartOptions={});var e=this._extensionOptions.chartOptions.seriesOptions;this._extensionOptions.chartOptions=$.extend({},this._$elementChart.data("ranetChart").options(),this._extensionOptions.chartOptions),this._extensionOptions.chartOptions.seriesOptions=e,this._extensionOptions.chartOptions.extensionType=this._extensionOptions.extensionType}return this._$elementVectorMap.data("ranetVectorMap")&&(this._extensionOptions.vectorMapSettings||(this._extensionOptions.vectorMapSettings={}),this._extensionOptions.vectorMapSettings.mapOptions=this._$elementVectorMap.data("ranetVectorMap").options()),this._extensionOptions||(this._extensionOptions={}),this._extensionOptions},set:function(t){void 0===t.chartOptions.defaultDiagramType&&(t.chartOptions.defaultDiagramType=2),this._extensionOptions=t;var i=$.extend({},this._extensionOptions);t.extensionType!==e.Controls.Extensions.ExtensionTypes.Chart&&t.extensionType!==e.Controls.Extensions.ExtensionTypes.Pie||(i.chartOptions.dataSource=[]),M.call(this),pe.call(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"currentDataSource",{get:function(){return this._$elementPivotTable.data("pivotTable").currentDataSource},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"customCellsConditions",{get:function(){return this._customCellsConditions||(this._customCellsConditions=[]),this._customCellsConditions},set:function(e){this._customCellsConditions=e,this._$elementPivotTable.data("pivotTable").option({cellConditions:this._customCellsConditions}),this._$elementPivotTable.data("pivotTable").reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isVisibleExtensionPanel",{get:function(){return this._isVisibleExtensionPanel},set:function(e){this._isVisibleExtensionPanel=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"headerText",{get:function(){return void 0!==this._rightExtensionView&&(this._headerText=this._rightExtensionView.headerText),this._headerText},set:function(e){this._headerText=e,void 0!==this._rightExtensionView&&(this._rightExtensionView.headerText=this._headerText)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"footerText",{get:function(){return void 0!==this._rightExtensionView&&(this._footerText=this._rightExtensionView.footerText),this._footerText},set:function(e){this._footerText=e,void 0!==this._rightExtensionView&&(this._rightExtensionView.footerText=this._footerText)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"initialSourceType",{get:function(){return this._initialSourceType},set:function(e){switch(this._initialSourceType=e,this._initialSourceType){case g.Query:this._rotateAxes=!1,this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!1}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!1;break;case g.State:this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!0}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!0;break;default:throw new Error("NotImplementedException")}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"initialQuery",{get:function(){return this._initialQuery},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"selectedMeasureGroupName",{get:function(){return this._selectedMeasureGroupName},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onStateUpdateStorageChangedCallback",{get:function(){return this._onStateUpdateStorageChangedCallback},set:function(e){this._onStateUpdateStorageChangedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isEnabledWhatIfAnalysis",{get:function(){return this._isEnabledWhatIfAnalysis},set:function(e){this._isEnabledWhatIfAnalysis=e,!0===this._isEnabledWhatIfAnalysis?(this._rotateAxes=!1,this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!1}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!1):this.initialSourceType===g.State&&(this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!0}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!0);var t=this;!1===this._isEnabledWhatIfAnalysis?this._updatedCellsStorage.hasServerChanges?this.rollback.call(this).done(function(){t._$elementPivotTable.data("pivotTable").clearLocalChanges(),t._updatedCellsStorage.clearAllChanges(),t.updateData()}):this._updatedCellsStorage.hasLocalChanges?m.call(this):this.updateData():this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"useCustomUpdateScriptTemplate",{get:function(){return this._useCustomUpdateScriptTemplate},set:function(e){this._useCustomUpdateScriptTemplate=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"useChangesCache",{get:function(){return this._useChangesCache},set:function(e){this._useChangesCache=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"currentUpdateScriptTemplate",{get:function(){if(!1===this.useCustomUpdateScriptTemplate){var t=this._$elementPivotTable.data("pivotTable").getAllHierarchies().map(function(e){return e.uniqueName});this._currentUpdateScriptTemplate=e.Controls.UpdateScriptBuilder.getDefaultUpdateScriptTemplate(t)}return this._currentUpdateScriptTemplate},set:function(e){this._currentUpdateScriptTemplate=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"sortingRowsOptions",{get:function(){return this._sortingRowsOptions},set:function(e){this._sortingRowsOptions=e,this._$elementQueryDesigner&&this._$elementQueryDesigner.data("ranetQueryDesigner").option({sortingRowsOptions:this._sortingRowsOptions})},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"sortingColumnsOptions",{get:function(){return this._sortingColumnsOptions},set:function(e){this._sortingColumnsOptions=e,this._$elementQueryDesigner&&this._$elementQueryDesigner.data("ranetQueryDesigner").option({sortingColumnsOptions:this._sortingColumnsOptions})},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"availableSlicers",{get:function(){return this._availableSlicers=this._$elementQueryDesigner.data("ranetQueryDesigner").getAvailableSlicers(),this._availableSlicers},enumerable:!0,configurable:!0}),u.prototype.reset=function(){this.initialSourceType=g.State,this.historyManager.clear();var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();e.rows={},e.columns={},e.filters={},e.data={},this.headerText="",this.footerText="",this.customCalculatedItems=null,this.customCellsConditions=null,this._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:e}),q.call(this,e,this.historyManager.getAllActions()),y.call(this)},u.prototype.removeAllActions=function(){if(this.initialSourceType===g.State){var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();q.call(this,e,[])}else{if(this.initialSourceType!==g.Query)throw new Error("NotImplementationException");U.call(this,this.initialQuery,[])}},u.prototype.init=function(){if(this.isInit)throw new Error("PageDynamicPivotGrid has initialized.");this.isInit=!0,N.call(this),se.call(this),T.call(this),D.call(this),E.call(this),M.call(this),x.call(this),le.call(this)},u.prototype.updateData=function(){var e=this.historyManager.getAllActions();if(this.initialSourceType===g.State){var t=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();A.call(this,t),k.call(this,t,e)}else{if(this.initialSourceType!==g.Query)throw new Error("NotImplementationException");z.call(this,this.currentMdxQuery,e)}},u.prototype.destroy=function(){var e=this._$elementPivotTable.data("pivotTable"),t=this._$elementChart.data("ranetChart"),i=this._$elementLoadPanel.data("ranetLoadPanel");if(!e||!t||!i)throw new Error("Destroy");e.destroy(),t.destroy(),i.destroy(),this._$currentPanel.remove()},u.prototype.setUpInitialQuery=function(t){e.UserActionsTracker.track("Layout -> custom query",{query:t}),this.initialSourceType=g.Query,this.historyManager.clear(),this._$elementPivotTable.data("pivotTable").resetScrolls(),U.call(this,t,[])},u.prototype.setUpInitialCurrentState=function(){e.UserActionsTracker.track("Custom query -> current layout"),this.initialSourceType=g.State,this.historyManager.clear(),q.call(this,this.layout,[])},u.prototype.recalculate=function(){var e=this;p.call(this).done(function(){m.call(e),e.updateData()})},u.prototype.save=function(){var e=this;this._updatedCellsStorage.hasLocalChanges?p.call(this).done(function(){h.call(e).done(function(){e.updateData()})}):h.call(this).done(function(){e.updateData()})},u.prototype.rollback=function(){var e=this;d.call(this).done(function(){m.call(e),e.updateData()})},u.prototype.clearLocalChanges=function(){m.call(this),this.updateData()},u}(Ranet),dynamicPivotGrid=function(e){function t(e){return"["===e[0]&&"]"===e[e.length-1]?e:"["+e+"]"}function i(e){this._$panel=$(e)}function n(e){var t=this._descriptionCurrentPage;this._descriptionCurrentPage=e,this.onPageChangedCallback&&this.onPageChangedCallback(t,e)}function o(i,n,o){var r={header:{title:{text:"",fontSize:24,font:"open sans"}},size:{canvasHeight:400,canvasWidth:400,pieInnerRadius:"0%",pieOuterRadius:"70%"},data:{content:[]},labels:{outer:{format:"label",pieDistance:15,color:"#000000"},inner:{format:"none",hideWhenLessThanPercentage:3},mainLabel:{color:"#fff",fontSize:11},percentage:{color:"#fff",fontSize:9,decimalPlaces:0},value:{color:"#fff",fontSize:11},lines:{enabled:!0},truncation:{enabled:!0,truncateLength:27}},tooltips:{enabled:!0},effects:{load:{effect:"none"},pullOutSegmentOnClick:{effect:"linear",speed:400,size:8}},legend:{visible:!0},callbacks:{},minHeight:200},a={dataSource:[],seriesOptions:[],autogenerate:!0,defaultDiagramType:2,legend:{visible:!0,position:Ranet.Controls.Extensions.LegendPosition.Top},tooltip:{enabled:!0},showArgumentLabels:!0,extensionType:0},s={connection:o,cubeName:t(n.cubeName),autoExecuteMdxQuery:!0,queryDesignerSetting:n.queryDesignerSetting,placementLayoutModeQueryDesigner:0,selectedMeasureGroupName:n.selectedMeasureGroupName,actions:n.actions,initialSourceType:void 0===n.initialSourceType?0:n.initialSourceType,initialQuery:n.initialQuery,loadStateFromHistory:n.loadStateFromHistory,extensionOptions:{},placementLayoutModeDataViewer:n.placementLayoutModeDataViewer||0,isVisibleActiveFilters:n.isVisibleActiveFilters||!1,customCellsConditions:n.customCellsConditions,useCustomUpdateScriptTemplate:n.useCustomUpdateScriptTemplate,useChangesCache:n.useChangesCache,isEnabledWhatIfAnalysis:n.isEnabledWhatIfAnalysis,currentUpdateScriptTemplate:n.currentUpdateScriptTemplate,showMetadataAndQueryDesigner:n.showMetadataAndQueryDesigner,sortingRowsOptions:n.sortingRowsOptions,sortingColumnsOptions:n.sortingColumnsOptions,isVisibleExtensionPanel:n.isVisibleExtensionPanel,headerText:n.headerText,footerText:n.footerText,availableSlicers:n.availableSlicers};if(n.extensionSettings?(s.extensionOptions.chartOptions=n.extensionSettings.chartOptions||a,s.extensionOptions.extensionType=n.extensionSettings.extensionType||0,s.extensionOptions.vectorMapSettings=n.extensionSettings.vectorMapSettings||{dataSettings:{col:0,row:void 0}}):(s.extensionOptions.chartOptions=a,s.extensionOptions.extensionType=0,s.extensionOptions.vectorMapSettings={dataSettings:{col:0,row:void 0}}),s.extensionOptions.chartOptions.pie||(s.extensionOptions.chartOptions.pie=r),n.connection&&(s.connection=n.connection),s.extensionOptions.chartOptions.dataSource=[],void 0!==n.autoExecuteMdxQuery&&(s.autoExecuteMdxQuery=n.autoExecuteMdxQuery),n.placementLayoutModeQueryDesigner&&(s.placementLayoutModeQueryDesigner=n.placementLayoutModeQueryDesigner),void 0!==n.layout){var l=jQuery.extend(!0,{},n.layout);s.layout=l}else s.layout=void 0;s.customCalculatedItems={calculatedMembers:n.calculatedMembers,calculatedNamedSets:n.calculatedNamedSets};var c=new e(i,s);return c.init(),c}Object.defineProperty(i.prototype,"descriptionCurrentPage",{get:function(){if(this._descriptionCurrentPage&&(this._descriptionCurrentPage.page.layout=this._descriptionCurrentPage.view.layout,this._descriptionCurrentPage.page.calculatedNamedSets=this._descriptionCurrentPage.view.customCalculatedItems.calculatedNamedSets,this._descriptionCurrentPage.page.calculatedMembers=this._descriptionCurrentPage.view.customCalculatedItems.calculatedMembers,this._descriptionCurrentPage.page.queryDesignerSetting=this._descriptionCurrentPage.view.queryDesignerSetting,this._descriptionCurrentPage.page.loadStateFromHistory=this._descriptionCurrentPage.view.loadStateFromHistory,this._descriptionCurrentPage.page.placementLayoutModeDataViewer=this._descriptionCurrentPage.view.placementLayoutModeDataViewer,this._descriptionCurrentPage.page.placementLayoutModeQueryDesigner=this._descriptionCurrentPage.view.placementLayoutModeQueryDesigner,this._descriptionCurrentPage.page.isVisibleActiveFilters=this._descriptionCurrentPage.view.isVisibleActiveFilters,this._descriptionCurrentPage.page.customCellsConditions=this._descriptionCurrentPage.view.customCellsConditions,this._descriptionCurrentPage.page.selectedMeasureGroupName=this._descriptionCurrentPage.view.selectedMeasureGroupName,this._descriptionCurrentPage.page.isVisibleExtensionPanel=this._descriptionCurrentPage.view.isVisibleExtensionPanel,this._descriptionCurrentPage.page.headerText=this._descriptionCurrentPage.view.headerText,this._descriptionCurrentPage.page.footerText=this._descriptionCurrentPage.view.footerText,this._descriptionCurrentPage.page.extensionSettings=this._descriptionCurrentPage.view.extensionSettings,this._descriptionCurrentPage.view.loadStateFromHistory)){var e=this._descriptionCurrentPage.view.historyManager.getAllActions();this._descriptionCurrentPage.page.actions=e}return this._descriptionCurrentPage},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onPageChangedCallback",{get:function(){return this._onPageChangedCallback},set:function(e){this._onPageChangedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"report",{get:function(){for(var e=this._mapPages,t=this._currentReport,i=0;i<t.pages.length;i++){var n=t.pages[i];if(delete n.actions,e[n.id]){var o=e[n.id].view;if(n.layout=o.layout,n.calculatedNamedSets=o.customCalculatedItems.calculatedNamedSets,n.calculatedMembers=o.customCalculatedItems.calculatedMembers,n.queryDesignerSetting=o.queryDesignerSetting,n.loadStateFromHistory=o.loadStateFromHistory,n.extensionSettings=o.extensionSettings,n.placementLayoutModeDataViewer=o.placementLayoutModeDataViewer,n.placementLayoutModeQueryDesigner=o.placementLayoutModeQueryDesigner,n.isVisibleActiveFilters=o.isVisibleActiveFilters,n.customCellsConditions=o.customCellsConditions,n.selectedMeasureGroupName=o.selectedMeasureGroupName,n.initialSourceType=o.initialSourceType,n.autoExecuteMdxQuery=o.autoExecuteMdxQuery,n.isEnabledWhatIfAnalysis=o.isEnabledWhatIfAnalysis,n.useCustomUpdateScriptTemplate=o.useCustomUpdateScriptTemplate,n.useChangesCache=o.useChangesCache,n.currentUpdateScriptTemplate=o.currentUpdateScriptTemplate,n.showMetadataAndQueryDesigner=o.showMetadataAndQueryDesigner,n.sortingColumnsOptions=o.sortingColumnsOptions,n.sortingRowsOptions=o.sortingRowsOptions,n.isVisibleExtensionPanel=o.isVisibleExtensionPanel,n.headerText=o.headerText,n.footerText=o.footerText,n.availableSlicers=o.availableSlicers,1===n.initialSourceType&&(!0===n.loadStateFromHistory?n.initialQuery=o.currentMdxQuery:n.initialQuery=o.initialQuery),0===n.initialSourceType&&!0===o.loadStateFromHistory){var r=o.historyManager.getAllActions();n.actions=r}}}return t},enumerable:!0,configurable:!0});var r=function(){var e=this._mapPages;if(e)for(var t in e)e.hasOwnProperty(t)&&e[t].view.destroy();this._mapPages=void 0,this._$panel.empty()};return i.prototype.init=function(e,t){this._currentReport=e,this._connection=t},i.prototype.setPage=function(e){this._mapPages||(this._mapPages={});var t=this._currentReport.pages.filter(function(t){if(t.id===e)return t})[0];if(!t)throw new Error("ArgumentException");var i=this._mapPages[t.id];if(i)this.descriptionCurrentPage.view.isVisible=!1,i.view.isVisible=!0,n.call(this,i);else{this.descriptionCurrentPage&&(this.descriptionCurrentPage.view.isVisible=!1);var r={view:o(this._$panel,t,this._connection),page:t};this._mapPages[t.id]=r,n.call(this,r)}},i.prototype.deletePage=function(e){var t=this._mapPages[e.id];if(t&&(t.view.destroy(),delete this._mapPages[e.id]),Ranet.Utility.ArrayUtility.removeItem(this._currentReport.pages,e),0!==this._currentReport.pages.length){if(this.descriptionCurrentPage.page===e){var i=this._currentReport.pages[this._currentReport.pages.length-1];this.setPage(i.id)}}else n.call(this,void 0)},i.prototype.destroy=function(){r.call(this)},i}(pageDynamicPivotGrid);!function(e,t,i){e&&e.module("ranet",[]).directive("ranetDynamicPivotgrid",["$parse","appConfig",function(e,n){return{restrict:"A",link:function(o,r,a){var s=e(a.oncreaterefcontrol),l=a.pathresource,c=a.applicationurl;i.PathManager.resourcePath=l,i.PathManager.applicationUrl=c;var u=new t(r);u.placementLayoutModeQueryDesigner=n.placementLayoutModeQueryDesigner,s(o,{referenceControl:u})}}}])}(window.angular,dynamicPivotGrid,Ranet),function(e,t,i){e.ranetPivotMdxDesigner=function(n,o){var r={locale:"en",applicationUrl:"",templatesPath:"assets/templates/",autoExecuteQuery:!0,placementLayoutModeDataViewer:0,placementLayoutModeQueryDesigner:0,autoExecuteMdxQuery:!0,loadStateFromHistory:!1,showMetadataAndQueryDesigner:!0,isVisibleActiveFilters:!1,initialSourceType:0},a={rows:[],columns:[],data:[],filters:[]},s={generateCustomCalculated:!1,hideEmptyColumns:!0,hideEmptyRows:!0,includeAllMembers:!1,includeCustomCalculationsInDrillDown:!1,subsetCount:0,useVisualTotals:!0},l=this;l.settings={};var c;Object.defineProperty(l,"currentMdxQuery",{get:function(){return c.currentMdxQuery},enumerable:!0,configurable:!0}),Object.defineProperty(l,"currentFocusedCell",{get:function(){return c.currentFocusedCell},enumerable:!0,configurable:!0}),Object.defineProperty(l,"historyManager",{get:function(){return c.historyManager},enumerable:!0,configurable:!0}),Object.defineProperty(l,"showMetadataAndQueryDesigner",{get:function(){return c.showMetadataAndQueryDesigner},set:function(e){c.showMetadataAndQueryDesigner=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"placementLayoutModeQueryDesigner",{get:function(){return c.placementLayoutModeQueryDesigner},set:function(e){c.placementLayoutModeQueryDesigner=e},enumerable:!0,configurable:!0}),this.updateData=function(){c&&c.updateData()};!function(){l.settings=e.extend({},r,o);var u=e.extend({},a,o.layout);l.settings.layout=u;var p=e.extend({},s,o.queryDesignerSetting);if(l.settings.queryDesignerSetting=p,i.PathManager.applicationUrl=l.settings.applicationUrl,i.PathManager.resourcePath=l.settings.resourcePath,i.Localization.isInit)(c=new t(n,l.settings)).init();else{var h=new i.Controls.LoadPanel(n,{visible:!0,position:{of:window}});i.Localization.init(l.settings.applicationUrl,l.settings.resourcePath,l.settings.locale).done(function(){(c=new t(n,l.settings)).init()}).always(function(){h.visible=!1})}}()},e.fn.ranetPivotMdxDesigner=function(t){return this.each(function(){if(void 0==e(this).data("ranetPivotMdxDesigner")){var i=new e.ranetPivotMdxDesigner(this,t);e(this).data("ranetPivotMdxDesigner",i)}})}}(jQuery,pageDynamicPivotGrid,Ranet),function(e,t,i){e.ranetDynamicPivotGrid=function(n,o){var r={locale:"en",applicationUrl:"",templatesPath:"assets/templates/"},a={autoExecuteQuery:!0,placementLayoutModeDataViewer:0,placementLayoutModeQueryDesigner:0,autoExecuteMdxQuery:!0,loadStateFromHistory:!1,showMetadataAndQueryDesigner:!0},s={rows:[],columns:[],data:[],filters:[]},l={generateCustomCalculated:!1,hideEmptyColumns:!0,hideEmptyRows:!0,includeAllMembers:!1,includeCustomCalculationsInDrillDown:!1,subsetCount:0,useVisualTotals:!0},c={chartOptions:{dataSource:[],seriesOptions:[],autogenerate:!1,defaultDiagramType:2,legend:{visible:!0,position:i.Controls.Extensions.LegendPosition.Bottom},tooltip:{enabled:!0,font:{family:"Courier New"},customizeTooltip:function(){var e="<span style='color:"+this.point.color+";font-size:18px;'>&#9632;</span> ";return e+=this.point.name+"  "+this.point.displayValue}},styling:{paddingLeft:60,paddingRight:0,paddingTop:10,paddingBottom:25},showArgumentLabels:!0},vectorMapOptions:{data:{},groups:[]}},u=this;u.settings={};var p;this.setPage=function(e){p.setPage(e)};!function(){if(!o.pages)throw new Error("Not found pages of report");if(!o.idDefaultPage)throw new Error("Not found ID default page");u.settings=e.extend({},r,o);for(var h=0;h<o.pages.length;h++){var d=o.pages[h];d.calculatedMembers&&(o.pages[h].calculatedMembers=d.calculatedMembers),d.calculatedNamedSets&&(o.pages[h].calculatedNamedSets=d.calculatedNamedSets),o.pages[h]=e.extend({},a,d),o.pages[h].layout=e.extend({},s,d.layout),o.pages[h].queryDesignerSetting=e.extend({},l,d.queryDesignerSetting),o.pages[h].extensionSettings=e.extend({},c,d.extensionSettings)}var m=u.settings.connection,f=u.settings.locale,g=u.settings.applicationUrl;if(i.PathManager.applicationUrl=g,i.PathManager.resourcePath=u.settings.resourcePath,delete u.settings.connection,delete u.settings.locale,i.Localization.isInit)(p=new t(n)).init(u.settings,m),p.setPage(o.idDefaultPage);else{var _=new i.Controls.LoadPanel(n,{visible:!0,position:{of:window}});i.Localization.init(g,u.settings.resourcePath,f).done(function(){(p=new t(n)).init(u.settings,m),p.setPage(o.idDefaultPage)}).always(function(){_.visible=!1})}}()},e.fn.ranetDynamicPivotGrid=function(t){return this.each(function(){if(void 0==e(this).data("ranetDynamicPivotGrid")){var i=new e.ranetDynamicPivotGrid(this,t);e(this).data("ranetDynamicPivotGrid",i)}})}}(jQuery,dynamicPivotGrid,Ranet);
(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
	for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("5805549aa622cd3d70a7404b0aa0b839");